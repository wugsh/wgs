cscope 15 $HOME/wgs/Open-source/Micrium/Software/uCOS-III/Source               0000255384
	@os.h

36 #iâdeà 
OS_H


37 
	#OS_H


	)

45 
	#OS_VERSION
 30300u

	)

53 #ifdeà
__ýlu¥lus


59 
	~<os_cfg.h
>

60 
	~<ýu.h
>

61 
	~<ýu_cÜe.h
>

62 
	~<lib_def.h
>

63 
	~<os_ty³.h
>

64 
	~<os_ýu.h
>

74 #ià 
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u && 
defšed
(
CPU_CFG_INT_DIS_MEAS_EN
)

75 
	#OS_SCHED_LOCK_TIME_MEAS_START
(è
	`OS_SchedLockTimeM—sS¹
()

	)

77 
	#OS_SCHED_LOCK_TIME_MEAS_START
()

	)

81 #ià 
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u && 
defšed
(
CPU_CFG_INT_DIS_MEAS_EN
)

82 
	#OS_SCHED_LOCK_TIME_MEAS_STOP
(è
	`OS_SchedLockTimeM—sStÝ
()

	)

84 
	#OS_SCHED_LOCK_TIME_MEAS_STOP
()

	)

87 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

89 
	#OS_CRITICAL_ENTER
(è\

	)

91 
CPU_CRITICAL_ENTER
(); \

92 
OSSchedLockNe¡šgCŒ
++; \

93 ià(
OSSchedLockNe¡šgCŒ
 == 1u) { \

94 
OS_SCHED_LOCK_TIME_MEAS_START
(); \

96 
CPU_CRITICAL_EXIT
(); \

99 
	#OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
(è\

	)

101 
OSSchedLockNe¡šgCŒ
++; \

103 ià(
OSSchedLockNe¡šgCŒ
 == 1u) { \

104 
OS_SCHED_LOCK_TIME_MEAS_START
(); \

106 
CPU_CRITICAL_EXIT
(); \

110 
	#OS_CRITICAL_EXIT
(è\

	)

112 
CPU_CRITICAL_ENTER
(); \

113 
OSSchedLockNe¡šgCŒ
--; \

114 ià(
OSSchedLockNe¡šgCŒ
 =ð(
OS_NESTING_CTR
)0) { \

115 
OS_SCHED_LOCK_TIME_MEAS_STOP
(); \

116 ià(
OSIÁQNbrEÁr›s
 > (
OS_OBJ_QTY
)0) { \

117 
CPU_CRITICAL_EXIT
(); \

118 
OS_Sched0
(); \

120 
CPU_CRITICAL_EXIT
(); \

123 
CPU_CRITICAL_EXIT
(); \

127 
	#OS_CRITICAL_EXIT_NO_SCHED
(è\

	)

129 
CPU_CRITICAL_ENTER
(); \

130 
OSSchedLockNe¡šgCŒ
--; \

131 ià(
OSSchedLockNe¡šgCŒ
 =ð(
OS_NESTING_CTR
)0) { \

132 
OS_SCHED_LOCK_TIME_MEAS_STOP
(); \

134 
CPU_CRITICAL_EXIT
(); \

141 
	#OS_CRITICAL_ENTER
(è
	`CPU_CRITICAL_ENTER
()

	)

143 
	#OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
()

	)

145 
	#OS_CRITICAL_EXIT
(è
	`CPU_CRITICAL_EXIT
()

	)

147 
	#OS_CRITICAL_EXIT_NO_SCHED
(è
	`CPU_CRITICAL_EXIT
()

	)

157 #ifdeà 
OS_GLOBALS


158 
	#OS_EXT


	)

160 
	#OS_EXT
 

	)

164 
	#OS_PRIO_TBL_SIZE
 (((
OS_CFG_PRIO_MAX
 - 1uè/ 
DEF_INT_CPU_NBR_BITS
è+ 1u)

	)

166 
	#OS_MSG_EN
 (((
OS_CFG_TASK_Q_EN
 > 0uè|| (
OS_CFG_Q_EN
 > 0u)è? 1u : 0u)

	)

183 
	#OS_STATE_OS_STOPPED
 (
OS_STATE
)(0u)

	)

184 
	#OS_STATE_OS_RUNNING
 (
OS_STATE
)(1u)

	)

186 
	#OS_STATE_NOT_RDY
 (
CPU_BOOLEAN
)(0u)

	)

187 
	#OS_STATE_RDY
 (
CPU_BOOLEAN
)(1u)

	)

191 
	#OS_TASK_STATE_BIT_DLY
 (
OS_STATE
)(0x01uè

	)

193 
	#OS_TASK_STATE_BIT_PEND
 (
OS_STATE
)(0x02uè

	)

195 
	#OS_TASK_STATE_BIT_SUSPENDED
 (
OS_STATE
)(0x04uè

	)

199 
	#OS_TASK_STATE_RDY
 (
OS_STATE
)Ð0uè

	)

200 
	#OS_TASK_STATE_DLY
 (
OS_STATE
)Ð1uè

	)

201 
	#OS_TASK_STATE_PEND
 (
OS_STATE
)Ð2uè

	)

202 
	#OS_TASK_STATE_PEND_TIMEOUT
 (
OS_STATE
)Ð3uè

	)

203 
	#OS_TASK_STATE_SUSPENDED
 (
OS_STATE
)Ð4uè

	)

204 
	#OS_TASK_STATE_DLY_SUSPENDED
 (
OS_STATE
)Ð5uè

	)

205 
	#OS_TASK_STATE_PEND_SUSPENDED
 (
OS_STATE
)Ð6uè

	)

206 
	#OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
 (
OS_STATE
)Ð7uè

	)

207 
	#OS_TASK_STATE_DEL
 (
OS_STATE
)(255u)

	)

210 
	#OS_TASK_PEND_ON_NOTHING
 (
OS_STATE
)Ð0uè

	)

211 
	#OS_TASK_PEND_ON_FLAG
 (
OS_STATE
)Ð1uè

	)

212 
	#OS_TASK_PEND_ON_TASK_Q
 (
OS_STATE
)Ð2uè

	)

213 
	#OS_TASK_PEND_ON_MULTI
 (
OS_STATE
)Ð3uè

	)

214 
	#OS_TASK_PEND_ON_MUTEX
 (
OS_STATE
)Ð4uè

	)

215 
	#OS_TASK_PEND_ON_Q
 (
OS_STATE
)Ð5uè

	)

216 
	#OS_TASK_PEND_ON_SEM
 (
OS_STATE
)Ð6uè

	)

217 
	#OS_TASK_PEND_ON_TASK_SEM
 (
OS_STATE
)Ð7uè

	)

226 
	#OS_STATUS_PEND_OK
 (
OS_STATUS
)Ð0uè

	)

227 
	#OS_STATUS_PEND_ABORT
 (
OS_STATUS
)Ð1uè

	)

228 
	#OS_STATUS_PEND_DEL
 (
OS_STATUS
)Ð2uè

	)

229 
	#OS_STATUS_PEND_TIMEOUT
 (
OS_STATUS
)Ð3uè

	)

241 
	#OS_OBJ_TYPE_NONE
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('N', 'O', 'N', 'E')

	)

242 
	#OS_OBJ_TYPE_FLAG
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('F', 'L', 'A', 'G')

	)

243 
	#OS_OBJ_TYPE_MEM
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('M', 'E', 'M', ' ')

	)

244 
	#OS_OBJ_TYPE_MUTEX
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('M', 'U', 'T', 'X')

	)

245 
	#OS_OBJ_TYPE_Q
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('Q', 'U', 'E', 'U')

	)

246 
	#OS_OBJ_TYPE_SEM
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('S', 'E', 'M', 'A')

	)

247 
	#OS_OBJ_TYPE_TASK_MSG
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('T', 'M', 'S', 'G')

	)

248 
	#OS_OBJ_TYPE_TASK_RESUME
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('T', 'R', 'E', 'S')

	)

249 
	#OS_OBJ_TYPE_TASK_SIGNAL
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('T', 'S', 'I', 'G')

	)

250 
	#OS_OBJ_TYPE_TASK_SUSPEND
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('T', 'S', 'U', 'S')

	)

251 
	#OS_OBJ_TYPE_TICK
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('T', 'I', 'C', 'K')

	)

252 
	#OS_OBJ_TYPE_TMR
 (
OS_OBJ_TYPE
)
	`CPU_TYPE_CREATE
('T', 'M', 'R', ' ')

	)

260 
	#OS_OPT_NONE
 (
OS_OPT
)(0x0000u)

	)

268 
	#OS_OPT_DEL_NO_PEND
 (
OS_OPT
)(0x0000u)

	)

269 
	#OS_OPT_DEL_ALWAYS
 (
OS_OPT
)(0x0001u)

	)

277 
	#OS_OPT_PEND_FLAG_MASK
 (
OS_OPT
)(0x000Fu)

	)

278 
	#OS_OPT_PEND_FLAG_CLR_ALL
 (
OS_OPT
)(0x0001uè

	)

279 
	#OS_OPT_PEND_FLAG_CLR_AND
 (
OS_OPT
)(0x0001u)

	)

281 
	#OS_OPT_PEND_FLAG_CLR_ANY
 (
OS_OPT
)(0x0002uè

	)

282 
	#OS_OPT_PEND_FLAG_CLR_OR
 (
OS_OPT
)(0x0002u)

	)

284 
	#OS_OPT_PEND_FLAG_SET_ALL
 (
OS_OPT
)(0x0004uè

	)

285 
	#OS_OPT_PEND_FLAG_SET_AND
 (
OS_OPT
)(0x0004u)

	)

287 
	#OS_OPT_PEND_FLAG_SET_ANY
 (
OS_OPT
)(0x0008uè

	)

288 
	#OS_OPT_PEND_FLAG_SET_OR
 (
OS_OPT
)(0x0008u)

	)

290 
	#OS_OPT_PEND_FLAG_CONSUME
 (
OS_OPT
)(0x0100uè

	)

293 
	#OS_OPT_PEND_BLOCKING
 (
OS_OPT
)(0x0000u)

	)

294 
	#OS_OPT_PEND_NON_BLOCKING
 (
OS_OPT
)(0x8000u)

	)

302 
	#OS_OPT_PEND_ABORT_1
 (
OS_OPT
)(0x0000uè

	)

303 
	#OS_OPT_PEND_ABORT_ALL
 (
OS_OPT
)(0x0100uè

	)

312 
	#OS_OPT_POST_NONE
 (
OS_OPT
)(0x0000u)

	)

314 
	#OS_OPT_POST_FLAG_SET
 (
OS_OPT
)(0x0000u)

	)

315 
	#OS_OPT_POST_FLAG_CLR
 (
OS_OPT
)(0x0001u)

	)

317 
	#OS_OPT_POST_FIFO
 (
OS_OPT
)(0x0000uè

	)

318 
	#OS_OPT_POST_LIFO
 (
OS_OPT
)(0x0010uè

	)

319 
	#OS_OPT_POST_1
 (
OS_OPT
)(0x0000uè

	)

320 
	#OS_OPT_POST_ALL
 (
OS_OPT
)(0x0200uè

	)

322 
	#OS_OPT_POST_NO_SCHED
 (
OS_OPT
)(0x8000uè

	)

330 
	#OS_OPT_TASK_NONE
 (
OS_OPT
)(0x0000uè

	)

331 
	#OS_OPT_TASK_STK_CHK
 (
OS_OPT
)(0x0001uè

	)

332 
	#OS_OPT_TASK_STK_CLR
 (
OS_OPT
)(0x0002uè

	)

333 
	#OS_OPT_TASK_SAVE_FP
 (
OS_OPT
)(0x0004uè

	)

334 
	#OS_OPT_TASK_NO_TLS
 (
OS_OPT
)(0x0008uè

	)

342 
	#OS_OPT_TIME_DLY
 
DEF_BIT_NONE


	)

343 
	#OS_OPT_TIME_TIMEOUT
 ((
OS_OPT
)
DEF_BIT_01
)

	)

344 
	#OS_OPT_TIME_MATCH
 ((
OS_OPT
)
DEF_BIT_02
)

	)

345 
	#OS_OPT_TIME_PERIODIC
 ((
OS_OPT
)
DEF_BIT_03
)

	)

347 
	#OS_OPT_TIME_HMSM_STRICT
 ((
OS_OPT
)
DEF_BIT_NONE
)

	)

348 
	#OS_OPT_TIME_HMSM_NON_STRICT
 ((
OS_OPT
)
DEF_BIT_04
)

	)

350 
	#OS_OPT_TIME_MASK
 ((
OS_OPT
)(
OS_OPT_TIME_DLY
 | \

	)

351 
OS_OPT_TIME_TIMEOUT
 | \

352 
OS_OPT_TIME_PERIODIC
 | \

353 
OS_OPT_TIME_MATCH
))

355 
	#OS_OPT_TIME_OPTS_MASK
 (
OS_OPT_TIME_DLY
 | \

	)

356 
OS_OPT_TIME_TIMEOUT
 | \

357 
OS_OPT_TIME_PERIODIC
 | \

358 
OS_OPT_TIME_MATCH
 | \

359 
OS_OPT_TIME_HMSM_NON_STRICT
)

367 
	#OS_OPT_TMR_NONE
 (
OS_OPT
)(0uè

	)

369 
	#OS_OPT_TMR_ONE_SHOT
 (
OS_OPT
)(1uè

	)

370 
	#OS_OPT_TMR_PERIODIC
 (
OS_OPT
)(2uè

	)

372 
	#OS_OPT_TMR_CALLBACK
 (
OS_OPT
)(3uè

	)

373 
	#OS_OPT_TMR_CALLBACK_ARG
 (
OS_OPT
)(4uè

	)

381 
	#OS_TMR_STATE_UNUSED
 (
OS_STATE
)(0u)

	)

382 
	#OS_TMR_STATE_STOPPED
 (
OS_STATE
)(1u)

	)

383 
	#OS_TMR_STATE_RUNNING
 (
OS_STATE
)(2u)

	)

384 
	#OS_TMR_STATE_COMPLETED
 (
OS_STATE
)(3u)

	)

392 
	#OS_PRIO_INIT
 (
OS_PRIO
)(
OS_CFG_PRIO_MAX
)

	)

400 
	#OS_TICK_TH_INIT
 (
OS_TICK
)(
	`DEF_BIT
 (((OS_TICKè* 
DEF_OCTET_NBR_BITS
è- 1u))

	)

403 
	#OS_TICK_TH_RDY
 (
OS_TICK
)(
	`DEF_BIT_FIELD
((((OS_TICKè* 
DEF_OCTET_NBR_BITS
è/ 2u), \

	)

404 (((
OS_TICK
è* 
DEF_OCTET_NBR_BITS
) / 2u)))

421 
	eos_”r
 {

422 
OS_ERR_NONE
 = 0u,

424 
OS_ERR_A
 = 10000u,

425 
OS_ERR_ACCEPT_ISR
 = 10001u,

427 
OS_ERR_B
 = 11000u,

429 
OS_ERR_C
 = 12000u,

430 
OS_ERR_CREATE_ISR
 = 12001u,

432 
OS_ERR_D
 = 13000u,

433 
OS_ERR_DEL_ISR
 = 13001u,

435 
OS_ERR_E
 = 14000u,

437 
OS_ERR_F
 = 15000u,

438 
OS_ERR_FATAL_RETURN
 = 15001u,

440 
OS_ERR_FLAG_GRP_DEPLETED
 = 15101u,

441 
OS_ERR_FLAG_NOT_RDY
 = 15102u,

442 
OS_ERR_FLAG_PEND_OPT
 = 15103u,

443 
OS_ERR_FLUSH_ISR
 = 15104u,

445 
OS_ERR_G
 = 16000u,

447 
OS_ERR_H
 = 17000u,

449 
OS_ERR_I
 = 18000u,

450 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
 = 18001u,

451 
OS_ERR_INT_Q
 = 18002u,

452 
OS_ERR_INT_Q_FULL
 = 18003u,

453 
OS_ERR_INT_Q_SIZE
 = 18004u,

454 
OS_ERR_INT_Q_STK_INVALID
 = 18005u,

455 
OS_ERR_INT_Q_STK_SIZE_INVALID
 = 18006u,

457 
OS_ERR_J
 = 19000u,

459 
OS_ERR_K
 = 20000u,

461 
OS_ERR_L
 = 21000u,

462 
OS_ERR_LOCK_NESTING_OVF
 = 21001u,

464 
OS_ERR_M
 = 22000u,

466 
OS_ERR_MEM_CREATE_ISR
 = 22201u,

467 
OS_ERR_MEM_FULL
 = 22202u,

468 
OS_ERR_MEM_INVALID_P_ADDR
 = 22203u,

469 
OS_ERR_MEM_INVALID_BLKS
 = 22204u,

470 
OS_ERR_MEM_INVALID_PART
 = 22205u,

471 
OS_ERR_MEM_INVALID_P_BLK
 = 22206u,

472 
OS_ERR_MEM_INVALID_P_MEM
 = 22207u,

473 
OS_ERR_MEM_INVALID_P_DATA
 = 22208u,

474 
OS_ERR_MEM_INVALID_SIZE
 = 22209u,

475 
OS_ERR_MEM_NO_FREE_BLKS
 = 22210u,

477 
OS_ERR_MSG_POOL_EMPTY
 = 22301u,

478 
OS_ERR_MSG_POOL_NULL_PTR
 = 22302u,

480 
OS_ERR_MUTEX_NOT_OWNER
 = 22401u,

481 
OS_ERR_MUTEX_OWNER
 = 22402u,

482 
OS_ERR_MUTEX_NESTING
 = 22403u,

484 
OS_ERR_N
 = 23000u,

485 
OS_ERR_NAME
 = 23001u,

486 
OS_ERR_NO_MORE_ID_AVAIL
 = 23002u,

488 
OS_ERR_O
 = 24000u,

489 
OS_ERR_OBJ_CREATED
 = 24001u,

490 
OS_ERR_OBJ_DEL
 = 24002u,

491 
OS_ERR_OBJ_PTR_NULL
 = 24003u,

492 
OS_ERR_OBJ_TYPE
 = 24004u,

494 
OS_ERR_OPT_INVALID
 = 24101u,

496 
OS_ERR_OS_NOT_RUNNING
 = 24201u,

497 
OS_ERR_OS_RUNNING
 = 24202u,

499 
OS_ERR_P
 = 25000u,

500 
OS_ERR_PEND_ABORT
 = 25001u,

501 
OS_ERR_PEND_ABORT_ISR
 = 25002u,

502 
OS_ERR_PEND_ABORT_NONE
 = 25003u,

503 
OS_ERR_PEND_ABORT_SELF
 = 25004u,

504 
OS_ERR_PEND_DEL
 = 25005u,

505 
OS_ERR_PEND_ISR
 = 25006u,

506 
OS_ERR_PEND_LOCKED
 = 25007u,

507 
OS_ERR_PEND_WOULD_BLOCK
 = 25008u,

509 
OS_ERR_POST_NULL_PTR
 = 25101u,

510 
OS_ERR_POST_ISR
 = 25102u,

512 
OS_ERR_PRIO_EXIST
 = 25201u,

513 
OS_ERR_PRIO
 = 25202u,

514 
OS_ERR_PRIO_INVALID
 = 25203u,

516 
OS_ERR_PTR_INVALID
 = 25301u,

518 
OS_ERR_Q
 = 26000u,

519 
OS_ERR_Q_FULL
 = 26001u,

520 
OS_ERR_Q_EMPTY
 = 26002u,

521 
OS_ERR_Q_MAX
 = 26003u,

522 
OS_ERR_Q_SIZE
 = 26004u,

524 
OS_ERR_R
 = 27000u,

525 
OS_ERR_REG_ID_INVALID
 = 27001u,

526 
OS_ERR_ROUND_ROBIN_1
 = 27002u,

527 
OS_ERR_ROUND_ROBIN_DISABLED
 = 27003u,

529 
OS_ERR_S
 = 28000u,

530 
OS_ERR_SCHED_INVALID_TIME_SLICE
 = 28001u,

531 
OS_ERR_SCHED_LOCK_ISR
 = 28002u,

532 
OS_ERR_SCHED_LOCKED
 = 28003u,

533 
OS_ERR_SCHED_NOT_LOCKED
 = 28004u,

534 
OS_ERR_SCHED_UNLOCK_ISR
 = 28005u,

536 
OS_ERR_SEM_OVF
 = 28101u,

537 
OS_ERR_SET_ISR
 = 28102u,

539 
OS_ERR_STAT_RESET_ISR
 = 28201u,

540 
OS_ERR_STAT_PRIO_INVALID
 = 28202u,

541 
OS_ERR_STAT_STK_INVALID
 = 28203u,

542 
OS_ERR_STAT_STK_SIZE_INVALID
 = 28204u,

543 
OS_ERR_STATE_INVALID
 = 28205u,

544 
OS_ERR_STATUS_INVALID
 = 28206u,

545 
OS_ERR_STK_INVALID
 = 28207u,

546 
OS_ERR_STK_SIZE_INVALID
 = 28208u,

547 
OS_ERR_STK_LIMIT_INVALID
 = 28209u,

549 
OS_ERR_T
 = 29000u,

550 
OS_ERR_TASK_CHANGE_PRIO_ISR
 = 29001u,

551 
OS_ERR_TASK_CREATE_ISR
 = 29002u,

552 
OS_ERR_TASK_DEL
 = 29003u,

553 
OS_ERR_TASK_DEL_IDLE
 = 29004u,

554 
OS_ERR_TASK_DEL_INVALID
 = 29005u,

555 
OS_ERR_TASK_DEL_ISR
 = 29006u,

556 
OS_ERR_TASK_INVALID
 = 29007u,

557 
OS_ERR_TASK_NO_MORE_TCB
 = 29008u,

558 
OS_ERR_TASK_NOT_DLY
 = 29009u,

559 
OS_ERR_TASK_NOT_EXIST
 = 29010u,

560 
OS_ERR_TASK_NOT_SUSPENDED
 = 29011u,

561 
OS_ERR_TASK_OPT
 = 29012u,

562 
OS_ERR_TASK_RESUME_ISR
 = 29013u,

563 
OS_ERR_TASK_RESUME_PRIO
 = 29014u,

564 
OS_ERR_TASK_RESUME_SELF
 = 29015u,

565 
OS_ERR_TASK_RUNNING
 = 29016u,

566 
OS_ERR_TASK_STK_CHK_ISR
 = 29017u,

567 
OS_ERR_TASK_SUSPENDED
 = 29018u,

568 
OS_ERR_TASK_SUSPEND_IDLE
 = 29019u,

569 
OS_ERR_TASK_SUSPEND_INT_HANDLER
 = 29020u,

570 
OS_ERR_TASK_SUSPEND_ISR
 = 29021u,

571 
OS_ERR_TASK_SUSPEND_PRIO
 = 29022u,

572 
OS_ERR_TASK_WAITING
 = 29023u,

574 
OS_ERR_TCB_INVALID
 = 29101u,

576 
OS_ERR_TLS_ID_INVALID
 = 29120u,

577 
OS_ERR_TLS_ISR
 = 29121u,

578 
OS_ERR_TLS_NO_MORE_AVAIL
 = 29122u,

579 
OS_ERR_TLS_NOT_EN
 = 29123u,

580 
OS_ERR_TLS_DESTRUCT_ASSIGNED
 = 29124u,

582 
OS_ERR_TICK_PRIO_INVALID
 = 29201u,

583 
OS_ERR_TICK_STK_INVALID
 = 29202u,

584 
OS_ERR_TICK_STK_SIZE_INVALID
 = 29203u,

585 
OS_ERR_TICK_WHEEL_SIZE
 = 29204u,

587 
OS_ERR_TIME_DLY_ISR
 = 29301u,

588 
OS_ERR_TIME_DLY_RESUME_ISR
 = 29302u,

589 
OS_ERR_TIME_GET_ISR
 = 29303u,

590 
OS_ERR_TIME_INVALID_HOURS
 = 29304u,

591 
OS_ERR_TIME_INVALID_MINUTES
 = 29305u,

592 
OS_ERR_TIME_INVALID_SECONDS
 = 29306u,

593 
OS_ERR_TIME_INVALID_MILLISECONDS
 = 29307u,

594 
OS_ERR_TIME_NOT_DLY
 = 29308u,

595 
OS_ERR_TIME_SET_ISR
 = 29309u,

596 
OS_ERR_TIME_ZERO_DLY
 = 29310u,

598 
OS_ERR_TIMEOUT
 = 29401u,

600 
OS_ERR_TMR_INACTIVE
 = 29501u,

601 
OS_ERR_TMR_INVALID_DEST
 = 29502u,

602 
OS_ERR_TMR_INVALID_DLY
 = 29503u,

603 
OS_ERR_TMR_INVALID_PERIOD
 = 29504u,

604 
OS_ERR_TMR_INVALID_STATE
 = 29505u,

605 
OS_ERR_TMR_INVALID
 = 29506u,

606 
OS_ERR_TMR_ISR
 = 29507u,

607 
OS_ERR_TMR_NO_CALLBACK
 = 29508u,

608 
OS_ERR_TMR_NON_AVAIL
 = 29509u,

609 
OS_ERR_TMR_PRIO_INVALID
 = 29510u,

610 
OS_ERR_TMR_STK_INVALID
 = 29511u,

611 
OS_ERR_TMR_STK_SIZE_INVALID
 = 29512u,

612 
OS_ERR_TMR_STOPPED
 = 29513u,

614 
OS_ERR_U
 = 30000u,

616 
OS_ERR_V
 = 31000u,

618 
OS_ERR_W
 = 32000u,

620 
OS_ERR_X
 = 33000u,

622 
OS_ERR_Y
 = 34000u,

623 
OS_ERR_YIELD_ISR
 = 34001u,

625 
OS_ERR_Z
 = 35000u

626 } 
	tOS_ERR
;

638 
os_æag_g½
 
	tOS_FLAG_GRP
;

640 
os_mem
 
	tOS_MEM
;

642 
os_msg
 
	tOS_MSG
;

643 
os_msg_poÞ
 
	tOS_MSG_POOL
;

644 
os_msg_q
 
	tOS_MSG_Q
;

646 
os_mu‹x
 
	tOS_MUTEX
;

648 
os_št_q
 
	tOS_INT_Q
;

650 
os_q
 
	tOS_Q
;

652 
os_£m
 
	tOS_SEM
;

654 (*
	gOS_TASK_PTR
)(*
	tp_¬g
);

656 
os_tcb
 
	tOS_TCB
;

658 #ià
defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

659 *
	tOS_TLS
;

661 
CPU_DATA
 
	tOS_TLS_ID
;

663 (*
	gOS_TLS_DESTRUCT_PTR
)(
	tOS_TCB
 *
	tp_tcb
,

664 
	tOS_TLS_ID
 
	tid
,

665 
	tOS_TLS
 
	tv®ue
);

668 
os_rdy_li¡
 
	tOS_RDY_LIST
;

670 
os_tick_¥oke
 
	tOS_TICK_SPOKE
;

672 (*
	gOS_TMR_CALLBACK_PTR
)(*
	tp_tmr
, *
	tp_¬g
);

673 
os_tmr
 
	tOS_TMR
;

674 
os_tmr_¥oke
 
	tOS_TMR_SPOKE
;

677 
os_³nd_d©a
 
	tOS_PEND_DATA
;

678 
os_³nd_li¡
 
	tOS_PEND_LIST
;

679 
os_³nd_obj
 
	tOS_PEND_OBJ
;

681 #ià
OS_CFG_APP_HOOKS_EN
 > 0u

682 (*
	gOS_APP_HOOK_VOID
)();

683 (*
	gOS_APP_HOOK_TCB
)(
	tOS_TCB
 *
	tp_tcb
);

701 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

702 
	sos_št_q
 {

703 
OS_OBJ_TYPE
 
	gTy³
;

704 
OS_INT_Q
 *
	gNextPŒ
;

705 *
	gObjPŒ
;

706 *
	gMsgPŒ
;

707 
OS_MSG_SIZE
 
	gMsgSize
;

708 
OS_FLAGS
 
	gFÏgs
;

709 
OS_OPT
 
	gO±
;

710 
CPU_TS
 
	gTS
;

720 
	sos_rdy_li¡
 {

721 
OS_TCB
 *
	gH—dPŒ
;

722 
OS_TCB
 *
	gTažPŒ
;

723 
OS_OBJ_QTY
 
	gNbrEÁr›s
;

733 
	sos_³nd_d©a
 {

734 
OS_PEND_DATA
 *
	gP»vPŒ
;

735 
OS_PEND_DATA
 *
	gNextPŒ
;

736 
OS_TCB
 *
	gTCBPŒ
;

737 
OS_PEND_OBJ
 *
	gP’dObjPŒ
;

738 
OS_PEND_OBJ
 *
	gRdyObjPŒ
;

739 *
	gRdyMsgPŒ
;

740 
OS_MSG_SIZE
 
	gRdyMsgSize
;

741 
CPU_TS
 
	gRdyTS
;

745 
	sos_³nd_li¡
 {

746 
OS_PEND_DATA
 *
	gH—dPŒ
;

747 
OS_PEND_DATA
 *
	gTažPŒ
;

748 
OS_OBJ_QTY
 
	gNbrEÁr›s
;

767 
	sos_³nd_obj
 {

768 
OS_OBJ_TYPE
 
	gTy³
;

769 
CPU_CHAR
 *
	gNamePŒ
;

770 
OS_PEND_LIST
 
	gP’dLi¡
;

771 #ià
OS_CFG_DBG_EN
 > 0u

772 *
	gDbgP»vPŒ
;

773 *
	gDbgNextPŒ
;

774 
CPU_CHAR
 *
	gDbgNamePŒ
;

788 
	sos_æag_g½
 {

790 
OS_OBJ_TYPE
 
	gTy³
;

791 
CPU_CHAR
 *
	gNamePŒ
;

792 
OS_PEND_LIST
 
	gP’dLi¡
;

793 #ià
OS_CFG_DBG_EN
 > 0u

794 
OS_FLAG_GRP
 *
	gDbgP»vPŒ
;

795 
OS_FLAG_GRP
 *
	gDbgNextPŒ
;

796 
CPU_CHAR
 *
	gDbgNamePŒ
;

799 
OS_FLAGS
 
	gFÏgs
;

800 
CPU_TS
 
	gTS
;

811 
	sos_mem
 {

812 
OS_OBJ_TYPE
 
	gTy³
;

813 *
	gAddrPŒ
;

814 
CPU_CHAR
 *
	gNamePŒ
;

815 *
	gF»eLi¡PŒ
;

816 
OS_MEM_SIZE
 
	gBlkSize
;

817 
OS_MEM_QTY
 
	gNbrMax
;

818 
OS_MEM_QTY
 
	gNbrF»e
;

819 #ià
OS_CFG_DBG_EN
 > 0u

820 
OS_MEM
 *
	gDbgP»vPŒ
;

821 
OS_MEM
 *
	gDbgNextPŒ
;

832 
	sos_msg
 {

833 
OS_MSG
 *
	gNextPŒ
;

834 *
	gMsgPŒ
;

835 
OS_MSG_SIZE
 
	gMsgSize
;

836 
CPU_TS
 
	gMsgTS
;

842 
	sos_msg_poÞ
 {

843 
OS_MSG
 *
	gNextPŒ
;

844 
OS_MSG_QTY
 
	gNbrF»e
;

845 
OS_MSG_QTY
 
	gNbrU£d
;

846 
OS_MSG_QTY
 
	gNbrU£dMax
;

851 
	sos_msg_q
 {

852 
OS_MSG
 *
	gInPŒ
;

853 
OS_MSG
 *
	gOutPŒ
;

854 
OS_MSG_QTY
 
	gNbrEÁr›sSize
;

855 
OS_MSG_QTY
 
	gNbrEÁr›s
;

856 
OS_MSG_QTY
 
	gNbrEÁr›sMax
;

868 
	sos_mu‹x
 {

870 
OS_OBJ_TYPE
 
	gTy³
;

871 
CPU_CHAR
 *
	gNamePŒ
;

872 
OS_PEND_LIST
 
	gP’dLi¡
;

873 #ià
OS_CFG_DBG_EN
 > 0u

874 
OS_MUTEX
 *
	gDbgP»vPŒ
;

875 
OS_MUTEX
 *
	gDbgNextPŒ
;

876 
CPU_CHAR
 *
	gDbgNamePŒ
;

879 
OS_TCB
 *
	gOwÃrTCBPŒ
;

880 
OS_PRIO
 
	gOwÃrOrigš®Prio
;

881 
OS_NESTING_CTR
 
	gOwÃrNe¡šgCŒ
;

882 
CPU_TS
 
	gTS
;

894 
	sos_q
 {

896 
OS_OBJ_TYPE
 
	gTy³
;

897 
CPU_CHAR
 *
	gNamePŒ
;

898 
OS_PEND_LIST
 
	gP’dLi¡
;

899 #ià
OS_CFG_DBG_EN
 > 0u

900 
OS_Q
 *
	gDbgP»vPŒ
;

901 
OS_Q
 *
	gDbgNextPŒ
;

902 
CPU_CHAR
 *
	gDbgNamePŒ
;

905 
OS_MSG_Q
 
	gMsgQ
;

917 
	sos_£m
 {

919 
OS_OBJ_TYPE
 
	gTy³
;

920 
CPU_CHAR
 *
	gNamePŒ
;

921 
OS_PEND_LIST
 
	gP’dLi¡
;

922 #ià
OS_CFG_DBG_EN
 > 0u

923 
OS_SEM
 *
	gDbgP»vPŒ
;

924 
OS_SEM
 *
	gDbgNextPŒ
;

925 
CPU_CHAR
 *
	gDbgNamePŒ
;

928 
OS_SEM_CTR
 
	gCŒ
;

929 
CPU_TS
 
	gTS
;

939 
	sos_tcb
 {

940 
CPU_STK
 *
	gStkPŒ
;

942 *
	gExtPŒ
;

944 
CPU_STK
 *
	gStkLim™PŒ
;

946 
OS_TCB
 *
	gNextPŒ
;

947 
OS_TCB
 *
	gP»vPŒ
;

949 
OS_TCB
 *
	gTickNextPŒ
;

950 
OS_TCB
 *
	gTickP»vPŒ
;

952 
OS_TICK_SPOKE
 *
	gTickSpokePŒ
;

954 
CPU_CHAR
 *
	gNamePŒ
;

956 
CPU_STK
 *
	gStkBa£PŒ
;

958 #ià
defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

959 
OS_TLS
 
	gTLS_Tbl
[
OS_CFG_TLS_TBL_SIZE
];

962 
OS_TASK_PTR
 
	gTaskEÁryAddr
;

963 *
	gTaskEÁryArg
;

965 
OS_PEND_DATA
 *
	gP’dD©aTblPŒ
;

966 
OS_STATE
 
	gP’dOn
;

967 
OS_STATUS
 
	gP’dStus
;

969 
OS_STATE
 
	gTaskS‹
;

970 
OS_PRIO
 
	gPrio
;

971 
CPU_STK_SIZE
 
	gStkSize
;

972 
OS_OPT
 
	gO±
;

974 
OS_OBJ_QTY
 
	gP’dD©aTblEÁr›s
;

976 
CPU_TS
 
	gTS
;

978 
OS_SEM_CTR
 
	gSemCŒ
;

981 
OS_TICK
 
	gTickCŒP»v
;

982 
OS_TICK
 
	gTickCŒM©ch
;

983 
OS_TICK
 
	gTickRemaš
;

985 
OS_TICK
 
	gTimeQuª
;

986 
OS_TICK
 
	gTimeQuªCŒ
;

988 #ià
OS_MSG_EN
 > 0u

989 *
	gMsgPŒ
;

990 
OS_MSG_SIZE
 
	gMsgSize
;

993 #ià
OS_CFG_TASK_Q_EN
 > 0u

994 
OS_MSG_Q
 
	gMsgQ
;

995 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

996 
CPU_TS
 
	gMsgQP’dTime
;

997 
CPU_TS
 
	gMsgQP’dTimeMax
;

1001 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1002 
OS_REG
 
	gRegTbl
[
OS_CFG_TASK_REG_TBL_SIZE
];

1005 #ià
OS_CFG_FLAG_EN
 > 0u

1006 
OS_FLAGS
 
	gFÏgsP’d
;

1007 
OS_FLAGS
 
	gFÏgsRdy
;

1008 
OS_OPT
 
	gFÏgsO±
;

1011 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

1012 
OS_NESTING_CTR
 
	gSu¥’dCŒ
;

1015 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

1016 
OS_CPU_USAGE
 
	gCPUU§ge
;

1017 
OS_CPU_USAGE
 
	gCPUU§geMax
;

1018 
OS_CTX_SW_CTR
 
	gCtxSwCŒ
;

1019 
CPU_TS
 
	gCyþesD–
;

1020 
CPU_TS
 
	gCyþesS¹
;

1021 
OS_CYCLES
 
	gCyþesTÙ®
;

1022 
OS_CYCLES
 
	gCyþesTÙ®P»v
;

1024 
CPU_TS
 
	gSemP’dTime
;

1025 
CPU_TS
 
	gSemP’dTimeMax
;

1028 #ià
OS_CFG_STAT_TASK_STK_CHK_EN
 > 0u

1029 
CPU_STK_SIZE
 
	gStkU£d
;

1030 
CPU_STK_SIZE
 
	gStkF»e
;

1033 #ifdeà
CPU_CFG_INT_DIS_MEAS_EN


1034 
CPU_TS
 
	gIÁDisTimeMax
;

1036 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

1037 
CPU_TS
 
	gSchedLockTimeMax
;

1040 #ià
OS_CFG_DBG_EN
 > 0u

1041 
OS_TCB
 *
	gDbgP»vPŒ
;

1042 
OS_TCB
 *
	gDbgNextPŒ
;

1043 
CPU_CHAR
 *
	gDbgNamePŒ
;

1054 
	sos_tick_¥oke
 {

1055 
OS_TCB
 *
	gFœ¡PŒ
;

1056 
OS_OBJ_QTY
 
	gNbrEÁr›s
;

1057 
OS_OBJ_QTY
 
	gNbrEÁr›sMax
;

1067 
	sos_tmr
 {

1068 
OS_OBJ_TYPE
 
	gTy³
;

1069 
CPU_CHAR
 *
	gNamePŒ
;

1070 
OS_TMR_CALLBACK_PTR
 
	gC®lbackPŒ
;

1071 *
	gC®lbackPŒArg
;

1072 
OS_TMR
 *
	gNextPŒ
;

1073 
OS_TMR
 *
	gP»vPŒ
;

1074 
OS_TICK
 
	gM©ch
;

1075 
OS_TICK
 
	gRemaš
;

1076 
OS_TICK
 
	gDly
;

1077 
OS_TICK
 
	gP”iod
;

1078 
OS_OPT
 
	gO±
;

1079 
OS_STATE
 
	gS‹
;

1080 #ià
OS_CFG_DBG_EN
 > 0u

1081 
OS_TMR
 *
	gDbgP»vPŒ
;

1082 
OS_TMR
 *
	gDbgNextPŒ
;

1088 
	sos_tmr_¥oke
 {

1089 
OS_TMR
 *
	gFœ¡PŒ
;

1090 
OS_OBJ_QTY
 
	gNbrEÁr›s
;

1091 
OS_OBJ_QTY
 
	gNbrEÁr›sMax
;

1103 #ià
OS_CFG_APP_HOOKS_EN
 > 0u

1104 
OS_EXT
 
OS_APP_HOOK_TCB
 
	gOS_AµTaskC»©eHookPŒ
;

1105 
OS_EXT
 
OS_APP_HOOK_TCB
 
	gOS_AµTaskD–HookPŒ
;

1106 
OS_EXT
 
OS_APP_HOOK_TCB
 
	gOS_AµTaskR‘uºHookPŒ
;

1108 
OS_EXT
 
OS_APP_HOOK_VOID
 
	gOS_AµIdËTaskHookPŒ
;

1109 
OS_EXT
 
OS_APP_HOOK_VOID
 
	gOS_AµStTaskHookPŒ
;

1110 
OS_EXT
 
OS_APP_HOOK_VOID
 
	gOS_AµTaskSwHookPŒ
;

1111 
OS_EXT
 
OS_APP_HOOK_VOID
 
	gOS_AµTimeTickHookPŒ
;

1115 
OS_EXT
 
OS_IDLE_CTR
 
	gOSIdËTaskCŒ
;

1116 
OS_EXT
 
OS_TCB
 
	gOSIdËTaskTCB
;

1119 
OS_EXT
 
OS_NESTING_CTR
 
	gOSIÁNe¡šgCŒ
;

1120 #ifdeà
CPU_CFG_INT_DIS_MEAS_EN


1121 
OS_EXT
 
CPU_TS
 
	gOSIÁDisTimeMax
;

1124 
OS_EXT
 
OS_STATE
 
	gOSRuÂšg
;

1128 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

1129 
OS_EXT
 
OS_INT_Q
 *
	gOSIÁQInPŒ
;

1130 
OS_EXT
 
OS_INT_Q
 *
	gOSIÁQOutPŒ
;

1131 
OS_EXT
 
OS_OBJ_QTY
 
	gOSIÁQNbrEÁr›s
;

1132 
OS_EXT
 
OS_OBJ_QTY
 
	gOSIÁQNbrEÁr›sMax
;

1133 
OS_EXT
 
OS_OBJ_QTY
 
	gOSIÁQOvfCŒ
;

1134 
OS_EXT
 
OS_TCB
 
	gOSIÁQTaskTCB
;

1135 
OS_EXT
 
CPU_TS
 
	gOSIÁQTaskTimeMax
;

1139 #ià
OS_CFG_FLAG_EN
 > 0u

1140 #ià
OS_CFG_DBG_EN
 > 0u

1141 
OS_EXT
 
OS_FLAG_GRP
 *
	gOSFÏgDbgLi¡PŒ
;

1143 
OS_EXT
 
OS_OBJ_QTY
 
	gOSFÏgQty
;

1147 #ià
OS_CFG_MEM_EN
 > 0u

1148 #ià
OS_CFG_DBG_EN
 > 0u

1149 
OS_EXT
 
OS_MEM
 *
	gOSMemDbgLi¡PŒ
;

1151 
OS_EXT
 
OS_OBJ_QTY
 
	gOSMemQty
;

1155 #ià
OS_MSG_EN
 > 0u

1156 
OS_EXT
 
OS_MSG_POOL
 
	gOSMsgPoÞ
;

1160 #ià
OS_CFG_MUTEX_EN
 > 0u

1161 #ià
OS_CFG_DBG_EN
 > 0u

1162 
OS_EXT
 
OS_MUTEX
 *
	gOSMu‹xDbgLi¡PŒ
;

1164 
OS_EXT
 
OS_OBJ_QTY
 
	gOSMu‹xQty
;

1168 
OS_EXT
 
OS_PRIO
 
	gOSPrioCur
;

1169 
OS_EXT
 
OS_PRIO
 
	gOSPrioHighRdy
;

1170 
OS_EXT
 
OS_PRIO
 
	gOSPrioSaved
;

1171 
CPU_DATA
 
OSPrioTbl
[
OS_PRIO_TBL_SIZE
];

1174 #ià
OS_CFG_Q_EN
 > 0u

1175 #ià
OS_CFG_DBG_EN
 > 0u

1176 
OS_EXT
 
OS_Q
 *
	gOSQDbgLi¡PŒ
;

1178 
OS_EXT
 
OS_OBJ_QTY
 
	gOSQQty
;

1184 
OS_EXT
 
OS_RDY_LIST
 
	gOSRdyLi¡
[
OS_CFG_PRIO_MAX
];

1187 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


1188 
OS_EXT
 
CPU_BOOLEAN
 
	gOSSaãtyCr™iÿlS¹FÏg
;

1191 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

1192 
OS_EXT
 
CPU_TS_TMR
 
	gOSSchedLockTimeBegš
;

1193 
OS_EXT
 
CPU_TS_TMR
 
	gOSSchedLockTimeMax
;

1194 
OS_EXT
 
CPU_TS_TMR
 
	gOSSchedLockTimeMaxCur
;

1197 
OS_EXT
 
OS_NESTING_CTR
 
	gOSSchedLockNe¡šgCŒ
;

1198 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

1199 
OS_EXT
 
OS_TICK
 
	gOSSchedRoundRobšDætTimeQuª
;

1200 
OS_EXT
 
CPU_BOOLEAN
 
	gOSSchedRoundRobšEn
;

1203 #ià
OS_CFG_SEM_EN
 > 0u

1204 #ià
OS_CFG_DBG_EN
 > 0u

1205 
OS_EXT
 
OS_SEM
 *
	gOSSemDbgLi¡PŒ
;

1207 
OS_EXT
 
OS_OBJ_QTY
 
	gOSSemQty
;

1211 #ià
OS_CFG_STAT_TASK_EN
 > 0u

1212 
OS_EXT
 
CPU_BOOLEAN
 
	gOSStRe£tFÏg
;

1213 
OS_EXT
 
OS_CPU_USAGE
 
	gOSStTaskCPUU§ge
;

1214 
OS_EXT
 
OS_CPU_USAGE
 
	gOSStTaskCPUU§geMax
;

1215 
OS_EXT
 
OS_TICK
 
	gOSStTaskCŒ
;

1216 
OS_EXT
 
OS_TICK
 
	gOSStTaskCŒMax
;

1217 
OS_EXT
 
OS_TICK
 
	gOSStTaskCŒRun
;

1218 
OS_EXT
 
CPU_BOOLEAN
 
	gOSStTaskRdy
;

1219 
OS_EXT
 
OS_TCB
 
	gOSStTaskTCB
;

1220 
OS_EXT
 
CPU_TS
 
	gOSStTaskTimeMax
;

1224 
OS_EXT
 
OS_CTX_SW_CTR
 
	gOSTaskCtxSwCŒ
;

1225 #ià
OS_CFG_DBG_EN
 > 0u

1226 
OS_EXT
 
OS_TCB
 *
	gOSTaskDbgLi¡PŒ
;

1228 
OS_EXT
 
OS_OBJ_QTY
 
	gOSTaskQty
;

1230 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1231 
OS_EXT
 
OS_REG_ID
 
	gOSTaskRegNextAvažID
;

1235 
OS_EXT
 
OS_TICK
 
	gOSTickCŒ
;

1236 
OS_EXT
 
OS_TCB
 
	gOSTickTaskTCB
;

1237 
OS_EXT
 
CPU_TS
 
	gOSTickTaskTimeMax
;

1240 #ià
OS_CFG_TMR_EN
 > 0u

1241 #ià
OS_CFG_DBG_EN
 > 0u

1242 
OS_EXT
 
OS_TMR
 *
	gOSTmrDbgLi¡PŒ
;

1244 
OS_EXT
 
OS_OBJ_QTY
 
	gOSTmrQty
;

1245 
OS_EXT
 
OS_TCB
 
	gOSTmrTaskTCB
;

1246 
OS_EXT
 
CPU_TS
 
	gOSTmrTaskTimeMax
;

1247 
OS_EXT
 
OS_TICK
 
	gOSTmrTickCŒ
;

1248 
OS_EXT
 
OS_CTR
 
	gOSTmrUpd©eCÁ
;

1249 
OS_EXT
 
OS_CTR
 
	gOSTmrUpd©eCŒ
;

1253 
OS_EXT
 
OS_TCB
 *
	gOSTCBCurPŒ
;

1254 
OS_EXT
 
OS_TCB
 *
	gOSTCBHighRdyPŒ
;

1265 
CPU_STK
 * cÚ¡ 
OSCfg_IdËTaskStkBa£PŒ
;

1266 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_IdËTaskStkLim™
;

1267 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_IdËTaskStkSize
;

1268 
CPU_INT32U
 cÚ¡ 
OSCfg_IdËTaskStkSizeRAM
;

1270 
OS_INT_Q
 * cÚ¡ 
OSCfg_IÁQBa£PŒ
;

1271 
OS_OBJ_QTY
 cÚ¡ 
OSCfg_IÁQSize
;

1272 
CPU_INT32U
 cÚ¡ 
OSCfg_IÁQSizeRAM
;

1273 
CPU_STK
 * cÚ¡ 
OSCfg_IÁQTaskStkBa£PŒ
;

1274 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_IÁQTaskStkLim™
;

1275 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_IÁQTaskStkSize
;

1276 
CPU_INT32U
 cÚ¡ 
OSCfg_IÁQTaskStkSizeRAM
;

1278 
CPU_STK
 * cÚ¡ 
OSCfg_ISRStkBa£PŒ
;

1279 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_ISRStkSize
;

1280 
CPU_INT32U
 cÚ¡ 
OSCfg_ISRStkSizeRAM
;

1282 
OS_MSG_SIZE
 cÚ¡ 
OSCfg_MsgPoÞSize
;

1283 
CPU_INT32U
 cÚ¡ 
OSCfg_MsgPoÞSizeRAM
;

1284 
OS_MSG
 * cÚ¡ 
OSCfg_MsgPoÞBa£PŒ
;

1286 
OS_PRIO
 cÚ¡ 
OSCfg_StTaskPrio
;

1287 
OS_RATE_HZ
 cÚ¡ 
OSCfg_StTaskR©e_Hz
;

1288 
CPU_STK
 * cÚ¡ 
OSCfg_StTaskStkBa£PŒ
;

1289 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_StTaskStkLim™
;

1290 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_StTaskStkSize
;

1291 
CPU_INT32U
 cÚ¡ 
OSCfg_StTaskStkSizeRAM
;

1293 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_StkSizeMš
;

1295 
OS_RATE_HZ
 cÚ¡ 
OSCfg_TickR©e_Hz
;

1296 
OS_PRIO
 cÚ¡ 
OSCfg_TickTaskPrio
;

1297 
CPU_STK
 * cÚ¡ 
OSCfg_TickTaskStkBa£PŒ
;

1298 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_TickTaskStkLim™
;

1299 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_TickTaskStkSize
;

1300 
CPU_INT32U
 cÚ¡ 
OSCfg_TickTaskStkSizeRAM
;

1301 
OS_OBJ_QTY
 cÚ¡ 
OSCfg_TickWh“lSize
;

1302 
CPU_INT32U
 cÚ¡ 
OSCfg_TickWh“lSizeRAM
;

1304 
OS_PRIO
 cÚ¡ 
OSCfg_TmrTaskPrio
;

1305 
OS_RATE_HZ
 cÚ¡ 
OSCfg_TmrTaskR©e_Hz
;

1306 
CPU_STK
 * cÚ¡ 
OSCfg_TmrTaskStkBa£PŒ
;

1307 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_TmrTaskStkLim™
;

1308 
CPU_STK_SIZE
 cÚ¡ 
OSCfg_TmrTaskStkSize
;

1309 
CPU_INT32U
 cÚ¡ 
OSCfg_TmrTaskStkSizeRAM
;

1310 
OS_OBJ_QTY
 cÚ¡ 
OSCfg_TmrWh“lSize
;

1311 
CPU_INT32U
 cÚ¡ 
OSCfg_TmrSizeRAM
;

1314 
CPU_STK
 
OSCfg_IdËTaskStk
[];

1316 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u)

1317 
CPU_STK
 
OSCfg_IÁQTaskStk
[];

1318 
OS_INT_Q
 
OSCfg_IÁQ
[];

1321 
CPU_STK
 
OSCfg_ISRStk
[];

1323 #ià(
OS_MSG_EN
 > 0u)

1324 
OS_MSG
 
OSCfg_MsgPoÞ
[];

1327 #ià(
OS_CFG_STAT_TASK_EN
 > 0u)

1328 
CPU_STK
 
OSCfg_StTaskStk
[];

1331 
CPU_STK
 
OSCfg_TickTaskStk
[];

1332 
OS_TICK_SPOKE
 
OSCfg_TickWh“l
[];

1334 #ià(
OS_CFG_TMR_EN
 > 0u)

1335 
CPU_STK
 
OSCfg_TmrTaskStk
[];

1336 
OS_TMR_SPOKE
 
OSCfg_TmrWh“l
[];

1351 #ià
OS_CFG_FLAG_EN
 > 0u

1353 
OSFÏgC»©e
 (
OS_FLAG_GRP
 *
p_g½
,

1354 
CPU_CHAR
 *
p_Çme
,

1355 
OS_FLAGS
 
æags
,

1356 
OS_ERR
 *
p_”r
);

1358 #ià
OS_CFG_FLAG_DEL_EN
 > 0u

1359 
OS_OBJ_QTY
 
OSFÏgD–
 (
OS_FLAG_GRP
 *
p_g½
,

1360 
OS_OPT
 
Ýt
,

1361 
OS_ERR
 *
p_”r
);

1364 
OS_FLAGS
 
OSFÏgP’d
 (
OS_FLAG_GRP
 *
p_g½
,

1365 
OS_FLAGS
 
æags
,

1366 
OS_TICK
 
timeout
,

1367 
OS_OPT
 
Ýt
,

1368 
CPU_TS
 *
p_ts
,

1369 
OS_ERR
 *
p_”r
);

1371 #ià
OS_CFG_FLAG_PEND_ABORT_EN
 > 0u

1372 
OS_OBJ_QTY
 
OSFÏgP’dAbÜt
 (
OS_FLAG_GRP
 *
p_g½
,

1373 
OS_OPT
 
Ýt
,

1374 
OS_ERR
 *
p_”r
);

1377 
OS_FLAGS
 
OSFÏgP’dG‘FÏgsRdy
 (
OS_ERR
 *
p_”r
);

1379 
OS_FLAGS
 
OSFÏgPo¡
 (
OS_FLAG_GRP
 *
p_g½
,

1380 
OS_FLAGS
 
æags
,

1381 
OS_OPT
 
Ýt
,

1382 
OS_ERR
 *
p_”r
);

1386 
OS_FÏgCÌ
 (
OS_FLAG_GRP
 *
p_g½
);

1388 
OS_FÏgBlock
 (
OS_PEND_DATA
 *
p_³nd_d©a
,

1389 
OS_FLAG_GRP
 *
p_g½
,

1390 
OS_FLAGS
 
æags
,

1391 
OS_OPT
 
Ýt
,

1392 
OS_TICK
 
timeout
);

1394 #ià
OS_CFG_DBG_EN
 > 0u

1395 
OS_FÏgDbgLi¡Add
 (
OS_FLAG_GRP
 *
p_g½
);

1397 
OS_FÏgDbgLi¡Remove
 (
OS_FLAG_GRP
 *
p_g½
);

1400 
OS_FÏgIn™
 (
OS_ERR
 *
p_”r
);

1402 
OS_FLAGS
 
OS_FÏgPo¡
 (
OS_FLAG_GRP
 *
p_g½
,

1403 
OS_FLAGS
 
æags
,

1404 
OS_OPT
 
Ýt
,

1405 
CPU_TS
 
ts
,

1406 
OS_ERR
 *
p_”r
);

1408 
OS_FÏgTaskRdy
 (
OS_TCB
 *
p_tcb
,

1409 
OS_FLAGS
 
æags_rdy
,

1410 
CPU_TS
 
ts
);

1418 #ià
OS_CFG_MEM_EN
 > 0u

1420 
OSMemC»©e
 (
OS_MEM
 *
p_mem
,

1421 
CPU_CHAR
 *
p_Çme
,

1422 *
p_addr
,

1423 
OS_MEM_QTY
 
n_blks
,

1424 
OS_MEM_SIZE
 
blk_size
,

1425 
OS_ERR
 *
p_”r
);

1427 *
OSMemG‘
 (
OS_MEM
 *
p_mem
,

1428 
OS_ERR
 *
p_”r
);

1430 
OSMemPut
 (
OS_MEM
 *
p_mem
,

1431 *
p_blk
,

1432 
OS_ERR
 *
p_”r
);

1436 #ià
OS_CFG_DBG_EN
 > 0u

1437 
OS_MemDbgLi¡Add
 (
OS_MEM
 *
p_mem
);

1440 
OS_MemIn™
 (
OS_ERR
 *
p_”r
);

1449 #ià
OS_CFG_MUTEX_EN
 > 0u

1451 
OSMu‹xC»©e
 (
OS_MUTEX
 *
p_mu‹x
,

1452 
CPU_CHAR
 *
p_Çme
,

1453 
OS_ERR
 *
p_”r
);

1455 #ià
OS_CFG_MUTEX_DEL_EN
 > 0u

1456 
OS_OBJ_QTY
 
OSMu‹xD–
 (
OS_MUTEX
 *
p_mu‹x
,

1457 
OS_OPT
 
Ýt
,

1458 
OS_ERR
 *
p_”r
);

1461 
OSMu‹xP’d
 (
OS_MUTEX
 *
p_mu‹x
,

1462 
OS_TICK
 
timeout
,

1463 
OS_OPT
 
Ýt
,

1464 
CPU_TS
 *
p_ts
,

1465 
OS_ERR
 *
p_”r
);

1467 #ià
OS_CFG_MUTEX_PEND_ABORT_EN
 > 0u

1468 
OS_OBJ_QTY
 
OSMu‹xP’dAbÜt
 (
OS_MUTEX
 *
p_mu‹x
,

1469 
OS_OPT
 
Ýt
,

1470 
OS_ERR
 *
p_”r
);

1473 
OSMu‹xPo¡
 (
OS_MUTEX
 *
p_mu‹x
,

1474 
OS_OPT
 
Ýt
,

1475 
OS_ERR
 *
p_”r
);

1480 
OS_Mu‹xCÌ
 (
OS_MUTEX
 *
p_mu‹x
);

1482 #ià
OS_CFG_DBG_EN
 > 0u

1483 
OS_Mu‹xDbgLi¡Add
 (
OS_MUTEX
 *
p_mu‹x
);

1485 
OS_Mu‹xDbgLi¡Remove
 (
OS_MUTEX
 *
p_mu‹x
);

1488 
OS_Mu‹xIn™
 (
OS_ERR
 *
p_”r
);

1496 #ià
OS_CFG_PEND_MULTI_EN
 > 0u

1498 
OS_OBJ_QTY
 
OSP’dMuÉi
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

1499 
OS_OBJ_QTY
 
tbl_size
,

1500 
OS_TICK
 
timeout
,

1501 
OS_OPT
 
Ýt
,

1502 
OS_ERR
 *
p_”r
);

1506 
OS_OBJ_QTY
 
OS_P’dMuÉiG‘Rdy
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

1507 
OS_OBJ_QTY
 
tbl_size
);

1509 
CPU_BOOLEAN
 
OS_P’dMuÉiV®id©e
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

1510 
OS_OBJ_QTY
 
tbl_size
);

1512 
OS_P’dMuÉiWa™
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

1513 
OS_OBJ_QTY
 
tbl_size
,

1514 
OS_TICK
 
timeout
);

1521 #ià
OS_CFG_Q_EN
 > 0u

1523 
OSQC»©e
 (
OS_Q
 *
p_q
,

1524 
CPU_CHAR
 *
p_Çme
,

1525 
OS_MSG_QTY
 
max_qty
,

1526 
OS_ERR
 *
p_”r
);

1528 #ià
OS_CFG_Q_DEL_EN
 > 0u

1529 
OS_OBJ_QTY
 
OSQD–
 (
OS_Q
 *
p_q
,

1530 
OS_OPT
 
Ýt
,

1531 
OS_ERR
 *
p_”r
);

1534 #ià
OS_CFG_Q_FLUSH_EN
 > 0u

1535 
OS_MSG_QTY
 
OSQFlush
 (
OS_Q
 *
p_q
,

1536 
OS_ERR
 *
p_”r
);

1539 *
OSQP’d
 (
OS_Q
 *
p_q
,

1540 
OS_TICK
 
timeout
,

1541 
OS_OPT
 
Ýt
,

1542 
OS_MSG_SIZE
 *
p_msg_size
,

1543 
CPU_TS
 *
p_ts
,

1544 
OS_ERR
 *
p_”r
);

1546 #ià
OS_CFG_Q_PEND_ABORT_EN
 > 0u

1547 
OS_OBJ_QTY
 
OSQP’dAbÜt
 (
OS_Q
 *
p_q
,

1548 
OS_OPT
 
Ýt
,

1549 
OS_ERR
 *
p_”r
);

1552 
OSQPo¡
 (
OS_Q
 *
p_q
,

1553 *
p_void
,

1554 
OS_MSG_SIZE
 
msg_size
,

1555 
OS_OPT
 
Ýt
,

1556 
OS_ERR
 *
p_”r
);

1560 
OS_QCÌ
 (
OS_Q
 *
p_q
);

1562 #ià
OS_CFG_DBG_EN
 > 0u

1563 
OS_QDbgLi¡Add
 (
OS_Q
 *
p_q
);

1565 
OS_QDbgLi¡Remove
 (
OS_Q
 *
p_q
);

1568 
OS_QIn™
 (
OS_ERR
 *
p_”r
);

1570 
OS_QPo¡
 (
OS_Q
 *
p_q
,

1571 *
p_void
,

1572 
OS_MSG_SIZE
 
msg_size
,

1573 
OS_OPT
 
Ýt
,

1574 
CPU_TS
 
ts
,

1575 
OS_ERR
 *
p_”r
);

1583 #ià
OS_CFG_SEM_EN
 > 0u

1585 
OSSemC»©e
 (
OS_SEM
 *
p_£m
,

1586 
CPU_CHAR
 *
p_Çme
,

1587 
OS_SEM_CTR
 
út
,

1588 
OS_ERR
 *
p_”r
);

1590 
OS_OBJ_QTY
 
OSSemD–
 (
OS_SEM
 *
p_£m
,

1591 
OS_OPT
 
Ýt
,

1592 
OS_ERR
 *
p_”r
);

1594 
OS_SEM_CTR
 
OSSemP’d
 (
OS_SEM
 *
p_£m
,

1595 
OS_TICK
 
timeout
,

1596 
OS_OPT
 
Ýt
,

1597 
CPU_TS
 *
p_ts
,

1598 
OS_ERR
 *
p_”r
);

1600 #ià
OS_CFG_SEM_PEND_ABORT_EN
 > 0u

1601 
OS_OBJ_QTY
 
OSSemP’dAbÜt
 (
OS_SEM
 *
p_£m
,

1602 
OS_OPT
 
Ýt
,

1603 
OS_ERR
 *
p_”r
);

1606 
OS_SEM_CTR
 
OSSemPo¡
 (
OS_SEM
 *
p_£m
,

1607 
OS_OPT
 
Ýt
,

1608 
OS_ERR
 *
p_”r
);

1610 #ià
OS_CFG_SEM_SET_EN
 > 0u

1611 
OSSemS‘
 (
OS_SEM
 *
p_£m
,

1612 
OS_SEM_CTR
 
út
,

1613 
OS_ERR
 *
p_”r
);

1618 
OS_SemCÌ
 (
OS_SEM
 *
p_£m
);

1620 #ià
OS_CFG_DBG_EN
 > 0u

1621 
OS_SemDbgLi¡Add
 (
OS_SEM
 *
p_£m
);

1623 
OS_SemDbgLi¡Remove
 (
OS_SEM
 *
p_£m
);

1626 
OS_SemIn™
 (
OS_ERR
 *
p_”r
);

1628 
OS_SEM_CTR
 
OS_SemPo¡
 (
OS_SEM
 *
p_£m
,

1629 
OS_OPT
 
Ýt
,

1630 
CPU_TS
 
ts
,

1631 
OS_ERR
 *
p_”r
);

1639 #ià
OS_CFG_TASK_CHANGE_PRIO_EN
 > 0u

1640 
OSTaskChªgePrio
 (
OS_TCB
 *
p_tcb
,

1641 
OS_PRIO
 
´io_Ãw
,

1642 
OS_ERR
 *
p_”r
);

1645 
OSTaskC»©e
 (
OS_TCB
 *
p_tcb
,

1646 
CPU_CHAR
 *
p_Çme
,

1647 
OS_TASK_PTR
 
p_sk
,

1648 *
p_¬g
,

1649 
OS_PRIO
 
´io
,

1650 
CPU_STK
 *
p_¡k_ba£
,

1651 
CPU_STK_SIZE
 
¡k_lim™
,

1652 
CPU_STK_SIZE
 
¡k_size
,

1653 
OS_MSG_QTY
 
q_size
,

1654 
OS_TICK
 
time_quª
,

1655 *
p_ext
,

1656 
OS_OPT
 
Ýt
,

1657 
OS_ERR
 *
p_”r
);

1659 #ià
OS_CFG_TASK_DEL_EN
 > 0u

1660 
OSTaskD–
 (
OS_TCB
 *
p_tcb
,

1661 
OS_ERR
 *
p_”r
);

1664 #ià
OS_CFG_TASK_Q_EN
 > 0u

1665 
OS_MSG_QTY
 
OSTaskQFlush
 (
OS_TCB
 *
p_tcb
,

1666 
OS_ERR
 *
p_”r
);

1668 *
OSTaskQP’d
 (
OS_TICK
 
timeout
,

1669 
OS_OPT
 
Ýt
,

1670 
OS_MSG_SIZE
 *
p_msg_size
,

1671 
CPU_TS
 *
p_ts
,

1672 
OS_ERR
 *
p_”r
);

1674 
CPU_BOOLEAN
 
OSTaskQP’dAbÜt
 (
OS_TCB
 *
p_tcb
,

1675 
OS_OPT
 
Ýt
,

1676 
OS_ERR
 *
p_”r
);

1678 
OSTaskQPo¡
 (
OS_TCB
 *
p_tcb
,

1679 *
p_void
,

1680 
OS_MSG_SIZE
 
msg_size
,

1681 
OS_OPT
 
Ýt
,

1682 
OS_ERR
 *
p_”r
);

1686 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1687 
OS_REG
 
OSTaskRegG‘
 (
OS_TCB
 *
p_tcb
,

1688 
OS_REG_ID
 
id
,

1689 
OS_ERR
 *
p_”r
);

1691 
OS_REG_ID
 
OSTaskRegG‘ID
 (
OS_ERR
 *
p_”r
);

1693 
OSTaskRegS‘
 (
OS_TCB
 *
p_tcb
,

1694 
OS_REG_ID
 
id
,

1695 
OS_REG
 
v®ue
,

1696 
OS_ERR
 *
p_”r
);

1699 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

1700 
OSTaskResume
 (
OS_TCB
 *
p_tcb
,

1701 
OS_ERR
 *
p_”r
);

1703 
OSTaskSu¥’d
 (
OS_TCB
 *
p_tcb
,

1704 
OS_ERR
 *
p_”r
);

1707 
OS_SEM_CTR
 
OSTaskSemP’d
 (
OS_TICK
 
timeout
,

1708 
OS_OPT
 
Ýt
,

1709 
CPU_TS
 *
p_ts
,

1710 
OS_ERR
 *
p_”r
);

1712 #ià(
OS_CFG_TASK_SEM_PEND_ABORT_EN
 > 0u)

1713 
CPU_BOOLEAN
 
OSTaskSemP’dAbÜt
 (
OS_TCB
 *
p_tcb
,

1714 
OS_OPT
 
Ýt
,

1715 
OS_ERR
 *
p_”r
);

1718 
OS_SEM_CTR
 
OSTaskSemPo¡
 (
OS_TCB
 *
p_tcb
,

1719 
OS_OPT
 
Ýt
,

1720 
OS_ERR
 *
p_”r
);

1722 
OS_SEM_CTR
 
OSTaskSemS‘
 (
OS_TCB
 *
p_tcb
,

1723 
OS_SEM_CTR
 
út
,

1724 
OS_ERR
 *
p_”r
);

1726 #ià
OS_CFG_STAT_TASK_STK_CHK_EN
 > 0u

1727 
OSTaskStkChk
 (
OS_TCB
 *
p_tcb
,

1728 
CPU_STK_SIZE
 *
p_ä“
,

1729 
CPU_STK_SIZE
 *
p_u£d
,

1730 
OS_ERR
 *
p_”r
);

1733 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

1734 
OSTaskTimeQuªS‘
 (
OS_TCB
 *
p_tcb
,

1735 
OS_TICK
 
time_quª
,

1736 
OS_ERR
 *
p_”r
);

1741 
OS_TaskBlock
 (
OS_TCB
 *
p_tcb
,

1742 
OS_TICK
 
timeout
);

1744 #ià
OS_CFG_DBG_EN
 > 0u

1745 
OS_TaskDbgLi¡Add
 (
OS_TCB
 *
p_tcb
);

1747 
OS_TaskDbgLi¡Remove
 (
OS_TCB
 *
p_tcb
);

1750 
OS_TaskIn™
 (
OS_ERR
 *
p_”r
);

1752 
OS_TaskIn™TCB
 (
OS_TCB
 *
p_tcb
);

1754 
OS_TaskQPo¡
 (
OS_TCB
 *
p_tcb
,

1755 *
p_void
,

1756 
OS_MSG_SIZE
 
msg_size
,

1757 
OS_OPT
 
Ýt
,

1758 
CPU_TS
 
ts
,

1759 
OS_ERR
 *
p_”r
);

1761 
OS_TaskRdy
 (
OS_TCB
 *
p_tcb
);

1763 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

1764 
OS_TaskResume
 (
OS_TCB
 *
p_tcb
,

1765 
OS_ERR
 *
p_”r
);

1768 
OS_TaskR‘uº
 ();

1770 
OS_SEM_CTR
 
OS_TaskSemPo¡
 (
OS_TCB
 *
p_tcb
,

1771 
OS_OPT
 
Ýt
,

1772 
CPU_TS
 
ts
,

1773 
OS_ERR
 *
p_”r
);

1775 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

1776 
OS_TaskSu¥’d
 (
OS_TCB
 *
p_tcb
,

1777 
OS_ERR
 *
p_”r
);

1785 #ià
defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

1786 
OS_TLS_ID
 
OS_TLS_G‘ID
 (
OS_ERR
 *
p_”r
);

1788 
OS_TLS
 
OS_TLS_G‘V®ue
 (
OS_TCB
 *
p_tcb
,

1789 
OS_TLS_ID
 
id
,

1790 
OS_ERR
 *
p_”r
);

1792 
OS_TLS_In™
 (
OS_ERR
 *
p_”r
);

1794 
OS_TLS_S‘V®ue
 (
OS_TCB
 *
p_tcb
,

1795 
OS_TLS_ID
 
id
,

1796 
OS_TLS
 
v®ue
,

1797 
OS_ERR
 *
p_”r
);

1799 
OS_TLS_S‘De¡ruù
 (
OS_TLS_ID
 
id
,

1800 
OS_TLS_DESTRUCT_PTR
 
p_de¡ruù
,

1801 
OS_ERR
 *
p_”r
);

1803 
OS_TLS_TaskC»©e
 (
OS_TCB
 *
p_tcb
);

1805 
OS_TLS_TaskD–
 (
OS_TCB
 *
p_tcb
);

1807 
OS_TLS_TaskSw
 ();

1815 
OSTimeDly
 (
OS_TICK
 
dly
,

1816 
OS_OPT
 
Ýt
,

1817 
OS_ERR
 *
p_”r
);

1819 #ià
OS_CFG_TIME_DLY_HMSM_EN
 > 0u

1820 
OSTimeDlyHMSM
 (
CPU_INT16U
 
hours
,

1821 
CPU_INT16U
 
mšu‹s
,

1822 
CPU_INT16U
 
£cÚds
,

1823 
CPU_INT32U
 
mžli
,

1824 
OS_OPT
 
Ýt
,

1825 
OS_ERR
 *
p_”r
);

1828 #ià
OS_CFG_TIME_DLY_RESUME_EN
 > 0u

1829 
OSTimeDlyResume
 (
OS_TCB
 *
p_tcb
,

1830 
OS_ERR
 *
p_”r
);

1833 
OS_TICK
 
OSTimeG‘
 (
OS_ERR
 *
p_”r
);

1835 
OSTimeS‘
 (
OS_TICK
 
ticks
,

1836 
OS_ERR
 *
p_”r
);

1838 
OSTimeTick
 ();

1845 #ià
OS_CFG_TMR_EN
 > 0u

1846 
OSTmrC»©e
 (
OS_TMR
 *
p_tmr
,

1847 
CPU_CHAR
 *
p_Çme
,

1848 
OS_TICK
 
dly
,

1849 
OS_TICK
 
³riod
,

1850 
OS_OPT
 
Ýt
,

1851 
OS_TMR_CALLBACK_PTR
 
p_ÿÎback
,

1852 *
p_ÿÎback_¬g
,

1853 
OS_ERR
 *
p_”r
);

1855 
CPU_BOOLEAN
 
OSTmrD–
 (
OS_TMR
 *
p_tmr
,

1856 
OS_ERR
 *
p_”r
);

1858 
OS_TICK
 
OSTmrRemašG‘
 (
OS_TMR
 *
p_tmr
,

1859 
OS_ERR
 *
p_”r
);

1861 
CPU_BOOLEAN
 
OSTmrS¹
 (
OS_TMR
 *
p_tmr
,

1862 
OS_ERR
 *
p_”r
);

1864 
OS_STATE
 
OSTmrS‹G‘
 (
OS_TMR
 *
p_tmr
,

1865 
OS_ERR
 *
p_”r
);

1867 
CPU_BOOLEAN
 
OSTmrStÝ
 (
OS_TMR
 *
p_tmr
,

1868 
OS_OPT
 
Ýt
,

1869 *
p_ÿÎback_¬g
,

1870 
OS_ERR
 *
p_”r
);

1874 
OS_TmrCÌ
 (
OS_TMR
 *
p_tmr
);

1876 #ià
OS_CFG_DBG_EN
 > 0u

1877 
OS_TmrDbgLi¡Add
 (
OS_TMR
 *
p_tmr
);

1879 
OS_TmrDbgLi¡Remove
 (
OS_TMR
 *
p_tmr
);

1882 
OS_TmrIn™
 (
OS_ERR
 *
p_”r
);

1884 
OS_TmrLšk
 (
OS_TMR
 *
p_tmr
,

1885 
OS_OPT
 
Ýt
);

1887 
OS_TmrRe£tP—k
 ();

1889 
OS_TmrUÆšk
 (
OS_TMR
 *
p_tmr
);

1891 
OS_TmrTask
 (*
p_¬g
);

1900 
OSIn™
 (
OS_ERR
 *
p_”r
);

1902 
OSIÁEÁ”
 ();

1903 
OSIÁEx™
 ();

1905 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


1906 
OSSaãtyCr™iÿlS¹
 ();

1909 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

1910 
OSSchedRoundRobšCfg
 (
CPU_BOOLEAN
 
’
,

1911 
OS_TICK
 
dæt_time_quª
,

1912 
OS_ERR
 *
p_”r
);

1914 
OSSchedRoundRobšY›ld
 (
OS_ERR
 *
p_”r
);

1918 
OSSched
 ();

1920 
OSSchedLock
 (
OS_ERR
 *
p_”r
);

1921 
OSSchedUÆock
 (
OS_ERR
 *
p_”r
);

1923 
OSS¹
 (
OS_ERR
 *
p_”r
);

1925 #ià
OS_CFG_STAT_TASK_EN
 > 0u

1926 
OSStRe£t
 (
OS_ERR
 *
p_”r
);

1928 
OSStTaskCPUU§geIn™
 (
OS_ERR
 *
p_”r
);

1931 
CPU_INT16U
 
OSV”siÚ
 (
OS_ERR
 *
p_”r
);

1935 
OS_IdËTask
 (*
p_¬g
);

1937 
OS_IdËTaskIn™
 (
OS_ERR
 *
p_”r
);

1939 #ià
OS_CFG_STAT_TASK_EN
 > 0u

1940 
OS_StTask
 (*
p_¬g
);

1943 
OS_StTaskIn™
 (
OS_ERR
 *
p_”r
);

1945 
OS_TickTask
 (*
p_¬g
);

1946 
OS_TickTaskIn™
 (
OS_ERR
 *
p_”r
);

1957 
OSIn™Hook
 ();

1959 
OSTaskC»©eHook
 (
OS_TCB
 *
p_tcb
);

1960 
OSTaskD–Hook
 (
OS_TCB
 *
p_tcb
);

1962 
OSIdËTaskHook
 ();

1964 
OSTaskR‘uºHook
 (
OS_TCB
 *
p_tcb
);

1966 
OSStTaskHook
 ();

1968 
CPU_STK
 *
OSTaskStkIn™
 (
OS_TASK_PTR
 
p_sk
,

1969 *
p_¬g
,

1970 
CPU_STK
 *
p_¡k_ba£
,

1971 
CPU_STK
 *
p_¡k_lim™
,

1972 
CPU_STK_SIZE
 
¡k_size
,

1973 
OS_OPT
 
Ýt
);

1975 
OSTaskSwHook
 ();

1977 
OSTimeTickHook
 ();

1988 
OSCfg_In™
 ();

1990 #ià
OS_CFG_DBG_EN
 > 0u

1991 
OS_Dbg_In™
 ();

1995 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

1996 
OS_IÁQTaskIn™
 (
OS_ERR
 *
p_”r
);

1998 
OS_IÁQPo¡
 (
OS_OBJ_TYPE
 
ty³
,

1999 *
p_obj
,

2000 *
p_void
,

2001 
OS_MSG_SIZE
 
msg_size
,

2002 
OS_FLAGS
 
æags
,

2003 
OS_OPT
 
Ýt
,

2004 
CPU_TS
 
ts
,

2005 
OS_ERR
 *
p_”r
);

2007 
OS_IÁQRePo¡
 ();

2009 
OS_IÁQTask
 (*
p_¬g
);

2014 
OS_MsgPoÞC»©e
 (
OS_MSG
 *
p_msg
,

2015 
OS_MSG_QTY
 
size
);

2017 
OS_MsgPoÞIn™
 (
OS_ERR
 *
p_”r
);

2019 
OS_MSG_QTY
 
OS_MsgQF»eAÎ
 (
OS_MSG_Q
 *
p_msg_q
);

2021 *
OS_MsgQG‘
 (
OS_MSG_Q
 *
p_msg_q
,

2022 
OS_MSG_SIZE
 *
p_msg_size
,

2023 
CPU_TS
 *
p_ts
,

2024 
OS_ERR
 *
p_”r
);

2026 
OS_MsgQIn™
 (
OS_MSG_Q
 *
p_msg_q
,

2027 
OS_MSG_QTY
 
size
);

2029 
OS_MsgQPut
 (
OS_MSG_Q
 *
p_msg_q
,

2030 *
p_void
,

2031 
OS_MSG_SIZE
 
msg_size
,

2032 
OS_OPT
 
Ýt
,

2033 
CPU_TS
 
ts
,

2034 
OS_ERR
 *
p_”r
);

2038 
OS_P’d
 (
OS_PEND_DATA
 *
p_³nd_d©a
,

2039 
OS_PEND_OBJ
 *
p_obj
,

2040 
OS_STATE
 
³ndšg_Ú
,

2041 
OS_TICK
 
timeout
);

2043 
OS_P’dAbÜt
 (
OS_PEND_OBJ
 *
p_obj
,

2044 
OS_TCB
 *
p_tcb
,

2045 
CPU_TS
 
ts
);

2047 
OS_P’dAbÜt1
 (
OS_PEND_OBJ
 *
p_obj
,

2048 
OS_TCB
 *
p_tcb
,

2049 
CPU_TS
 
ts
);

2051 
OS_P’dObjD–
 (
OS_PEND_OBJ
 *
p_obj
,

2052 
OS_TCB
 *
p_tcb
,

2053 
CPU_TS
 
ts
);

2055 
OS_P’dObjD–1
 (
OS_PEND_OBJ
 *
p_obj
,

2056 
OS_TCB
 *
p_tcb
,

2057 
CPU_TS
 
ts
);

2059 
OS_Po¡
 (
OS_PEND_OBJ
 *
p_obj
,

2060 
OS_TCB
 *
p_tcb
,

2061 *
p_void
,

2062 
OS_MSG_SIZE
 
msg_size
,

2063 
CPU_TS
 
ts
);

2065 
OS_Po¡1
 (
OS_PEND_OBJ
 *
p_obj
,

2066 
OS_TCB
 *
p_tcb
,

2067 *
p_void
,

2068 
OS_MSG_SIZE
 
msg_size
,

2069 
CPU_TS
 
ts
);

2073 
OS_PrioIn™
 ();

2075 
OS_PrioIn£¹
 (
OS_PRIO
 
´io
);

2077 
OS_PrioRemove
 (
OS_PRIO
 
´io
);

2079 
OS_PRIO
 
OS_PrioG‘Highe¡
 ();

2083 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

2084 
OS_Sched0
 ();

2087 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

2088 
OS_SchedLockTimeM—sS¹
 ();

2089 
OS_SchedLockTimeM—sStÝ
 ();

2092 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

2093 
OS_SchedRoundRobš
 (
OS_RDY_LIST
 *
p_rdy_li¡
);

2098 
OS_RdyLi¡In™
 ();

2100 
OS_RdyLi¡In£¹
 (
OS_TCB
 *
p_tcb
);

2102 
OS_RdyLi¡In£¹H—d
 (
OS_TCB
 *
p_tcb
);

2104 
OS_RdyLi¡In£¹Taž
 (
OS_TCB
 *
p_tcb
);

2106 
OS_RdyLi¡MoveH—dToTaž
 (
OS_RDY_LIST
 *
p_rdy_li¡
);

2108 
OS_RdyLi¡Remove
 (
OS_TCB
 *
p_tcb
);

2112 
OS_P’dD©aIn™
 (
OS_TCB
 *
p_tcb
,

2113 
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

2114 
OS_OBJ_QTY
 
tbl_size
);

2116 #ià
OS_CFG_DBG_EN
 > 0u

2117 
OS_P’dDbgNameAdd
 (
OS_PEND_OBJ
 *
p_obj
,

2118 
OS_TCB
 *
p_tcb
);

2120 
OS_P’dDbgNameRemove
 (
OS_PEND_OBJ
 *
p_obj
,

2121 
OS_TCB
 *
p_tcb
);

2124 
OS_PEND_LIST
 *
OS_P’dLi¡G‘PŒ
 (
OS_PEND_OBJ
 *
p_obj
);

2126 
OS_P’dLi¡In™
 (
OS_PEND_LIST
 *
p_³nd_li¡
);

2128 
OS_P’dLi¡In£¹H—d
 (
OS_PEND_LIST
 *
p_³nd_li¡
,

2129 
OS_PEND_DATA
 *
p_³nd_d©a
);

2131 
OS_P’dLi¡In£¹Prio
 (
OS_PEND_LIST
 *
p_³nd_li¡
,

2132 
OS_PEND_DATA
 *
p_³nd_d©a
);

2134 
OS_P’dLi¡ChªgePrio
 (
OS_TCB
 *
p_tcb
,

2135 
OS_PRIO
 
´io_Ãw
);

2137 
OS_P’dLi¡Remove
 (
OS_TCB
 *
p_tcb
);

2139 
OS_P’dLi¡Remove1
 (
OS_PEND_LIST
 *
p_³nd_li¡
,

2140 
OS_PEND_DATA
 *
p_³nd_d©a
);

2144 
OS_TickLi¡In™
 ();

2146 
OS_TickLi¡In£¹
 (
OS_TCB
 *
p_tcb
,

2147 
OS_TICK
 
time
,

2148 
OS_OPT
 
Ýt
,

2149 
OS_ERR
 *
p_”r
);

2151 
OS_TickLi¡Remove
 (
OS_TCB
 *
p_tcb
);

2153 
OS_TickLi¡Re£tP—k
 ();

2155 
OS_TickLi¡Upd©e
 ();

2176 #iâdeà
OS_CFG_APP_HOOKS_EN


2181 #iâdeà
OS_CFG_ARG_CHK_EN


2186 #iâdeà
OS_CFG_DBG_EN


2191 #iâdeà
OS_CFG_CALLED_FROM_ISR_CHK_EN


2196 #iâdeà
OS_CFG_OBJ_TYPE_CHK_EN


2201 #iâdeà
OS_CFG_PEND_MULTI_EN


2206 #ià 
OS_CFG_PRIO_MAX
 < 8u

2211 #iâdeà
OS_CFG_SCHED_LOCK_TIME_MEAS_EN


2214 #ià (
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u) && \

2215 (
	gOS_CFG_TS_EN
 < 1u)

2221 #iâdeà
OS_CFG_SCHED_ROUND_ROBIN_EN


2226 #iâdeà
OS_CFG_STK_SIZE_MIN


2230 #iâdeà
OS_CFG_TS_EN


2233 #ià (
OS_CFG_TS_EN
 > 0u) && \

2234 (
	gCPU_CFG_TS_EN
 =ð
DEF_DISABLED
)

2245 #iâdeà
OS_CFG_FLAG_EN


2248 #iâdeà
OS_CFG_FLAG_DEL_EN


2252 #iâdeà
OS_CFG_FLAG_MODE_CLR_EN


2256 #iâdeà
OS_CFG_FLAG_PEND_ABORT_EN


2267 #iâdeà
OS_CFG_MEM_EN


2277 #iâdeà
OS_CFG_MUTEX_EN


2280 #iâdeà
OS_CFG_MUTEX_DEL_EN


2284 #iâdeà
OS_CFG_MUTEX_PEND_ABORT_EN


2295 #iâdeà
OS_CFG_Q_EN


2298 #iâdeà
OS_CFG_Q_DEL_EN


2302 #iâdeà
OS_CFG_Q_FLUSH_EN


2306 #iâdeà
OS_CFG_Q_PEND_ABORT_EN


2317 #iâdeà
OS_CFG_SEM_EN


2320 #iâdeà
OS_CFG_SEM_DEL_EN


2324 #iâdeà
OS_CFG_SEM_PEND_ABORT_EN


2328 #iâdeà
OS_CFG_SEM_SET_EN


2339 #iâdeà
OS_CFG_STAT_TASK_EN


2343 #iâdeà
OS_CFG_STAT_TASK_STK_CHK_EN


2347 #iâdeà
OS_CFG_TASK_CHANGE_PRIO_EN


2351 #iâdeà
OS_CFG_TASK_DEL_EN


2355 #iâdeà
OS_CFG_TASK_Q_EN


2359 #iâdeà
OS_CFG_TASK_Q_PEND_ABORT_EN


2363 #iâdeà
OS_CFG_TASK_PROFILE_EN


2367 #iâdeà
OS_CFG_TASK_REG_TBL_SIZE


2371 #iâdeà
OS_CFG_TASK_SEM_PEND_ABORT_EN


2375 #iâdeà
OS_CFG_TASK_SUSPEND_EN


2385 #iâdeà
OS_CFG_TIME_DLY_HMSM_EN


2389 #iâdeà
OS_CFG_TIME_DLY_RESUME_EN


2399 #iâdeà
OS_CFG_TMR_EN


2402 #iâdeà
OS_CFG_TMR_DEL_EN


2414 #ià
LIB_VERSION
 < 126u

2420 #ià
CPU_CORE_VERSION
 < 125u

2431 #ifdeà
__ýlu¥lus


	@os_cfg_app.c

35 
	#MICRIUM_SOURCE


	)

36 
	~<os_cfg_­p.h
>

37 
	~<os.h
>

39 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


40 cÚ¡ 
CPU_CHAR
 *
	gos_cfg_­p__c
 = "$Id: $";

43 
	#OS_CFG_IDLE_TASK_STK_LIMIT
 ((
OS_CFG_IDLE_TASK_STK_SIZE
 * 
OS_CFG_TASK_STK_LIMIT_PCT_EMPTY
è/ 100u)

	)

44 
	#OS_CFG_INT_Q_TASK_STK_LIMIT
 ((
OS_CFG_INT_Q_TASK_STK_SIZE
 * 
OS_CFG_TASK_STK_LIMIT_PCT_EMPTY
è/ 100u)

	)

45 
	#OS_CFG_STAT_TASK_STK_LIMIT
 ((
OS_CFG_STAT_TASK_STK_SIZE
 * 
OS_CFG_TASK_STK_LIMIT_PCT_EMPTY
è/ 100u)

	)

46 
	#OS_CFG_TICK_TASK_STK_LIMIT
 ((
OS_CFG_TICK_TASK_STK_SIZE
 * 
OS_CFG_TASK_STK_LIMIT_PCT_EMPTY
è/ 100u)

	)

47 
	#OS_CFG_TMR_TASK_STK_LIMIT
 ((
OS_CFG_TMR_TASK_STK_SIZE
 * 
OS_CFG_TASK_STK_LIMIT_PCT_EMPTY
è/ 100u)

	)

55 
CPU_STK
 
	gOSCfg_IdËTaskStk
 [
OS_CFG_IDLE_TASK_STK_SIZE
];

57 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u)

58 
OS_INT_Q
 
	gOSCfg_IÁQ
 [
OS_CFG_INT_Q_SIZE
];

59 
CPU_STK
 
	gOSCfg_IÁQTaskStk
 [
OS_CFG_INT_Q_TASK_STK_SIZE
];

62 #ià(
OS_CFG_ISR_STK_SIZE
 > 0u)

63 
CPU_STK
 
	gOSCfg_ISRStk
 [
OS_CFG_ISR_STK_SIZE
];

66 #ià(
OS_MSG_EN
 > 0u)

67 
OS_MSG
 
	gOSCfg_MsgPoÞ
 [
OS_CFG_MSG_POOL_SIZE
];

70 #ià(
OS_CFG_STAT_TASK_EN
 > 0u)

71 
CPU_STK
 
	gOSCfg_StTaskStk
 [
OS_CFG_STAT_TASK_STK_SIZE
];

74 
CPU_STK
 
	gOSCfg_TickTaskStk
 [
OS_CFG_TICK_TASK_STK_SIZE
];

75 
OS_TICK_SPOKE
 
	gOSCfg_TickWh“l
 [
OS_CFG_TICK_WHEEL_SIZE
];

77 #ià(
OS_CFG_TMR_EN
 > 0u)

78 
CPU_STK
 
	gOSCfg_TmrTaskStk
 [
OS_CFG_TMR_TASK_STK_SIZE
];

79 
OS_TMR_SPOKE
 
	gOSCfg_TmrWh“l
 [
OS_CFG_TMR_WHEEL_SIZE
];

89 
CPU_STK
 * cÚ¡ 
	gOSCfg_IdËTaskStkBa£PŒ
 = (CPU_STK *)&
OSCfg_IdËTaskStk
[0];

90 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_IdËTaskStkLim™
 = (CPU_STK_SIZE)
OS_CFG_IDLE_TASK_STK_LIMIT
;

91 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_IdËTaskStkSize
 = (CPU_STK_SIZE)
OS_CFG_IDLE_TASK_STK_SIZE
;

92 
CPU_INT32U
 cÚ¡ 
	gOSCfg_IdËTaskStkSizeRAM
 = (CPU_INT32U )(
OSCfg_IdËTaskStk
);

95 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u)

96 
OS_INT_Q
 * cÚ¡ 
	gOSCfg_IÁQBa£PŒ
 = (OS_INT_Q *)&
OSCfg_IÁQ
[0];

97 
OS_OBJ_QTY
 cÚ¡ 
	gOSCfg_IÁQSize
 = (OS_OBJ_QTY )
OS_CFG_INT_Q_SIZE
;

98 
CPU_INT32U
 cÚ¡ 
	gOSCfg_IÁQSizeRAM
 = (CPU_INT32U )(
OSCfg_IÁQ
);

99 
CPU_STK
 * cÚ¡ 
	gOSCfg_IÁQTaskStkBa£PŒ
 = (CPU_STK *)&
OSCfg_IÁQTaskStk
[0];

100 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_IÁQTaskStkLim™
 = (CPU_STK_SIZE)
OS_CFG_INT_Q_TASK_STK_LIMIT
;

101 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_IÁQTaskStkSize
 = (CPU_STK_SIZE)
OS_CFG_INT_Q_TASK_STK_SIZE
;

102 
CPU_INT32U
 cÚ¡ 
	gOSCfg_IÁQTaskStkSizeRAM
 = (CPU_INT32U )(
OSCfg_IÁQTaskStk
);

104 
OS_INT_Q
 * cÚ¡ 
	gOSCfg_IÁQBa£PŒ
 = (OS_INT_Q *)0;

105 
OS_OBJ_QTY
 cÚ¡ 
	gOSCfg_IÁQSize
 = (OS_OBJ_QTY )0;

106 
CPU_INT32U
 cÚ¡ 
	gOSCfg_IÁQSizeRAM
 = (CPU_INT32U )0;

107 
CPU_STK
 * cÚ¡ 
	gOSCfg_IÁQTaskStkBa£PŒ
 = (CPU_STK *)0;

108 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_IÁQTaskStkLim™
 = (CPU_STK_SIZE)0;

109 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_IÁQTaskStkSize
 = (CPU_STK_SIZE)0;

110 
CPU_INT32U
 cÚ¡ 
	gOSCfg_IÁQTaskStkSizeRAM
 = (CPU_INT32U )0;

114 #ià(
OS_CFG_ISR_STK_SIZE
 > 0u)

115 
CPU_STK
 * cÚ¡ 
	gOSCfg_ISRStkBa£PŒ
 = (CPU_STK *)&
OSCfg_ISRStk
[0];

116 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_ISRStkSize
 = (CPU_STK_SIZE)
OS_CFG_ISR_STK_SIZE
;

117 
CPU_INT32U
 cÚ¡ 
	gOSCfg_ISRStkSizeRAM
 = (CPU_INT32U )(
OSCfg_ISRStk
);

119 
CPU_STK
 * cÚ¡ 
	gOSCfg_ISRStkBa£PŒ
 = (CPU_STK *)0;

120 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_ISRStkSize
 = (CPU_STK_SIZE)0;

121 
CPU_INT32U
 cÚ¡ 
	gOSCfg_ISRStkSizeRAM
 = (CPU_INT32U )0;

125 #ià(
OS_MSG_EN
 > 0u)

126 
OS_MSG_SIZE
 cÚ¡ 
	gOSCfg_MsgPoÞSize
 = (OS_MSG_SIZE)
OS_CFG_MSG_POOL_SIZE
;

127 
CPU_INT32U
 cÚ¡ 
	gOSCfg_MsgPoÞSizeRAM
 = (CPU_INT32U )(
OSCfg_MsgPoÞ
);

128 
OS_MSG
 * cÚ¡ 
	gOSCfg_MsgPoÞBa£PŒ
 = (OS_MSG *)&
OSCfg_MsgPoÞ
[0];

130 
OS_MSG_SIZE
 cÚ¡ 
	gOSCfg_MsgPoÞSize
 = (OS_MSG_SIZE)0;

131 
CPU_INT32U
 cÚ¡ 
	gOSCfg_MsgPoÞSizeRAM
 = (CPU_INT32U )0;

132 
OS_MSG
 * cÚ¡ 
	gOSCfg_MsgPoÞBa£PŒ
 = (OS_MSG *)0;

136 #ià(
OS_CFG_STAT_TASK_EN
 > 0u)

137 
OS_PRIO
 cÚ¡ 
	gOSCfg_StTaskPrio
 = (OS_PRIO )
OS_CFG_STAT_TASK_PRIO
;

138 
OS_RATE_HZ
 cÚ¡ 
	gOSCfg_StTaskR©e_Hz
 = (OS_RATE_HZ )
OS_CFG_STAT_TASK_RATE_HZ
;

139 
CPU_STK
 * cÚ¡ 
	gOSCfg_StTaskStkBa£PŒ
 = (CPU_STK *)&
OSCfg_StTaskStk
[0];

140 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_StTaskStkLim™
 = (CPU_STK_SIZE)
OS_CFG_STAT_TASK_STK_LIMIT
;

141 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_StTaskStkSize
 = (CPU_STK_SIZE)
OS_CFG_STAT_TASK_STK_SIZE
;

142 
CPU_INT32U
 cÚ¡ 
	gOSCfg_StTaskStkSizeRAM
 = (CPU_INT32U )(
OSCfg_StTaskStk
);

144 
OS_PRIO
 cÚ¡ 
	gOSCfg_StTaskPrio
 = (OS_PRIO )0;

145 
OS_RATE_HZ
 cÚ¡ 
	gOSCfg_StTaskR©e_Hz
 = (OS_RATE_HZ )0;

146 
CPU_STK
 * cÚ¡ 
	gOSCfg_StTaskStkBa£PŒ
 = (CPU_STK *)0;

147 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_StTaskStkLim™
 = (CPU_STK_SIZE)0;

148 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_StTaskStkSize
 = (CPU_STK_SIZE)0;

149 
CPU_INT32U
 cÚ¡ 
	gOSCfg_StTaskStkSizeRAM
 = (CPU_INT32U )0;

153 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_StkSizeMš
 = (CPU_STK_SIZE)
OS_CFG_STK_SIZE_MIN
;

156 
OS_RATE_HZ
 cÚ¡ 
	gOSCfg_TickR©e_Hz
 = (OS_RATE_HZ )
OS_CFG_TICK_RATE_HZ
;

157 
OS_PRIO
 cÚ¡ 
	gOSCfg_TickTaskPrio
 = (OS_PRIO )
OS_CFG_TICK_TASK_PRIO
;

158 
CPU_STK
 * cÚ¡ 
	gOSCfg_TickTaskStkBa£PŒ
 = (CPU_STK *)&
OSCfg_TickTaskStk
[0];

159 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_TickTaskStkLim™
 = (CPU_STK_SIZE)
OS_CFG_TICK_TASK_STK_LIMIT
;

160 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_TickTaskStkSize
 = (CPU_STK_SIZE)
OS_CFG_TICK_TASK_STK_SIZE
;

161 
CPU_INT32U
 cÚ¡ 
	gOSCfg_TickTaskStkSizeRAM
 = (CPU_INT32U )(
OSCfg_TickTaskStk
);

162 
OS_OBJ_QTY
 cÚ¡ 
	gOSCfg_TickWh“lSize
 = (OS_OBJ_QTY )
OS_CFG_TICK_WHEEL_SIZE
;

163 
CPU_INT32U
 cÚ¡ 
	gOSCfg_TickWh“lSizeRAM
 = (CPU_INT32U )(
OSCfg_TickWh“l
);

166 #ià(
OS_CFG_TMR_EN
 > 0u)

167 
OS_PRIO
 cÚ¡ 
	gOSCfg_TmrTaskPrio
 = (OS_PRIO )
OS_CFG_TMR_TASK_PRIO
;

168 
OS_RATE_HZ
 cÚ¡ 
	gOSCfg_TmrTaskR©e_Hz
 = (OS_RATE_HZ )
OS_CFG_TMR_TASK_RATE_HZ
;

169 
CPU_STK
 * cÚ¡ 
	gOSCfg_TmrTaskStkBa£PŒ
 = (CPU_STK *)&
OSCfg_TmrTaskStk
[0];

170 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_TmrTaskStkLim™
 = (CPU_STK_SIZE)
OS_CFG_TMR_TASK_STK_LIMIT
;

171 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_TmrTaskStkSize
 = (CPU_STK_SIZE)
OS_CFG_TMR_TASK_STK_SIZE
;

172 
CPU_INT32U
 cÚ¡ 
	gOSCfg_TmrTaskStkSizeRAM
 = (CPU_INT32U )(
OSCfg_TmrTaskStk
);

173 
OS_OBJ_QTY
 cÚ¡ 
	gOSCfg_TmrWh“lSize
 = (OS_OBJ_QTY )
OS_CFG_TMR_WHEEL_SIZE
;

174 
CPU_INT32U
 cÚ¡ 
	gOSCfg_TmrWh“lSizeRAM
 = (CPU_INT32U )(
OSCfg_TmrWh“l
);

176 
OS_PRIO
 cÚ¡ 
	gOSCfg_TmrTaskPrio
 = (OS_PRIO )0;

177 
OS_RATE_HZ
 cÚ¡ 
	gOSCfg_TmrTaskR©e_Hz
 = (OS_RATE_HZ )0;

178 
CPU_STK
 * cÚ¡ 
	gOSCfg_TmrTaskStkBa£PŒ
 = (CPU_STK *)0;

179 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_TmrTaskStkLim™
 = (CPU_STK_SIZE)0;

180 
CPU_STK_SIZE
 cÚ¡ 
	gOSCfg_TmrTaskStkSize
 = (CPU_STK_SIZE)0;

181 
CPU_INT32U
 cÚ¡ 
	gOSCfg_TmrTaskStkSizeRAM
 = (CPU_INT32U )0;

182 
OS_OBJ_QTY
 cÚ¡ 
	gOSCfg_TmrWh“lSize
 = (OS_OBJ_QTY )0;

183 
CPU_INT32U
 cÚ¡ 
	gOSCfg_TmrWh“lSizeRAM
 = (CPU_INT32U )0;

194 
CPU_INT32U
 cÚ¡ 
	gOSCfg_D©aSizeRAM
 = (
OSCfg_IdËTaskStk
)

196 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u)

197 + (
OSCfg_IÁQ
)

198 + (
OSCfg_IÁQTaskStk
)

201 #ià(
OS_MSG_EN
 > 0u)

202 + (
OSCfg_MsgPoÞ
)

205 #ià(
OS_CFG_STAT_TASK_EN
 > 0u)

206 + (
OSCfg_StTaskStk
)

209 #ià(
OS_CFG_TMR_EN
 > 0u)

210 + (
OSCfg_TmrTaskStk
)

211 + (
OSCfg_TmrWh“l
)

214 #ià(
OS_CFG_ISR_STK_SIZE
 > 0u)

215 + (
OSCfg_ISRStk
)

217 + (
OSCfg_TickTaskStk
)

218 + (
OSCfg_TickWh“l
);

240 
	$OSCfg_In™
 ()

242 cÚ¡ *
p_‹mp
;

245 
p_‹mp
 = (cÚ¡ *)&
OSCfg_D©aSizeRAM
;

247 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IdËTaskStkBa£PŒ
;

248 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IdËTaskStkLim™
;

249 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IdËTaskStkSize
;

250 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IdËTaskStkSizeRAM
;

252 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u)

253 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQBa£PŒ
;

254 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQSize
;

255 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQSizeRAM
;

256 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQTaskStkBa£PŒ
;

257 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQTaskStkLim™
;

258 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQTaskStkSize
;

259 
p_‹mp
 = (cÚ¡ *)&
OSCfg_IÁQTaskStkSizeRAM
;

262 
p_‹mp
 = (cÚ¡ *)&
OSCfg_ISRStkBa£PŒ
;

263 
p_‹mp
 = (cÚ¡ *)&
OSCfg_ISRStkSize
;

264 
p_‹mp
 = (cÚ¡ *)&
OSCfg_ISRStkSizeRAM
;

266 #ià(
OS_MSG_EN
 > 0u)

267 
p_‹mp
 = (cÚ¡ *)&
OSCfg_MsgPoÞSize
;

268 
p_‹mp
 = (cÚ¡ *)&
OSCfg_MsgPoÞSizeRAM
;

269 
p_‹mp
 = (cÚ¡ *)&
OSCfg_MsgPoÞBa£PŒ
;

272 #ià(
OS_CFG_STAT_TASK_EN
 > 0u)

273 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StTaskPrio
;

274 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StTaskR©e_Hz
;

275 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StTaskStkBa£PŒ
;

276 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StTaskStkLim™
;

277 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StTaskStkSize
;

278 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StTaskStkSizeRAM
;

281 
p_‹mp
 = (cÚ¡ *)&
OSCfg_StkSizeMš
;

283 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickR©e_Hz
;

284 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickTaskPrio
;

285 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickTaskStkBa£PŒ
;

286 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickTaskStkLim™
;

287 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickTaskStkSize
;

288 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickTaskStkSizeRAM
;

289 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickWh“lSize
;

290 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TickWh“lSizeRAM
;

292 #ià(
OS_CFG_TMR_EN
 > 0u)

293 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrTaskPrio
;

294 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrTaskR©e_Hz
;

295 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrTaskStkBa£PŒ
;

296 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrTaskStkLim™
;

297 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrTaskStkSize
;

298 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrTaskStkSizeRAM
;

299 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrWh“lSize
;

300 
p_‹mp
 = (cÚ¡ *)&
OSCfg_TmrWh“lSizeRAM
;

302 
p_‹mp
 =…_temp;

303 
	}
}

	@os_core.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_cÜe__c
 = "$Id: $";

55 
	$OSIn™
 (
OS_ERR
 *
p_”r
)

57 
CPU_STK
 *
p_¡k
;

58 
CPU_STK_SIZE
 
size
;

62 #ifdeà
OS_SAFETY_CRITICAL


63 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

64 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

69 
	`OSIn™Hook
();

71 
OSIÁNe¡šgCŒ
 = (
OS_NESTING_CTR
)0;

73 
OSRuÂšg
 = 
OS_STATE_OS_STOPPED
;

75 
OSSchedLockNe¡šgCŒ
 = (
OS_NESTING_CTR
)0;

77 
OSTCBCurPŒ
 = (
OS_TCB
 *)0;

78 
OSTCBHighRdyPŒ
 = (
OS_TCB
 *)0;

80 
OSPrioCur
 = (
OS_PRIO
)0;

81 
OSPrioHighRdy
 = (
OS_PRIO
)0;

82 
OSPrioSaved
 = (
OS_PRIO
)0;

84 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

85 
OSSchedLockTimeBegš
 = (
CPU_TS
)0;

86 
OSSchedLockTimeMax
 = (
CPU_TS
)0;

87 
OSSchedLockTimeMaxCur
 = (
CPU_TS
)0;

90 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


91 
OSSaãtyCr™iÿlS¹FÏg
 = 
DEF_FALSE
;

94 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

95 
OSSchedRoundRobšEn
 = 
DEF_FALSE
;

96 
OSSchedRoundRobšDætTimeQuª
 = 
OSCfg_TickR©e_Hz
 / 10u;

99 ià(
OSCfg_ISRStkSize
 > (
CPU_STK_SIZE
)0) {

100 
p_¡k
 = 
OSCfg_ISRStkBa£PŒ
;

101 ià(
p_¡k
 !ð(
CPU_STK
 *)0) {

102 
size
 = 
OSCfg_ISRStkSize
;

103 
size
 > (
CPU_STK_SIZE
)0) {

104 
size
--;

105 *
p_¡k
 = (
CPU_STK
)0;

106 
p_¡k
++;

111 #ià
OS_CFG_APP_HOOKS_EN
 > 0u

112 
OS_AµTaskC»©eHookPŒ
 = (
OS_APP_HOOK_TCB
 )0;

113 
OS_AµTaskD–HookPŒ
 = (
OS_APP_HOOK_TCB
 )0;

114 
OS_AµTaskR‘uºHookPŒ
 = (
OS_APP_HOOK_TCB
 )0;

116 
OS_AµIdËTaskHookPŒ
 = (
OS_APP_HOOK_VOID
)0;

117 
OS_AµStTaskHookPŒ
 = (
OS_APP_HOOK_VOID
)0;

118 
OS_AµTaskSwHookPŒ
 = (
OS_APP_HOOK_VOID
)0;

119 
OS_AµTimeTickHookPŒ
 = (
OS_APP_HOOK_VOID
)0;

122 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

123 
OSTaskRegNextAvažID
 = (
OS_REG_ID
)0;

126 
	`OS_PrioIn™
();

128 
	`OS_RdyLi¡In™
();

131 #ià
OS_CFG_FLAG_EN
 > 0u

132 
	`OS_FÏgIn™
(
p_”r
);

133 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

139 #ià
OS_CFG_MEM_EN
 > 0u

140 
	`OS_MemIn™
(
p_”r
);

141 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

147 #ià(
OS_MSG_EN
) > 0u

148 
	`OS_MsgPoÞIn™
(
p_”r
);

149 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

155 #ià
OS_CFG_MUTEX_EN
 > 0u

156 
	`OS_Mu‹xIn™
(
p_”r
);

157 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

163 #ià
OS_CFG_Q_EN
 > 0u

164 
	`OS_QIn™
(
p_”r
);

165 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

171 #ià
OS_CFG_SEM_EN
 > 0u

172 
	`OS_SemIn™
(
p_”r
);

173 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

179 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

180 
	`OS_TLS_In™
(
p_”r
);

181 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

187 
	`OS_TaskIn™
(
p_”r
);

188 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

193 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

194 
	`OS_IÁQTaskIn™
(
p_”r
);

195 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

201 
	`OS_IdËTaskIn™
(
p_”r
);

202 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

207 
	`OS_TickTaskIn™
(
p_”r
);

208 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

213 #ià
OS_CFG_STAT_TASK_EN
 > 0u

214 
	`OS_StTaskIn™
(
p_”r
);

215 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

221 #ià
OS_CFG_TMR_EN
 > 0u

222 
	`OS_TmrIn™
(
p_”r
);

223 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

229 #ià
OS_CFG_DBG_EN
 > 0u

230 
	`OS_Dbg_In™
();

234 
	`OSCfg_In™
();

235 
	}
}

266 
	$OSIÁEÁ”
 ()

268 ià(
OSRuÂšg
 !ð
OS_STATE_OS_RUNNING
) {

272 ià(
OSIÁNe¡šgCŒ
 >ð(
OS_NESTING_CTR
)250u) {

276 
OSIÁNe¡šgCŒ
++;

277 
	}
}

300 
	$OSIÁEx™
 ()

302 
	`CPU_SR_ALLOC
();

306 ià(
OSRuÂšg
 !ð
OS_STATE_OS_RUNNING
) {

310 
	`CPU_INT_DIS
();

311 ià(
OSIÁNe¡šgCŒ
 =ð(
OS_NESTING_CTR
)0) {

312 
	`CPU_INT_EN
();

315 
OSIÁNe¡šgCŒ
--;

316 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

317 
	`CPU_INT_EN
();

321 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

322 
	`CPU_INT_EN
();

326 
OSPrioHighRdy
 = 
	`OS_PrioG‘Highe¡
();

327 
OSTCBHighRdyPŒ
 = 
OSRdyLi¡
[
OSPrioHighRdy
].
H—dPŒ
;

328 ià(
OSTCBHighRdyPŒ
 =ð
OSTCBCurPŒ
) {

329 
	`CPU_INT_EN
();

333 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

334 
OSTCBHighRdyPŒ
->
CtxSwCŒ
++;

336 
OSTaskCtxSwCŒ
++;

338 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

339 
	`OS_TLS_TaskSw
();

342 
	`OSIÁCtxSw
();

343 
	`CPU_INT_EN
();

344 
	}
}

362 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


363 
	$OSSaãtyCr™iÿlS¹
 ()

365 
OSSaãtyCr™iÿlS¹FÏg
 = 
DEF_TRUE
;

366 
	}
}

387 
	$OSSched
 ()

389 
	`CPU_SR_ALLOC
();

393 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

397 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

401 
	`CPU_INT_DIS
();

402 
OSPrioHighRdy
 = 
	`OS_PrioG‘Highe¡
();

403 
OSTCBHighRdyPŒ
 = 
OSRdyLi¡
[
OSPrioHighRdy
].
H—dPŒ
;

404 ià(
OSTCBHighRdyPŒ
 =ð
OSTCBCurPŒ
) {

405 
	`CPU_INT_EN
();

409 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

410 
OSTCBHighRdyPŒ
->
CtxSwCŒ
++;

412 
OSTaskCtxSwCŒ
++;

414 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

415 
	`OS_TLS_TaskSw
();

418 
	`OS_TASK_SW
();

419 
	`CPU_INT_EN
();

420 
	}
}

444 
	$OSSchedLock
 (
OS_ERR
 *
p_”r
)

446 
	`CPU_SR_ALLOC
();

450 #ifdeà
OS_SAFETY_CRITICAL


451 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

452 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

457 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

458 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

459 *
p_”r
 = 
OS_ERR_SCHED_LOCK_ISR
;

464 ià(
OSRuÂšg
 !ð
OS_STATE_OS_RUNNING
) {

465 *
p_”r
 = 
OS_ERR_OS_NOT_RUNNING
;

469 ià(
OSSchedLockNe¡šgCŒ
 >ð(
OS_NESTING_CTR
)250u) {

470 *
p_”r
 = 
OS_ERR_LOCK_NESTING_OVF
;

474 
	`CPU_CRITICAL_ENTER
();

475 
OSSchedLockNe¡šgCŒ
++;

476 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

477 
	`OS_SchedLockTimeM—sS¹
();

479 
	`CPU_CRITICAL_EXIT
();

480 *
p_”r
 = 
OS_ERR_NONE
;

481 
	}
}

505 
	$OSSchedUÆock
 (
OS_ERR
 *
p_”r
)

507 
	`CPU_SR_ALLOC
();

511 #ifdeà
OS_SAFETY_CRITICAL


512 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

513 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

518 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

519 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

520 *
p_”r
 = 
OS_ERR_SCHED_UNLOCK_ISR
;

525 ià(
OSRuÂšg
 !ð
OS_STATE_OS_RUNNING
) {

526 *
p_”r
 = 
OS_ERR_OS_NOT_RUNNING
;

530 ià(
OSSchedLockNe¡šgCŒ
 =ð(
OS_NESTING_CTR
)0) {

531 *
p_”r
 = 
OS_ERR_SCHED_NOT_LOCKED
;

535 
	`CPU_CRITICAL_ENTER
();

536 
OSSchedLockNe¡šgCŒ
--;

537 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

538 
	`CPU_CRITICAL_EXIT
();

539 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

543 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

544 
	`OS_SchedLockTimeM—sStÝ
();

547 
	`CPU_CRITICAL_EXIT
();

548 
	`OSSched
();

549 *
p_”r
 = 
OS_ERR_NONE
;

550 
	}
}

571 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

572 
	$OSSchedRoundRobšCfg
 (
CPU_BOOLEAN
 
’
,

573 
OS_TICK
 
dæt_time_quª
,

574 
OS_ERR
 *
p_”r
)

576 
	`CPU_SR_ALLOC
();

580 #ifdeà
OS_SAFETY_CRITICAL


581 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

582 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

587 
	`CPU_CRITICAL_ENTER
();

588 ià(
’
 !ð
DEF_ENABLED
) {

589 
OSSchedRoundRobšEn
 = 
DEF_DISABLED
;

591 
OSSchedRoundRobšEn
 = 
DEF_ENABLED
;

594 ià(
dæt_time_quª
 > (
OS_TICK
)0) {

595 
OSSchedRoundRobšDætTimeQuª
 = 
dæt_time_quª
;

597 
OSSchedRoundRobšDætTimeQuª
 = (
OS_TICK
)(
OSCfg_TickR©e_Hz
 / (
OS_RATE_HZ
)10);

599 
	`CPU_CRITICAL_EXIT
();

600 *
p_”r
 = 
OS_ERR_NONE
;

601 
	}
}

625 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

626 
	$OSSchedRoundRobšY›ld
 (
OS_ERR
 *
p_”r
)

628 
OS_RDY_LIST
 *
p_rdy_li¡
;

629 
OS_TCB
 *
p_tcb
;

630 
	`CPU_SR_ALLOC
();

634 #ifdeà
OS_SAFETY_CRITICAL


635 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

636 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

641 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

642 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

643 *
p_”r
 = 
OS_ERR_YIELD_ISR
;

648 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

649 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

653 ià(
OSSchedRoundRobšEn
 !ð
DEF_TRUE
) {

654 *
p_”r
 = 
OS_ERR_ROUND_ROBIN_DISABLED
;

658 
	`CPU_CRITICAL_ENTER
();

659 
p_rdy_li¡
 = &
OSRdyLi¡
[
OSPrioCur
];

660 ià(
p_rdy_li¡
->
NbrEÁr›s
 < (
OS_OBJ_QTY
)2) {

661 
	`CPU_CRITICAL_EXIT
();

662 *
p_”r
 = 
OS_ERR_ROUND_ROBIN_1
;

666 
	`OS_RdyLi¡MoveH—dToTaž
(
p_rdy_li¡
);

667 
p_tcb
 = 
p_rdy_li¡
->
H—dPŒ
;

668 ià(
p_tcb
->
TimeQuª
 =ð(
OS_TICK
)0) {

669 
p_tcb
->
TimeQuªCŒ
 = 
OSSchedRoundRobšDætTimeQuª
;

671 
p_tcb
->
TimeQuªCŒ
 =…_tcb->
TimeQuª
;

674 
	`CPU_CRITICAL_EXIT
();

676 
	`OSSched
();

677 *
p_”r
 = 
OS_ERR_NONE
;

678 
	}
}

706 
	$OSS¹
 (
OS_ERR
 *
p_”r
)

708 #ifdeà
OS_SAFETY_CRITICAL


709 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

710 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

715 ià(
OSRuÂšg
 =ð
OS_STATE_OS_STOPPED
) {

716 
OSPrioHighRdy
 = 
	`OS_PrioG‘Highe¡
();

717 
OSPrioCur
 = 
OSPrioHighRdy
;

718 
OSTCBHighRdyPŒ
 = 
OSRdyLi¡
[
OSPrioHighRdy
].
H—dPŒ
;

719 
OSTCBCurPŒ
 = 
OSTCBHighRdyPŒ
;

720 
OSRuÂšg
 = 
OS_STATE_OS_RUNNING
;

721 
	`OSS¹HighRdy
();

722 *
p_”r
 = 
OS_ERR_FATAL_RETURN
;

724 *
p_”r
 = 
OS_ERR_OS_RUNNING
;

726 
	}
}

745 
CPU_INT16U
 
	$OSV”siÚ
 (
OS_ERR
 *
p_”r
)

747 #ifdeà
OS_SAFETY_CRITICAL


748 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

749 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

750  ((
CPU_INT16U
)0u);

754 *
p_”r
 = 
OS_ERR_NONE
;

755  (
OS_VERSION
);

756 
	}
}

781 
	$OS_IdËTask
 (*
p_¬g
)

783 
	`CPU_SR_ALLOC
();

787 
p_¬g
 =…_arg;

789 
DEF_ON
) {

790 
	`CPU_CRITICAL_ENTER
();

791 
OSIdËTaskCŒ
++;

792 #ià
OS_CFG_STAT_TASK_EN
 > 0u

793 
OSStTaskCŒ
++;

795 
	`CPU_CRITICAL_EXIT
();

797 
	`OSIdËTaskHook
();

799 
	}
}

816 
	$OS_IdËTaskIn™
 (
OS_ERR
 *
p_”r
)

818 #ifdeà
OS_SAFETY_CRITICAL


819 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

820 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

825 
OSIdËTaskCŒ
 = (
OS_IDLE_CTR
)0;

827 
	`OSTaskC»©e
((
OS_TCB
 *)&
OSIdËTaskTCB
,

828 (
CPU_CHAR
 *)((*)"uC/OS-III Idle Task"),

829 (
OS_TASK_PTR
)
OS_IdËTask
,

831 (
OS_PRIO
 )(
OS_CFG_PRIO_MAX
 - 1u),

832 (
CPU_STK
 *)
OSCfg_IdËTaskStkBa£PŒ
,

833 (
CPU_STK_SIZE
)
OSCfg_IdËTaskStkLim™
,

834 (
CPU_STK_SIZE
)
OSCfg_IdËTaskStkSize
,

835 (
OS_MSG_QTY
 )0u,

836 (
OS_TICK
 )0u,

838 (
OS_OPT
 )(
OS_OPT_TASK_STK_CHK
 | 
OS_OPT_TASK_STK_CLR
 | 
OS_OPT_TASK_NO_TLS
),

839 (
OS_ERR
 *)
p_”r
);

840 
	}
}

873 
	$OS_P’d
 (
OS_PEND_DATA
 *
p_³nd_d©a
,

874 
OS_PEND_OBJ
 *
p_obj
,

875 
OS_STATE
 
³ndšg_Ú
,

876 
OS_TICK
 
timeout
)

878 
OS_PEND_LIST
 *
p_³nd_li¡
;

882 
OSTCBCurPŒ
->
P’dOn
 = 
³ndšg_Ú
;

883 
OSTCBCurPŒ
->
P’dStus
 = 
OS_STATUS_PEND_OK
;

885 
	`OS_TaskBlock
(
OSTCBCurPŒ
,

886 
timeout
);

888 ià(
p_obj
 !ð(
OS_PEND_OBJ
 *)0) {

889 
p_³nd_li¡
 = &
p_obj
->
P’dLi¡
;

890 
p_³nd_d©a
->
P’dObjPŒ
 = 
p_obj
;

891 
	`OS_P’dD©aIn™
((
OS_TCB
 *)
OSTCBCurPŒ
,

892 (
OS_PEND_DATA
 *)
p_³nd_d©a
,

893 (
OS_OBJ_QTY
 )1);

894 
	`OS_P’dLi¡In£¹Prio
(
p_³nd_li¡
,

895 
p_³nd_d©a
);

897 
OSTCBCurPŒ
->
P’dD©aTblEÁr›s
 = (
OS_OBJ_QTY
 )0;

898 
OSTCBCurPŒ
->
P’dD©aTblPŒ
 = (
OS_PEND_DATA
 *)0;

900 #ià
OS_CFG_DBG_EN
 > 0u

901 
	`OS_P’dDbgNameAdd
(
p_obj
,

902 
OSTCBCurPŒ
);

904 
	}
}

927 
	$OS_P’dAbÜt
 (
OS_PEND_OBJ
 *
p_obj
,

928 
OS_TCB
 *
p_tcb
,

929 
CPU_TS
 
ts
)

931 
p_tcb
->
TaskS‹
) {

932 
OS_TASK_STATE_RDY
:

933 
OS_TASK_STATE_DLY
:

934 
OS_TASK_STATE_SUSPENDED
:

935 
OS_TASK_STATE_DLY_SUSPENDED
:

938 
OS_TASK_STATE_PEND
:

939 
OS_TASK_STATE_PEND_TIMEOUT
:

940 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_MULTI
) {

941 
	`OS_P’dAbÜt1
(
p_obj
,

942 
p_tcb
,

943 
ts
);

945 #ià(
OS_MSG_EN
 > 0u)

946 
p_tcb
->
MsgPŒ
 = (*)0;

947 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

949 
p_tcb
->
TS
 = 
ts
;

950 ià(
p_obj
 !ð(
OS_PEND_OBJ
 *)0) {

951 
	`OS_P’dLi¡Remove
(
p_tcb
);

953 
	`OS_TaskRdy
(
p_tcb
);

954 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

955 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_ABORT
;

956 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

959 
OS_TASK_STATE_PEND_SUSPENDED
:

960 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

961 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_MULTI
) {

962 
	`OS_P’dAbÜt1
(
p_obj
,

963 
p_tcb
,

964 
ts
);

966 #ià(
OS_MSG_EN
 > 0u)

967 
p_tcb
->
MsgPŒ
 = (*)0;

968 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

970 
p_tcb
->
TS
 = 
ts
;

971 ià(
p_obj
 !ð(
OS_PEND_OBJ
 *)0) {

972 
	`OS_P’dLi¡Remove
(
p_tcb
);

974 
	`OS_TickLi¡Remove
(
p_tcb
);

975 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

976 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_ABORT
;

977 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

983 
	}
}

1033 
	$OS_P’dAbÜt1
 (
OS_PEND_OBJ
 *
p_obj
,

1034 
OS_TCB
 *
p_tcb
,

1035 
CPU_TS
 
ts
)

1037 
OS_OBJ_QTY
 
n_³nd_li¡
;

1038 
OS_PEND_DATA
 *
p_³nd_d©a
;

1042 
p_³nd_d©a
 = 
p_tcb
->
P’dD©aTblPŒ
;

1043 
n_³nd_li¡
 = 
p_tcb
->
P’dD©aTblEÁr›s
;

1045 
n_³nd_li¡
 > (
OS_OBJ_QTY
)0) {

1046 ià(
p_obj
 =ð
p_³nd_d©a
->
P’dObjPŒ
) {

1047 
p_³nd_d©a
->
RdyObjPŒ
 = 
p_obj
;

1048 
p_³nd_d©a
->
RdyTS
 = 
ts
;

1051 
p_³nd_d©a
++;

1052 
n_³nd_li¡
--;

1054 
	}
}

1098 
	$OS_P’dD©aIn™
 (
OS_TCB
 *
p_tcb
,

1099 
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

1100 
OS_OBJ_QTY
 
tbl_size
)

1102 
OS_OBJ_QTY
 
i
;

1106 
p_tcb
->
P’dD©aTblEÁr›s
 = 
tbl_size
;

1107 
p_tcb
->
P’dD©aTblPŒ
 = 
p_³nd_d©a_tbl
;

1109 
i
 = 0u; i < 
tbl_size
; i++) {

1110 
p_³nd_d©a_tbl
->
NextPŒ
 = (
OS_PEND_DATA
 *)0;

1111 
p_³nd_d©a_tbl
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

1112 
p_³nd_d©a_tbl
->
RdyObjPŒ
 = (
OS_PEND_OBJ
 *)0;

1113 
p_³nd_d©a_tbl
->
RdyMsgPŒ
 = (*)0;

1114 
p_³nd_d©a_tbl
->
RdyMsgSize
 = (
OS_MSG_SIZE
 )0;

1115 
p_³nd_d©a_tbl
->
RdyTS
 = (
CPU_TS
 )0;

1116 
p_³nd_d©a_tbl
->
TCBPŒ
 = 
p_tcb
;

1117 
p_³nd_d©a_tbl
++;

1119 
	}
}

1140 #ià
OS_CFG_DBG_EN
 > 0u

1141 
	$OS_P’dDbgNameAdd
 (
OS_PEND_OBJ
 *
p_obj
,

1142 
OS_TCB
 *
p_tcb
)

1144 
OS_PEND_LIST
 *
p_³nd_li¡
;

1145 
OS_PEND_DATA
 *
p_³nd_d©a
;

1146 
OS_TCB
 *
p_tcb1
;

1149 ià(
p_obj
 !ð(
OS_PEND_OBJ
 *)0) {

1150 
p_tcb
->
DbgNamePŒ
 = 
p_obj
->
NamePŒ
;

1151 
p_³nd_li¡
 = &
p_obj
->
P’dLi¡
;

1152 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

1153 
p_tcb1
 = 
p_³nd_d©a
->
TCBPŒ
;

1154 
p_obj
->
DbgNamePŒ
 = 
p_tcb1
->
NamePŒ
;

1156 
p_tcb
->
P’dOn
) {

1157 
OS_TASK_PEND_ON_TASK_Q
:

1158 
p_tcb
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)"Task Q");

1161 
OS_TASK_PEND_ON_TASK_SEM
:

1162 
p_tcb
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)"Task Sem");

1166 
p_tcb
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

1170 
	}
}

1174 
	$OS_P’dDbgNameRemove
 (
OS_PEND_OBJ
 *
p_obj
,

1175 
OS_TCB
 *
p_tcb
)

1177 
OS_PEND_LIST
 *
p_³nd_li¡
;

1178 
OS_PEND_DATA
 *
p_³nd_d©a
;

1179 
OS_TCB
 *
p_tcb1
;

1182 
p_tcb
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

1183 
p_³nd_li¡
 = &
p_obj
->
P’dLi¡
;

1184 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

1185 ià(
p_³nd_d©a
 !ð(
OS_PEND_DATA
 *)0) {

1186 
p_tcb1
 = 
p_³nd_d©a
->
TCBPŒ
;

1187 
p_obj
->
DbgNamePŒ
 = 
p_tcb1
->
NamePŒ
;

1189 
p_obj
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

1191 
	}
}

1276 
	$OS_P’dLi¡ChªgePrio
 (
OS_TCB
 *
p_tcb
,

1277 
OS_PRIO
 
´io_Ãw
)

1279 
OS_OBJ_QTY
 
n_³nd_li¡
;

1280 
OS_PEND_DATA
 *
p_³nd_d©a
;

1281 
OS_PEND_LIST
 *
p_³nd_li¡
;

1282 
OS_PEND_OBJ
 *
p_obj
;

1285 
p_tcb
->
Prio
 = 
´io_Ãw
;

1286 
p_³nd_d©a
 = 
p_tcb
->
P’dD©aTblPŒ
;

1287 
n_³nd_li¡
 = 
p_tcb
->
P’dD©aTblEÁr›s
;

1289 
n_³nd_li¡
 > 0u) {

1290 
p_obj
 = 
p_³nd_d©a
->
P’dObjPŒ
;

1291 
p_³nd_li¡
 = &
p_obj
->
P’dLi¡
;

1292 ià(
p_³nd_li¡
->
NbrEÁr›s
 > 1u) {

1293 
	`OS_P’dLi¡Remove1
(
p_³nd_li¡
,

1294 
p_³nd_d©a
);

1295 
	`OS_P’dLi¡In£¹Prio
(
p_³nd_li¡
,

1296 
p_³nd_d©a
);

1298 
p_³nd_d©a
++;

1299 
n_³nd_li¡
--;

1301 
	}
}

1319 
	$OS_P’dLi¡In™
 (
OS_PEND_LIST
 *
p_³nd_li¡
)

1321 
p_³nd_li¡
->
H—dPŒ
 = (
OS_PEND_DATA
 *)0;

1322 
p_³nd_li¡
->
TažPŒ
 = (
OS_PEND_DATA
 *)0;

1323 
p_³nd_li¡
->
NbrEÁr›s
 = (
OS_OBJ_QTY
 )0;

1324 
	}
}

1373 
	$OS_P’dLi¡In£¹H—d
 (
OS_PEND_LIST
 *
p_³nd_li¡
,

1374 
OS_PEND_DATA
 *
p_³nd_d©a
)

1376 
OS_PEND_DATA
 *
p_³nd_d©a_Ãxt
;

1380 
p_³nd_li¡
->
NbrEÁr›s
++;

1381 
p_³nd_d©a
->
NextPŒ
 = 
p_³nd_li¡
->
H—dPŒ
;

1382 
p_³nd_d©a
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

1383 
p_³nd_d©a_Ãxt
 = 
p_³nd_li¡
->
H—dPŒ
;

1384 ià(
p_³nd_d©a_Ãxt
 !ð(
OS_PEND_DATA
 *)0) {

1385 
p_³nd_d©a_Ãxt
->
P»vPŒ
 = 
p_³nd_d©a
;

1387 
p_³nd_li¡
->
H—dPŒ
 = 
p_³nd_d©a
;

1388 ià(
p_³nd_li¡
->
NbrEÁr›s
 == 1u) {

1389 
p_³nd_li¡
->
TažPŒ
 = 
p_³nd_d©a
;

1391 
	}
}

1461 
	$OS_P’dLi¡In£¹Prio
 (
OS_PEND_LIST
 *
p_³nd_li¡
,

1462 
OS_PEND_DATA
 *
p_³nd_d©a
)

1464 
OS_PRIO
 
´io
;

1465 
OS_TCB
 *
p_tcb
;

1466 
OS_TCB
 *
p_tcb_Ãxt
;

1467 
OS_PEND_DATA
 *
p_³nd_d©a_´ev
;

1468 
OS_PEND_DATA
 *
p_³nd_d©a_Ãxt
;

1472 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

1473 
´io
 = 
p_tcb
->
Prio
;

1474 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

1475 
p_³nd_li¡
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)1;

1476 
p_³nd_d©a
->
NextPŒ
 = (
OS_PEND_DATA
 *)0;

1477 
p_³nd_d©a
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

1478 
p_³nd_li¡
->
H—dPŒ
 = 
p_³nd_d©a
;

1479 
p_³nd_li¡
->
TažPŒ
 = 
p_³nd_d©a
;

1481 
p_³nd_li¡
->
NbrEÁr›s
++;

1482 
p_³nd_d©a_Ãxt
 = 
p_³nd_li¡
->
H—dPŒ
;

1483 
p_³nd_d©a_Ãxt
 !ð(
OS_PEND_DATA
 *)0) {

1484 
p_tcb_Ãxt
 = 
p_³nd_d©a_Ãxt
->
TCBPŒ
;

1485 ià(
´io
 < 
p_tcb_Ãxt
->
Prio
) {

1488 
p_³nd_d©a_Ãxt
 =…_³nd_d©a_Ãxt->
NextPŒ
;

1491 ià(
p_³nd_d©a_Ãxt
 =ð(
OS_PEND_DATA
 *)0) {

1492 
p_³nd_d©a
->
NextPŒ
 = (
OS_PEND_DATA
 *)0;

1493 
p_³nd_d©a_´ev
 = 
p_³nd_li¡
->
TažPŒ
;

1494 
p_³nd_d©a
->
P»vPŒ
 = 
p_³nd_d©a_´ev
;

1495 
p_³nd_d©a_´ev
->
NextPŒ
 = 
p_³nd_d©a
;

1496 
p_³nd_li¡
->
TažPŒ
 = 
p_³nd_d©a
;

1498 ià(
p_³nd_d©a_Ãxt
->
P»vPŒ
 =ð(
OS_PEND_DATA
 *)0) {

1499 
p_³nd_d©a_Ãxt
->
P»vPŒ
 = 
p_³nd_d©a
;

1500 
p_³nd_d©a
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

1501 
p_³nd_d©a
->
NextPŒ
 = 
p_³nd_d©a_Ãxt
;

1502 
p_³nd_li¡
->
H—dPŒ
 = 
p_³nd_d©a
;

1504 
p_³nd_d©a_´ev
 = 
p_³nd_d©a_Ãxt
->
P»vPŒ
;

1505 
p_³nd_d©a
->
P»vPŒ
 = 
p_³nd_d©a_´ev
;

1506 
p_³nd_d©a
->
NextPŒ
 = 
p_³nd_d©a_Ãxt
;

1507 
p_³nd_d©a_´ev
->
NextPŒ
 = 
p_³nd_d©a
;

1508 
p_³nd_d©a_Ãxt
->
P»vPŒ
 = 
p_³nd_d©a
;

1512 
	}
}

1564 
	$OS_P’dLi¡Remove
 (
OS_TCB
 *
p_tcb
)

1566 
OS_OBJ_QTY
 
n_³nd_li¡
;

1567 
OS_PEND_DATA
 *
p_³nd_d©a
;

1568 
OS_PEND_LIST
 *
p_³nd_li¡
;

1569 
OS_PEND_OBJ
 *
p_obj
;

1573 
p_³nd_d©a
 = 
p_tcb
->
P’dD©aTblPŒ
;

1574 
n_³nd_li¡
 = 
p_tcb
->
P’dD©aTblEÁr›s
;

1576 
n_³nd_li¡
 > (
OS_OBJ_QTY
)0) {

1577 
p_obj
 = 
p_³nd_d©a
->
P’dObjPŒ
;

1578 
p_³nd_li¡
 = &
p_obj
->
P’dLi¡
;

1579 
	`OS_P’dLi¡Remove1
(
p_³nd_li¡
,

1580 
p_³nd_d©a
);

1581 
p_³nd_d©a
++;

1582 
n_³nd_li¡
--;

1584 
p_tcb
->
P’dD©aTblEÁr›s
 = (
OS_OBJ_QTY
 )0;

1585 
p_tcb
->
P’dD©aTblPŒ
 = (
OS_PEND_DATA
 *)0;

1586 
	}
}

1639 
	$OS_P’dLi¡Remove1
 (
OS_PEND_LIST
 *
p_³nd_li¡
,

1640 
OS_PEND_DATA
 *
p_³nd_d©a
)

1642 
OS_PEND_DATA
 *
p_´ev
;

1643 
OS_PEND_DATA
 *
p_Ãxt
;

1647 ià(
p_³nd_li¡
->
NbrEÁr›s
 == 1u) {

1648 
p_³nd_li¡
->
H—dPŒ
 = (
OS_PEND_DATA
 *)0;

1649 
p_³nd_li¡
->
TažPŒ
 = (
OS_PEND_DATA
 *)0;

1651 } ià(
p_³nd_d©a
->
P»vPŒ
 =ð(
OS_PEND_DATA
 *)0) {

1652 
p_Ãxt
 = 
p_³nd_d©a
->
NextPŒ
;

1653 
p_Ãxt
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

1654 
p_³nd_li¡
->
H—dPŒ
 = 
p_Ãxt
;

1656 } ià(
p_³nd_d©a
->
NextPŒ
 =ð(
OS_PEND_DATA
 *)0) {

1657 
p_´ev
 = 
p_³nd_d©a
->
P»vPŒ
;

1658 
p_´ev
->
NextPŒ
 = (
OS_PEND_DATA
 *)0;

1659 
p_³nd_li¡
->
TažPŒ
 = 
p_´ev
;

1662 
p_´ev
 = 
p_³nd_d©a
->
P»vPŒ
;

1663 
p_Ãxt
 = 
p_³nd_d©a
->
NextPŒ
;

1664 
p_´ev
->
NextPŒ
 = 
p_Ãxt
;

1665 
p_Ãxt
->
P»vPŒ
 = 
p_´ev
;

1667 
p_³nd_li¡
->
NbrEÁr›s
--;

1668 
p_³nd_d©a
->
NextPŒ
 = (
OS_PEND_DATA
 *)0;

1669 
p_³nd_d©a
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

1670 
	}
}

1693 
	$OS_P’dObjD–
 (
OS_PEND_OBJ
 *
p_obj
,

1694 
OS_TCB
 *
p_tcb
,

1695 
CPU_TS
 
ts
)

1697 
p_tcb
->
TaskS‹
) {

1698 
OS_TASK_STATE_RDY
:

1699 
OS_TASK_STATE_DLY
:

1700 
OS_TASK_STATE_SUSPENDED
:

1701 
OS_TASK_STATE_DLY_SUSPENDED
:

1704 
OS_TASK_STATE_PEND
:

1705 
OS_TASK_STATE_PEND_TIMEOUT
:

1706 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_MULTI
) {

1707 
	`OS_P’dObjD–1
(
p_obj
,

1708 
p_tcb
,

1709 
ts
);

1711 #ià(
OS_MSG_EN
 > 0u)

1712 
p_tcb
->
MsgPŒ
 = (*)0;

1713 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

1715 
p_tcb
->
TS
 = 
ts
;

1716 
	`OS_P’dLi¡Remove
(
p_tcb
);

1717 
	`OS_TaskRdy
(
p_tcb
);

1718 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

1719 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_DEL
;

1720 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

1723 
OS_TASK_STATE_PEND_SUSPENDED
:

1724 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

1725 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_MULTI
) {

1726 
	`OS_P’dObjD–1
(
p_obj
,

1727 
p_tcb
,

1728 
ts
);

1730 #ià(
OS_MSG_EN
 > 0u)

1731 
p_tcb
->
MsgPŒ
 = (*)0;

1732 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

1734 
p_tcb
->
TS
 = 
ts
;

1735 
	`OS_TickLi¡Remove
(
p_tcb
);

1736 
	`OS_P’dLi¡Remove
(
p_tcb
);

1737 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

1738 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_DEL
;

1739 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

1745 
	}
}

1795 
	$OS_P’dObjD–1
 (
OS_PEND_OBJ
 *
p_obj
,

1796 
OS_TCB
 *
p_tcb
,

1797 
CPU_TS
 
ts
)

1799 
OS_OBJ_QTY
 
n_³nd_li¡
;

1800 
OS_PEND_DATA
 *
p_³nd_d©a
;

1804 
p_³nd_d©a
 = 
p_tcb
->
P’dD©aTblPŒ
;

1805 
n_³nd_li¡
 = 
p_tcb
->
P’dD©aTblEÁr›s
;

1807 
n_³nd_li¡
 > (
OS_OBJ_QTY
)0) {

1808 ià(
p_obj
 =ð
p_³nd_d©a
->
P’dObjPŒ
) {

1809 
p_³nd_d©a
->
RdyObjPŒ
 = 
p_obj
;

1810 
p_³nd_d©a
->
RdyTS
 = 
ts
;

1813 
p_³nd_d©a
++;

1814 
n_³nd_li¡
--;

1816 
	}
}

1844 
	$OS_Po¡
 (
OS_PEND_OBJ
 *
p_obj
,

1845 
OS_TCB
 *
p_tcb
,

1846 *
p_void
,

1847 
OS_MSG_SIZE
 
msg_size
,

1848 
CPU_TS
 
ts
)

1850 
p_tcb
->
TaskS‹
) {

1851 
OS_TASK_STATE_RDY
:

1852 
OS_TASK_STATE_DLY
:

1853 
OS_TASK_STATE_SUSPENDED
:

1854 
OS_TASK_STATE_DLY_SUSPENDED
:

1857 
OS_TASK_STATE_PEND
:

1858 
OS_TASK_STATE_PEND_TIMEOUT
:

1859 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_MULTI
) {

1860 
	`OS_Po¡1
(
p_obj
,

1861 
p_tcb
,

1862 
p_void
,

1863 
msg_size
,

1864 
ts
);

1866 #ià(
OS_MSG_EN
 > 0u)

1867 
p_tcb
->
MsgPŒ
 = 
p_void
;

1868 
p_tcb
->
MsgSize
 = 
msg_size
;

1870 
p_tcb
->
TS
 = 
ts
;

1872 ià(
p_obj
 !ð(
OS_PEND_OBJ
 *)0) {

1873 
	`OS_P’dLi¡Remove
(
p_tcb
);

1874 #ià
OS_CFG_DBG_EN
 > 0u

1875 
	`OS_P’dDbgNameRemove
(
p_obj
,

1876 
p_tcb
);

1879 
	`OS_TaskRdy
(
p_tcb
);

1880 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

1881 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_OK
;

1882 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

1885 
OS_TASK_STATE_PEND_SUSPENDED
:

1886 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

1887 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_MULTI
) {

1888 
	`OS_Po¡1
(
p_obj
,

1889 
p_tcb
,

1890 
p_void
,

1891 
msg_size
,

1892 
ts
);

1894 #ià(
OS_MSG_EN
 > 0u)

1895 
p_tcb
->
MsgPŒ
 = 
p_void
;

1896 
p_tcb
->
MsgSize
 = 
msg_size
;

1898 
p_tcb
->
TS
 = 
ts
;

1900 
	`OS_TickLi¡Remove
(
p_tcb
);

1901 ià(
p_obj
 !ð(
OS_PEND_OBJ
 *)0) {

1902 
	`OS_P’dLi¡Remove
(
p_tcb
);

1903 #ià
OS_CFG_DBG_EN
 > 0u

1904 
	`OS_P’dDbgNameRemove
(
p_obj
,

1905 
p_tcb
);

1908 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

1909 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_OK
;

1910 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

1916 
	}
}

1970 
	$OS_Po¡1
 (
OS_PEND_OBJ
 *
p_obj
,

1971 
OS_TCB
 *
p_tcb
,

1972 *
p_void
,

1973 
OS_MSG_SIZE
 
msg_size
,

1974 
CPU_TS
 
ts
)

1976 
OS_OBJ_QTY
 
n_³nd_li¡
;

1977 
OS_PEND_DATA
 *
p_³nd_d©a
;

1981 
p_³nd_d©a
 = 
p_tcb
->
P’dD©aTblPŒ
;

1982 
n_³nd_li¡
 = 
p_tcb
->
P’dD©aTblEÁr›s
;

1984 
n_³nd_li¡
 > (
OS_OBJ_QTY
)0) {

1985 ià(
p_obj
 =ð
p_³nd_d©a
->
P’dObjPŒ
) {

1986 
p_³nd_d©a
->
RdyObjPŒ
 = 
p_obj
;

1987 
p_³nd_d©a
->
RdyMsgPŒ
 = 
p_void
;

1988 
p_³nd_d©a
->
RdyMsgSize
 = 
msg_size
;

1989 
p_³nd_d©a
->
RdyTS
 = 
ts
;

1992 
p_³nd_d©a
++;

1993 
n_³nd_li¡
--;

1995 
	}
}

2040 
	$OS_RdyLi¡In™
 ()

2042 
OS_PRIO
 
i
;

2043 
OS_RDY_LIST
 *
p_rdy_li¡
;

2047 
i
 = 0u; i < 
OS_CFG_PRIO_MAX
; i++) {

2048 
p_rdy_li¡
 = &
OSRdyLi¡
[
i
];

2049 
p_rdy_li¡
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)0;

2050 
p_rdy_li¡
->
H—dPŒ
 = (
OS_TCB
 *)0;

2051 
p_rdy_li¡
->
TažPŒ
 = (
OS_TCB
 *)0;

2053 
	}
}

2074 
	$OS_RdyLi¡In£¹
 (
OS_TCB
 *
p_tcb
)

2076 
	`OS_PrioIn£¹
(
p_tcb
->
Prio
);

2077 ià(
p_tcb
->
Prio
 =ð
OSPrioCur
) {

2078 
	`OS_RdyLi¡In£¹Taž
(
p_tcb
);

2080 
	`OS_RdyLi¡In£¹H—d
(
p_tcb
);

2082 
	}
}

2141 
	$OS_RdyLi¡In£¹H—d
 (
OS_TCB
 *
p_tcb
)

2143 
OS_RDY_LIST
 *
p_rdy_li¡
;

2144 
OS_TCB
 *
p_tcb2
;

2148 
p_rdy_li¡
 = &
OSRdyLi¡
[
p_tcb
->
Prio
];

2149 ià(
p_rdy_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

2150 
p_rdy_li¡
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)1;

2151 
p_tcb
->
NextPŒ
 = (
OS_TCB
 *)0;

2152 
p_tcb
->
P»vPŒ
 = (
OS_TCB
 *)0;

2153 
p_rdy_li¡
->
H—dPŒ
 = 
p_tcb
;

2154 
p_rdy_li¡
->
TažPŒ
 = 
p_tcb
;

2156 
p_rdy_li¡
->
NbrEÁr›s
++;

2157 
p_tcb
->
NextPŒ
 = 
p_rdy_li¡
->
H—dPŒ
;

2158 
p_tcb
->
P»vPŒ
 = (
OS_TCB
 *)0;

2159 
p_tcb2
 = 
p_rdy_li¡
->
H—dPŒ
;

2160 
p_tcb2
->
P»vPŒ
 = 
p_tcb
;

2161 
p_rdy_li¡
->
H—dPŒ
 = 
p_tcb
;

2163 
	}
}

2222 
	$OS_RdyLi¡In£¹Taž
 (
OS_TCB
 *
p_tcb
)

2224 
OS_RDY_LIST
 *
p_rdy_li¡
;

2225 
OS_TCB
 *
p_tcb2
;

2229 
p_rdy_li¡
 = &
OSRdyLi¡
[
p_tcb
->
Prio
];

2230 ià(
p_rdy_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

2231 
p_rdy_li¡
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)1;

2232 
p_tcb
->
NextPŒ
 = (
OS_TCB
 *)0;

2233 
p_tcb
->
P»vPŒ
 = (
OS_TCB
 *)0;

2234 
p_rdy_li¡
->
H—dPŒ
 = 
p_tcb
;

2235 
p_rdy_li¡
->
TažPŒ
 = 
p_tcb
;

2237 
p_rdy_li¡
->
NbrEÁr›s
++;

2238 
p_tcb
->
NextPŒ
 = (
OS_TCB
 *)0;

2239 
p_tcb2
 = 
p_rdy_li¡
->
TažPŒ
;

2240 
p_tcb
->
P»vPŒ
 = 
p_tcb2
;

2241 
p_tcb2
->
NextPŒ
 = 
p_tcb
;

2242 
p_rdy_li¡
->
TažPŒ
 = 
p_tcb
;

2244 
	}
}

2299 
	$OS_RdyLi¡MoveH—dToTaž
 (
OS_RDY_LIST
 *
p_rdy_li¡
)

2301 
OS_TCB
 *
p_tcb1
;

2302 
OS_TCB
 *
p_tcb2
;

2303 
OS_TCB
 *
p_tcb3
;

2307 
p_rdy_li¡
->
NbrEÁr›s
) {

2313 
p_tcb1
 = 
p_rdy_li¡
->
H—dPŒ
;

2314 
p_tcb2
 = 
p_rdy_li¡
->
TažPŒ
;

2315 
p_tcb1
->
P»vPŒ
 = 
p_tcb2
;

2316 
p_tcb1
->
NextPŒ
 = (
OS_TCB
 *)0;

2317 
p_tcb2
->
P»vPŒ
 = (
OS_TCB
 *)0;

2318 
p_tcb2
->
NextPŒ
 = 
p_tcb1
;

2319 
p_rdy_li¡
->
H—dPŒ
 = 
p_tcb2
;

2320 
p_rdy_li¡
->
TažPŒ
 = 
p_tcb1
;

2324 
p_tcb1
 = 
p_rdy_li¡
->
H—dPŒ
;

2325 
p_tcb2
 = 
p_rdy_li¡
->
TažPŒ
;

2326 
p_tcb3
 = 
p_tcb1
->
NextPŒ
;

2327 
p_tcb3
->
P»vPŒ
 = (
OS_TCB
 *)0;

2328 
p_tcb1
->
NextPŒ
 = (
OS_TCB
 *)0;

2329 
p_tcb1
->
P»vPŒ
 = 
p_tcb2
;

2330 
p_tcb2
->
NextPŒ
 = 
p_tcb1
;

2331 
p_rdy_li¡
->
H—dPŒ
 = 
p_tcb3
;

2332 
p_rdy_li¡
->
TažPŒ
 = 
p_tcb1
;

2335 
	}
}

2386 
	$OS_RdyLi¡Remove
 (
OS_TCB
 *
p_tcb
)

2388 
OS_RDY_LIST
 *
p_rdy_li¡
;

2389 
OS_TCB
 *
p_tcb1
;

2390 
OS_TCB
 *
p_tcb2
;

2394 
p_rdy_li¡
 = &
OSRdyLi¡
[
p_tcb
->
Prio
];

2395 
p_tcb1
 = 
p_tcb
->
P»vPŒ
;

2396 
p_tcb2
 = 
p_tcb
->
NextPŒ
;

2397 ià(
p_tcb1
 =ð(
OS_TCB
 *)0) {

2398 ià(
p_tcb2
 =ð(
OS_TCB
 *)0) {

2399 
p_rdy_li¡
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)0;

2400 
p_rdy_li¡
->
H—dPŒ
 = (
OS_TCB
 *)0;

2401 
p_rdy_li¡
->
TažPŒ
 = (
OS_TCB
 *)0;

2402 
	`OS_PrioRemove
(
p_tcb
->
Prio
);

2404 
p_rdy_li¡
->
NbrEÁr›s
--;

2405 
p_tcb2
->
P»vPŒ
 = (
OS_TCB
 *)0;

2406 
p_rdy_li¡
->
H—dPŒ
 = 
p_tcb2
;

2409 
p_rdy_li¡
->
NbrEÁr›s
--;

2410 
p_tcb1
->
NextPŒ
 = 
p_tcb2
;

2411 ià(
p_tcb2
 =ð(
OS_TCB
 *)0) {

2412 
p_rdy_li¡
->
TažPŒ
 = 
p_tcb1
;

2414 
p_tcb2
->
P»vPŒ
 = 
p_tcb1
;

2417 
p_tcb
->
P»vPŒ
 = (
OS_TCB
 *)0;

2418 
p_tcb
->
NextPŒ
 = (
OS_TCB
 *)0;

2419 
	}
}

2437 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

2438 
	$OS_Sched0
 ()

2440 
	`CPU_SR_ALLOC
();

2444 
	`CPU_INT_DIS
();

2445 
OSPrioHighRdy
 = (
OS_PRIO
)0;

2446 
OSTCBHighRdyPŒ
 = &
OSIÁQTaskTCB
;

2447 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

2448 
OSTCBHighRdyPŒ
->
CtxSwCŒ
++;

2450 
OSTaskCtxSwCŒ
++;

2451 
	`OS_TASK_SW
();

2452 
	`CPU_INT_EN
();

2453 
	}
}

2478 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

2479 
	$OS_SchedLockTimeM—sS¹
 ()

2481 ià(
OSSchedLockNe¡šgCŒ
 == 1u) {

2482 
OSSchedLockTimeBegš
 = 
	`CPU_TS_TmrRd
();

2484 
	}
}

2489 
	$OS_SchedLockTimeM—sStÝ
 ()

2491 
CPU_TS_TMR
 
d–
;

2494 ià(
OSSchedLockNe¡šgCŒ
 =ð(
OS_NESTING_CTR
)0) {

2495 
d–
 = 
	`CPU_TS_TmrRd
()

2496 - 
OSSchedLockTimeBegš
;

2497 ià(
OSSchedLockTimeMax
 < 
d–
) {

2498 
OSSchedLockTimeMax
 = 
d–
;

2500 ià(
OSSchedLockTimeMaxCur
 < 
d–
) {

2501 
OSSchedLockTimeMaxCur
 = 
d–
;

2504 
	}
}

2524 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

2525 
	$OS_SchedRoundRobš
 (
OS_RDY_LIST
 *
p_rdy_li¡
)

2527 
OS_TCB
 *
p_tcb
;

2528 
	`CPU_SR_ALLOC
();

2532 ià(
OSSchedRoundRobšEn
 !ð
DEF_TRUE
) {

2536 
	`CPU_CRITICAL_ENTER
();

2537 
p_tcb
 = 
p_rdy_li¡
->
H—dPŒ
;

2539 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

2540 
	`CPU_CRITICAL_EXIT
();

2544 ià(
p_tcb
 =ð&
OSIdËTaskTCB
) {

2545 
	`CPU_CRITICAL_EXIT
();

2549 ià(
p_tcb
->
TimeQuªCŒ
 > (
OS_TICK
)0) {

2550 
p_tcb
->
TimeQuªCŒ
--;

2553 ià(
p_tcb
->
TimeQuªCŒ
 > (
OS_TICK
)0) {

2554 
	`CPU_CRITICAL_EXIT
();

2558 ià(
p_rdy_li¡
->
NbrEÁr›s
 < (
OS_OBJ_QTY
)2) {

2559 
	`CPU_CRITICAL_EXIT
();

2563 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

2564 
	`CPU_CRITICAL_EXIT
();

2568 
	`OS_RdyLi¡MoveH—dToTaž
(
p_rdy_li¡
);

2569 
p_tcb
 = 
p_rdy_li¡
->
H—dPŒ
;

2570 ià(
p_tcb
->
TimeQuª
 =ð(
OS_TICK
)0) {

2571 
p_tcb
->
TimeQuªCŒ
 = 
OSSchedRoundRobšDætTimeQuª
;

2573 
p_tcb
->
TimeQuªCŒ
 =…_tcb->
TimeQuª
;

2575 
	`CPU_CRITICAL_EXIT
();

2576 
	}
}

2598 
	$OS_TaskBlock
 (
OS_TCB
 *
p_tcb
,

2599 
OS_TICK
 
timeout
)

2601 
OS_ERR
 
”r
;

2604 ià(
timeout
 > (
OS_TICK
)0) {

2605 
	`OS_TickLi¡In£¹
(
p_tcb
,

2606 
timeout
,

2607 
OS_OPT_TIME_TIMEOUT
,

2608 &
”r
);

2609 ià(
”r
 =ð
OS_ERR_NONE
) {

2610 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND_TIMEOUT
;

2612 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND
;

2615 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND
;

2617 
	`OS_RdyLi¡Remove
(
p_tcb
);

2618 
	}
}

2636 
	$OS_TaskRdy
 (
OS_TCB
 *
p_tcb
)

2638 
	`OS_TickLi¡Remove
(
p_tcb
);

2639 ià((
p_tcb
->
TaskS‹
 & 
OS_TASK_STATE_BIT_SUSPENDED
è=ð(
OS_STATE
)0) {

2640 
	`OS_RdyLi¡In£¹
(
p_tcb
);

2642 
	}
}

	@os_dbg.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_dbg__c
 = "$Id: $";

40 
CPU_INT16U
 cÚ¡ 
	gOSDbg_DbgEn
 = 
OS_CFG_DBG_EN
;

42 #ià
OS_CFG_DBG_EN
 > 0u

50 
CPU_INT08U
 cÚ¡ 
	gOSDbg_ArgChkEn
 = 
OS_CFG_ARG_CHK_EN
;

51 
CPU_INT08U
 cÚ¡ 
	gOSDbg_AµHooksEn
 = 
OS_CFG_APP_HOOKS_EN
;

53 
CPU_INT32U
 cÚ¡ 
	gOSDbg_EndŸÂessTe¡
 = 0x12345678LU;

55 
CPU_INT08U
 cÚ¡ 
	gOSDbg_C®ËdFromISRChkEn
 = 
OS_CFG_CALLED_FROM_ISR_CHK_EN
;

57 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgEn
 = 
OS_CFG_FLAG_EN
;

58 
OS_FLAG_GRP
 cÚ¡ 
	gOSDbg_FÏgG½
 = { 0u };

59 #ià
OS_CFG_FLAG_EN
 > 0u

60 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgD–En
 = 
OS_CFG_FLAG_DEL_EN
;

61 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgModeCÌEn
 = 
OS_CFG_FLAG_MODE_CLR_EN
;

62 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgP’dAbÜtEn
 = 
OS_CFG_FLAG_PEND_ABORT_EN
;

63 
CPU_INT16U
 cÚ¡ 
	gOSDbg_FÏgG½Size
 = (
OS_FLAG_GRP
);

64 
CPU_INT16U
 cÚ¡ 
	gOSDbg_FÏgWidth
 = (
OS_FLAGS
);

66 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgD–En
 = 0u;

67 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgModeCÌEn
 = 0u;

68 
CPU_INT08U
 cÚ¡ 
	gOSDbg_FÏgP’dAbÜtEn
 = 0u;

69 
CPU_INT16U
 cÚ¡ 
	gOSDbg_FÏgG½Size
 = 0u;

70 
CPU_INT16U
 cÚ¡ 
	gOSDbg_FÏgWidth
 = 0u;

73 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

74 
CPU_INT16U
 cÚ¡ 
	gOSDbg_IÁQ
 = (
OS_INT_Q
);

76 
CPU_INT16U
 cÚ¡ 
	gOSDbg_IÁQ
 = 0u;

79 
CPU_INT08U
 cÚ¡ 
	gOSDbg_ISRPo¡Deã¼edEn
 = 
OS_CFG_ISR_POST_DEFERRED_EN
;

81 
OS_MEM
 cÚ¡ 
	gOSDbg_Mem
 = { 0u };

82 
CPU_INT08U
 cÚ¡ 
	gOSDbg_MemEn
 = 
OS_CFG_MEM_EN
;

83 #ià
OS_CFG_MEM_EN
 > 0u

84 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MemSize
 = (
OS_MEM
);

86 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MemSize
 = 0u;

90 
CPU_INT08U
 cÚ¡ 
	gOSDbg_MsgEn
 = 
OS_MSG_EN
;

91 #ià(
OS_MSG_EN
) > 0u

92 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MsgSize
 = (
OS_MSG
);

93 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MsgPoÞSize
 = (
OS_MSG_POOL
);

94 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MsgQSize
 = (
OS_MSG_Q
);

96 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MsgSize
 = 0u;

97 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MsgPoÞSize
 = 0u;

98 
CPU_INT16U
 cÚ¡ 
	gOSDbg_MsgQSize
 = 0u;

102 
OS_MUTEX
 cÚ¡ 
	gOSDbg_Mu‹x
 = { 0u };

103 
CPU_INT08U
 cÚ¡ 
	gOSDbg_Mu‹xEn
 = 
OS_CFG_MUTEX_EN
;

104 #ià
OS_CFG_MUTEX_EN
 > 0u

105 
CPU_INT08U
 cÚ¡ 
	gOSDbg_Mu‹xD–En
 = 
OS_CFG_MUTEX_DEL_EN
;

106 
CPU_INT08U
 cÚ¡ 
	gOSDbg_Mu‹xP’dAbÜtEn
 = 
OS_CFG_MUTEX_PEND_ABORT_EN
;

107 
CPU_INT16U
 cÚ¡ 
	gOSDbg_Mu‹xSize
 = (
OS_MUTEX
);

109 
CPU_INT08U
 cÚ¡ 
	gOSDbg_Mu‹xD–En
 = 0u;

110 
CPU_INT08U
 cÚ¡ 
	gOSDbg_Mu‹xP’dAbÜtEn
 = 0u;

111 
CPU_INT16U
 cÚ¡ 
	gOSDbg_Mu‹xSize
 = 0u;

114 
CPU_INT08U
 cÚ¡ 
	gOSDbg_ObjTy³ChkEn
 = 
OS_CFG_OBJ_TYPE_CHK_EN
;

117 
CPU_INT08U
 cÚ¡ 
	gOSDbg_P’dMuÉiEn
 = 
OS_CFG_PEND_MULTI_EN
;

118 
CPU_INT16U
 cÚ¡ 
	gOSDbg_P’dD©aSize
 = (
OS_PEND_DATA
);

119 
CPU_INT16U
 cÚ¡ 
	gOSDbg_P’dLi¡Size
 = (
OS_PEND_LIST
);

120 
CPU_INT16U
 cÚ¡ 
	gOSDbg_P’dObjSize
 = (
OS_PEND_OBJ
);

123 
CPU_INT16U
 cÚ¡ 
	gOSDbg_PrioMax
 = 
OS_CFG_PRIO_MAX
;

124 
CPU_INT16U
 cÚ¡ 
	gOSDbg_PrioTblSize
 = (
OSPrioTbl
);

126 
CPU_INT16U
 cÚ¡ 
	gOSDbg_PŒSize
 = (*);

129 
OS_Q
 cÚ¡ 
	gOSDbg_Q
 = { 0u };

130 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QEn
 = 
OS_CFG_Q_EN
;

131 #ià
OS_CFG_Q_EN
 > 0u

132 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QD–En
 = 
OS_CFG_Q_DEL_EN
;

133 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QFlushEn
 = 
OS_CFG_Q_FLUSH_EN
;

134 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QP’dAbÜtEn
 = 
OS_CFG_Q_PEND_ABORT_EN
;

135 
CPU_INT16U
 cÚ¡ 
	gOSDbg_QSize
 = (
OS_Q
);

137 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QD–En
 = 0u;

138 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QFlushEn
 = 0u;

139 
CPU_INT08U
 cÚ¡ 
	gOSDbg_QP’dAbÜtEn
 = 0u;

140 
CPU_INT16U
 cÚ¡ 
	gOSDbg_QSize
 = 0u;

144 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SchedRoundRobšEn
 = 
OS_CFG_SCHED_ROUND_ROBIN_EN
;

147 
OS_SEM
 cÚ¡ 
	gOSDbg_Sem
 = { 0u };

148 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemEn
 = 
OS_CFG_SEM_EN
;

149 #ià
OS_CFG_SEM_EN
 > 0u

150 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemD–En
 = 
OS_CFG_SEM_DEL_EN
;

151 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemP’dAbÜtEn
 = 
OS_CFG_SEM_PEND_ABORT_EN
;

152 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemS‘En
 = 
OS_CFG_SEM_SET_EN
;

153 
CPU_INT16U
 cÚ¡ 
	gOSDbg_SemSize
 = (
OS_SEM
);

155 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemD–En
 = 0u;

156 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemP’dAbÜtEn
 = 0u;

157 
CPU_INT08U
 cÚ¡ 
	gOSDbg_SemS‘En
 = 0u;

158 
CPU_INT16U
 cÚ¡ 
	gOSDbg_SemSize
 = 0u;

162 
CPU_INT16U
 cÚ¡ 
	gOSDbg_RdyLi¡
 = (
OS_RDY_LIST
);

163 
CPU_INT32U
 cÚ¡ 
	gOSDbg_RdyLi¡Size
 = (
OSRdyLi¡
);

165 
CPU_INT08U
 cÚ¡ 
	gOSDbg_StkWidth
 = (
CPU_STK
);

167 
CPU_INT08U
 cÚ¡ 
	gOSDbg_StTaskEn
 = 
OS_CFG_STAT_TASK_EN
;

168 
CPU_INT08U
 cÚ¡ 
	gOSDbg_StTaskStkChkEn
 = 
OS_CFG_STAT_TASK_STK_CHK_EN
;

170 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskChªgePrioEn
 = 
OS_CFG_TASK_CHANGE_PRIO_EN
;

171 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskD–En
 = 
OS_CFG_TASK_DEL_EN
;

172 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskQEn
 = 
OS_CFG_TASK_Q_EN
;

173 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskQP’dAbÜtEn
 = 
OS_CFG_TASK_Q_PEND_ABORT_EN
;

174 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskProfžeEn
 = 
OS_CFG_TASK_PROFILE_EN
;

175 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TaskRegTblSize
 = 
OS_CFG_TASK_REG_TBL_SIZE
;

176 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskSemP’dAbÜtEn
 = 
OS_CFG_TASK_SEM_PEND_ABORT_EN
;

177 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TaskSu¥’dEn
 = 
OS_CFG_TASK_SUSPEND_EN
;

180 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TCBSize
 = (
OS_TCB
);

182 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TickSpokeSize
 = (
OS_TICK_SPOKE
);

184 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TimeDlyHMSMEn
 = 
OS_CFG_TIME_DLY_HMSM_EN
;

185 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TimeDlyResumeEn
 = 
OS_CFG_TIME_DLY_RESUME_EN
;

187 #ià
defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

188 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TLS_TblSize
 = 
OS_CFG_TLS_TBL_SIZE
 * (
OS_TLS
);

190 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TLS_TblSize
 = 0u;

194 
OS_TMR
 cÚ¡ 
	gOSDbg_Tmr
 = { 0u };

195 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TmrEn
 = 
OS_CFG_TMR_EN
;

196 #ià
OS_CFG_TMR_EN
 > 0u

197 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TmrD–En
 = 
OS_CFG_TMR_DEL_EN
;

198 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TmrSize
 = (
OS_TMR
);

199 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TmrSpokeSize
 = (
OS_TMR_SPOKE
);

201 
CPU_INT08U
 cÚ¡ 
	gOSDbg_TmrD–En
 = 0u;

202 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TmrSize
 = 0u;

203 
CPU_INT16U
 cÚ¡ 
	gOSDbg_TmrSpokeSize
 = 0u;

206 
CPU_INT16U
 cÚ¡ 
	gOSDbg_V”siÚNbr
 = 
OS_VERSION
;

216 
CPU_INT32U
 cÚ¡ 
	gOSDbg_D©aSize
 = (
OSIÁNe¡šgCŒ
)

218 #ià
OS_CFG_APP_HOOKS_EN
 > 0u

219 + (
OS_AµTaskC»©eHookPŒ
)

220 + (
OS_AµTaskD–HookPŒ
)

221 + (
OS_AµTaskR‘uºHookPŒ
)

223 + (
OS_AµIdËTaskHookPŒ
)

224 + (
OS_AµStTaskHookPŒ
)

225 + (
OS_AµTaskSwHookPŒ
)

226 + (
OS_AµTimeTickHookPŒ
)

229 + (
OSIdËTaskCŒ
)

230 + (
OSIdËTaskTCB
)

232 #ifdeà
CPU_CFG_INT_DIS_MEAS_EN


233 + (
OSIÁDisTimeMax
)

236 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

237 + (
OSIÁQInPŒ
)

238 + (
OSIÁQOutPŒ
)

239 + (
OSIÁQNbrEÁr›s
)

240 + (
OSIÁQNbrEÁr›sMax
)

241 + (
OSIÁQOvfCŒ
)

242 + (
OSIÁQTaskTCB
)

243 + (
OSIÁQTaskTimeMax
)

246 + (
OSRuÂšg
)

248 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


249 + (
OSSaãtyCr™iÿlS¹FÏg
)

252 #ià
OS_CFG_FLAG_EN
 > 0u

253 + (
OSFÏgDbgLi¡PŒ
)

254 + (
OSFÏgQty
)

257 #ià
OS_CFG_MEM_EN
 > 0u

258 #ià
OS_CFG_DBG_EN
 > 0u

259 + (
OSMemDbgLi¡PŒ
)

261 + (
OSMemQty
)

264 #ià
OS_MSG_EN
 > 0u

265 + (
OSMsgPoÞ
)

268 #ià
OS_CFG_MUTEX_EN
 > 0u

269 #ià
OS_CFG_DBG_EN
 > 0u

270 + (
OSMu‹xDbgLi¡PŒ
)

272 + (
OSMu‹xQty
)

275 + (
OSPrioCur
)

276 + (
OSPrioHighRdy
)

277 + (
OSPrioSaved
)

278 + (
OSPrioTbl
)

280 #ià
OS_CFG_Q_EN
 > 0u

281 #ià
OS_CFG_DBG_EN
 > 0u

282 + (
OSQDbgLi¡PŒ
)

284 + (
OSQQty
)

287 + (
OSRdyLi¡
)

289 + (
OSSchedLockNe¡šgCŒ
)

291 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

292 + (
OSSchedLockTimeBegš
)

293 + (
OSSchedLockTimeMax
)

294 + (
OSSchedLockTimeMaxCur
)

297 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN


298 + (
OSSchedRoundRobšDætTimeQuª
)

299 + (
OSSchedRoundRobšEn
)

302 #ià
OS_CFG_SEM_EN
 > 0u

303 #ià
OS_CFG_DBG_EN
 > 0u

304 + (
OSSemDbgLi¡PŒ
)

306 + (
OSSemQty
)

308 + (
OSTaskCtxSwCŒ
)

309 #ià
OS_CFG_DBG_EN
 > 0u

310 + (
OSTaskDbgLi¡PŒ
)

312 + (
OSTaskQty
)

314 #ià
OS_CFG_STAT_TASK_EN
 > 0u

315 + (
OSStRe£tFÏg
)

316 + (
OSStTaskCPUU§ge
)

317 + (
OSStTaskCPUU§geMax
)

318 + (
OSStTaskCŒ
)

319 + (
OSStTaskCŒMax
)

320 + (
OSStTaskCŒRun
)

321 + (
OSStTaskRdy
)

322 + (
OSStTaskTCB
)

323 + (
OSStTaskTimeMax
)

326 + (
OSTickCŒ
)

327 + (
OSTickTaskTCB
)

328 + (
OSTickTaskTimeMax
)

330 #ià
OS_CFG_TMR_EN
 > 0u

331 #ià
OS_CFG_DBG_EN
 > 0u

332 + (
OSTmrDbgLi¡PŒ
)

334 + (
OSTmrQty
)

335 + (
OSTmrTaskTCB
)

336 + (
OSTmrTaskTimeMax
)

337 + (
OSTmrTickCŒ
)

338 + (
OSTmrUpd©eCÁ
)

339 + (
OSTmrUpd©eCŒ
)

342 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

343 + (
OSTaskRegNextAvažID
)

346 + (
OSTCBCurPŒ
)

347 + (
OSTCBHighRdyPŒ
);

369 
	$OS_Dbg_In™
 ()

371 cÚ¡ *
p_‹mp
;

374 
p_‹mp
 = (cÚ¡ *)&
OSDbg_DbgEn
;

376 
p_‹mp
 = (cÚ¡ *)&
OSDbg_D©aSize
;

378 
p_‹mp
 = (cÚ¡ *)&
OSDbg_ArgChkEn
;

379 
p_‹mp
 = (cÚ¡ *)&
OSDbg_AµHooksEn
;

381 
p_‹mp
 = (cÚ¡ *)&
OSDbg_EndŸÂessTe¡
;

383 
p_‹mp
 = (cÚ¡ *)&
OSDbg_C®ËdFromISRChkEn
;

385 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgG½
;

386 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgEn
;

387 #ià
OS_CFG_FLAG_EN
 > 0u

388 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgD–En
;

389 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgModeCÌEn
;

390 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgP’dAbÜtEn
;

391 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgG½Size
;

392 
p_‹mp
 = (cÚ¡ *)&
OSDbg_FÏgWidth
;

395 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

396 
p_‹mp
 = (cÚ¡ *)&
OSDbg_IÁQ
;

399 
p_‹mp
 = (cÚ¡ *)&
OSDbg_ISRPo¡Deã¼edEn
;

401 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Mem
;

402 
p_‹mp
 = (cÚ¡ *)&
OSDbg_MemEn
;

403 #ià
OS_CFG_MEM_EN
 > 0u

404 
p_‹mp
 = (cÚ¡ *)&
OSDbg_MemSize
;

407 
p_‹mp
 = (cÚ¡ *)&
OSDbg_MsgEn
;

408 #ià(
OS_MSG_EN
) > 0u

409 
p_‹mp
 = (cÚ¡ *)&
OSDbg_MsgSize
;

410 
p_‹mp
 = (cÚ¡ *)&
OSDbg_MsgPoÞSize
;

411 
p_‹mp
 = (cÚ¡ *)&
OSDbg_MsgQSize
;

414 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Mu‹x
;

415 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Mu‹xEn
;

416 #ià(
OS_CFG_MUTEX_EN
) > 0u

417 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Mu‹xD–En
;

418 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Mu‹xP’dAbÜtEn
;

419 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Mu‹xSize
;

422 
p_‹mp
 = (cÚ¡ *)&
OSDbg_ObjTy³ChkEn
;

424 
p_‹mp
 = (cÚ¡ *)&
OSDbg_P’dMuÉiEn
;

425 
p_‹mp
 = (cÚ¡ *)&
OSDbg_P’dD©aSize
;

426 
p_‹mp
 = (cÚ¡ *)&
OSDbg_P’dLi¡Size
;

427 
p_‹mp
 = (cÚ¡ *)&
OSDbg_P’dObjSize
;

429 
p_‹mp
 = (cÚ¡ *)&
OSDbg_PrioMax
;

430 
p_‹mp
 = (cÚ¡ *)&
OSDbg_PrioTblSize
;

432 
p_‹mp
 = (cÚ¡ *)&
OSDbg_PŒSize
;

434 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Q
;

435 
p_‹mp
 = (cÚ¡ *)&
OSDbg_QEn
;

436 #ià(
OS_CFG_Q_EN
) > 0u

437 
p_‹mp
 = (cÚ¡ *)&
OSDbg_QD–En
;

438 
p_‹mp
 = (cÚ¡ *)&
OSDbg_QFlushEn
;

439 
p_‹mp
 = (cÚ¡ *)&
OSDbg_QP’dAbÜtEn
;

440 
p_‹mp
 = (cÚ¡ *)&
OSDbg_QSize
;

443 
p_‹mp
 = (cÚ¡ *)&
OSDbg_SchedRoundRobšEn
;

445 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Sem
;

446 
p_‹mp
 = (cÚ¡ *)&
OSDbg_SemEn
;

447 #ià(
OS_CFG_SEM_EN
) > 0u

448 
p_‹mp
 = (cÚ¡ *)&
OSDbg_SemD–En
;

449 
p_‹mp
 = (cÚ¡ *)&
OSDbg_SemP’dAbÜtEn
;

450 
p_‹mp
 = (cÚ¡ *)&
OSDbg_SemS‘En
;

451 
p_‹mp
 = (cÚ¡ *)&
OSDbg_SemSize
;

454 
p_‹mp
 = (cÚ¡ *)&
OSDbg_RdyLi¡
;

455 
p_‹mp
 = (cÚ¡ *)&
OSDbg_RdyLi¡Size
;

457 
p_‹mp
 = (cÚ¡ *)&
OSDbg_StkWidth
;

459 
p_‹mp
 = (cÚ¡ *)&
OSDbg_StTaskEn
;

460 
p_‹mp
 = (cÚ¡ *)&
OSDbg_StTaskStkChkEn
;

462 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskChªgePrioEn
;

463 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskD–En
;

464 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskQEn
;

465 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskQP’dAbÜtEn
;

466 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskProfžeEn
;

467 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskRegTblSize
;

468 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskSemP’dAbÜtEn
;

469 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TaskSu¥’dEn
;

471 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TCBSize
;

473 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TickSpokeSize
;

475 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TimeDlyHMSMEn
;

476 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TimeDlyResumeEn
;

479 
p_‹mp
 = (cÚ¡ *)&
OSDbg_Tmr
;

480 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TmrEn
;

481 #ià(
OS_CFG_TMR_EN
) > 0u

482 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TmrD–En
;

483 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TmrSize
;

484 
p_‹mp
 = (cÚ¡ *)&
OSDbg_TmrSpokeSize
;

487 
p_‹mp
 = (cÚ¡ *)&
OSDbg_V”siÚNbr
;

489 
p_‹mp
 =…_temp;

490 
	}
}

	@os_flag.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_æag__c
 = "$Id: $";

41 #ià
OS_CFG_FLAG_EN
 > 0u

70 
	$OSFÏgC»©e
 (
OS_FLAG_GRP
 *
p_g½
,

71 
CPU_CHAR
 *
p_Çme
,

72 
OS_FLAGS
 
æags
,

73 
OS_ERR
 *
p_”r
)

75 
	`CPU_SR_ALLOC
();

79 #ifdeà
OS_SAFETY_CRITICAL


80 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

81 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

86 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


87 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

88 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

93 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

94 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

95 *
p_”r
 = 
OS_ERR_CREATE_ISR
;

100 #ià
OS_CFG_ARG_CHK_EN
 > 0u

101 ià(
p_g½
 =ð(
OS_FLAG_GRP
 *)0) {

102 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

107 
	`OS_CRITICAL_ENTER
();

108 
p_g½
->
Ty³
 = 
OS_OBJ_TYPE_FLAG
;

109 
p_g½
->
NamePŒ
 = 
p_Çme
;

110 
p_g½
->
FÏgs
 = 
æags
;

111 
p_g½
->
TS
 = (
CPU_TS
)0;

112 
	`OS_P’dLi¡In™
(&
p_g½
->
P’dLi¡
);

114 #ià
OS_CFG_DBG_EN
 > 0u

115 
	`OS_FÏgDbgLi¡Add
(
p_g½
);

117 
OSFÏgQty
++;

119 
	`OS_CRITICAL_EXIT_NO_SCHED
();

120 *
p_”r
 = 
OS_ERR_NONE
;

121 
	}
}

155 #ià
OS_CFG_FLAG_DEL_EN
 > 0u

156 
OS_OBJ_QTY
 
	$OSFÏgD–
 (
OS_FLAG_GRP
 *
p_g½
,

157 
OS_OPT
 
Ýt
,

158 
OS_ERR
 *
p_”r
)

160 
OS_OBJ_QTY
 
út
;

161 
OS_OBJ_QTY
 
nbr_sks
;

162 
OS_PEND_DATA
 *
p_³nd_d©a
;

163 
OS_PEND_LIST
 *
p_³nd_li¡
;

164 
OS_TCB
 *
p_tcb
;

165 
CPU_TS
 
ts
;

166 
	`CPU_SR_ALLOC
();

170 #ifdeà
OS_SAFETY_CRITICAL


171 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

172 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

173  ((
OS_OBJ_QTY
)0);

177 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

178 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

179 *
p_”r
 = 
OS_ERR_DEL_ISR
;

180  ((
OS_OBJ_QTY
)0);

184 #ià
OS_CFG_ARG_CHK_EN
 > 0u

185 ià(
p_g½
 =ð(
OS_FLAG_GRP
 *)0) {

186 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

187  ((
OS_OBJ_QTY
)0);

189 
Ýt
) {

190 
OS_OPT_DEL_NO_PEND
:

191 
OS_OPT_DEL_ALWAYS
:

195 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

196  ((
OS_OBJ_QTY
)0);

200 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

201 ià(
p_g½
->
Ty³
 !ð
OS_OBJ_TYPE_FLAG
) {

202 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

203  ((
OS_OBJ_QTY
)0);

206 
	`OS_CRITICAL_ENTER
();

207 
p_³nd_li¡
 = &
p_g½
->
P’dLi¡
;

208 
út
 = 
p_³nd_li¡
->
NbrEÁr›s
;

209 
nbr_sks
 = 
út
;

210 
Ýt
) {

211 
OS_OPT_DEL_NO_PEND
:

212 ià(
nbr_sks
 =ð(
OS_OBJ_QTY
)0) {

213 #ià
OS_CFG_DBG_EN
 > 0u

214 
	`OS_FÏgDbgLi¡Remove
(
p_g½
);

216 
OSFÏgQty
--;

217 
	`OS_FÏgCÌ
(
p_g½
);

219 
	`OS_CRITICAL_EXIT
();

220 *
p_”r
 = 
OS_ERR_NONE
;

222 
	`OS_CRITICAL_EXIT
();

223 *
p_”r
 = 
OS_ERR_TASK_WAITING
;

227 
OS_OPT_DEL_ALWAYS
:

228 
ts
 = 
	`OS_TS_GET
();

229 
út
 > 0u) {

230 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

231 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

232 
	`OS_P’dObjD–
((
OS_PEND_OBJ
 *)((*)
p_g½
),

233 
p_tcb
,

234 
ts
);

235 
út
--;

237 #ià
OS_CFG_DBG_EN
 > 0u

238 
	`OS_FÏgDbgLi¡Remove
(
p_g½
);

240 
OSFÏgQty
--;

241 
	`OS_FÏgCÌ
(
p_g½
);

242 
	`OS_CRITICAL_EXIT_NO_SCHED
();

243 
	`OSSched
();

244 *
p_”r
 = 
OS_ERR_NONE
;

248 
	`OS_CRITICAL_EXIT
();

249 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

252  (
nbr_sks
);

253 
	}
}

315 
OS_FLAGS
 
	$OSFÏgP’d
 (
OS_FLAG_GRP
 *
p_g½
,

316 
OS_FLAGS
 
æags
,

317 
OS_TICK
 
timeout
,

318 
OS_OPT
 
Ýt
,

319 
CPU_TS
 *
p_ts
,

320 
OS_ERR
 *
p_”r
)

322 
CPU_BOOLEAN
 
cÚsume
;

323 
OS_FLAGS
 
æags_rdy
;

324 
OS_OPT
 
mode
;

325 
OS_PEND_DATA
 
³nd_d©a
;

326 
	`CPU_SR_ALLOC
();

330 #ifdeà
OS_SAFETY_CRITICAL


331 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

332 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

333  ((
OS_FLAGS
)0);

337 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

338 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

339 *
p_”r
 = 
OS_ERR_PEND_ISR
;

340  ((
OS_FLAGS
)0);

344 #ià
OS_CFG_ARG_CHK_EN
 > 0u

345 ià(
p_g½
 =ð(
OS_FLAG_GRP
 *)0) {

346 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

347  ((
OS_FLAGS
)0);

349 
Ýt
) {

350 
OS_OPT_PEND_FLAG_CLR_ALL
:

351 
OS_OPT_PEND_FLAG_CLR_ANY
:

352 
OS_OPT_PEND_FLAG_SET_ALL
:

353 
OS_OPT_PEND_FLAG_SET_ANY
:

354 
OS_OPT_PEND_FLAG_CLR_ALL
 | 
OS_OPT_PEND_FLAG_CONSUME
:

355 
OS_OPT_PEND_FLAG_CLR_ANY
 | 
OS_OPT_PEND_FLAG_CONSUME
:

356 
OS_OPT_PEND_FLAG_SET_ALL
 | 
OS_OPT_PEND_FLAG_CONSUME
:

357 
OS_OPT_PEND_FLAG_SET_ANY
 | 
OS_OPT_PEND_FLAG_CONSUME
:

358 
OS_OPT_PEND_FLAG_CLR_ALL
 | 
OS_OPT_PEND_NON_BLOCKING
:

359 
OS_OPT_PEND_FLAG_CLR_ANY
 | 
OS_OPT_PEND_NON_BLOCKING
:

360 
OS_OPT_PEND_FLAG_SET_ALL
 | 
OS_OPT_PEND_NON_BLOCKING
:

361 
OS_OPT_PEND_FLAG_SET_ANY
 | 
OS_OPT_PEND_NON_BLOCKING
:

362 
OS_OPT_PEND_FLAG_CLR_ALL
 | 
OS_OPT_PEND_FLAG_CONSUME
 | 
OS_OPT_PEND_NON_BLOCKING
:

363 
OS_OPT_PEND_FLAG_CLR_ANY
 | 
OS_OPT_PEND_FLAG_CONSUME
 | 
OS_OPT_PEND_NON_BLOCKING
:

364 
OS_OPT_PEND_FLAG_SET_ALL
 | 
OS_OPT_PEND_FLAG_CONSUME
 | 
OS_OPT_PEND_NON_BLOCKING
:

365 
OS_OPT_PEND_FLAG_SET_ANY
 | 
OS_OPT_PEND_FLAG_CONSUME
 | 
OS_OPT_PEND_NON_BLOCKING
:

369 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

370  ((
OS_OBJ_QTY
)0);

374 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

375 ià(
p_g½
->
Ty³
 !ð
OS_OBJ_TYPE_FLAG
) {

376 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

377  ((
OS_FLAGS
)0);

381 ià((
Ýt
 & 
OS_OPT_PEND_FLAG_CONSUME
è!ð(
OS_OPT
)0) {

382 
cÚsume
 = 
DEF_TRUE
;

384 
cÚsume
 = 
DEF_FALSE
;

387 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

388 *
p_ts
 = (
CPU_TS
)0;

391 
mode
 = 
Ýt
 & 
OS_OPT_PEND_FLAG_MASK
;

392 
	`CPU_CRITICAL_ENTER
();

393 
mode
) {

394 
OS_OPT_PEND_FLAG_SET_ALL
:

395 
æags_rdy
 = (
OS_FLAGS
)(
p_g½
->
FÏgs
 & 
æags
);

396 ià(
æags_rdy
 =ð
æags
) {

397 ià(
cÚsume
 =ð
DEF_TRUE
) {

398 
p_g½
->
FÏgs
 &ð~
æags_rdy
;

400 
OSTCBCurPŒ
->
FÏgsRdy
 = 
æags_rdy
;

401 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

402 *
p_ts
 = 
p_g½
->
TS
;

404 
	`CPU_CRITICAL_EXIT
();

405 *
p_”r
 = 
OS_ERR_NONE
;

406  (
æags_rdy
);

408 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

409 
	`CPU_CRITICAL_EXIT
();

410 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

411  ((
OS_FLAGS
)0);

413 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

414 
	`CPU_CRITICAL_EXIT
();

415 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

416  ((
OS_FLAGS
)0);

420 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

421 
	`OS_FÏgBlock
(&
³nd_d©a
,

422 
p_g½
,

423 
æags
,

424 
Ýt
,

425 
timeout
);

426 
	`OS_CRITICAL_EXIT_NO_SCHED
();

430 
OS_OPT_PEND_FLAG_SET_ANY
:

431 
æags_rdy
 = (
OS_FLAGS
)(
p_g½
->
FÏgs
 & 
æags
);

432 ià(
æags_rdy
 !ð(
OS_FLAGS
)0) {

433 ià(
cÚsume
 =ð
DEF_TRUE
) {

434 
p_g½
->
FÏgs
 &ð~
æags_rdy
;

436 
OSTCBCurPŒ
->
FÏgsRdy
 = 
æags_rdy
;

437 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

438 *
p_ts
 = 
p_g½
->
TS
;

440 
	`CPU_CRITICAL_EXIT
();

441 *
p_”r
 = 
OS_ERR_NONE
;

442  (
æags_rdy
);

444 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

445 
	`CPU_CRITICAL_EXIT
();

446 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

447  ((
OS_FLAGS
)0);

449 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

450 
	`CPU_CRITICAL_EXIT
();

451 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

452  ((
OS_FLAGS
)0);

456 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

457 
	`OS_FÏgBlock
(&
³nd_d©a
,

458 
p_g½
,

459 
æags
,

460 
Ýt
,

461 
timeout
);

462 
	`OS_CRITICAL_EXIT_NO_SCHED
();

466 #ià
OS_CFG_FLAG_MODE_CLR_EN
 > 0u

467 
OS_OPT_PEND_FLAG_CLR_ALL
:

468 
æags_rdy
 = (
OS_FLAGS
)(~
p_g½
->
FÏgs
 & 
æags
);

469 ià(
æags_rdy
 =ð
æags
) {

470 ià(
cÚsume
 =ð
DEF_TRUE
) {

471 
p_g½
->
FÏgs
 |ð
æags_rdy
;

473 
OSTCBCurPŒ
->
FÏgsRdy
 = 
æags_rdy
;

474 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

475 *
p_ts
 = 
p_g½
->
TS
;

477 
	`CPU_CRITICAL_EXIT
();

478 *
p_”r
 = 
OS_ERR_NONE
;

479  (
æags_rdy
);

481 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

482 
	`CPU_CRITICAL_EXIT
();

483 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

484  ((
OS_FLAGS
)0);

486 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

487 
	`CPU_CRITICAL_EXIT
();

488 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

489  ((
OS_FLAGS
)0);

493 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

494 
	`OS_FÏgBlock
(&
³nd_d©a
,

495 
p_g½
,

496 
æags
,

497 
Ýt
,

498 
timeout
);

499 
	`OS_CRITICAL_EXIT_NO_SCHED
();

503 
OS_OPT_PEND_FLAG_CLR_ANY
:

504 
æags_rdy
 = (
OS_FLAGS
)(~
p_g½
->
FÏgs
 & 
æags
);

505 ià(
æags_rdy
 !ð(
OS_FLAGS
)0) {

506 ià(
cÚsume
 =ð
DEF_TRUE
) {

507 
p_g½
->
FÏgs
 |ð
æags_rdy
;

509 
OSTCBCurPŒ
->
FÏgsRdy
 = 
æags_rdy
;

510 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

511 *
p_ts
 = 
p_g½
->
TS
;

513 
	`CPU_CRITICAL_EXIT
();

514 *
p_”r
 = 
OS_ERR_NONE
;

515  (
æags_rdy
);

517 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

518 
	`CPU_CRITICAL_EXIT
();

519 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

520  ((
OS_FLAGS
)0);

522 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

523 
	`CPU_CRITICAL_EXIT
();

524 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

525  ((
OS_FLAGS
)0);

529 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

530 
	`OS_FÏgBlock
(&
³nd_d©a
,

531 
p_g½
,

532 
æags
,

533 
Ýt
,

534 
timeout
);

535 
	`OS_CRITICAL_EXIT_NO_SCHED
();

541 
	`CPU_CRITICAL_EXIT
();

542 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

543  ((
OS_FLAGS
)0);

546 
	`OSSched
();

548 
	`CPU_CRITICAL_ENTER
();

549 
OSTCBCurPŒ
->
P’dStus
) {

550 
OS_STATUS_PEND_OK
:

551 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

552 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

554 *
p_”r
 = 
OS_ERR_NONE
;

557 
OS_STATUS_PEND_ABORT
:

558 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

559 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

561 
	`CPU_CRITICAL_EXIT
();

562 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

563  ((
OS_FLAGS
)0);

565 
OS_STATUS_PEND_TIMEOUT
:

566 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

567 *
p_ts
 = (
CPU_TS
 )0;

569 
	`CPU_CRITICAL_EXIT
();

570 *
p_”r
 = 
OS_ERR_TIMEOUT
;

571  ((
OS_FLAGS
)0);

573 
OS_STATUS_PEND_DEL
:

574 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

575 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

577 
	`CPU_CRITICAL_EXIT
();

578 *
p_”r
 = 
OS_ERR_OBJ_DEL
;

579  ((
OS_FLAGS
)0);

582 
	`CPU_CRITICAL_EXIT
();

583 *
p_”r
 = 
OS_ERR_STATUS_INVALID
;

584  ((
OS_FLAGS
)0);

587 
æags_rdy
 = 
OSTCBCurPŒ
->
FÏgsRdy
;

588 ià(
cÚsume
 =ð
DEF_TRUE
) {

589 
mode
) {

590 
OS_OPT_PEND_FLAG_SET_ALL
:

591 
OS_OPT_PEND_FLAG_SET_ANY
:

592 
p_g½
->
FÏgs
 &ð~
æags_rdy
;

595 #ià
OS_CFG_FLAG_MODE_CLR_EN
 > 0u

596 
OS_OPT_PEND_FLAG_CLR_ALL
:

597 
OS_OPT_PEND_FLAG_CLR_ANY
:

598 
p_g½
->
FÏgs
 |ð
æags_rdy
;

602 
	`CPU_CRITICAL_EXIT
();

603 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

604  ((
OS_FLAGS
)0);

607 
	`CPU_CRITICAL_EXIT
();

608 *
p_”r
 = 
OS_ERR_NONE
;

609  (
æags_rdy
);

610 
	}
}

646 #ià
OS_CFG_FLAG_PEND_ABORT_EN
 > 0u

647 
OS_OBJ_QTY
 
	$OSFÏgP’dAbÜt
 (
OS_FLAG_GRP
 *
p_g½
,

648 
OS_OPT
 
Ýt
,

649 
OS_ERR
 *
p_”r
)

651 
OS_PEND_LIST
 *
p_³nd_li¡
;

652 
OS_TCB
 *
p_tcb
;

653 
CPU_TS
 
ts
;

654 
OS_OBJ_QTY
 
nbr_sks
;

655 
	`CPU_SR_ALLOC
();

659 #ifdeà
OS_SAFETY_CRITICAL


660 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

661 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

662  ((
OS_OBJ_QTY
)0u);

666 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

667 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

668 *
p_”r
 = 
OS_ERR_PEND_ABORT_ISR
;

669  ((
OS_OBJ_QTY
)0u);

673 #ià
OS_CFG_ARG_CHK_EN
 > 0u

674 ià(
p_g½
 =ð(
OS_FLAG_GRP
 *)0) {

675 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

676  ((
OS_OBJ_QTY
)0u);

678 
Ýt
) {

679 
OS_OPT_PEND_ABORT_1
:

680 
OS_OPT_PEND_ABORT_ALL
:

681 
OS_OPT_PEND_ABORT_1
 | 
OS_OPT_POST_NO_SCHED
:

682 
OS_OPT_PEND_ABORT_ALL
 | 
OS_OPT_POST_NO_SCHED
:

686 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

687  ((
OS_OBJ_QTY
)0u);

691 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

692 ià(
p_g½
->
Ty³
 !ð
OS_OBJ_TYPE_FLAG
) {

693 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

694  ((
OS_OBJ_QTY
)0u);

698 
	`CPU_CRITICAL_ENTER
();

699 
p_³nd_li¡
 = &
p_g½
->
P’dLi¡
;

700 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0u) {

701 
	`CPU_CRITICAL_EXIT
();

702 *
p_”r
 = 
OS_ERR_PEND_ABORT_NONE
;

703  ((
OS_OBJ_QTY
)0u);

706 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

707 
nbr_sks
 = 0u;

708 
ts
 = 
	`OS_TS_GET
();

709 
p_³nd_li¡
->
NbrEÁr›s
 > (
OS_OBJ_QTY
)0u) {

710 
p_tcb
 = 
p_³nd_li¡
->
H—dPŒ
->
TCBPŒ
;

711 
	`OS_P’dAbÜt
((
OS_PEND_OBJ
 *)((*)
p_g½
),

712 
p_tcb
,

713 
ts
);

714 
nbr_sks
++;

715 ià(
Ýt
 !ð
OS_OPT_PEND_ABORT_ALL
) {

719 
	`OS_CRITICAL_EXIT_NO_SCHED
();

721 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0u) {

722 
	`OSSched
();

725 *
p_”r
 = 
OS_ERR_NONE
;

726  (
nbr_sks
);

727 
	}
}

747 
OS_FLAGS
 
	$OSFÏgP’dG‘FÏgsRdy
 (
OS_ERR
 *
p_”r
)

749 
OS_FLAGS
 
æags
;

750 
	`CPU_SR_ALLOC
();

754 #ifdeà
OS_SAFETY_CRITICAL


755 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

756 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

757  ((
OS_FLAGS
)0);

761 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

762 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

763 *
p_”r
 = 
OS_ERR_PEND_ISR
;

764  ((
OS_FLAGS
)0);

768 
	`CPU_CRITICAL_ENTER
();

769 
æags
 = 
OSTCBCurPŒ
->
FÏgsRdy
;

770 
	`CPU_CRITICAL_EXIT
();

771 *
p_”r
 = 
OS_ERR_NONE
;

772  (
æags
);

773 
	}
}

817 
OS_FLAGS
 
	$OSFÏgPo¡
 (
OS_FLAG_GRP
 *
p_g½
,

818 
OS_FLAGS
 
æags
,

819 
OS_OPT
 
Ýt
,

820 
OS_ERR
 *
p_”r
)

822 
OS_FLAGS
 
æags_cur
;

823 
CPU_TS
 
ts
;

827 #ifdeà
OS_SAFETY_CRITICAL


828 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

829 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

830  ((
OS_FLAGS
)0);

834 #ià
OS_CFG_ARG_CHK_EN
 > 0u

835 ià(
p_g½
 =ð(
OS_FLAG_GRP
 *)0) {

836 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

837  ((
OS_FLAGS
)0);

839 
Ýt
) {

840 
OS_OPT_POST_FLAG_SET
:

841 
OS_OPT_POST_FLAG_CLR
:

842 
OS_OPT_POST_FLAG_SET
 | 
OS_OPT_POST_NO_SCHED
:

843 
OS_OPT_POST_FLAG_CLR
 | 
OS_OPT_POST_NO_SCHED
:

847 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

848  ((
OS_FLAGS
)0);

852 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

853 ià(
p_g½
->
Ty³
 !ð
OS_OBJ_TYPE_FLAG
) {

854 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

855  ((
OS_FLAGS
)0);

859 
ts
 = 
	`OS_TS_GET
();

860 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

861 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

862 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_FLAG
,

863 (*)
p_g½
,

865 (
OS_MSG_SIZE
)0,

866 (
OS_FLAGS
 )
æags
,

867 (
OS_OPT
 )
Ýt
,

868 (
CPU_TS
 )
ts
,

869 (
OS_ERR
 *)
p_”r
);

870  ((
OS_FLAGS
)0);

874 
æags_cur
 = 
	`OS_FÏgPo¡
(
p_g½
,

875 
æags
,

876 
Ýt
,

877 
ts
,

878 
p_”r
);

880  (
æags_cur
);

881 
	}
}

920 
	$OS_FÏgBlock
 (
OS_PEND_DATA
 *
p_³nd_d©a
,

921 
OS_FLAG_GRP
 *
p_g½
,

922 
OS_FLAGS
 
æags
,

923 
OS_OPT
 
Ýt
,

924 
OS_TICK
 
timeout
)

926 
OSTCBCurPŒ
->
FÏgsP’d
 = 
æags
;

927 
OSTCBCurPŒ
->
FÏgsO±
 = 
Ýt
;

928 
OSTCBCurPŒ
->
FÏgsRdy
 = (
OS_FLAGS
)0;

930 
	`OS_P’d
(
p_³nd_d©a
,

931 (
OS_PEND_OBJ
 *)((*)
p_g½
),

932 
OS_TASK_PEND_ON_FLAG
,

933 
timeout
);

934 
	}
}

953 
	$OS_FÏgCÌ
 (
OS_FLAG_GRP
 *
p_g½
)

955 
OS_PEND_LIST
 *
p_³nd_li¡
;

959 
p_g½
->
Ty³
 = 
OS_OBJ_TYPE_NONE
;

960 
p_g½
->
NamePŒ
 = (
CPU_CHAR
 *)((*)"?FLAG");

961 
p_g½
->
FÏgs
 = (
OS_FLAGS
 )0;

962 
p_³nd_li¡
 = &
p_g½
->
P’dLi¡
;

963 
	`OS_P’dLi¡In™
(
p_³nd_li¡
);

964 
	}
}

984 
	$OS_FÏgIn™
 (
OS_ERR
 *
p_”r
)

986 #ifdeà
OS_SAFETY_CRITICAL


987 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

988 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

993 #ià
OS_CFG_DBG_EN
 > 0u

994 
OSFÏgDbgLi¡PŒ
 = (
OS_FLAG_GRP
 *)0;

997 
OSFÏgQty
 = (
OS_OBJ_QTY
 )0;

998 *
p_”r
 = 
OS_ERR_NONE
;

999 
	}
}

1017 #ià
OS_CFG_DBG_EN
 > 0u

1018 
	$OS_FÏgDbgLi¡Add
 (
OS_FLAG_GRP
 *
p_g½
)

1020 
p_g½
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

1021 
p_g½
->
DbgP»vPŒ
 = (
OS_FLAG_GRP
 *)0;

1022 ià(
OSFÏgDbgLi¡PŒ
 =ð(
OS_FLAG_GRP
 *)0) {

1023 
p_g½
->
DbgNextPŒ
 = (
OS_FLAG_GRP
 *)0;

1025 
p_g½
->
DbgNextPŒ
 = 
OSFÏgDbgLi¡PŒ
;

1026 
OSFÏgDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_g½
;

1028 
OSFÏgDbgLi¡PŒ
 = 
p_g½
;

1029 
	}
}

1033 
	$OS_FÏgDbgLi¡Remove
 (
OS_FLAG_GRP
 *
p_g½
)

1035 
OS_FLAG_GRP
 *
p_g½_Ãxt
;

1036 
OS_FLAG_GRP
 *
p_g½_´ev
;

1039 
p_g½_´ev
 = 
p_g½
->
DbgP»vPŒ
;

1040 
p_g½_Ãxt
 = 
p_g½
->
DbgNextPŒ
;

1042 ià(
p_g½_´ev
 =ð(
OS_FLAG_GRP
 *)0) {

1043 
OSFÏgDbgLi¡PŒ
 = 
p_g½_Ãxt
;

1044 ià(
p_g½_Ãxt
 !ð(
OS_FLAG_GRP
 *)0) {

1045 
p_g½_Ãxt
->
DbgP»vPŒ
 = (
OS_FLAG_GRP
 *)0;

1047 
p_g½
->
DbgNextPŒ
 = (
OS_FLAG_GRP
 *)0;

1049 } ià(
p_g½_Ãxt
 =ð(
OS_FLAG_GRP
 *)0) {

1050 
p_g½_´ev
->
DbgNextPŒ
 = (
OS_FLAG_GRP
 *)0;

1051 
p_g½
->
DbgP»vPŒ
 = (
OS_FLAG_GRP
 *)0;

1054 
p_g½_´ev
->
DbgNextPŒ
 = 
p_g½_Ãxt
;

1055 
p_g½_Ãxt
->
DbgP»vPŒ
 = 
p_g½_´ev
;

1056 
p_g½
->
DbgNextPŒ
 = (
OS_FLAG_GRP
 *)0;

1057 
p_g½
->
DbgP»vPŒ
 = (
OS_FLAG_GRP
 *)0;

1059 
	}
}

1106 
OS_FLAGS
 
	$OS_FÏgPo¡
 (
OS_FLAG_GRP
 *
p_g½
,

1107 
OS_FLAGS
 
æags
,

1108 
OS_OPT
 
Ýt
,

1109 
CPU_TS
 
ts
,

1110 
OS_ERR
 *
p_”r
)

1112 
OS_FLAGS
 
æags_cur
;

1113 
OS_FLAGS
 
æags_rdy
;

1114 
OS_OPT
 
mode
;

1115 
OS_PEND_DATA
 *
p_³nd_d©a
;

1116 
OS_PEND_DATA
 *
p_³nd_d©a_Ãxt
;

1117 
OS_PEND_LIST
 *
p_³nd_li¡
;

1118 
OS_TCB
 *
p_tcb
;

1119 
	`CPU_SR_ALLOC
();

1123 
	`CPU_CRITICAL_ENTER
();

1124 
Ýt
) {

1125 
OS_OPT_POST_FLAG_SET
:

1126 
OS_OPT_POST_FLAG_SET
 | 
OS_OPT_POST_NO_SCHED
:

1127 
p_g½
->
FÏgs
 |ð
æags
;

1130 
OS_OPT_POST_FLAG_CLR
:

1131 
OS_OPT_POST_FLAG_CLR
 | 
OS_OPT_POST_NO_SCHED
:

1132 
p_g½
->
FÏgs
 &ð~
æags
;

1136 
	`CPU_CRITICAL_EXIT
();

1137 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

1138  ((
OS_FLAGS
)0);

1140 
p_g½
->
TS
 = 
ts
;

1141 
p_³nd_li¡
 = &
p_g½
->
P’dLi¡
;

1142 ià(
p_³nd_li¡
->
NbrEÁr›s
 == 0u) {

1143 
	`CPU_CRITICAL_EXIT
();

1144 *
p_”r
 = 
OS_ERR_NONE
;

1145  (
p_g½
->
FÏgs
);

1148 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

1149 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

1150 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

1151 
p_tcb
 !ð(
OS_TCB
 *)0) {

1152 
p_³nd_d©a_Ãxt
 = 
p_³nd_d©a
->
NextPŒ
;

1153 
mode
 = 
p_tcb
->
FÏgsO±
 & 
OS_OPT_PEND_FLAG_MASK
;

1154 
mode
) {

1155 
OS_OPT_PEND_FLAG_SET_ALL
:

1156 
æags_rdy
 = (
OS_FLAGS
)(
p_g½
->
FÏgs
 & 
p_tcb
->
FÏgsP’d
);

1157 ià(
æags_rdy
 =ð
p_tcb
->
FÏgsP’d
) {

1158 
	`OS_FÏgTaskRdy
(
p_tcb
,

1159 
æags_rdy
,

1160 
ts
);

1164 
OS_OPT_PEND_FLAG_SET_ANY
:

1165 
æags_rdy
 = (
OS_FLAGS
)(
p_g½
->
FÏgs
 & 
p_tcb
->
FÏgsP’d
);

1166 ià(
æags_rdy
 !ð(
OS_FLAGS
)0) {

1167 
	`OS_FÏgTaskRdy
(
p_tcb
,

1168 
æags_rdy
,

1169 
ts
);

1173 #ià
OS_CFG_FLAG_MODE_CLR_EN
 > 0u

1174 
OS_OPT_PEND_FLAG_CLR_ALL
:

1175 
æags_rdy
 = (
OS_FLAGS
)(~
p_g½
->
FÏgs
 & 
p_tcb
->
FÏgsP’d
);

1176 ià(
æags_rdy
 =ð
p_tcb
->
FÏgsP’d
) {

1177 
	`OS_FÏgTaskRdy
(
p_tcb
,

1178 
æags_rdy
,

1179 
ts
);

1183 
OS_OPT_PEND_FLAG_CLR_ANY
:

1184 
æags_rdy
 = (
OS_FLAGS
)(~
p_g½
->
FÏgs
 & 
p_tcb
->
FÏgsP’d
);

1185 ià(
æags_rdy
 !ð(
OS_FLAGS
)0) {

1186 
	`OS_FÏgTaskRdy
(
p_tcb
,

1187 
æags_rdy
,

1188 
ts
);

1193 
	`OS_CRITICAL_EXIT
();

1194 *
p_”r
 = 
OS_ERR_FLAG_PEND_OPT
;

1195  ((
OS_FLAGS
)0);

1197 
p_³nd_d©a
 = 
p_³nd_d©a_Ãxt
;

1198 ià(
p_³nd_d©a
 !ð(
OS_PEND_DATA
 *)0) {

1199 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

1201 
p_tcb
 = (
OS_TCB
 *)0;

1204 
	`OS_CRITICAL_EXIT_NO_SCHED
();

1206 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

1207 
	`OSSched
();

1210 
	`CPU_CRITICAL_ENTER
();

1211 
æags_cur
 = 
p_g½
->
FÏgs
;

1212 
	`CPU_CRITICAL_EXIT
();

1213 *
p_”r
 = 
OS_ERR_NONE
;

1214  (
æags_cur
);

1215 
	}
}

1238 
	$OS_FÏgTaskRdy
 (
OS_TCB
 *
p_tcb
,

1239 
OS_FLAGS
 
æags_rdy
,

1240 
CPU_TS
 
ts
)

1242 
p_tcb
->
FÏgsRdy
 = 
æags_rdy
;

1243 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_OK
;

1244 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

1245 
p_tcb
->
TS
 = 
ts
;

1246 
p_tcb
->
TaskS‹
) {

1247 
OS_TASK_STATE_RDY
:

1248 
OS_TASK_STATE_DLY
:

1249 
OS_TASK_STATE_DLY_SUSPENDED
:

1250 
OS_TASK_STATE_SUSPENDED
:

1253 
OS_TASK_STATE_PEND
:

1254 
OS_TASK_STATE_PEND_TIMEOUT
:

1255 
	`OS_TaskRdy
(
p_tcb
);

1256 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

1259 
OS_TASK_STATE_PEND_SUSPENDED
:

1260 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

1261 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

1267 
	`OS_P’dLi¡Remove
(
p_tcb
);

1268 
	}
}

	@os_int.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_št__c
 = "$Id: $";

41 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

91 
	$OS_IÁQPo¡
 (
OS_OBJ_TYPE
 
ty³
,

92 *
p_obj
,

93 *
p_void
,

94 
OS_MSG_SIZE
 
msg_size
,

95 
OS_FLAGS
 
æags
,

96 
OS_OPT
 
Ýt
,

97 
CPU_TS
 
ts
,

98 
OS_ERR
 *
p_”r
)

100 
	`CPU_SR_ALLOC
();

104 #ifdeà
OS_SAFETY_CRITICAL


105 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

106 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

111 
	`CPU_CRITICAL_ENTER
();

112 ià(
OSIÁQNbrEÁr›s
 < 
OSCfg_IÁQSize
) {

113 
OSIÁQNbrEÁr›s
++;

115 ià(
OSIÁQNbrEÁr›sMax
 < 
OSIÁQNbrEÁr›s
) {

116 
OSIÁQNbrEÁr›sMax
 = 
OSIÁQNbrEÁr›s
;

119 
OSIÁQInPŒ
->
Ty³
 = 
ty³
;

120 
OSIÁQInPŒ
->
ObjPŒ
 = 
p_obj
;

121 
OSIÁQInPŒ
->
MsgPŒ
 = 
p_void
;

122 
OSIÁQInPŒ
->
MsgSize
 = 
msg_size
;

123 
OSIÁQInPŒ
->
FÏgs
 = 
æags
;

124 
OSIÁQInPŒ
->
O±
 = 
Ýt
;

125 
OSIÁQInPŒ
->
TS
 = 
ts
;

127 
OSIÁQInPŒ
 = OSIÁQInPŒ->
NextPŒ
;

129 
OSRdyLi¡
[0].
NbrEÁr›s
 = (
OS_OBJ_QTY
)1;

130 
OSRdyLi¡
[0].
H—dPŒ
 = &
OSIÁQTaskTCB
;

131 
OSRdyLi¡
[0].
TažPŒ
 = &
OSIÁQTaskTCB
;

132 
	`OS_PrioIn£¹
(0u);

133 ià(
OSPrioCur
 != 0) {

134 
OSPrioSaved
 = 
OSPrioCur
;

137 *
p_”r
 = 
OS_ERR_NONE
;

139 
OSIÁQOvfCŒ
++;

140 *
p_”r
 = 
OS_ERR_INT_Q_FULL
;

142 
	`CPU_CRITICAL_EXIT
();

143 
	}
}

159 
	$OS_IÁQRePo¡
 ()

161 
CPU_TS
 
ts
;

162 
OS_ERR
 
”r
;

165 
OSIÁQOutPŒ
->
Ty³
) {

166 
OS_OBJ_TYPE_FLAG
:

167 #ià
OS_CFG_FLAG_EN
 > 0u

168 ()
	`OS_FÏgPo¡
((
OS_FLAG_GRP
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

169 (
OS_FLAGS
 ) 
OSIÁQOutPŒ
->
FÏgs
,

170 (
OS_OPT
 ) 
OSIÁQOutPŒ
->
O±
,

171 (
CPU_TS
 ) 
OSIÁQOutPŒ
->
TS
,

172 (
OS_ERR
 *)&
”r
);

176 
OS_OBJ_TYPE_Q
:

177 #ià
OS_CFG_Q_EN
 > 0u

178 
	`OS_QPo¡
((
OS_Q
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

179 (*è
OSIÁQOutPŒ
->
MsgPŒ
,

180 (
OS_MSG_SIZE
è
OSIÁQOutPŒ
->
MsgSize
,

181 (
OS_OPT
 ) 
OSIÁQOutPŒ
->
O±
,

182 (
CPU_TS
 ) 
OSIÁQOutPŒ
->
TS
,

183 (
OS_ERR
 *)&
”r
);

187 
OS_OBJ_TYPE_SEM
:

188 #ià
OS_CFG_SEM_EN
 > 0u

189 ()
	`OS_SemPo¡
((
OS_SEM
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

190 (
OS_OPT
 ) 
OSIÁQOutPŒ
->
O±
,

191 (
CPU_TS
 ) 
OSIÁQOutPŒ
->
TS
,

192 (
OS_ERR
 *)&
”r
);

196 
OS_OBJ_TYPE_TASK_MSG
:

197 #ià
OS_CFG_TASK_Q_EN
 > 0u

198 
	`OS_TaskQPo¡
((
OS_TCB
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

199 (*è
OSIÁQOutPŒ
->
MsgPŒ
,

200 (
OS_MSG_SIZE
è
OSIÁQOutPŒ
->
MsgSize
,

201 (
OS_OPT
 ) 
OSIÁQOutPŒ
->
O±
,

202 (
CPU_TS
 ) 
OSIÁQOutPŒ
->
TS
,

203 (
OS_ERR
 *)&
”r
);

207 
OS_OBJ_TYPE_TASK_RESUME
:

208 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

209 ()
	`OS_TaskResume
((
OS_TCB
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

210 (
OS_ERR
 *)&
”r
);

214 
OS_OBJ_TYPE_TASK_SIGNAL
:

215 ()
	`OS_TaskSemPo¡
((
OS_TCB
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

216 (
OS_OPT
 ) 
OSIÁQOutPŒ
->
O±
,

217 (
CPU_TS
 ) 
OSIÁQOutPŒ
->
TS
,

218 (
OS_ERR
 *)&
”r
);

221 
OS_OBJ_TYPE_TASK_SUSPEND
:

222 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

223 ()
	`OS_TaskSu¥’d
((
OS_TCB
 *è
OSIÁQOutPŒ
->
ObjPŒ
,

224 (
OS_ERR
 *)&
”r
);

228 
OS_OBJ_TYPE_TICK
:

229 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

230 
	`OS_SchedRoundRobš
(&
OSRdyLi¡
[
OSPrioSaved
]);

233 ()
	`OS_TaskSemPo¡
((
OS_TCB
 *)&
OSTickTaskTCB
,

234 (
OS_OPT
 ) 
OS_OPT_POST_NONE
,

235 (
CPU_TS
 ) 
OSIÁQOutPŒ
->
TS
,

236 (
OS_ERR
 *)&
”r
);

237 #ià
OS_CFG_TMR_EN
 > 0u

238 
OSTmrUpd©eCŒ
--;

239 ià(
OSTmrUpd©eCŒ
 =ð(
OS_CTR
)0u) {

240 
OSTmrUpd©eCŒ
 = 
OSTmrUpd©eCÁ
;

241 
ts
 = 
	`OS_TS_GET
();

242 ()
	`OS_TaskSemPo¡
((
OS_TCB
 *)&
OSTmrTaskTCB
,

243 (
OS_OPT
 ) 
OS_OPT_POST_NONE
,

244 (
CPU_TS
 ) 
ts
,

245 (
OS_ERR
 *)&
”r
);

253 
	}
}

269 
	$OS_IÁQTask
 (*
p_¬g
)

271 
CPU_BOOLEAN
 
dÚe
;

272 
CPU_TS
 
ts_¡¬t
;

273 
CPU_TS
 
ts_’d
;

274 
	`CPU_SR_ALLOC
();

278 
p_¬g
 =…_arg;

279 
DEF_ON
) {

280 
dÚe
 = 
DEF_FALSE
;

281 
dÚe
 =ð
DEF_FALSE
) {

282 
	`CPU_CRITICAL_ENTER
();

283 ià(
OSIÁQNbrEÁr›s
 =ð(
OS_OBJ_QTY
)0u) {

284 
OSRdyLi¡
[0].
NbrEÁr›s
 = (
OS_OBJ_QTY
)0u;

285 
OSRdyLi¡
[0].
H—dPŒ
 = (
OS_TCB
 *)0;

286 
OSRdyLi¡
[0].
TažPŒ
 = (
OS_TCB
 *)0;

287 
	`OS_PrioRemove
(0u);

288 
	`CPU_CRITICAL_EXIT
();

289 
	`OSSched
();

290 
dÚe
 = 
DEF_TRUE
;

292 
	`CPU_CRITICAL_EXIT
();

293 
ts_¡¬t
 = 
	`OS_TS_GET
();

294 
	`OS_IÁQRePo¡
();

295 
ts_’d
 = 
	`OS_TS_GET
(è- 
ts_¡¬t
;

296 ià(
OSIÁQTaskTimeMax
 < 
ts_’d
) {

297 
OSIÁQTaskTimeMax
 = 
ts_’d
;

299 
	`CPU_CRITICAL_ENTER
();

300 
OSIÁQOutPŒ
 = OSIÁQOutPŒ->
NextPŒ
;

301 
OSIÁQNbrEÁr›s
--;

302 
	`CPU_CRITICAL_EXIT
();

306 
	}
}

331 
	$OS_IÁQTaskIn™
 (
OS_ERR
 *
p_”r
)

333 
OS_INT_Q
 *
p_št_q
;

334 
OS_INT_Q
 *
p_št_q_Ãxt
;

335 
OS_OBJ_QTY
 
i
;

339 #ifdeà
OS_SAFETY_CRITICAL


340 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

341 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

346 
OSIÁQOvfCŒ
 = (
OS_QTY
)0u;

348 ià(
OSCfg_IÁQBa£PŒ
 =ð(
OS_INT_Q
 *)0) {

349 *
p_”r
 = 
OS_ERR_INT_Q
;

353 ià(
OSCfg_IÁQSize
 < (
OS_OBJ_QTY
)2u) {

354 *
p_”r
 = 
OS_ERR_INT_Q_SIZE
;

358 
OSIÁQTaskTimeMax
 = (
CPU_TS
)0;

360 
p_št_q
 = 
OSCfg_IÁQBa£PŒ
;

361 
p_št_q_Ãxt
 = 
p_št_q
;

362 
p_št_q_Ãxt
++;

363 
i
 = 0u; i < 
OSCfg_IÁQSize
; i++) {

364 
p_št_q
->
Ty³
 = 
OS_OBJ_TYPE_NONE
;

365 
p_št_q
->
ObjPŒ
 = (*)0;

366 
p_št_q
->
MsgPŒ
 = (*)0;

367 
p_št_q
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

368 
p_št_q
->
FÏgs
 = (
OS_FLAGS
 )0u;

369 
p_št_q
->
O±
 = (
OS_OPT
 )0u;

370 
p_št_q
->
NextPŒ
 = 
p_št_q_Ãxt
;

371 
p_št_q
++;

372 
p_št_q_Ãxt
++;

374 
p_št_q
--;

375 
p_št_q_Ãxt
 = 
OSCfg_IÁQBa£PŒ
;

376 
p_št_q
->
NextPŒ
 = 
p_št_q_Ãxt
;

377 
OSIÁQInPŒ
 = 
p_št_q_Ãxt
;

378 
OSIÁQOutPŒ
 = 
p_št_q_Ãxt
;

379 
OSIÁQNbrEÁr›s
 = (
OS_OBJ_QTY
)0u;

380 
OSIÁQNbrEÁr›sMax
 = (
OS_OBJ_QTY
)0u;

383 ià(
OSCfg_IÁQTaskStkBa£PŒ
 =ð(
CPU_STK
 *)0) {

384 *
p_”r
 = 
OS_ERR_INT_Q_STK_INVALID
;

388 ià(
OSCfg_IÁQTaskStkSize
 < 
OSCfg_StkSizeMš
) {

389 *
p_”r
 = 
OS_ERR_INT_Q_STK_SIZE_INVALID
;

393 
	`OSTaskC»©e
((
OS_TCB
 *)&
OSIÁQTaskTCB
,

394 (
CPU_CHAR
 *)((*)"uC/OS-III ISR Queue Task"),

395 (
OS_TASK_PTR
 )
OS_IÁQTask
,

397 (
OS_PRIO
 )0u,

398 (
CPU_STK
 *)
OSCfg_IÁQTaskStkBa£PŒ
,

399 (
CPU_STK_SIZE
)
OSCfg_IÁQTaskStkLim™
,

400 (
CPU_STK_SIZE
)
OSCfg_IÁQTaskStkSize
,

401 (
OS_MSG_QTY
 )0u,

402 (
OS_TICK
 )0u,

404 (
OS_OPT
 )(
OS_OPT_TASK_STK_CHK
 | 
OS_OPT_TASK_STK_CLR
),

405 (
OS_ERR
 *)
p_”r
);

406 
	}
}

	@os_mem.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_mem__c
 = "$Id: $";

41 #ià
OS_CFG_MEM_EN
 > 0u

75 
	$OSMemC»©e
 (
OS_MEM
 *
p_mem
,

76 
CPU_CHAR
 *
p_Çme
,

77 *
p_addr
,

78 
OS_MEM_QTY
 
n_blks
,

79 
OS_MEM_SIZE
 
blk_size
,

80 
OS_ERR
 *
p_”r
)

82 #ià
OS_CFG_ARG_CHK_EN
 > 0u

83 
CPU_DATA
 
®ign_msk
;

85 
OS_MEM_QTY
 
i
;

86 
OS_MEM_QTY
 
loÝs
;

87 
CPU_INT08U
 *
p_blk
;

88 **
p_lšk
;

89 
	`CPU_SR_ALLOC
();

93 #ifdeà
OS_SAFETY_CRITICAL


94 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

95 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

100 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


101 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

102 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

107 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

108 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

109 *
p_”r
 = 
OS_ERR_MEM_CREATE_ISR
;

114 #ià
OS_CFG_ARG_CHK_EN
 > 0u

115 ià(
p_addr
 == (*)0) {

116 *
p_”r
 = 
OS_ERR_MEM_INVALID_P_ADDR
;

119 ià(
n_blks
 < (
OS_MEM_QTY
)2) {

120 *
p_”r
 = 
OS_ERR_MEM_INVALID_BLKS
;

123 ià(
blk_size
 < (*)) {

124 *
p_”r
 = 
OS_ERR_MEM_INVALID_SIZE
;

127 
®ign_msk
 = (*) - 1u;

128 ià(
®ign_msk
 > 0) {

129 ià(((
CPU_ADDR
)
p_addr
 & 
®ign_msk
) != 0u){

130 *
p_”r
 = 
OS_ERR_MEM_INVALID_P_ADDR
;

133 ià((
blk_size
 & 
®ign_msk
) != 0u) {

134 *
p_”r
 = 
OS_ERR_MEM_INVALID_SIZE
;

140 
p_lšk
 = (**)
p_addr
;

141 
p_blk
 = (
CPU_INT08U
 *)
p_addr
;

142 
loÝs
 = 
n_blks
 - 1u;

143 
i
 = 0u; i < 
loÝs
; i++) {

144 
p_blk
 +ð
blk_size
;

145 *
p_lšk
 = (*)
p_blk
;

146 
p_lšk
 = (**)(*)
p_blk
;

148 *
p_lšk
 = (*)0;

150 
	`OS_CRITICAL_ENTER
();

151 
p_mem
->
Ty³
 = 
OS_OBJ_TYPE_MEM
;

152 
p_mem
->
NamePŒ
 = 
p_Çme
;

153 
p_mem
->
AddrPŒ
 = 
p_addr
;

154 
p_mem
->
F»eLi¡PŒ
 = 
p_addr
;

155 
p_mem
->
NbrF»e
 = 
n_blks
;

156 
p_mem
->
NbrMax
 = 
n_blks
;

157 
p_mem
->
BlkSize
 = 
blk_size
;

159 #ià
OS_CFG_DBG_EN
 > 0u

160 
	`OS_MemDbgLi¡Add
(
p_mem
);

163 
OSMemQty
++;

165 
	`OS_CRITICAL_EXIT_NO_SCHED
();

166 *
p_”r
 = 
OS_ERR_NONE
;

167 
	}
}

190 *
	$OSMemG‘
 (
OS_MEM
 *
p_mem
,

191 
OS_ERR
 *
p_”r
)

193 *
p_blk
;

194 
	`CPU_SR_ALLOC
();

198 #ifdeà
OS_SAFETY_CRITICAL


199 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

200 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

205 #ià
OS_CFG_ARG_CHK_EN
 > 0u

206 ià(
p_mem
 =ð(
OS_MEM
 *)0) {

207 *
p_”r
 = 
OS_ERR_MEM_INVALID_P_MEM
;

212 
	`CPU_CRITICAL_ENTER
();

213 ià(
p_mem
->
NbrF»e
 =ð(
OS_MEM_QTY
)0) {

214 
	`CPU_CRITICAL_EXIT
();

215 *
p_”r
 = 
OS_ERR_MEM_NO_FREE_BLKS
;

218 
p_blk
 = 
p_mem
->
F»eLi¡PŒ
;

219 
p_mem
->
F»eLi¡PŒ
 = *(**)
p_blk
;

220 
p_mem
->
NbrF»e
--;

221 
	`CPU_CRITICAL_EXIT
();

222 *
p_”r
 = 
OS_ERR_NONE
;

223  (
p_blk
);

224 
	}
}

247 
	$OSMemPut
 (
OS_MEM
 *
p_mem
,

248 *
p_blk
,

249 
OS_ERR
 *
p_”r
)

251 
	`CPU_SR_ALLOC
();

255 #ifdeà
OS_SAFETY_CRITICAL


256 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

257 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

262 #ià
OS_CFG_ARG_CHK_EN
 > 0u

263 ià(
p_mem
 =ð(
OS_MEM
 *)0) {

264 *
p_”r
 = 
OS_ERR_MEM_INVALID_P_MEM
;

267 ià(
p_blk
 == (*)0) {

268 *
p_”r
 = 
OS_ERR_MEM_INVALID_P_BLK
;

273 
	`CPU_CRITICAL_ENTER
();

274 ià(
p_mem
->
NbrF»e
 >ðp_mem->
NbrMax
) {

275 
	`CPU_CRITICAL_EXIT
();

276 *
p_”r
 = 
OS_ERR_MEM_FULL
;

279 *(**)
p_blk
 = 
p_mem
->
F»eLi¡PŒ
;

280 
p_mem
->
F»eLi¡PŒ
 = 
p_blk
;

281 
p_mem
->
NbrF»e
++;

282 
	`CPU_CRITICAL_EXIT
();

283 *
p_”r
 = 
OS_ERR_NONE
;

284 
	}
}

301 #ià
OS_CFG_DBG_EN
 > 0u

302 
	$OS_MemDbgLi¡Add
 (
OS_MEM
 *
p_mem
)

304 
p_mem
->
DbgP»vPŒ
 = (
OS_MEM
 *)0;

305 ià(
OSMemDbgLi¡PŒ
 =ð(
OS_MEM
 *)0) {

306 
p_mem
->
DbgNextPŒ
 = (
OS_MEM
 *)0;

308 
p_mem
->
DbgNextPŒ
 = 
OSMemDbgLi¡PŒ
;

309 
OSMemDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_mem
;

311 
OSMemDbgLi¡PŒ
 = 
p_mem
;

312 
	}
}

331 
	$OS_MemIn™
 (
OS_ERR
 *
p_”r
)

333 #ifdeà
OS_SAFETY_CRITICAL


334 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

335 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

340 #ià
OS_CFG_DBG_EN
 > 0u

341 
OSMemDbgLi¡PŒ
 = (
OS_MEM
 *)0;

344 
OSMemQty
 = (
OS_OBJ_QTY
)0;

345 *
p_”r
 = 
OS_ERR_NONE
;

346 
	}
}

	@os_msg.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_msg__c
 = "$Id: $";

41 #ià
OS_MSG_EN
 > 0u

62 
	$OS_MsgPoÞC»©e
 (
OS_MSG
 *
p_msg
,

63 
OS_MSG_QTY
 
size
)

65 
OS_MSG
 *
p_msg1
;

66 
OS_MSG
 *
p_msg2
;

67 
OS_MSG_QTY
 
i
;

68 
OS_MSG_QTY
 
loÝs
;

72 
p_msg1
 = 
p_msg
;

73 
p_msg2
 = 
p_msg
;

74 
p_msg2
++;

75 
loÝs
 = 
size
 - 1u;

76 
i
 = 0u; i < 
loÝs
; i++) {

77 
p_msg1
->
NextPŒ
 = 
p_msg2
;

78 
p_msg1
->
MsgPŒ
 = (*)0;

79 
p_msg1
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

80 
p_msg1
->
MsgTS
 = (
CPU_TS
 )0u;

81 
p_msg1
++;

82 
p_msg2
++;

84 
p_msg1
->
NextPŒ
 = (
OS_MSG
 *)0;

85 
p_msg1
->
MsgPŒ
 = (*)0;

86 
p_msg1
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

87 
p_msg1
->
MsgTS
 = (
CPU_TS
 )0u;

88 
	}
}

109 
	$OS_MsgPoÞIn™
 (
OS_ERR
 *
p_”r
)

111 #ifdeà
OS_SAFETY_CRITICAL


112 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

113 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

118 #ià
OS_CFG_ARG_CHK_EN
 > 0u

119 ià(
OSCfg_MsgPoÞBa£PŒ
 =ð(
OS_MSG
 *)0) {

120 *
p_”r
 = 
OS_ERR_MSG_POOL_NULL_PTR
;

123 ià(
OSCfg_MsgPoÞSize
 =ð(
OS_MSG_QTY
)0) {

124 *
p_”r
 = 
OS_ERR_MSG_POOL_EMPTY
;

129 
	`OS_MsgPoÞC»©e
(
OSCfg_MsgPoÞBa£PŒ
,

130 
OSCfg_MsgPoÞSize
);

131 
OSMsgPoÞ
.
NextPŒ
 = 
OSCfg_MsgPoÞBa£PŒ
;

132 
OSMsgPoÞ
.
NbrF»e
 = 
OSCfg_MsgPoÞSize
;

133 
OSMsgPoÞ
.
NbrU£d
 = (
OS_MSG_QTY
)0;

134 
OSMsgPoÞ
.
NbrU£dMax
 = (
OS_MSG_QTY
)0;

135 *
p_”r
 = 
OS_ERR_NONE
;

136 
	}
}

154 
OS_MSG_QTY
 
	$OS_MsgQF»eAÎ
 (
OS_MSG_Q
 *
p_msg_q
)

156 
OS_MSG
 *
p_msg
;

157 
OS_MSG_QTY
 
qty
;

161 
qty
 = 
p_msg_q
->
NbrEÁr›s
;

162 ià(
p_msg_q
->
NbrEÁr›s
 > (
OS_MSG_QTY
)0) {

163 
p_msg
 = 
p_msg_q
->
InPŒ
;

164 
p_msg
->
NextPŒ
 = 
OSMsgPoÞ
.NextPtr;

165 
OSMsgPoÞ
.
NextPŒ
 = 
p_msg_q
->
OutPŒ
;

166 
OSMsgPoÞ
.
NbrU£d
 -ð
p_msg_q
->
NbrEÁr›s
;

167 
OSMsgPoÞ
.
NbrF»e
 +ð
p_msg_q
->
NbrEÁr›s
;

168 
p_msg_q
->
NbrEÁr›s
 = (
OS_MSG_QTY
)0;

169 
p_msg_q
->
NbrEÁr›sMax
 = (
OS_MSG_QTY
)0;

170 
p_msg_q
->
InPŒ
 = (
OS_MSG
 *)0;

171 
p_msg_q
->
OutPŒ
 = (
OS_MSG
 *)0;

173  (
qty
);

174 
	}
}

194 
	$OS_MsgQIn™
 (
OS_MSG_Q
 *
p_msg_q
,

195 
OS_MSG_QTY
 
size
)

197 
p_msg_q
->
NbrEÁr›sSize
 = (
OS_MSG_QTY
)
size
;

198 
p_msg_q
->
NbrEÁr›s
 = (
OS_MSG_QTY
)0;

199 
p_msg_q
->
NbrEÁr›sMax
 = (
OS_MSG_QTY
)0;

200 
p_msg_q
->
InPŒ
 = (
OS_MSG
 *)0;

201 
p_msg_q
->
OutPŒ
 = (
OS_MSG
 *)0;

202 
	}
}

229 *
	$OS_MsgQG‘
 (
OS_MSG_Q
 *
p_msg_q
,

230 
OS_MSG_SIZE
 *
p_msg_size
,

231 
CPU_TS
 *
p_ts
,

232 
OS_ERR
 *
p_”r
)

234 
OS_MSG
 *
p_msg
;

235 *
p_void
;

239 #ifdeà
OS_SAFETY_CRITICAL


240 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

241 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

246 ià(
p_msg_q
->
NbrEÁr›s
 =ð(
OS_MSG_QTY
)0) {

247 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

248 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

249 *
p_ts
 = (
CPU_TS
 )0;

251 *
p_”r
 = 
OS_ERR_Q_EMPTY
;

255 
p_msg
 = 
p_msg_q
->
OutPŒ
;

256 
p_void
 = 
p_msg
->
MsgPŒ
;

257 *
p_msg_size
 = 
p_msg
->
MsgSize
;

258 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

259 *
p_ts
 = 
p_msg
->
MsgTS
;

261 
p_msg_q
->
OutPŒ
 = 
p_msg
->
NextPŒ
;

262 ià(
p_msg_q
->
OutPŒ
 =ð(
OS_MSG
 *)0) {

263 
p_msg_q
->
InPŒ
 = (
OS_MSG
 *)0;

264 
p_msg_q
->
NbrEÁr›s
 = (
OS_MSG_QTY
)0;

266 
p_msg_q
->
NbrEÁr›s
--;

268 
p_msg
->
NextPŒ
 = 
OSMsgPoÞ
.NextPtr;

269 
OSMsgPoÞ
.
NextPŒ
 = 
p_msg
;

270 
OSMsgPoÞ
.
NbrF»e
++;

271 
OSMsgPoÞ
.
NbrU£d
--;

272 *
p_”r
 = 
OS_ERR_NONE
;

273  (
p_void
);

274 
	}
}

309 
	$OS_MsgQPut
 (
OS_MSG_Q
 *
p_msg_q
,

310 *
p_void
,

311 
OS_MSG_SIZE
 
msg_size
,

312 
OS_OPT
 
Ýt
,

313 
CPU_TS
 
ts
,

314 
OS_ERR
 *
p_”r
)

316 
OS_MSG
 *
p_msg
;

317 
OS_MSG
 *
p_msg_š
;

321 #ifdeà
OS_SAFETY_CRITICAL


322 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

323 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

328 ià(
p_msg_q
->
NbrEÁr›s
 >ðp_msg_q->
NbrEÁr›sSize
) {

329 *
p_”r
 = 
OS_ERR_Q_MAX
;

333 ià(
OSMsgPoÞ
.
NbrF»e
 =ð(
OS_MSG_QTY
)0) {

334 *
p_”r
 = 
OS_ERR_MSG_POOL_EMPTY
;

338 
p_msg
 = 
OSMsgPoÞ
.
NextPŒ
;

339 
OSMsgPoÞ
.
NextPŒ
 = 
p_msg
->NextPtr;

340 
OSMsgPoÞ
.
NbrF»e
--;

341 
OSMsgPoÞ
.
NbrU£d
++;

342 ià(
OSMsgPoÞ
.
NbrU£dMax
 < OSMsgPoÞ.
NbrU£d
) {

343 
OSMsgPoÞ
.
NbrU£dMax
 = OSMsgPoÞ.
NbrU£d
;

345 ià(
p_msg_q
->
NbrEÁr›s
 =ð(
OS_MSG_QTY
)0) {

346 
p_msg_q
->
InPŒ
 = 
p_msg
;

347 
p_msg_q
->
OutPŒ
 = 
p_msg
;

348 
p_msg_q
->
NbrEÁr›s
 = (
OS_MSG_QTY
)1;

350 ià((
Ýt
 & 
OS_OPT_POST_LIFO
è=ð
OS_OPT_POST_FIFO
) {

351 
p_msg_š
 = 
p_msg_q
->
InPŒ
;

352 
p_msg_š
->
NextPŒ
 = 
p_msg
;

353 
p_msg
->
NextPŒ
 = (
OS_MSG
 *)0;

354 
p_msg_q
->
InPŒ
 = 
p_msg
;

356 
p_msg
->
NextPŒ
 = 
p_msg_q
->
OutPŒ
;

357 
p_msg_q
->
OutPŒ
 = 
p_msg
;

359 
p_msg_q
->
NbrEÁr›s
++;

361 ià(
p_msg_q
->
NbrEÁr›sMax
 <…_msg_q->
NbrEÁr›s
) {

362 
p_msg_q
->
NbrEÁr›sMax
 =…_msg_q->
NbrEÁr›s
;

364 
p_msg
->
MsgPŒ
 = 
p_void
;

365 
p_msg
->
MsgSize
 = 
msg_size
;

366 
p_msg
->
MsgTS
 = 
ts
;

367 *
p_”r
 = 
OS_ERR_NONE
;

368 
	}
}

	@os_mutex.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_mu‹x__c
 = "$Id: $";

41 #ià
OS_CFG_MUTEX_EN
 > 0u

67 
	$OSMu‹xC»©e
 (
OS_MUTEX
 *
p_mu‹x
,

68 
CPU_CHAR
 *
p_Çme
,

69 
OS_ERR
 *
p_”r
)

71 
	`CPU_SR_ALLOC
();

75 #ifdeà
OS_SAFETY_CRITICAL


76 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

77 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

82 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


83 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

84 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

89 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

90 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

91 *
p_”r
 = 
OS_ERR_CREATE_ISR
;

96 #ià
OS_CFG_ARG_CHK_EN
 > 0u

97 ià(
p_mu‹x
 =ð(
OS_MUTEX
 *)0) {

98 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

103 
	`OS_CRITICAL_ENTER
();

104 
p_mu‹x
->
Ty³
 = 
OS_OBJ_TYPE_MUTEX
;

105 
p_mu‹x
->
NamePŒ
 = 
p_Çme
;

106 
p_mu‹x
->
OwÃrTCBPŒ
 = (
OS_TCB
 *)0;

107 
p_mu‹x
->
OwÃrNe¡šgCŒ
 = (
OS_NESTING_CTR
)0;

108 
p_mu‹x
->
TS
 = (
CPU_TS
 )0;

109 
p_mu‹x
->
OwÃrOrigš®Prio
 = 
OS_CFG_PRIO_MAX
;

110 
	`OS_P’dLi¡In™
(&
p_mu‹x
->
P’dLi¡
);

112 #ià
OS_CFG_DBG_EN
 > 0u

113 
	`OS_Mu‹xDbgLi¡Add
(
p_mu‹x
);

115 
OSMu‹xQty
++;

117 
	`OS_CRITICAL_EXIT_NO_SCHED
();

118 *
p_”r
 = 
OS_ERR_NONE
;

119 
	}
}

159 #ià
OS_CFG_MUTEX_DEL_EN
 > 0u

160 
OS_OBJ_QTY
 
	$OSMu‹xD–
 (
OS_MUTEX
 *
p_mu‹x
,

161 
OS_OPT
 
Ýt
,

162 
OS_ERR
 *
p_”r
)

164 
OS_OBJ_QTY
 
út
;

165 
OS_OBJ_QTY
 
nbr_sks
;

166 
OS_PEND_DATA
 *
p_³nd_d©a
;

167 
OS_PEND_LIST
 *
p_³nd_li¡
;

168 
OS_TCB
 *
p_tcb
;

169 
OS_TCB
 *
p_tcb_owÃr
;

170 
CPU_TS
 
ts
;

171 
	`CPU_SR_ALLOC
();

175 #ifdeà
OS_SAFETY_CRITICAL


176 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

177 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

178  ((
OS_OBJ_QTY
)0);

182 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

183 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

184 *
p_”r
 = 
OS_ERR_DEL_ISR
;

185  ((
OS_OBJ_QTY
)0);

189 #ià
OS_CFG_ARG_CHK_EN
 > 0u

190 ià(
p_mu‹x
 =ð(
OS_MUTEX
 *)0) {

191 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

192  ((
OS_OBJ_QTY
)0);

194 
Ýt
) {

195 
OS_OPT_DEL_NO_PEND
:

196 
OS_OPT_DEL_ALWAYS
:

200 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

201  ((
OS_OBJ_QTY
)0);

205 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

206 ià(
p_mu‹x
->
Ty³
 !ð
OS_OBJ_TYPE_MUTEX
) {

207 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

208  ((
OS_OBJ_QTY
)0);

212 
	`OS_CRITICAL_ENTER
();

213 
p_³nd_li¡
 = &
p_mu‹x
->
P’dLi¡
;

214 
út
 = 
p_³nd_li¡
->
NbrEÁr›s
;

215 
nbr_sks
 = 
út
;

216 
Ýt
) {

217 
OS_OPT_DEL_NO_PEND
:

218 ià(
nbr_sks
 =ð(
OS_OBJ_QTY
)0) {

219 #ià
OS_CFG_DBG_EN
 > 0u

220 
	`OS_Mu‹xDbgLi¡Remove
(
p_mu‹x
);

222 
OSMu‹xQty
--;

223 
	`OS_Mu‹xCÌ
(
p_mu‹x
);

224 
	`OS_CRITICAL_EXIT
();

225 *
p_”r
 = 
OS_ERR_NONE
;

227 
	`OS_CRITICAL_EXIT
();

228 *
p_”r
 = 
OS_ERR_TASK_WAITING
;

232 
OS_OPT_DEL_ALWAYS
:

233 
p_tcb_owÃr
 = 
p_mu‹x
->
OwÃrTCBPŒ
;

234 ià((
p_tcb_owÃr
 !ð(
OS_TCB
 *)0) &&

235 (
p_tcb_owÃr
->
Prio
 !ð
p_mu‹x
->
OwÃrOrigš®Prio
)) {

236 
p_tcb_owÃr
->
TaskS‹
) {

237 
OS_TASK_STATE_RDY
:

238 
	`OS_RdyLi¡Remove
(
p_tcb_owÃr
);

239 
p_tcb_owÃr
->
Prio
 = 
p_mu‹x
->
OwÃrOrigš®Prio
;

240 
	`OS_PrioIn£¹
(
p_tcb_owÃr
->
Prio
);

241 
	`OS_RdyLi¡In£¹Taž
(
p_tcb_owÃr
);

244 
OS_TASK_STATE_DLY
:

245 
OS_TASK_STATE_SUSPENDED
:

246 
OS_TASK_STATE_DLY_SUSPENDED
:

247 
p_tcb_owÃr
->
Prio
 = 
p_mu‹x
->
OwÃrOrigš®Prio
;

250 
OS_TASK_STATE_PEND
:

251 
OS_TASK_STATE_PEND_TIMEOUT
:

252 
OS_TASK_STATE_PEND_SUSPENDED
:

253 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

254 
	`OS_P’dLi¡ChªgePrio
(
p_tcb_owÃr
,

255 
p_mu‹x
->
OwÃrOrigš®Prio
);

259 
	`OS_CRITICAL_EXIT
();

260 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

261  ((
OS_OBJ_QTY
)0);

265 
ts
 = 
	`OS_TS_GET
();

266 
út
 > 0u) {

267 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

268 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

269 
	`OS_P’dObjD–
((
OS_PEND_OBJ
 *)((*)
p_mu‹x
),

270 
p_tcb
,

271 
ts
);

272 
út
--;

274 #ià
OS_CFG_DBG_EN
 > 0u

275 
	`OS_Mu‹xDbgLi¡Remove
(
p_mu‹x
);

277 
OSMu‹xQty
--;

278 
	`OS_Mu‹xCÌ
(
p_mu‹x
);

279 
	`OS_CRITICAL_EXIT_NO_SCHED
();

280 
	`OSSched
();

281 *
p_”r
 = 
OS_ERR_NONE
;

285 
	`OS_CRITICAL_EXIT
();

286 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

289  (
nbr_sks
);

290 
	}
}

339 
	$OSMu‹xP’d
 (
OS_MUTEX
 *
p_mu‹x
,

340 
OS_TICK
 
timeout
,

341 
OS_OPT
 
Ýt
,

342 
CPU_TS
 *
p_ts
,

343 
OS_ERR
 *
p_”r
)

345 
OS_PEND_DATA
 
³nd_d©a
;

346 
OS_TCB
 *
p_tcb
;

347 
	`CPU_SR_ALLOC
();

351 #ifdeà
OS_SAFETY_CRITICAL


352 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

353 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

358 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

359 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

360 *
p_”r
 = 
OS_ERR_PEND_ISR
;

365 #ià
OS_CFG_ARG_CHK_EN
 > 0u

366 ià(
p_mu‹x
 =ð(
OS_MUTEX
 *)0) {

367 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

370 
Ýt
) {

371 
OS_OPT_PEND_BLOCKING
:

372 
OS_OPT_PEND_NON_BLOCKING
:

376 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

381 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

382 ià(
p_mu‹x
->
Ty³
 !ð
OS_OBJ_TYPE_MUTEX
) {

383 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

388 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

389 *
p_ts
 = (
CPU_TS
 )0;

392 
	`CPU_CRITICAL_ENTER
();

393 ià(
p_mu‹x
->
OwÃrNe¡šgCŒ
 =ð(
OS_NESTING_CTR
)0) {

394 
p_mu‹x
->
OwÃrTCBPŒ
 = 
OSTCBCurPŒ
;

395 
p_mu‹x
->
OwÃrOrigš®Prio
 = 
OSTCBCurPŒ
->
Prio
;

396 
p_mu‹x
->
OwÃrNe¡šgCŒ
 = (
OS_NESTING_CTR
)1;

397 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

398 *
p_ts
 = 
p_mu‹x
->
TS
;

400 
	`CPU_CRITICAL_EXIT
();

401 *
p_”r
 = 
OS_ERR_NONE
;

405 ià(
OSTCBCurPŒ
 =ð
p_mu‹x
->
OwÃrTCBPŒ
) {

406 
p_mu‹x
->
OwÃrNe¡šgCŒ
++;

407 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

408 *
p_ts
 = 
p_mu‹x
->
TS
;

410 
	`CPU_CRITICAL_EXIT
();

411 *
p_”r
 = 
OS_ERR_MUTEX_OWNER
;

415 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

416 
	`CPU_CRITICAL_EXIT
();

417 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

420 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

421 
	`CPU_CRITICAL_EXIT
();

422 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

427 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

428 
p_tcb
 = 
p_mu‹x
->
OwÃrTCBPŒ
;

429 ià(
p_tcb
->
Prio
 > 
OSTCBCurPŒ
->Prio) {

430 
p_tcb
->
TaskS‹
) {

431 
OS_TASK_STATE_RDY
:

432 
	`OS_RdyLi¡Remove
(
p_tcb
);

433 
p_tcb
->
Prio
 = 
OSTCBCurPŒ
->Prio;

434 
	`OS_PrioIn£¹
(
p_tcb
->
Prio
);

435 
	`OS_RdyLi¡In£¹H—d
(
p_tcb
);

438 
OS_TASK_STATE_DLY
:

439 
OS_TASK_STATE_DLY_SUSPENDED
:

440 
OS_TASK_STATE_SUSPENDED
:

441 
p_tcb
->
Prio
 = 
OSTCBCurPŒ
->Prio;

444 
OS_TASK_STATE_PEND
:

445 
OS_TASK_STATE_PEND_TIMEOUT
:

446 
OS_TASK_STATE_PEND_SUSPENDED
:

447 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

448 
	`OS_P’dLi¡ChªgePrio
(
p_tcb
,

449 
OSTCBCurPŒ
->
Prio
);

453 
	`OS_CRITICAL_EXIT
();

454 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

459 
	`OS_P’d
(&
³nd_d©a
,

460 (
OS_PEND_OBJ
 *)((*)
p_mu‹x
),

461 
OS_TASK_PEND_ON_MUTEX
,

462 
timeout
);

464 
	`OS_CRITICAL_EXIT_NO_SCHED
();

466 
	`OSSched
();

468 
	`CPU_CRITICAL_ENTER
();

469 
OSTCBCurPŒ
->
P’dStus
) {

470 
OS_STATUS_PEND_OK
:

471 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

472 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

474 *
p_”r
 = 
OS_ERR_NONE
;

477 
OS_STATUS_PEND_ABORT
:

478 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

479 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

481 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

484 
OS_STATUS_PEND_TIMEOUT
:

485 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

486 *
p_ts
 = (
CPU_TS
 )0;

488 *
p_”r
 = 
OS_ERR_TIMEOUT
;

491 
OS_STATUS_PEND_DEL
:

492 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

493 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

495 *
p_”r
 = 
OS_ERR_OBJ_DEL
;

499 *
p_”r
 = 
OS_ERR_STATUS_INVALID
;

502 
	`CPU_CRITICAL_EXIT
();

503 
	}
}

537 #ià
OS_CFG_MUTEX_PEND_ABORT_EN
 > 0u

538 
OS_OBJ_QTY
 
	$OSMu‹xP’dAbÜt
 (
OS_MUTEX
 *
p_mu‹x
,

539 
OS_OPT
 
Ýt
,

540 
OS_ERR
 *
p_”r
)

542 
OS_PEND_LIST
 *
p_³nd_li¡
;

543 
OS_TCB
 *
p_tcb
;

544 
CPU_TS
 
ts
;

545 
OS_OBJ_QTY
 
nbr_sks
;

546 
	`CPU_SR_ALLOC
();

550 #ifdeà
OS_SAFETY_CRITICAL


551 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

552 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

553  ((
OS_OBJ_QTY
)0u);

557 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

558 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

559 *
p_”r
 = 
OS_ERR_PEND_ABORT_ISR
;

560  ((
OS_OBJ_QTY
)0u);

564 #ià
OS_CFG_ARG_CHK_EN
 > 0u

565 ià(
p_mu‹x
 =ð(
OS_MUTEX
 *)0) {

566 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

567  ((
OS_OBJ_QTY
)0u);

569 
Ýt
) {

570 
OS_OPT_PEND_ABORT_1
:

571 
OS_OPT_PEND_ABORT_ALL
:

572 
OS_OPT_PEND_ABORT_1
 | 
OS_OPT_POST_NO_SCHED
:

573 
OS_OPT_PEND_ABORT_ALL
 | 
OS_OPT_POST_NO_SCHED
:

577 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

578  ((
OS_OBJ_QTY
)0u);

582 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

583 ià(
p_mu‹x
->
Ty³
 !ð
OS_OBJ_TYPE_MUTEX
) {

584 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

585  ((
OS_OBJ_QTY
)0u);

589 
	`CPU_CRITICAL_ENTER
();

590 
p_³nd_li¡
 = &
p_mu‹x
->
P’dLi¡
;

591 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0u) {

592 
	`CPU_CRITICAL_EXIT
();

593 *
p_”r
 = 
OS_ERR_PEND_ABORT_NONE
;

594  ((
OS_OBJ_QTY
)0u);

597 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

598 
nbr_sks
 = 0u;

599 
ts
 = 
	`OS_TS_GET
();

600 
p_³nd_li¡
->
NbrEÁr›s
 > (
OS_OBJ_QTY
)0u) {

601 
p_tcb
 = 
p_³nd_li¡
->
H—dPŒ
->
TCBPŒ
;

602 
	`OS_P’dAbÜt
((
OS_PEND_OBJ
 *)((*)
p_mu‹x
),

603 
p_tcb
,

604 
ts
);

605 
nbr_sks
++;

606 ià(
Ýt
 !ð
OS_OPT_PEND_ABORT_ALL
) {

610 
	`OS_CRITICAL_EXIT_NO_SCHED
();

612 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0u) {

613 
	`OSSched
();

616 *
p_”r
 = 
OS_ERR_NONE
;

617  (
nbr_sks
);

618 
	}
}

648 
	$OSMu‹xPo¡
 (
OS_MUTEX
 *
p_mu‹x
,

649 
OS_OPT
 
Ýt
,

650 
OS_ERR
 *
p_”r
)

652 
OS_PEND_LIST
 *
p_³nd_li¡
;

653 
OS_TCB
 *
p_tcb
;

654 
CPU_TS
 
ts
;

655 
	`CPU_SR_ALLOC
();

659 #ifdeà
OS_SAFETY_CRITICAL


660 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

661 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

666 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

667 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

668 *
p_”r
 = 
OS_ERR_POST_ISR
;

673 #ià
OS_CFG_ARG_CHK_EN
 > 0u

674 ià(
p_mu‹x
 =ð(
OS_MUTEX
 *)0) {

675 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

678 
Ýt
) {

679 
OS_OPT_POST_NONE
:

680 
OS_OPT_POST_NO_SCHED
:

684 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

689 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

690 ià(
p_mu‹x
->
Ty³
 !ð
OS_OBJ_TYPE_MUTEX
) {

691 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

696 
	`CPU_CRITICAL_ENTER
();

697 ià(
OSTCBCurPŒ
 !ð
p_mu‹x
->
OwÃrTCBPŒ
) {

698 
	`CPU_CRITICAL_EXIT
();

699 *
p_”r
 = 
OS_ERR_MUTEX_NOT_OWNER
;

703 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

704 
ts
 = 
	`OS_TS_GET
();

705 
p_mu‹x
->
TS
 = 
ts
;

706 
p_mu‹x
->
OwÃrNe¡šgCŒ
--;

707 ià(
p_mu‹x
->
OwÃrNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

708 
	`OS_CRITICAL_EXIT
();

709 *
p_”r
 = 
OS_ERR_MUTEX_NESTING
;

713 
p_³nd_li¡
 = &
p_mu‹x
->
P’dLi¡
;

714 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

715 
p_mu‹x
->
OwÃrTCBPŒ
 = (
OS_TCB
 *)0;

716 
p_mu‹x
->
OwÃrNe¡šgCŒ
 = (
OS_NESTING_CTR
)0;

717 
	`OS_CRITICAL_EXIT
();

718 *
p_”r
 = 
OS_ERR_NONE
;

722 ià(
OSTCBCurPŒ
->
Prio
 !ð
p_mu‹x
->
OwÃrOrigš®Prio
) {

723 
	`OS_RdyLi¡Remove
(
OSTCBCurPŒ
);

724 
OSTCBCurPŒ
->
Prio
 = 
p_mu‹x
->
OwÃrOrigš®Prio
;

725 
	`OS_PrioIn£¹
(
OSTCBCurPŒ
->
Prio
);

726 
	`OS_RdyLi¡In£¹Taž
(
OSTCBCurPŒ
);

727 
OSPrioCur
 = 
OSTCBCurPŒ
->
Prio
;

730 
p_tcb
 = 
p_³nd_li¡
->
H—dPŒ
->
TCBPŒ
;

731 
p_mu‹x
->
OwÃrTCBPŒ
 = 
p_tcb
;

732 
p_mu‹x
->
OwÃrOrigš®Prio
 = 
p_tcb
->
Prio
;

733 
p_mu‹x
->
OwÃrNe¡šgCŒ
 = (
OS_NESTING_CTR
)1;

735 
	`OS_Po¡
((
OS_PEND_OBJ
 *)((*)
p_mu‹x
),

736 (
OS_TCB
 *)
p_tcb
,

738 (
OS_MSG_SIZE
 )0,

739 (
CPU_TS
 )
ts
);

741 
	`OS_CRITICAL_EXIT_NO_SCHED
();

743 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

744 
	`OSSched
();

747 *
p_”r
 = 
OS_ERR_NONE
;

748 
	}
}

767 
	$OS_Mu‹xCÌ
 (
OS_MUTEX
 *
p_mu‹x
)

769 
p_mu‹x
->
Ty³
 = 
OS_OBJ_TYPE_NONE
;

770 
p_mu‹x
->
NamePŒ
 = (
CPU_CHAR
 *)((*)"?MUTEX");

771 
p_mu‹x
->
OwÃrTCBPŒ
 = (
OS_TCB
 *)0;

772 
p_mu‹x
->
OwÃrNe¡šgCŒ
 = (
OS_NESTING_CTR
)0;

773 
p_mu‹x
->
TS
 = (
CPU_TS
 )0;

774 
p_mu‹x
->
OwÃrOrigš®Prio
 = 
OS_CFG_PRIO_MAX
;

775 
	`OS_P’dLi¡In™
(&
p_mu‹x
->
P’dLi¡
);

776 
	}
}

794 #ià
OS_CFG_DBG_EN
 > 0u

795 
	$OS_Mu‹xDbgLi¡Add
 (
OS_MUTEX
 *
p_mu‹x
)

797 
p_mu‹x
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

798 
p_mu‹x
->
DbgP»vPŒ
 = (
OS_MUTEX
 *)0;

799 ià(
OSMu‹xDbgLi¡PŒ
 =ð(
OS_MUTEX
 *)0) {

800 
p_mu‹x
->
DbgNextPŒ
 = (
OS_MUTEX
 *)0;

802 
p_mu‹x
->
DbgNextPŒ
 = 
OSMu‹xDbgLi¡PŒ
;

803 
OSMu‹xDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_mu‹x
;

805 
OSMu‹xDbgLi¡PŒ
 = 
p_mu‹x
;

806 
	}
}

810 
	$OS_Mu‹xDbgLi¡Remove
 (
OS_MUTEX
 *
p_mu‹x
)

812 
OS_MUTEX
 *
p_mu‹x_Ãxt
;

813 
OS_MUTEX
 *
p_mu‹x_´ev
;

816 
p_mu‹x_´ev
 = 
p_mu‹x
->
DbgP»vPŒ
;

817 
p_mu‹x_Ãxt
 = 
p_mu‹x
->
DbgNextPŒ
;

819 ià(
p_mu‹x_´ev
 =ð(
OS_MUTEX
 *)0) {

820 
OSMu‹xDbgLi¡PŒ
 = 
p_mu‹x_Ãxt
;

821 ià(
p_mu‹x_Ãxt
 !ð(
OS_MUTEX
 *)0) {

822 
p_mu‹x_Ãxt
->
DbgP»vPŒ
 = (
OS_MUTEX
 *)0;

824 
p_mu‹x
->
DbgNextPŒ
 = (
OS_MUTEX
 *)0;

826 } ià(
p_mu‹x_Ãxt
 =ð(
OS_MUTEX
 *)0) {

827 
p_mu‹x_´ev
->
DbgNextPŒ
 = (
OS_MUTEX
 *)0;

828 
p_mu‹x
->
DbgP»vPŒ
 = (
OS_MUTEX
 *)0;

831 
p_mu‹x_´ev
->
DbgNextPŒ
 = 
p_mu‹x_Ãxt
;

832 
p_mu‹x_Ãxt
->
DbgP»vPŒ
 = 
p_mu‹x_´ev
;

833 
p_mu‹x
->
DbgNextPŒ
 = (
OS_MUTEX
 *)0;

834 
p_mu‹x
->
DbgP»vPŒ
 = (
OS_MUTEX
 *)0;

836 
	}
}

857 
	$OS_Mu‹xIn™
 (
OS_ERR
 *
p_”r
)

859 #ifdeà
OS_SAFETY_CRITICAL


860 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

861 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

866 #ià
OS_CFG_DBG_EN
 > 0u

867 
OSMu‹xDbgLi¡PŒ
 = (
OS_MUTEX
 *)0;

870 
OSMu‹xQty
 = (
OS_OBJ_QTY
)0;

871 *
p_”r
 = 
OS_ERR_NONE
;

872 
	}
}

	@os_pend_multi.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_³nd_muÉi__c
 = "$Id: $";

41 #ià(((
OS_CFG_Q_EN
 > 0uè|| (
OS_CFG_SEM_EN
 > 0u)è&& (
OS_CFG_PEND_MULTI_EN
 > 0u))

121 
OS_OBJ_QTY
 
	$OSP’dMuÉi
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

122 
OS_OBJ_QTY
 
tbl_size
,

123 
OS_TICK
 
timeout
,

124 
OS_OPT
 
Ýt
,

125 
OS_ERR
 *
p_”r
)

127 
CPU_BOOLEAN
 
v®id
;

128 
OS_OBJ_QTY
 
nbr_obj_rdy
;

129 
	`CPU_SR_ALLOC
();

133 #ifdeà
OS_SAFETY_CRITICAL


134 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

135 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

136  ((
OS_OBJ_QTY
)0);

140 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

141 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

142 *
p_”r
 = 
OS_ERR_PEND_ISR
;

143  ((
OS_OBJ_QTY
)0);

147 #ià
OS_CFG_ARG_CHK_EN
 > 0u

148 ià(
p_³nd_d©a_tbl
 =ð(
OS_PEND_DATA
 *)0) {

149 *
p_”r
 = 
OS_ERR_PTR_INVALID
;

150  ((
OS_OBJ_QTY
)0);

152 ià(
tbl_size
 =ð(
OS_OBJ_QTY
)0) {

153 *
p_”r
 = 
OS_ERR_PTR_INVALID
;

154  ((
OS_OBJ_QTY
)0);

156 
Ýt
) {

157 
OS_OPT_PEND_BLOCKING
:

158 
OS_OPT_PEND_NON_BLOCKING
:

162 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

163  ((
OS_OBJ_QTY
)0);

167 
v®id
 = 
	`OS_P’dMuÉiV®id©e
(
p_³nd_d©a_tbl
,

168 
tbl_size
);

169 ià(
v®id
 =ð
DEF_FALSE
) {

170 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

171  ((
OS_OBJ_QTY
)0);

175 
	`CPU_CRITICAL_ENTER
();

176 
nbr_obj_rdy
 = 
	`OS_P’dMuÉiG‘Rdy
(
p_³nd_d©a_tbl
,

177 
tbl_size
);

178 ià(
nbr_obj_rdy
 > (
OS_OBJ_QTY
)0) {

179 
	`CPU_CRITICAL_EXIT
();

180 *
p_”r
 = 
OS_ERR_NONE
;

181  ((
OS_OBJ_QTY
)
nbr_obj_rdy
);

184 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

185 
	`CPU_CRITICAL_EXIT
();

186 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

187  ((
OS_OBJ_QTY
)0);

189 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

190 
	`CPU_CRITICAL_EXIT
();

191 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

192  ((
OS_OBJ_QTY
)0);

195 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

197 
	`OS_P’dMuÉiWa™
(
p_³nd_d©a_tbl
,

198 
tbl_size
,

199 
timeout
);

201 
	`OS_CRITICAL_EXIT_NO_SCHED
();

203 
	`OSSched
();

205 
	`CPU_CRITICAL_ENTER
();

206 
OSTCBCurPŒ
->
P’dStus
) {

207 
OS_STATUS_PEND_OK
:

208 *
p_”r
 = 
OS_ERR_NONE
;

211 
OS_STATUS_PEND_ABORT
:

212 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

215 
OS_STATUS_PEND_TIMEOUT
:

216 *
p_”r
 = 
OS_ERR_TIMEOUT
;

219 
OS_STATUS_PEND_DEL
:

220 *
p_”r
 = 
OS_ERR_OBJ_DEL
;

224 *
p_”r
 = 
OS_ERR_STATUS_INVALID
;

228 
OSTCBCurPŒ
->
P’dStus
 = 
OS_STATUS_PEND_OK
;

229 
	`CPU_CRITICAL_EXIT
();

231  ((
OS_OBJ_QTY
)1);

232 
	}
}

253 
OS_OBJ_QTY
 
	$OS_P’dMuÉiG‘Rdy
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

254 
OS_OBJ_QTY
 
tbl_size
)

256 
OS_OBJ_QTY
 
i
;

257 
OS_OBJ_QTY
 
nbr_obj_rdy
;

258 #ià
OS_CFG_Q_EN
 > 0u

259 
OS_ERR
 
”r
;

260 
OS_MSG_SIZE
 
msg_size
;

261 
OS_Q
 *
p_q
;

262 *
p_void
;

263 
CPU_TS
 
ts
;

265 #ià
OS_CFG_SEM_EN
 > 0u

266 
OS_SEM
 *
p_£m
;

271 
nbr_obj_rdy
 = (
OS_OBJ_QTY
)0;

272 
i
 = 0u; i < 
tbl_size
; i++) {

273 
p_³nd_d©a_tbl
->
RdyObjPŒ
 = (
OS_PEND_OBJ
 *)0;

274 
p_³nd_d©a_tbl
->
RdyMsgPŒ
 = (*)0;

275 
p_³nd_d©a_tbl
->
RdyMsgSize
 = (
OS_MSG_SIZE
 )0;

276 
p_³nd_d©a_tbl
->
RdyTS
 = (
CPU_TS
 )0;

277 
p_³nd_d©a_tbl
->
NextPŒ
 = (
OS_PEND_DATA
 *)0;

278 
p_³nd_d©a_tbl
->
P»vPŒ
 = (
OS_PEND_DATA
 *)0;

279 
p_³nd_d©a_tbl
->
TCBPŒ
 = (
OS_TCB
 *)0;

280 #ià
OS_CFG_Q_EN
 > 0u

281 
p_q
 = (
OS_Q
 *)((*)
p_³nd_d©a_tbl
->
P’dObjPŒ
);

282 ià(
p_q
->
Ty³
 =ð
OS_OBJ_TYPE_Q
) {

283 
p_void
 = 
	`OS_MsgQG‘
(&
p_q
->
MsgQ
,

284 &
msg_size
,

285 &
ts
,

286 &
”r
);

287 ià(
”r
 =ð
OS_ERR_NONE
) {

288 
p_³nd_d©a_tbl
->
RdyObjPŒ
 =…_³nd_d©a_tbl->
P’dObjPŒ
;

289 
p_³nd_d©a_tbl
->
RdyMsgPŒ
 = 
p_void
;

290 
p_³nd_d©a_tbl
->
RdyMsgSize
 = 
msg_size
;

291 
p_³nd_d©a_tbl
->
RdyTS
 = 
ts
;

292 
nbr_obj_rdy
++;

297 #ià
OS_CFG_SEM_EN
 > 0u

298 
p_£m
 = (
OS_SEM
 *)((*)
p_³nd_d©a_tbl
->
P’dObjPŒ
);

299 ià(
p_£m
->
Ty³
 =ð
OS_OBJ_TYPE_SEM
) {

300 ià(
p_£m
->
CŒ
 > 0u) {

301 
p_£m
->
CŒ
--;

302 
p_³nd_d©a_tbl
->
RdyObjPŒ
 =…_³nd_d©a_tbl->
P’dObjPŒ
;

303 
p_³nd_d©a_tbl
->
RdyTS
 = 
p_£m
->
TS
;

304 
nbr_obj_rdy
++;

309 
p_³nd_d©a_tbl
++;

311  (
nbr_obj_rdy
);

312 
	}
}

334 
CPU_BOOLEAN
 
	$OS_P’dMuÉiV®id©e
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

335 
OS_OBJ_QTY
 
tbl_size
)

337 
OS_OBJ_QTY
 
i
;

338 
OS_OBJ_QTY
 
ùr
;

339 #ià
OS_CFG_SEM_EN
 > 0u

340 
OS_SEM
 *
p_£m
;

342 #ià
OS_CFG_Q_EN
 > 0u

343 
OS_Q
 *
p_q
;

347 
i
 = 0u; i < 
tbl_size
; i++) {

348 ià(
p_³nd_d©a_tbl
->
P’dObjPŒ
 =ð(
OS_PEND_OBJ
 *)0) {

349  (
DEF_FALSE
);

352 
ùr
 = 0u;

353 #ià
OS_CFG_SEM_EN
 > 0u

354 
p_£m
 = (
OS_SEM
 *)((*)
p_³nd_d©a_tbl
->
P’dObjPŒ
);

355 ià(
p_£m
->
Ty³
 =ð
OS_OBJ_TYPE_SEM
) {

356 
ùr
++;

360 #ià
OS_CFG_Q_EN
 > 0u

361 
p_q
 = (
OS_Q
 *)((*)
p_³nd_d©a_tbl
->
P’dObjPŒ
);

362 ià(
p_q
->
Ty³
 =ð
OS_OBJ_TYPE_Q
) {

363 
ùr
++;

367 ià(
ùr
 =ð(
OS_OBJ_QTY
)0) {

368  (
DEF_FALSE
);

370 
p_³nd_d©a_tbl
++;

372  (
DEF_TRUE
);

373 
	}
}

396 
	$OS_P’dMuÉiWa™
 (
OS_PEND_DATA
 *
p_³nd_d©a_tbl
,

397 
OS_OBJ_QTY
 
tbl_size
,

398 
OS_TICK
 
timeout
)

400 
OS_OBJ_QTY
 
i
;

401 
OS_PEND_LIST
 *
p_³nd_li¡
;

403 #ià
OS_CFG_Q_EN
 > 0u

404 
OS_Q
 *
p_q
;

407 #ià
OS_CFG_SEM_EN
 > 0u

408 
OS_SEM
 *
p_£m
;

413 
OSTCBCurPŒ
->
P’dOn
 = 
OS_TASK_PEND_ON_MULTI
;

414 
OSTCBCurPŒ
->
P’dStus
 = 
OS_STATUS_PEND_OK
;

415 
OSTCBCurPŒ
->
P’dD©aTblEÁr›s
 = 
tbl_size
;

416 
OSTCBCurPŒ
->
P’dD©aTblPŒ
 = 
p_³nd_d©a_tbl
;

418 
	`OS_TaskBlock
(
OSTCBCurPŒ
,

419 
timeout
);

421 
i
 = 0u; i < 
tbl_size
; i++) {

422 
p_³nd_d©a_tbl
->
TCBPŒ
 = 
OSTCBCurPŒ
;

424 #ià
OS_CFG_SEM_EN
 > 0u

425 
p_£m
 = (
OS_SEM
 *)((*)
p_³nd_d©a_tbl
->
P’dObjPŒ
);

426 ià(
p_£m
->
Ty³
 =ð
OS_OBJ_TYPE_SEM
) {

427 
p_³nd_li¡
 = &
p_£m
->
P’dLi¡
;

428 
	`OS_P’dLi¡In£¹Prio
(
p_³nd_li¡
,

429 
p_³nd_d©a_tbl
);

433 #ià
OS_CFG_Q_EN
 > 0u

434 
p_q
 = (
OS_Q
 *)((*)
p_³nd_d©a_tbl
->
P’dObjPŒ
);

435 ià(
p_q
->
Ty³
 =ð
OS_OBJ_TYPE_Q
) {

436 
p_³nd_li¡
 = &
p_q
->
P’dLi¡
;

437 
	`OS_P’dLi¡In£¹Prio
(
p_³nd_li¡
,

438 
p_³nd_d©a_tbl
);

442 
p_³nd_d©a_tbl
++;

444 
	}
}

	@os_prio.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_´io__c
 = "$Id: $";

41 
CPU_DATA
 
	gOSPrioTbl
[
OS_PRIO_TBL_SIZE
];

59 
	$OS_PrioIn™
 ()

61 
CPU_DATA
 
i
;

65 
i
 = 0u; i < 
OS_PRIO_TBL_SIZE
; i++) {

66 
OSPrioTbl
[
i
] = (
CPU_DATA
)0;

68 
	}
}

85 
OS_PRIO
 
	$OS_PrioG‘Highe¡
 ()

87 
CPU_DATA
 *
p_tbl
;

88 
OS_PRIO
 
´io
;

91 
´io
 = (
OS_PRIO
)0;

92 
p_tbl
 = &
OSPrioTbl
[0];

93 *
p_tbl
 =ð(
CPU_DATA
)0) {

94 
´io
 +ð
DEF_INT_CPU_NBR_BITS
;

95 
p_tbl
++;

97 
´io
 +ð(
OS_PRIO
)
	`CPU_CÁL—dZ”os
(*
p_tbl
);

98  (
´io
);

99 
	}
}

115 
	$OS_PrioIn£¹
 (
OS_PRIO
 
´io
)

117 
CPU_DATA
 
b™
;

118 
CPU_DATA
 
b™_nbr
;

119 
OS_PRIO
 
ix
;

122 
ix
 = 
´io
 / 
DEF_INT_CPU_NBR_BITS
;

123 
b™_nbr
 = (
CPU_DATA
)
´io
 & (
DEF_INT_CPU_NBR_BITS
 - 1u);

124 
b™
 = 1u;

125 
b™
 <<ð(
DEF_INT_CPU_NBR_BITS
 - 1uè- 
b™_nbr
;

126 
OSPrioTbl
[
ix
] |ð
b™
;

127 
	}
}

143 
	$OS_PrioRemove
 (
OS_PRIO
 
´io
)

145 
CPU_DATA
 
b™
;

146 
CPU_DATA
 
b™_nbr
;

147 
OS_PRIO
 
ix
;

150 
ix
 = 
´io
 / 
DEF_INT_CPU_NBR_BITS
;

151 
b™_nbr
 = (
CPU_DATA
)
´io
 & (
DEF_INT_CPU_NBR_BITS
 - 1u);

152 
b™
 = 1u;

153 
b™
 <<ð(
DEF_INT_CPU_NBR_BITS
 - 1uè- 
b™_nbr
;

154 
OSPrioTbl
[
ix
] &ð~
b™
;

155 
	}
}

	@os_q.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_q__c
 = "$Id: $";

41 #ià
OS_CFG_Q_EN
 > 0u

71 
	$OSQC»©e
 (
OS_Q
 *
p_q
,

72 
CPU_CHAR
 *
p_Çme
,

73 
OS_MSG_QTY
 
max_qty
,

74 
OS_ERR
 *
p_”r
)

77 
	`CPU_SR_ALLOC
();

81 #ifdeà
OS_SAFETY_CRITICAL


82 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

83 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

88 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


89 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

90 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

95 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

96 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

97 *
p_”r
 = 
OS_ERR_CREATE_ISR
;

102 #ià
OS_CFG_ARG_CHK_EN
 > 0u

103 ià(
p_q
 =ð(
OS_Q
 *)0) {

104 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

107 ià(
max_qty
 =ð(
OS_MSG_QTY
)0) {

108 *
p_”r
 = 
OS_ERR_Q_SIZE
;

113 
	`OS_CRITICAL_ENTER
();

114 
p_q
->
Ty³
 = 
OS_OBJ_TYPE_Q
;

115 
p_q
->
NamePŒ
 = 
p_Çme
;

116 
	`OS_MsgQIn™
(&
p_q
->
MsgQ
,

117 
max_qty
);

118 
	`OS_P’dLi¡In™
(&
p_q
->
P’dLi¡
);

120 #ià
OS_CFG_DBG_EN
 > 0u

121 
	`OS_QDbgLi¡Add
(
p_q
);

123 
OSQQty
++;

125 
	`OS_CRITICAL_EXIT_NO_SCHED
();

126 *
p_”r
 = 
OS_ERR_NONE
;

127 
	}
}

166 #ià
OS_CFG_Q_DEL_EN
 > 0u

167 
OS_OBJ_QTY
 
	$OSQD–
 (
OS_Q
 *
p_q
,

168 
OS_OPT
 
Ýt
,

169 
OS_ERR
 *
p_”r
)

171 
OS_OBJ_QTY
 
út
;

172 
OS_OBJ_QTY
 
nbr_sks
;

173 
OS_PEND_DATA
 *
p_³nd_d©a
;

174 
OS_PEND_LIST
 *
p_³nd_li¡
;

175 
OS_TCB
 *
p_tcb
;

176 
CPU_TS
 
ts
;

177 
	`CPU_SR_ALLOC
();

181 #ifdeà
OS_SAFETY_CRITICAL


182 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

183 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

184  ((
OS_OBJ_QTY
)0);

188 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

189 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

190 *
p_”r
 = 
OS_ERR_DEL_ISR
;

191  ((
OS_OBJ_QTY
)0);

195 #ià
OS_CFG_ARG_CHK_EN
 > 0u

196 ià(
p_q
 =ð(
OS_Q
 *)0) {

197 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

198  ((
OS_OBJ_QTY
)0u);

200 
Ýt
) {

201 
OS_OPT_DEL_NO_PEND
:

202 
OS_OPT_DEL_ALWAYS
:

206 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

207  ((
OS_OBJ_QTY
)0u);

211 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

212 ià(
p_q
->
Ty³
 !ð
OS_OBJ_TYPE_Q
) {

213 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

214  ((
OS_OBJ_QTY
)0);

218 
	`CPU_CRITICAL_ENTER
();

219 
p_³nd_li¡
 = &
p_q
->
P’dLi¡
;

220 
út
 = 
p_³nd_li¡
->
NbrEÁr›s
;

221 
nbr_sks
 = 
út
;

222 
Ýt
) {

223 
OS_OPT_DEL_NO_PEND
:

224 ià(
nbr_sks
 =ð(
OS_OBJ_QTY
)0) {

225 #ià
OS_CFG_DBG_EN
 > 0u

226 
	`OS_QDbgLi¡Remove
(
p_q
);

228 
OSQQty
--;

229 
	`OS_QCÌ
(
p_q
);

230 
	`CPU_CRITICAL_EXIT
();

231 *
p_”r
 = 
OS_ERR_NONE
;

233 
	`CPU_CRITICAL_EXIT
();

234 *
p_”r
 = 
OS_ERR_TASK_WAITING
;

238 
OS_OPT_DEL_ALWAYS
:

239 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

240 
ts
 = 
	`OS_TS_GET
();

241 
út
 > 0u) {

242 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

243 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

244 
	`OS_P’dObjD–
((
OS_PEND_OBJ
 *)((*)
p_q
),

245 
p_tcb
,

246 
ts
);

247 
út
--;

249 #ià
OS_CFG_DBG_EN
 > 0u

250 
	`OS_QDbgLi¡Remove
(
p_q
);

252 
OSQQty
--;

253 
	`OS_QCÌ
(
p_q
);

254 
	`OS_CRITICAL_EXIT_NO_SCHED
();

255 
	`OSSched
();

256 *
p_”r
 = 
OS_ERR_NONE
;

260 
	`CPU_CRITICAL_EXIT
();

261 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

264  (
nbr_sks
);

265 
	}
}

293 #ià
OS_CFG_Q_FLUSH_EN
 > 0u

294 
OS_MSG_QTY
 
	$OSQFlush
 (
OS_Q
 *
p_q
,

295 
OS_ERR
 *
p_”r
)

297 
OS_MSG_QTY
 
’Œ›s
;

298 
	`CPU_SR_ALLOC
();

302 #ifdeà
OS_SAFETY_CRITICAL


303 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

304 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

305  ((
OS_MSG_QTY
)0);

309 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

310 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

311 *
p_”r
 = 
OS_ERR_FLUSH_ISR
;

312  ((
OS_MSG_QTY
)0);

316 #ià
OS_CFG_ARG_CHK_EN
 > 0u

317 ià(
p_q
 =ð(
OS_Q
 *)0) {

318 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

319  ((
OS_MSG_QTY
)0);

323 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

324 ià(
p_q
->
Ty³
 !ð
OS_OBJ_TYPE_Q
) {

325 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

326  ((
OS_MSG_QTY
)0);

330 
	`OS_CRITICAL_ENTER
();

331 
’Œ›s
 = 
	`OS_MsgQF»eAÎ
(&
p_q
->
MsgQ
);

332 
	`OS_CRITICAL_EXIT
();

333 *
p_”r
 = 
OS_ERR_NONE
;

334  ((
OS_MSG_QTY
)
’Œ›s
);

335 
	}
}

384 *
	$OSQP’d
 (
OS_Q
 *
p_q
,

385 
OS_TICK
 
timeout
,

386 
OS_OPT
 
Ýt
,

387 
OS_MSG_SIZE
 *
p_msg_size
,

388 
CPU_TS
 *
p_ts
,

389 
OS_ERR
 *
p_”r
)

391 
OS_PEND_DATA
 
³nd_d©a
;

392 *
p_void
;

393 
	`CPU_SR_ALLOC
();

397 #ifdeà
OS_SAFETY_CRITICAL


398 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

399 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

404 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

405 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

406 *
p_”r
 = 
OS_ERR_PEND_ISR
;

411 #ià
OS_CFG_ARG_CHK_EN
 > 0u

412 ià(
p_q
 =ð(
OS_Q
 *)0) {

413 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

416 ià(
p_msg_size
 =ð(
OS_MSG_SIZE
 *)0) {

417 *
p_”r
 = 
OS_ERR_PTR_INVALID
;

420 
Ýt
) {

421 
OS_OPT_PEND_BLOCKING
:

422 
OS_OPT_PEND_NON_BLOCKING
:

426 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

431 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

432 ià(
p_q
->
Ty³
 !ð
OS_OBJ_TYPE_Q
) {

433 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

438 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

439 *
p_ts
 = (
CPU_TS
 )0;

442 
	`CPU_CRITICAL_ENTER
();

443 
p_void
 = 
	`OS_MsgQG‘
(&
p_q
->
MsgQ
,

444 
p_msg_size
,

445 
p_ts
,

446 
p_”r
);

447 ià(*
p_”r
 =ð
OS_ERR_NONE
) {

448 
	`CPU_CRITICAL_EXIT
();

449  (
p_void
);

452 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

453 
	`CPU_CRITICAL_EXIT
();

454 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

457 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

458 
	`CPU_CRITICAL_EXIT
();

459 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

464 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

465 
	`OS_P’d
(&
³nd_d©a
,

466 (
OS_PEND_OBJ
 *)((*)
p_q
),

467 
OS_TASK_PEND_ON_Q
,

468 
timeout
);

469 
	`OS_CRITICAL_EXIT_NO_SCHED
();

471 
	`OSSched
();

473 
	`CPU_CRITICAL_ENTER
();

474 
OSTCBCurPŒ
->
P’dStus
) {

475 
OS_STATUS_PEND_OK
:

476 
p_void
 = 
OSTCBCurPŒ
->
MsgPŒ
;

477 *
p_msg_size
 = 
OSTCBCurPŒ
->
MsgSize
;

478 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

479 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

481 *
p_”r
 = 
OS_ERR_NONE
;

484 
OS_STATUS_PEND_ABORT
:

485 
p_void
 = (*)0;

486 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

487 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

488 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

490 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

493 
OS_STATUS_PEND_TIMEOUT
:

494 
p_void
 = (*)0;

495 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

496 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

497 *
p_ts
 = (
CPU_TS
 )0;

499 *
p_”r
 = 
OS_ERR_TIMEOUT
;

502 
OS_STATUS_PEND_DEL
:

503 
p_void
 = (*)0;

504 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

505 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

506 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

508 *
p_”r
 = 
OS_ERR_OBJ_DEL
;

512 
p_void
 = (*)0;

513 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

514 *
p_”r
 = 
OS_ERR_STATUS_INVALID
;

517 
	`CPU_CRITICAL_EXIT
();

518  (
p_void
);

519 
	}
}

554 #ià
OS_CFG_Q_PEND_ABORT_EN
 > 0u

555 
OS_OBJ_QTY
 
	$OSQP’dAbÜt
 (
OS_Q
 *
p_q
,

556 
OS_OPT
 
Ýt
,

557 
OS_ERR
 *
p_”r
)

559 
OS_PEND_LIST
 *
p_³nd_li¡
;

560 
OS_TCB
 *
p_tcb
;

561 
CPU_TS
 
ts
;

562 
OS_OBJ_QTY
 
nbr_sks
;

563 
	`CPU_SR_ALLOC
();

567 #ifdeà
OS_SAFETY_CRITICAL


568 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

569 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

570  ((
OS_OBJ_QTY
)0u);

574 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

575 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

576 *
p_”r
 = 
OS_ERR_PEND_ABORT_ISR
;

577  ((
OS_OBJ_QTY
)0u);

581 #ià
OS_CFG_ARG_CHK_EN
 > 0u

582 ià(
p_q
 =ð(
OS_Q
 *)0) {

583 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

584  ((
OS_OBJ_QTY
)0u);

586 
Ýt
) {

587 
OS_OPT_PEND_ABORT_1
:

588 
OS_OPT_PEND_ABORT_ALL
:

589 
OS_OPT_PEND_ABORT_1
 | 
OS_OPT_POST_NO_SCHED
:

590 
OS_OPT_PEND_ABORT_ALL
 | 
OS_OPT_POST_NO_SCHED
:

594 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

595  ((
OS_OBJ_QTY
)0u);

599 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

600 ià(
p_q
->
Ty³
 !ð
OS_OBJ_TYPE_Q
) {

601 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

602  ((
OS_OBJ_QTY
)0u);

606 
	`CPU_CRITICAL_ENTER
();

607 
p_³nd_li¡
 = &
p_q
->
P’dLi¡
;

608 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0u) {

609 
	`CPU_CRITICAL_EXIT
();

610 *
p_”r
 = 
OS_ERR_PEND_ABORT_NONE
;

611  ((
OS_OBJ_QTY
)0u);

614 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

615 
nbr_sks
 = 0u;

616 
ts
 = 
	`OS_TS_GET
();

617 
p_³nd_li¡
->
NbrEÁr›s
 > (
OS_OBJ_QTY
)0u) {

618 
p_tcb
 = 
p_³nd_li¡
->
H—dPŒ
->
TCBPŒ
;

619 
	`OS_P’dAbÜt
((
OS_PEND_OBJ
 *)((*)
p_q
),

620 
p_tcb
,

621 
ts
);

622 
nbr_sks
++;

623 ià(
Ýt
 !ð
OS_OPT_PEND_ABORT_ALL
) {

627 
	`OS_CRITICAL_EXIT_NO_SCHED
();

629 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0u) {

630 
	`OSSched
();

633 *
p_”r
 = 
OS_ERR_NONE
;

634  (
nbr_sks
);

635 
	}
}

688 
	$OSQPo¡
 (
OS_Q
 *
p_q
,

689 *
p_void
,

690 
OS_MSG_SIZE
 
msg_size
,

691 
OS_OPT
 
Ýt
,

692 
OS_ERR
 *
p_”r
)

694 
CPU_TS
 
ts
;

698 #ifdeà
OS_SAFETY_CRITICAL


699 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

700 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

705 #ià
OS_CFG_ARG_CHK_EN
 > 0u

706 ià(
p_q
 =ð(
OS_Q
 *)0) {

707 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

710 
Ýt
) {

711 
OS_OPT_POST_FIFO
:

712 
OS_OPT_POST_LIFO
:

713 
OS_OPT_POST_FIFO
 | 
OS_OPT_POST_ALL
:

714 
OS_OPT_POST_LIFO
 | 
OS_OPT_POST_ALL
:

715 
OS_OPT_POST_FIFO
 | 
OS_OPT_POST_NO_SCHED
:

716 
OS_OPT_POST_LIFO
 | 
OS_OPT_POST_NO_SCHED
:

717 
OS_OPT_POST_FIFO
 | 
OS_OPT_POST_ALL
 | 
OS_OPT_POST_NO_SCHED
:

718 
OS_OPT_POST_LIFO
 | 
OS_OPT_POST_ALL
 | 
OS_OPT_POST_NO_SCHED
:

722 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

727 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

728 ià(
p_q
->
Ty³
 !ð
OS_OBJ_TYPE_Q
) {

729 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

734 
ts
 = 
	`OS_TS_GET
();

736 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

737 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

738 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_Q
,

739 (*)
p_q
,

740 (*)
p_void
,

741 (
OS_MSG_SIZE
)
msg_size
,

742 (
OS_FLAGS
 )0,

743 (
OS_OPT
 )
Ýt
,

744 (
CPU_TS
 )
ts
,

745 (
OS_ERR
 *)
p_”r
);

750 
	`OS_QPo¡
(
p_q
,

751 
p_void
,

752 
msg_size
,

753 
Ýt
,

754 
ts
,

755 
p_”r
);

756 
	}
}

775 
	$OS_QCÌ
 (
OS_Q
 *
p_q
)

777 ()
	`OS_MsgQF»eAÎ
(&
p_q
->
MsgQ
);

778 
p_q
->
Ty³
 = 
OS_OBJ_TYPE_NONE
;

779 
p_q
->
NamePŒ
 = (
CPU_CHAR
 *)((*)"?Q");

780 
	`OS_MsgQIn™
(&
p_q
->
MsgQ
,

782 
	`OS_P’dLi¡In™
(&
p_q
->
P’dLi¡
);

783 
	}
}

802 #ià
OS_CFG_DBG_EN
 > 0u

803 
	$OS_QDbgLi¡Add
 (
OS_Q
 *
p_q
)

805 
p_q
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

806 
p_q
->
DbgP»vPŒ
 = (
OS_Q
 *)0;

807 ià(
OSQDbgLi¡PŒ
 =ð(
OS_Q
 *)0) {

808 
p_q
->
DbgNextPŒ
 = (
OS_Q
 *)0;

810 
p_q
->
DbgNextPŒ
 = 
OSQDbgLi¡PŒ
;

811 
OSQDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_q
;

813 
OSQDbgLi¡PŒ
 = 
p_q
;

814 
	}
}

818 
	$OS_QDbgLi¡Remove
 (
OS_Q
 *
p_q
)

820 
OS_Q
 *
p_q_Ãxt
;

821 
OS_Q
 *
p_q_´ev
;

824 
p_q_´ev
 = 
p_q
->
DbgP»vPŒ
;

825 
p_q_Ãxt
 = 
p_q
->
DbgNextPŒ
;

827 ià(
p_q_´ev
 =ð(
OS_Q
 *)0) {

828 
OSQDbgLi¡PŒ
 = 
p_q_Ãxt
;

829 ià(
p_q_Ãxt
 !ð(
OS_Q
 *)0) {

830 
p_q_Ãxt
->
DbgP»vPŒ
 = (
OS_Q
 *)0;

832 
p_q
->
DbgNextPŒ
 = (
OS_Q
 *)0;

834 } ià(
p_q_Ãxt
 =ð(
OS_Q
 *)0) {

835 
p_q_´ev
->
DbgNextPŒ
 = (
OS_Q
 *)0;

836 
p_q
->
DbgP»vPŒ
 = (
OS_Q
 *)0;

839 
p_q_´ev
->
DbgNextPŒ
 = 
p_q_Ãxt
;

840 
p_q_Ãxt
->
DbgP»vPŒ
 = 
p_q_´ev
;

841 
p_q
->
DbgNextPŒ
 = (
OS_Q
 *)0;

842 
p_q
->
DbgP»vPŒ
 = (
OS_Q
 *)0;

844 
	}
}

865 
	$OS_QIn™
 (
OS_ERR
 *
p_”r
)

867 #ifdeà
OS_SAFETY_CRITICAL


868 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

869 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

874 #ià
OS_CFG_DBG_EN
 > 0u

875 
OSQDbgLi¡PŒ
 = (
OS_Q
 *)0;

878 
OSQQty
 = (
OS_OBJ_QTY
)0;

879 *
p_”r
 = 
OS_ERR_NONE
;

880 
	}
}

922 
	$OS_QPo¡
 (
OS_Q
 *
p_q
,

923 *
p_void
,

924 
OS_MSG_SIZE
 
msg_size
,

925 
OS_OPT
 
Ýt
,

926 
CPU_TS
 
ts
,

927 
OS_ERR
 *
p_”r
)

929 
OS_OBJ_QTY
 
út
;

930 
OS_OPT
 
po¡_ty³
;

931 
OS_PEND_LIST
 *
p_³nd_li¡
;

932 
OS_PEND_DATA
 *
p_³nd_d©a
;

933 
OS_PEND_DATA
 *
p_³nd_d©a_Ãxt
;

934 
OS_TCB
 *
p_tcb
;

935 
	`CPU_SR_ALLOC
();

939 
	`OS_CRITICAL_ENTER
();

940 
p_³nd_li¡
 = &
p_q
->
P’dLi¡
;

941 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

942 ià((
Ýt
 & 
OS_OPT_POST_LIFO
è=ð(
OS_OPT
)0) {

943 
po¡_ty³
 = 
OS_OPT_POST_FIFO
;

945 
po¡_ty³
 = 
OS_OPT_POST_LIFO
;

947 
	`OS_MsgQPut
(&
p_q
->
MsgQ
,

948 
p_void
,

949 
msg_size
,

950 
po¡_ty³
,

951 
ts
,

952 
p_”r
);

953 
	`OS_CRITICAL_EXIT
();

957 ià((
Ýt
 & 
OS_OPT_POST_ALL
è!ð(
OS_OPT
)0) {

958 
út
 = 
p_³nd_li¡
->
NbrEÁr›s
;

960 
út
 = (
OS_OBJ_QTY
)1;

962 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

963 
út
 > 0u) {

964 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

965 
p_³nd_d©a_Ãxt
 = 
p_³nd_d©a
->
NextPŒ
;

966 
	`OS_Po¡
((
OS_PEND_OBJ
 *)((*)
p_q
),

967 
p_tcb
,

968 
p_void
,

969 
msg_size
,

970 
ts
);

971 
p_³nd_d©a
 = 
p_³nd_d©a_Ãxt
;

972 
út
--;

974 
	`OS_CRITICAL_EXIT_NO_SCHED
();

975 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

976 
	`OSSched
();

978 *
p_”r
 = 
OS_ERR_NONE
;

979 
	}
}

	@os_sem.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_£m__c
 = "$Id: $";

41 #ià
OS_CFG_SEM_EN
 > 0u

73 
	$OSSemC»©e
 (
OS_SEM
 *
p_£m
,

74 
CPU_CHAR
 *
p_Çme
,

75 
OS_SEM_CTR
 
út
,

76 
OS_ERR
 *
p_”r
)

78 
	`CPU_SR_ALLOC
();

82 #ifdeà
OS_SAFETY_CRITICAL


83 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

84 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

89 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


90 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

91 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

96 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

97 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

98 *
p_”r
 = 
OS_ERR_CREATE_ISR
;

103 #ià
OS_CFG_ARG_CHK_EN
 > 0u

104 ià(
p_£m
 =ð(
OS_SEM
 *)0) {

105 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

110 
	`OS_CRITICAL_ENTER
();

111 
p_£m
->
Ty³
 = 
OS_OBJ_TYPE_SEM
;

112 
p_£m
->
CŒ
 = 
út
;

113 
p_£m
->
TS
 = (
CPU_TS
)0;

114 
p_£m
->
NamePŒ
 = 
p_Çme
;

115 
	`OS_P’dLi¡In™
(&
p_£m
->
P’dLi¡
);

117 #ià
OS_CFG_DBG_EN
 > 0u

118 
	`OS_SemDbgLi¡Add
(
p_£m
);

120 
OSSemQty
++;

122 
	`OS_CRITICAL_EXIT_NO_SCHED
();

123 *
p_”r
 = 
OS_ERR_NONE
;

124 
	}
}

162 #ià
OS_CFG_SEM_DEL_EN
 > 0u

163 
OS_OBJ_QTY
 
	$OSSemD–
 (
OS_SEM
 *
p_£m
,

164 
OS_OPT
 
Ýt
,

165 
OS_ERR
 *
p_”r
)

167 
OS_OBJ_QTY
 
út
;

168 
OS_OBJ_QTY
 
nbr_sks
;

169 
OS_PEND_DATA
 *
p_³nd_d©a
;

170 
OS_PEND_LIST
 *
p_³nd_li¡
;

171 
OS_TCB
 *
p_tcb
;

172 
CPU_TS
 
ts
;

173 
	`CPU_SR_ALLOC
();

177 #ifdeà
OS_SAFETY_CRITICAL


178 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

179 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

180  ((
OS_OBJ_QTY
)0);

184 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

185 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

186 *
p_”r
 = 
OS_ERR_DEL_ISR
;

187  ((
OS_OBJ_QTY
)0);

191 #ià
OS_CFG_ARG_CHK_EN
 > 0u

192 ià(
p_£m
 =ð(
OS_SEM
 *)0) {

193 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

194  ((
OS_OBJ_QTY
)0);

196 
Ýt
) {

197 
OS_OPT_DEL_NO_PEND
:

198 
OS_OPT_DEL_ALWAYS
:

202 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

203  ((
OS_OBJ_QTY
)0);

207 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

208 ià(
p_£m
->
Ty³
 !ð
OS_OBJ_TYPE_SEM
) {

209 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

210  ((
OS_OBJ_QTY
)0);

214 
	`CPU_CRITICAL_ENTER
();

215 
p_³nd_li¡
 = &
p_£m
->
P’dLi¡
;

216 
út
 = 
p_³nd_li¡
->
NbrEÁr›s
;

217 
nbr_sks
 = 
út
;

218 
Ýt
) {

219 
OS_OPT_DEL_NO_PEND
:

220 ià(
nbr_sks
 =ð(
OS_OBJ_QTY
)0) {

221 #ià
OS_CFG_DBG_EN
 > 0u

222 
	`OS_SemDbgLi¡Remove
(
p_£m
);

224 
OSSemQty
--;

225 
	`OS_SemCÌ
(
p_£m
);

226 
	`CPU_CRITICAL_EXIT
();

227 *
p_”r
 = 
OS_ERR_NONE
;

229 
	`CPU_CRITICAL_EXIT
();

230 *
p_”r
 = 
OS_ERR_TASK_WAITING
;

234 
OS_OPT_DEL_ALWAYS
:

235 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

236 
ts
 = 
	`OS_TS_GET
();

237 
út
 > 0u) {

238 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

239 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

240 
	`OS_P’dObjD–
((
OS_PEND_OBJ
 *)((*)
p_£m
),

241 
p_tcb
,

242 
ts
);

243 
út
--;

245 #ià
OS_CFG_DBG_EN
 > 0u

246 
	`OS_SemDbgLi¡Remove
(
p_£m
);

248 
OSSemQty
--;

249 
	`OS_SemCÌ
(
p_£m
);

250 
	`OS_CRITICAL_EXIT_NO_SCHED
();

251 
	`OSSched
();

252 *
p_”r
 = 
OS_ERR_NONE
;

256 
	`CPU_CRITICAL_EXIT
();

257 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

260  ((
OS_OBJ_QTY
)
nbr_sks
);

261 
	}
}

311 
OS_SEM_CTR
 
	$OSSemP’d
 (
OS_SEM
 *
p_£m
,

312 
OS_TICK
 
timeout
,

313 
OS_OPT
 
Ýt
,

314 
CPU_TS
 *
p_ts
,

315 
OS_ERR
 *
p_”r
)

317 
OS_SEM_CTR
 
ùr
;

318 
OS_PEND_DATA
 
³nd_d©a
;

319 
	`CPU_SR_ALLOC
();

323 #ifdeà
OS_SAFETY_CRITICAL


324 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

325 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

326  ((
OS_SEM_CTR
)0);

330 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

331 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

332 *
p_”r
 = 
OS_ERR_PEND_ISR
;

333  ((
OS_SEM_CTR
)0);

337 #ià
OS_CFG_ARG_CHK_EN
 > 0u

338 ià(
p_£m
 =ð(
OS_SEM
 *)0) {

339 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

340  ((
OS_SEM_CTR
)0);

342 
Ýt
) {

343 
OS_OPT_PEND_BLOCKING
:

344 
OS_OPT_PEND_NON_BLOCKING
:

348 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

349  ((
OS_SEM_CTR
)0);

353 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

354 ià(
p_£m
->
Ty³
 !ð
OS_OBJ_TYPE_SEM
) {

355 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

356  ((
OS_SEM_CTR
)0);

360 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

361 *
p_ts
 = (
CPU_TS
)0;

363 
	`CPU_CRITICAL_ENTER
();

364 ià(
p_£m
->
CŒ
 > (
OS_SEM_CTR
)0) {

365 
p_£m
->
CŒ
--;

366 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

367 *
p_ts
 = 
p_£m
->
TS
;

369 
ùr
 = 
p_£m
->
CŒ
;

370 
	`CPU_CRITICAL_EXIT
();

371 *
p_”r
 = 
OS_ERR_NONE
;

372  (
ùr
);

375 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

376 
ùr
 = 
p_£m
->
CŒ
;

377 
	`CPU_CRITICAL_EXIT
();

378 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

379  (
ùr
);

381 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

382 
	`CPU_CRITICAL_EXIT
();

383 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

384  ((
OS_SEM_CTR
)0);

388 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

389 
	`OS_P’d
(&
³nd_d©a
,

390 (
OS_PEND_OBJ
 *)((*)
p_£m
),

391 
OS_TASK_PEND_ON_SEM
,

392 
timeout
);

394 
	`OS_CRITICAL_EXIT_NO_SCHED
();

396 
	`OSSched
();

398 
	`CPU_CRITICAL_ENTER
();

399 
OSTCBCurPŒ
->
P’dStus
) {

400 
OS_STATUS_PEND_OK
:

401 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

402 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

404 *
p_”r
 = 
OS_ERR_NONE
;

407 
OS_STATUS_PEND_ABORT
:

408 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

409 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

411 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

414 
OS_STATUS_PEND_TIMEOUT
:

415 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

416 *
p_ts
 = (
CPU_TS
 )0;

418 *
p_”r
 = 
OS_ERR_TIMEOUT
;

421 
OS_STATUS_PEND_DEL
:

422 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

423 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

425 *
p_”r
 = 
OS_ERR_OBJ_DEL
;

429 *
p_”r
 = 
OS_ERR_STATUS_INVALID
;

430 
	`CPU_CRITICAL_EXIT
();

431  ((
OS_SEM_CTR
)0);

433 
ùr
 = 
p_£m
->
CŒ
;

434 
	`CPU_CRITICAL_EXIT
();

435  (
ùr
);

436 
	}
}

470 #ià
OS_CFG_SEM_PEND_ABORT_EN
 > 0u

471 
OS_OBJ_QTY
 
	$OSSemP’dAbÜt
 (
OS_SEM
 *
p_£m
,

472 
OS_OPT
 
Ýt
,

473 
OS_ERR
 *
p_”r
)

475 
OS_PEND_LIST
 *
p_³nd_li¡
;

476 
OS_TCB
 *
p_tcb
;

477 
CPU_TS
 
ts
;

478 
OS_OBJ_QTY
 
nbr_sks
;

479 
	`CPU_SR_ALLOC
();

483 #ifdeà
OS_SAFETY_CRITICAL


484 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

485 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

486  ((
OS_OBJ_QTY
)0u);

490 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

491 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

492 *
p_”r
 = 
OS_ERR_PEND_ABORT_ISR
;

493  ((
OS_OBJ_QTY
)0u);

497 #ià
OS_CFG_ARG_CHK_EN
 > 0u

498 ià(
p_£m
 =ð(
OS_SEM
 *)0) {

499 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

500  ((
OS_OBJ_QTY
)0u);

502 
Ýt
) {

503 
OS_OPT_PEND_ABORT_1
:

504 
OS_OPT_PEND_ABORT_ALL
:

505 
OS_OPT_PEND_ABORT_1
 | 
OS_OPT_POST_NO_SCHED
:

506 
OS_OPT_PEND_ABORT_ALL
 | 
OS_OPT_POST_NO_SCHED
:

510 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

511  ((
OS_OBJ_QTY
)0u);

515 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

516 ià(
p_£m
->
Ty³
 !ð
OS_OBJ_TYPE_SEM
) {

517 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

518  ((
OS_OBJ_QTY
)0u);

522 
	`CPU_CRITICAL_ENTER
();

523 
p_³nd_li¡
 = &
p_£m
->
P’dLi¡
;

524 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0u) {

525 
	`CPU_CRITICAL_EXIT
();

526 *
p_”r
 = 
OS_ERR_PEND_ABORT_NONE
;

527  ((
OS_OBJ_QTY
)0u);

530 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

531 
nbr_sks
 = 0u;

532 
ts
 = 
	`OS_TS_GET
();

533 
p_³nd_li¡
->
NbrEÁr›s
 > (
OS_OBJ_QTY
)0u) {

534 
p_tcb
 = 
p_³nd_li¡
->
H—dPŒ
->
TCBPŒ
;

535 
	`OS_P’dAbÜt
((
OS_PEND_OBJ
 *)((*)
p_£m
),

536 
p_tcb
,

537 
ts
);

538 
nbr_sks
++;

539 ià(
Ýt
 !ð
OS_OPT_PEND_ABORT_ALL
) {

543 
	`OS_CRITICAL_EXIT_NO_SCHED
();

545 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0u) {

546 
	`OSSched
();

549 *
p_”r
 = 
OS_ERR_NONE
;

550  (
nbr_sks
);

551 
	}
}

584 
OS_SEM_CTR
 
	$OSSemPo¡
 (
OS_SEM
 *
p_£m
,

585 
OS_OPT
 
Ýt
,

586 
OS_ERR
 *
p_”r
)

588 
OS_SEM_CTR
 
ùr
;

589 
CPU_TS
 
ts
;

593 #ifdeà
OS_SAFETY_CRITICAL


594 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

595 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

596  ((
OS_SEM_CTR
)0);

600 #ià
OS_CFG_ARG_CHK_EN
 > 0u

601 ià(
p_£m
 =ð(
OS_SEM
 *)0) {

602 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

603  ((
OS_SEM_CTR
)0);

605 
Ýt
) {

606 
OS_OPT_POST_1
:

607 
OS_OPT_POST_ALL
:

608 
OS_OPT_POST_1
 | 
OS_OPT_POST_NO_SCHED
:

609 
OS_OPT_POST_ALL
 | 
OS_OPT_POST_NO_SCHED
:

613 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

614  ((
OS_SEM_CTR
)0u);

618 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

619 ià(
p_£m
->
Ty³
 !ð
OS_OBJ_TYPE_SEM
) {

620 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

621  ((
OS_SEM_CTR
)0);

625 
ts
 = 
	`OS_TS_GET
();

627 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

628 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

629 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_SEM
,

630 (*)
p_£m
,

632 (
OS_MSG_SIZE
)0,

633 (
OS_FLAGS
 )0,

634 (
OS_OPT
 )
Ýt
,

635 (
CPU_TS
 )
ts
,

636 (
OS_ERR
 *)
p_”r
);

637  ((
OS_SEM_CTR
)0);

641 
ùr
 = 
	`OS_SemPo¡
(
p_£m
,

642 
Ýt
,

643 
ts
,

644 
p_”r
);

646  (
ùr
);

647 
	}
}

675 #ià
OS_CFG_SEM_SET_EN
 > 0u

676 
	$OSSemS‘
 (
OS_SEM
 *
p_£m
,

677 
OS_SEM_CTR
 
út
,

678 
OS_ERR
 *
p_”r
)

680 
OS_PEND_LIST
 *
p_³nd_li¡
;

681 
	`CPU_SR_ALLOC
();

685 #ifdeà
OS_SAFETY_CRITICAL


686 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

687 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

692 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

693 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

694 *
p_”r
 = 
OS_ERR_SET_ISR
;

699 #ià
OS_CFG_ARG_CHK_EN
 > 0u

700 ià(
p_£m
 =ð(
OS_SEM
 *)0) {

701 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

706 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

707 ià(
p_£m
->
Ty³
 !ð
OS_OBJ_TYPE_SEM
) {

708 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

713 *
p_”r
 = 
OS_ERR_NONE
;

714 
	`CPU_CRITICAL_ENTER
();

715 ià(
p_£m
->
CŒ
 > (
OS_SEM_CTR
)0) {

716 
p_£m
->
CŒ
 = 
út
;

718 
p_³nd_li¡
 = &
p_£m
->
P’dLi¡
;

719 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

720 
p_£m
->
CŒ
 = 
út
;

722 *
p_”r
 = 
OS_ERR_TASK_WAITING
;

725 
	`CPU_CRITICAL_EXIT
();

726 
	}
}

746 
	$OS_SemCÌ
 (
OS_SEM
 *
p_£m
)

748 
p_£m
->
Ty³
 = 
OS_OBJ_TYPE_NONE
;

749 
p_£m
->
CŒ
 = (
OS_SEM_CTR
)0;

750 
p_£m
->
TS
 = (
CPU_TS
 )0;

751 
p_£m
->
NamePŒ
 = (
CPU_CHAR
 *)((*)"?SEM");

752 
	`OS_P’dLi¡In™
(&
p_£m
->
P’dLi¡
);

753 
	}
}

771 #ià
OS_CFG_DBG_EN
 > 0u

772 
	$OS_SemDbgLi¡Add
 (
OS_SEM
 *
p_£m
)

774 
p_£m
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

775 
p_£m
->
DbgP»vPŒ
 = (
OS_SEM
 *)0;

776 ià(
OSSemDbgLi¡PŒ
 =ð(
OS_SEM
 *)0) {

777 
p_£m
->
DbgNextPŒ
 = (
OS_SEM
 *)0;

779 
p_£m
->
DbgNextPŒ
 = 
OSSemDbgLi¡PŒ
;

780 
OSSemDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_£m
;

782 
OSSemDbgLi¡PŒ
 = 
p_£m
;

783 
	}
}

787 
	$OS_SemDbgLi¡Remove
 (
OS_SEM
 *
p_£m
)

789 
OS_SEM
 *
p_£m_Ãxt
;

790 
OS_SEM
 *
p_£m_´ev
;

793 
p_£m_´ev
 = 
p_£m
->
DbgP»vPŒ
;

794 
p_£m_Ãxt
 = 
p_£m
->
DbgNextPŒ
;

796 ià(
p_£m_´ev
 =ð(
OS_SEM
 *)0) {

797 
OSSemDbgLi¡PŒ
 = 
p_£m_Ãxt
;

798 ià(
p_£m_Ãxt
 !ð(
OS_SEM
 *)0) {

799 
p_£m_Ãxt
->
DbgP»vPŒ
 = (
OS_SEM
 *)0;

801 
p_£m
->
DbgNextPŒ
 = (
OS_SEM
 *)0;

803 } ià(
p_£m_Ãxt
 =ð(
OS_SEM
 *)0) {

804 
p_£m_´ev
->
DbgNextPŒ
 = (
OS_SEM
 *)0;

805 
p_£m
->
DbgP»vPŒ
 = (
OS_SEM
 *)0;

808 
p_£m_´ev
->
DbgNextPŒ
 = 
p_£m_Ãxt
;

809 
p_£m_Ãxt
->
DbgP»vPŒ
 = 
p_£m_´ev
;

810 
p_£m
->
DbgNextPŒ
 = (
OS_SEM
 *)0;

811 
p_£m
->
DbgP»vPŒ
 = (
OS_SEM
 *)0;

813 
	}
}

834 
	$OS_SemIn™
 (
OS_ERR
 *
p_”r
)

836 #ifdeà
OS_SAFETY_CRITICAL


837 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

838 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

843 #ià
OS_CFG_DBG_EN
 > 0u

844 
OSSemDbgLi¡PŒ
 = (
OS_SEM
 *)0;

847 
OSSemQty
 = (
OS_OBJ_QTY
)0;

848 *
p_”r
 = 
OS_ERR_NONE
;

849 
	}
}

884 
OS_SEM_CTR
 
	$OS_SemPo¡
 (
OS_SEM
 *
p_£m
,

885 
OS_OPT
 
Ýt
,

886 
CPU_TS
 
ts
,

887 
OS_ERR
 *
p_”r
)

889 
OS_OBJ_QTY
 
út
;

890 
OS_SEM_CTR
 
ùr
;

891 
OS_PEND_LIST
 *
p_³nd_li¡
;

892 
OS_PEND_DATA
 *
p_³nd_d©a
;

893 
OS_PEND_DATA
 *
p_³nd_d©a_Ãxt
;

894 
OS_TCB
 *
p_tcb
;

895 
	`CPU_SR_ALLOC
();

899 
	`CPU_CRITICAL_ENTER
();

900 
p_³nd_li¡
 = &
p_£m
->
P’dLi¡
;

901 ià(
p_³nd_li¡
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0) {

902 (
OS_SEM_CTR
)) {

904 ià(
p_£m
->
CŒ
 =ð
DEF_INT_08U_MAX_VAL
) {

905 
	`CPU_CRITICAL_EXIT
();

906 *
p_”r
 = 
OS_ERR_SEM_OVF
;

907  ((
OS_SEM_CTR
)0);

912 ià(
p_£m
->
CŒ
 =ð
DEF_INT_16U_MAX_VAL
) {

913 
	`CPU_CRITICAL_EXIT
();

914 *
p_”r
 = 
OS_ERR_SEM_OVF
;

915  ((
OS_SEM_CTR
)0);

920 ià(
p_£m
->
CŒ
 =ð
DEF_INT_32U_MAX_VAL
) {

921 
	`CPU_CRITICAL_EXIT
();

922 *
p_”r
 = 
OS_ERR_SEM_OVF
;

923  ((
OS_SEM_CTR
)0);

930 
p_£m
->
CŒ
++;

931 
ùr
 = 
p_£m
->
CŒ
;

932 
p_£m
->
TS
 = 
ts
;

933 
	`CPU_CRITICAL_EXIT
();

934 *
p_”r
 = 
OS_ERR_NONE
;

935  (
ùr
);

938 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

939 ià((
Ýt
 & 
OS_OPT_POST_ALL
è!ð(
OS_OPT
)0) {

940 
út
 = 
p_³nd_li¡
->
NbrEÁr›s
;

942 
út
 = (
OS_OBJ_QTY
)1;

944 
p_³nd_d©a
 = 
p_³nd_li¡
->
H—dPŒ
;

945 
út
 > 0u) {

946 
p_tcb
 = 
p_³nd_d©a
->
TCBPŒ
;

947 
p_³nd_d©a_Ãxt
 = 
p_³nd_d©a
->
NextPŒ
;

948 
	`OS_Po¡
((
OS_PEND_OBJ
 *)((*)
p_£m
),

949 
p_tcb
,

951 (
OS_MSG_SIZE
)0,

952 
ts
);

953 
p_³nd_d©a
 = 
p_³nd_d©a_Ãxt
;

954 
út
--;

956 
ùr
 = 
p_£m
->
CŒ
;

957 
	`OS_CRITICAL_EXIT_NO_SCHED
();

958 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

959 
	`OSSched
();

961 *
p_”r
 = 
OS_ERR_NONE
;

962  (
ùr
);

963 
	}
}

	@os_stat.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_¡©__c
 = "$Id: $";

41 #ià
OS_CFG_STAT_TASK_EN
 > 0u

57 
	$OSStRe£t
 (
OS_ERR
 *
p_”r
)

59 #ià(
OS_CFG_DBG_EN
 > 0u)

60 
OS_TCB
 *
p_tcb
;

61 #ià(
OS_MSG_EN
 > 0u)

62 
OS_MSG_Q
 *
p_msg_q
;

64 #ià(
OS_CFG_Q_EN
 > 0u)

65 
OS_Q
 *
p_q
;

67 
	`CPU_SR_ALLOC
();

72 #ifdeà
OS_SAFETY_CRITICAL


73 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

74 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

79 
	`CPU_CRITICAL_ENTER
();

80 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

81 
OSIÁQTaskTimeMax
 = (
CPU_TS
 )0;

82 
OSIÁQNbrEÁr›sMax
 = (
OS_OBJ_QTY
)0;

85 #ià
OS_CFG_STAT_TASK_EN
 > 0u

86 
OSStTaskCPUU§geMax
 = 0u;

87 
OSStTaskTimeMax
 = (
CPU_TS
)0;

90 
OSTickTaskTimeMax
 = (
CPU_TS
)0;

92 #ià
OS_CFG_TMR_EN
 > 0u

93 
OSTmrTaskTimeMax
 = (
CPU_TS
)0;

96 #ifdeà
CPU_CFG_INT_DIS_MEAS_EN


97 
OSIÁDisTimeMax
 = (
CPU_TS
)0;

100 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

101 
OSSchedLockTimeMax
 = (
CPU_TS
)0;

104 #ià
OS_MSG_EN
 > 0u

105 
OSMsgPoÞ
.
NbrU£dMax
 = 0;

107 
	`CPU_CRITICAL_EXIT
();

109 #ià
OS_CFG_DBG_EN
 > 0u

110 
	`CPU_CRITICAL_ENTER
();

111 
p_tcb
 = 
OSTaskDbgLi¡PŒ
;

112 
	`CPU_CRITICAL_EXIT
();

113 
p_tcb
 !ð(
OS_TCB
 *)0) {

114 
	`CPU_CRITICAL_ENTER
();

116 #ifdeà
CPU_CFG_INT_DIS_MEAS_EN


117 
p_tcb
->
IÁDisTimeMax
 = (
CPU_TS
 )0;

120 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

121 
p_tcb
->
SchedLockTimeMax
 = (
CPU_TS
 )0;

124 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

125 #ià
OS_CFG_TASK_Q_EN
 > 0u

126 
p_tcb
->
MsgQP’dTimeMax
 = (
CPU_TS
 )0;

128 
p_tcb
->
SemP’dTimeMax
 = (
CPU_TS
 )0;

129 
p_tcb
->
CtxSwCŒ
 = (
OS_CTR
 )0;

130 
p_tcb
->
CPUU§ge
 = (
OS_CPU_USAGE
)0;

131 
p_tcb
->
CPUU§geMax
 = (
OS_CPU_USAGE
)0;

132 
p_tcb
->
CyþesTÙ®
 = (
OS_CYCLES
 )0;

133 
p_tcb
->
CyþesTÙ®P»v
 = (
OS_CYCLES
 )0;

134 
p_tcb
->
CyþesS¹
 = 
	`OS_TS_GET
();

137 #ià
OS_CFG_TASK_Q_EN
 > 0u

138 
p_msg_q
 = &
p_tcb
->
MsgQ
;

139 
p_msg_q
->
NbrEÁr›sMax
 = (
OS_MSG_QTY
 )0;

141 
p_tcb
 =…_tcb->
DbgNextPŒ
;

142 
	`CPU_CRITICAL_EXIT
();

146 #ià(
OS_CFG_Q_EN
 > 0uè&& (
OS_CFG_DBG_EN
 > 0u)

147 
	`CPU_CRITICAL_ENTER
();

148 
p_q
 = 
OSQDbgLi¡PŒ
;

149 
	`CPU_CRITICAL_EXIT
();

150 
p_q
 !ð(
OS_Q
 *)0) {

151 
	`CPU_CRITICAL_ENTER
();

152 
p_msg_q
 = &
p_q
->
MsgQ
;

153 
p_msg_q
->
NbrEÁr›sMax
 = (
OS_MSG_QTY
)0;

154 
p_q
 =…_q->
DbgNextPŒ
;

155 
	`CPU_CRITICAL_EXIT
();

159 
	`OS_TickLi¡Re£tP—k
();

161 #ià
OS_CFG_TMR_EN
 > 0u

162 
	`OS_TmrRe£tP—k
();

166 *
p_”r
 = 
OS_ERR_NONE
;

167 
	}
}

191 
	$OSStTaskCPUU§geIn™
 (
OS_ERR
 *
p_”r
)

193 
OS_ERR
 
”r
;

194 
OS_TICK
 
dly
;

195 
	`CPU_SR_ALLOC
();

199 #ifdeà
OS_SAFETY_CRITICAL


200 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

201 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

206 #ià(
OS_CFG_TMR_EN
 > 0u)

207 
	`OSTaskSu¥’d
(&
OSTmrTaskTCB
, &
”r
);

208 ià(
”r
 !ð
OS_ERR_NONE
) {

209 *
p_”r
 = 
”r
;

214 
	`OSTimeDly
((
OS_TICK
 )2,

215 (
OS_OPT
 )
OS_OPT_TIME_DLY
,

216 (
OS_ERR
 *)&
”r
);

217 ià(
”r
 !ð
OS_ERR_NONE
) {

218 *
p_”r
 = 
”r
;

221 
	`CPU_CRITICAL_ENTER
();

222 
OSStTaskCŒ
 = (
OS_TICK
)0;

223 
	`CPU_CRITICAL_EXIT
();

225 
dly
 = (
OS_TICK
)0;

226 ià(
OSCfg_TickR©e_Hz
 > 
OSCfg_StTaskR©e_Hz
) {

227 
dly
 = (
OS_TICK
)(
OSCfg_TickR©e_Hz
 / 
OSCfg_StTaskR©e_Hz
);

229 ià(
dly
 =ð(
OS_TICK
)0) {

230 
dly
 = (
OS_TICK
)(
OSCfg_TickR©e_Hz
 / (
OS_RATE_HZ
)10);

233 
	`OSTimeDly
(
dly
,

234 
OS_OPT_TIME_DLY
,

235 &
”r
);

237 #ià(
OS_CFG_TMR_EN
 > 0u)

238 
	`OSTaskResume
(&
OSTmrTaskTCB
, &
”r
);

239 ià(
”r
 !ð
OS_ERR_NONE
) {

240 *
p_”r
 = 
”r
;

245 
	`CPU_CRITICAL_ENTER
();

246 
OSStTaskTimeMax
 = (
CPU_TS
)0;

248 
OSStTaskCŒMax
 = 
OSStTaskCŒ
;

249 
OSStTaskRdy
 = 
OS_STATE_RDY
;

250 
	`CPU_CRITICAL_EXIT
();

251 *
p_”r
 = 
OS_ERR_NONE
;

252 
	}
}

281 
	$OS_StTask
 (*
p_¬g
)

283 #ià
OS_CFG_DBG_EN
 > 0u

284 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

285 
OS_CPU_USAGE
 
u§ge
;

286 
OS_CYCLES
 
cyþes_tÙ®
;

287 
OS_CYCLES
 
cyþes_div
;

288 
OS_CYCLES
 
cyþes_muÉ
;

289 
OS_CYCLES
 
cyþes_max
;

291 
OS_TCB
 *
p_tcb
;

293 
OS_TICK
 
ùr_max
;

294 
OS_TICK
 
ùr_muÉ
;

295 
OS_TICK
 
ùr_div
;

296 
OS_ERR
 
”r
;

297 
OS_TICK
 
dly
;

298 
CPU_TS
 
ts_¡¬t
;

299 
CPU_TS
 
ts_’d
;

300 
	`CPU_SR_ALLOC
();

304 
p_¬g
 =…_arg;

305 
OSStTaskRdy
 !ð
DEF_TRUE
) {

306 
	`OSTimeDly
(2u * 
OSCfg_StTaskR©e_Hz
,

307 
OS_OPT_TIME_DLY
,

308 &
”r
);

310 
	`OSStRe£t
(&
”r
);

312 
dly
 = (
OS_TICK
)0;

313 ià(
OSCfg_TickR©e_Hz
 > 
OSCfg_StTaskR©e_Hz
) {

314 
dly
 = (
OS_TICK
)(
OSCfg_TickR©e_Hz
 / 
OSCfg_StTaskR©e_Hz
);

316 ià(
dly
 =ð(
OS_TICK
)0) {

317 
dly
 = (
OS_TICK
)(
OSCfg_TickR©e_Hz
 / (
OS_RATE_HZ
)10);

320 
DEF_ON
) {

321 
ts_¡¬t
 = 
	`OS_TS_GET
();

322 #ifdeà 
CPU_CFG_INT_DIS_MEAS_EN


323 
OSIÁDisTimeMax
 = 
	`CPU_IÁDisM—sMaxG‘
();

326 
	`CPU_CRITICAL_ENTER
();

327 
OSStTaskCŒRun
 = 
OSStTaskCŒ
;

328 
OSStTaskCŒ
 = (
OS_TICK
)0;

329 
	`CPU_CRITICAL_EXIT
();

331 ià(
OSStTaskCŒMax
 > 
OSStTaskCŒRun
) {

332 ià(
OSStTaskCŒMax
 < 400000u) {

333 
ùr_muÉ
 = 10000u;

334 
ùr_div
 = 1u;

335 } ià(
OSStTaskCŒMax
 < 4000000u) {

336 
ùr_muÉ
 = 1000u;

337 
ùr_div
 = 10u;

338 } ià(
OSStTaskCŒMax
 < 40000000u) {

339 
ùr_muÉ
 = 100u;

340 
ùr_div
 = 100u;

341 } ià(
OSStTaskCŒMax
 < 400000000u) {

342 
ùr_muÉ
 = 10u;

343 
ùr_div
 = 1000u;

345 
ùr_muÉ
 = 1u;

346 
ùr_div
 = 10000u;

348 
ùr_max
 = 
OSStTaskCŒMax
 / 
ùr_div
;

349 
OSStTaskCPUU§ge
 = (
OS_CPU_USAGE
)((
OS_TICK
)10000u - 
ùr_muÉ
 * 
OSStTaskCŒRun
 / 
ùr_max
);

350 ià(
OSStTaskCPUU§geMax
 < 
OSStTaskCPUU§ge
) {

351 
OSStTaskCPUU§geMax
 = 
OSStTaskCPUU§ge
;

354 
OSStTaskCPUU§ge
 = (
OS_CPU_USAGE
)10000u;

357 
	`OSStTaskHook
();

360 #ià
OS_CFG_DBG_EN
 > 0u

361 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

362 
cyþes_tÙ®
 = (
OS_CYCLES
)0;

364 
	`CPU_CRITICAL_ENTER
();

365 
p_tcb
 = 
OSTaskDbgLi¡PŒ
;

366 
	`CPU_CRITICAL_EXIT
();

367 
p_tcb
 !ð(
OS_TCB
 *)0) {

368 
	`OS_CRITICAL_ENTER
();

369 
p_tcb
->
CyþesTÙ®P»v
 =…_tcb->
CyþesTÙ®
;

370 
p_tcb
->
CyþesTÙ®
 = (
OS_CYCLES
)0;

371 
	`OS_CRITICAL_EXIT
();

373 
cyþes_tÙ®
 +ð
p_tcb
->
CyþesTÙ®P»v
;

375 
	`CPU_CRITICAL_ENTER
();

376 
p_tcb
 =…_tcb->
DbgNextPŒ
;

377 
	`CPU_CRITICAL_EXIT
();

382 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

384 ià(
cyþes_tÙ®
 > (
OS_CYCLES
)0u) {

385 ià(
cyþes_tÙ®
 < 400000u) {

386 
cyþes_muÉ
 = 10000u;

387 
cyþes_div
 = 1u;

388 } ià(
cyþes_tÙ®
 < 4000000u) {

389 
cyþes_muÉ
 = 1000u;

390 
cyþes_div
 = 10u;

391 } ià(
cyþes_tÙ®
 < 40000000u) {

392 
cyþes_muÉ
 = 100u;

393 
cyþes_div
 = 100u;

394 } ià(
cyþes_tÙ®
 < 400000000u) {

395 
cyþes_muÉ
 = 10u;

396 
cyþes_div
 = 1000u;

398 
cyþes_muÉ
 = 1u;

399 
cyþes_div
 = 10000u;

401 
cyþes_max
 = 
cyþes_tÙ®
 / 
cyþes_div
;

403 
cyþes_muÉ
 = 0u;

404 
cyþes_max
 = 1u;

407 
	`CPU_CRITICAL_ENTER
();

408 
p_tcb
 = 
OSTaskDbgLi¡PŒ
;

409 
	`CPU_CRITICAL_EXIT
();

410 
p_tcb
 !ð(
OS_TCB
 *)0) {

411 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

412 
u§ge
 = (
OS_CPU_USAGE
)(
cyþes_muÉ
 * 
p_tcb
->
CyþesTÙ®P»v
 / 
cyþes_max
);

413 ià(
u§ge
 > 10000u) {

414 
u§ge
 = 10000u;

416 
p_tcb
->
CPUU§ge
 = 
u§ge
;

417 ià(
p_tcb
->
CPUU§geMax
 < 
u§ge
) {

418 
p_tcb
->
CPUU§geMax
 = 
u§ge
;

422 #ià
OS_CFG_STAT_TASK_STK_CHK_EN
 > 0u

423 
	`OSTaskStkChk
Ð
p_tcb
,

424 &
p_tcb
->
StkF»e
,

425 &
p_tcb
->
StkU£d
,

426 &
”r
);

429 
	`CPU_CRITICAL_ENTER
();

430 
p_tcb
 =…_tcb->
DbgNextPŒ
;

431 
	`CPU_CRITICAL_EXIT
();

435 ià(
OSStRe£tFÏg
 =ð
DEF_TRUE
) {

436 
OSStRe£tFÏg
 = 
DEF_FALSE
;

437 
	`OSStRe£t
(&
”r
);

440 
ts_’d
 = 
	`OS_TS_GET
(è- 
ts_¡¬t
;

441 ià(
OSStTaskTimeMax
 < 
ts_’d
) {

442 
OSStTaskTimeMax
 = 
ts_’d
;

445 
	`OSTimeDly
(
dly
,

446 
OS_OPT_TIME_DLY
,

447 &
”r
);

449 
	}
}

472 
	$OS_StTaskIn™
 (
OS_ERR
 *
p_”r
)

474 #ifdeà
OS_SAFETY_CRITICAL


475 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

476 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

481 
OSStTaskCŒ
 = (
OS_TICK
)0;

482 
OSStTaskCŒRun
 = (
OS_TICK
)0;

483 
OSStTaskCŒMax
 = (
OS_TICK
)0;

484 
OSStTaskRdy
 = 
OS_STATE_NOT_RDY
;

485 
OSStRe£tFÏg
 = 
DEF_FALSE
;

488 ià(
OSCfg_StTaskStkBa£PŒ
 =ð(
CPU_STK
 *)0) {

489 *
p_”r
 = 
OS_ERR_STAT_STK_INVALID
;

493 ià(
OSCfg_StTaskStkSize
 < 
OSCfg_StkSizeMš
) {

494 *
p_”r
 = 
OS_ERR_STAT_STK_SIZE_INVALID
;

498 ià(
OSCfg_StTaskPrio
 >ð(
OS_CFG_PRIO_MAX
 - 1u)) {

499 *
p_”r
 = 
OS_ERR_STAT_PRIO_INVALID
;

503 
	`OSTaskC»©e
((
OS_TCB
 *)&
OSStTaskTCB
,

504 (
CPU_CHAR
 *)((*)"uC/OS-III Stat Task"),

505 (
OS_TASK_PTR
 )
OS_StTask
,

507 (
OS_PRIO
 )
OSCfg_StTaskPrio
,

508 (
CPU_STK
 *)
OSCfg_StTaskStkBa£PŒ
,

509 (
CPU_STK_SIZE
)
OSCfg_StTaskStkLim™
,

510 (
CPU_STK_SIZE
)
OSCfg_StTaskStkSize
,

511 (
OS_MSG_QTY
 )0,

512 (
OS_TICK
 )0,

514 (
OS_OPT
 )(
OS_OPT_TASK_STK_CHK
 | 
OS_OPT_TASK_STK_CLR
),

515 (
OS_ERR
 *)
p_”r
);

516 
	}
}

	@os_task.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_sk__c
 = "$Id: $";

61 #ià
OS_CFG_TASK_CHANGE_PRIO_EN
 > 0u

62 
	$OSTaskChªgePrio
 (
OS_TCB
 *
p_tcb
,

63 
OS_PRIO
 
´io_Ãw
,

64 
OS_ERR
 *
p_”r
)

66 
CPU_BOOLEAN
 
£lf
;

67 
	`CPU_SR_ALLOC
();

71 #ifdeà
OS_SAFETY_CRITICAL


72 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

73 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

78 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

79 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

80 *
p_”r
 = 
OS_ERR_TASK_CHANGE_PRIO_ISR
;

85 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

86 ià(
´io_Ãw
 == 0) {

87 *
p_”r
 = 
OS_ERR_PRIO_INVALID
;

92 ià(
´io_Ãw
 >ð(
OS_CFG_PRIO_MAX
 - 1u)) {

93 *
p_”r
 = 
OS_ERR_PRIO_INVALID
;

97 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

98 
	`CPU_CRITICAL_ENTER
();

99 
p_tcb
 = 
OSTCBCurPŒ
;

100 
	`CPU_CRITICAL_EXIT
();

101 
£lf
 = 
DEF_TRUE
;

103 
£lf
 = 
DEF_FALSE
;

106 
	`OS_CRITICAL_ENTER
();

107 
p_tcb
->
TaskS‹
) {

108 
OS_TASK_STATE_RDY
:

109 
	`OS_RdyLi¡Remove
(
p_tcb
);

110 
p_tcb
->
Prio
 = 
´io_Ãw
;

111 
	`OS_PrioIn£¹
(
p_tcb
->
Prio
);

112 ià(
£lf
 =ð
DEF_TRUE
) {

113 
	`OS_RdyLi¡In£¹H—d
(
p_tcb
);

115 
	`OS_RdyLi¡In£¹Taž
(
p_tcb
);

119 
OS_TASK_STATE_DLY
:

120 
OS_TASK_STATE_SUSPENDED
:

121 
OS_TASK_STATE_DLY_SUSPENDED
:

122 
p_tcb
->
Prio
 = 
´io_Ãw
;

125 
OS_TASK_STATE_PEND
:

126 
OS_TASK_STATE_PEND_TIMEOUT
:

127 
OS_TASK_STATE_PEND_SUSPENDED
:

128 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

129 
p_tcb
->
P’dOn
) {

130 
OS_TASK_PEND_ON_TASK_Q
:

131 
OS_TASK_PEND_ON_TASK_SEM
:

132 
OS_TASK_PEND_ON_FLAG
:

133 
p_tcb
->
Prio
 = 
´io_Ãw
;

136 
OS_TASK_PEND_ON_MUTEX
:

137 
OS_TASK_PEND_ON_MULTI
:

138 
OS_TASK_PEND_ON_Q
:

139 
OS_TASK_PEND_ON_SEM
:

140 
	`OS_P’dLi¡ChªgePrio
(
p_tcb
,

141 
´io_Ãw
);

150 
	`OS_CRITICAL_EXIT
();

151 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

155 
	`OS_CRITICAL_EXIT_NO_SCHED
();

157 
	`OSSched
();

159 *
p_”r
 = 
OS_ERR_NONE
;

160 
	}
}

249 
	$OSTaskC»©e
 (
OS_TCB
 *
p_tcb
,

250 
CPU_CHAR
 *
p_Çme
,

251 
OS_TASK_PTR
 
p_sk
,

252 *
p_¬g
,

253 
OS_PRIO
 
´io
,

254 
CPU_STK
 *
p_¡k_ba£
,

255 
CPU_STK_SIZE
 
¡k_lim™
,

256 
CPU_STK_SIZE
 
¡k_size
,

257 
OS_MSG_QTY
 
q_size
,

258 
OS_TICK
 
time_quª
,

259 *
p_ext
,

260 
OS_OPT
 
Ýt
,

261 
OS_ERR
 *
p_”r
)

263 
CPU_STK_SIZE
 
i
;

264 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

265 
OS_REG_ID
 
»g_nbr
;

267 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

268 
OS_TLS_ID
 
id
;

271 
CPU_STK
 *
p_¥
;

272 
CPU_STK
 *
p_¡k_lim™
;

273 
	`CPU_SR_ALLOC
();

277 #ifdeà
OS_SAFETY_CRITICAL


278 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

279 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

284 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


285 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

286 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

291 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

292 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

293 *
p_”r
 = 
OS_ERR_TASK_CREATE_ISR
;

298 #ià
OS_CFG_ARG_CHK_EN
 > 0u

299 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

300 *
p_”r
 = 
OS_ERR_TCB_INVALID
;

303 ià(
p_sk
 =ð(
OS_TASK_PTR
)0) {

304 *
p_”r
 = 
OS_ERR_TASK_INVALID
;

307 ià(
p_¡k_ba£
 =ð(
CPU_STK
 *)0) {

308 *
p_”r
 = 
OS_ERR_STK_INVALID
;

311 ià(
¡k_size
 < 
OSCfg_StkSizeMš
) {

312 *
p_”r
 = 
OS_ERR_STK_SIZE_INVALID
;

315 ià(
¡k_lim™
 >ð
¡k_size
) {

316 *
p_”r
 = 
OS_ERR_STK_LIMIT_INVALID
;

319 ià(
´io
 >ð
OS_CFG_PRIO_MAX
) {

320 *
p_”r
 = 
OS_ERR_PRIO_INVALID
;

325 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

326 ià(
´io
 =ð(
OS_PRIO
)0) {

327 ià(
p_tcb
 !ð&
OSIÁQTaskTCB
) {

328 *
p_”r
 = 
OS_ERR_PRIO_INVALID
;

334 ià(
´io
 =ð(
OS_CFG_PRIO_MAX
 - 1u)) {

335 ià(
p_tcb
 !ð&
OSIdËTaskTCB
) {

336 *
p_”r
 = 
OS_ERR_PRIO_INVALID
;

341 
	`OS_TaskIn™TCB
(
p_tcb
);

343 *
p_”r
 = 
OS_ERR_NONE
;

345 ià((
Ýt
 & 
OS_OPT_TASK_STK_CHK
è!ð(
OS_OPT
)0) {

346 ià((
Ýt
 & 
OS_OPT_TASK_STK_CLR
è!ð(
OS_OPT
)0) {

347 
p_¥
 = 
p_¡k_ba£
;

348 
i
 = 0u; i < 
¡k_size
; i++) {

349 *
p_¥
 = (
CPU_STK
)0;

350 
p_¥
++;

355 #ià(
CPU_CFG_STK_GROWTH
 =ð
CPU_STK_GROWTH_HI_TO_LO
)

356 
p_¡k_lim™
 = 
p_¡k_ba£
 + 
¡k_lim™
;

358 
p_¡k_lim™
 = 
p_¡k_ba£
 + (
¡k_size
 - 1uè- 
¡k_lim™
;

361 
p_¥
 = 
	`OSTaskStkIn™
(
p_sk
,

362 
p_¬g
,

363 
p_¡k_ba£
,

364 
p_¡k_lim™
,

365 
¡k_size
,

366 
Ýt
);

369 
p_tcb
->
TaskEÁryAddr
 = 
p_sk
;

370 
p_tcb
->
TaskEÁryArg
 = 
p_¬g
;

372 
p_tcb
->
NamePŒ
 = 
p_Çme
;

374 
p_tcb
->
Prio
 = 
´io
;

376 
p_tcb
->
StkPŒ
 = 
p_¥
;

377 
p_tcb
->
StkLim™PŒ
 = 
p_¡k_lim™
;

379 
p_tcb
->
TimeQuª
 = 
time_quª
;

380 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

381 ià(
time_quª
 =ð(
OS_TICK
)0) {

382 
p_tcb
->
TimeQuªCŒ
 = 
OSSchedRoundRobšDætTimeQuª
;

384 
p_tcb
->
TimeQuªCŒ
 = 
time_quª
;

387 
p_tcb
->
ExtPŒ
 = 
p_ext
;

388 
p_tcb
->
StkBa£PŒ
 = 
p_¡k_ba£
;

389 
p_tcb
->
StkSize
 = 
¡k_size
;

390 
p_tcb
->
O±
 = 
Ýt
;

392 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

393 
»g_nbr
 = 0u;„eg_nb¸< 
OS_CFG_TASK_REG_TBL_SIZE
;„eg_nbr++) {

394 
p_tcb
->
RegTbl
[
»g_nbr
] = (
OS_REG
)0;

398 #ià
OS_CFG_TASK_Q_EN
 > 0u

399 
	`OS_MsgQIn™
(&
p_tcb
->
MsgQ
,

400 
q_size
);

402 ()&
q_size
;

405 
	`OSTaskC»©eHook
(
p_tcb
);

407 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

408 
id
 = 0u; id < 
OS_CFG_TLS_TBL_SIZE
; id++) {

409 
p_tcb
->
TLS_Tbl
[
id
] = (
OS_TLS
)0;

411 
	`OS_TLS_TaskC»©e
(
p_tcb
);

414 
	`OS_CRITICAL_ENTER
();

415 
	`OS_PrioIn£¹
(
p_tcb
->
Prio
);

416 
	`OS_RdyLi¡In£¹Taž
(
p_tcb
);

418 #ià
OS_CFG_DBG_EN
 > 0u

419 
	`OS_TaskDbgLi¡Add
(
p_tcb
);

422 
OSTaskQty
++;

424 ià(
OSRuÂšg
 !ð
OS_STATE_OS_RUNNING
) {

425 
	`OS_CRITICAL_EXIT
();

429 
	`OS_CRITICAL_EXIT_NO_SCHED
();

431 
	`OSSched
();

432 
	}
}

459 #ià
OS_CFG_TASK_DEL_EN
 > 0u

460 
	$OSTaskD–
 (
OS_TCB
 *
p_tcb
,

461 
OS_ERR
 *
p_”r
)

463 
	`CPU_SR_ALLOC
();

467 #ifdeà
OS_SAFETY_CRITICAL


468 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

469 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

474 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

475 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

476 *
p_”r
 = 
OS_ERR_TASK_DEL_ISR
;

481 ià(
p_tcb
 =ð&
OSIdËTaskTCB
) {

482 *
p_”r
 = 
OS_ERR_TASK_DEL_IDLE
;

486 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

487 ià(
p_tcb
 =ð&
OSIÁQTaskTCB
) {

488 *
p_”r
 = 
OS_ERR_TASK_DEL_INVALID
;

493 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

494 
	`CPU_CRITICAL_ENTER
();

495 
p_tcb
 = 
OSTCBCurPŒ
;

496 
	`CPU_CRITICAL_EXIT
();

499 
	`OS_CRITICAL_ENTER
();

500 
p_tcb
->
TaskS‹
) {

501 
OS_TASK_STATE_RDY
:

502 
	`OS_RdyLi¡Remove
(
p_tcb
);

505 
OS_TASK_STATE_SUSPENDED
:

508 
OS_TASK_STATE_DLY
:

509 
OS_TASK_STATE_DLY_SUSPENDED
:

510 
	`OS_TickLi¡Remove
(
p_tcb
);

513 
OS_TASK_STATE_PEND
:

514 
OS_TASK_STATE_PEND_SUSPENDED
:

515 
OS_TASK_STATE_PEND_TIMEOUT
:

516 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

517 
	`OS_TickLi¡Remove
(
p_tcb
);

518 
p_tcb
->
P’dOn
) {

519 
OS_TASK_PEND_ON_NOTHING
:

520 
OS_TASK_PEND_ON_TASK_Q
:

521 
OS_TASK_PEND_ON_TASK_SEM
:

524 
OS_TASK_PEND_ON_FLAG
:

525 
OS_TASK_PEND_ON_MULTI
:

526 
OS_TASK_PEND_ON_MUTEX
:

527 
OS_TASK_PEND_ON_Q
:

528 
OS_TASK_PEND_ON_SEM
:

529 
	`OS_P’dLi¡Remove
(
p_tcb
);

538 
	`OS_CRITICAL_EXIT
();

539 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

543 #ià
OS_CFG_TASK_Q_EN
 > 0u

544 ()
	`OS_MsgQF»eAÎ
(&
p_tcb
->
MsgQ
);

547 
	`OSTaskD–Hook
(
p_tcb
);

549 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

550 
	`OS_TLS_TaskD–
(
p_tcb
);

553 #ià
OS_CFG_DBG_EN
 > 0u

554 
	`OS_TaskDbgLi¡Remove
(
p_tcb
);

556 
OSTaskQty
--;

558 
	`OS_TaskIn™TCB
(
p_tcb
);

559 
p_tcb
->
TaskS‹
 = (
OS_STATE
)
OS_TASK_STATE_DEL
;

561 
	`OS_CRITICAL_EXIT_NO_SCHED
();

563 *
p_”r
 = 
OS_ERR_NONE
;

565 
	`OSSched
();

566 
	}
}

593 #ià
OS_CFG_TASK_Q_EN
 > 0u

594 
OS_MSG_QTY
 
	$OSTaskQFlush
 (
OS_TCB
 *
p_tcb
,

595 
OS_ERR
 *
p_”r
)

597 
OS_MSG_QTY
 
’Œ›s
;

598 
	`CPU_SR_ALLOC
();

602 #ifdeà
OS_SAFETY_CRITICAL


603 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

604 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

605  ((
OS_MSG_QTY
)0);

609 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

610 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

611 *
p_”r
 = 
OS_ERR_FLUSH_ISR
;

612  ((
OS_MSG_QTY
)0);

616 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

617 
	`CPU_CRITICAL_ENTER
();

618 
p_tcb
 = 
OSTCBCurPŒ
;

619 
	`CPU_CRITICAL_EXIT
();

622 
	`OS_CRITICAL_ENTER
();

623 
’Œ›s
 = 
	`OS_MsgQF»eAÎ
(&
p_tcb
->
MsgQ
);

624 
	`OS_CRITICAL_EXIT
();

625 *
p_”r
 = 
OS_ERR_NONE
;

626  (
’Œ›s
);

627 
	}
}

671 #ià
OS_CFG_TASK_Q_EN
 > 0u

672 *
	$OSTaskQP’d
 (
OS_TICK
 
timeout
,

673 
OS_OPT
 
Ýt
,

674 
OS_MSG_SIZE
 *
p_msg_size
,

675 
CPU_TS
 *
p_ts
,

676 
OS_ERR
 *
p_”r
)

678 
OS_MSG_Q
 *
p_msg_q
;

679 *
p_void
;

680 
	`CPU_SR_ALLOC
();

684 #ifdeà
OS_SAFETY_CRITICAL


685 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

686 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

691 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

692 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

693 *
p_”r
 = 
OS_ERR_PEND_ISR
;

698 #ià
OS_CFG_ARG_CHK_EN
 > 0u

699 ià(
p_msg_size
 =ð(
OS_MSG_SIZE
 *)0) {

700 *
p_”r
 = 
OS_ERR_PTR_INVALID
;

703 
Ýt
) {

704 
OS_OPT_PEND_BLOCKING
:

705 
OS_OPT_PEND_NON_BLOCKING
:

709 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

714 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

715 *
p_ts
 = (
CPU_TS
 )0;

718 
	`CPU_CRITICAL_ENTER
();

719 
p_msg_q
 = &
OSTCBCurPŒ
->
MsgQ
;

720 
p_void
 = 
	`OS_MsgQG‘
(
p_msg_q
,

721 
p_msg_size
,

722 
p_ts
,

723 
p_”r
);

724 ià(*
p_”r
 =ð
OS_ERR_NONE
) {

725 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

726 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

727 
OSTCBCurPŒ
->
MsgQP’dTime
 = 
	`OS_TS_GET
(è- *
p_ts
;

728 ià(
OSTCBCurPŒ
->
MsgQP’dTimeMax
 < OSTCBCurPŒ->
MsgQP’dTime
) {

729 
OSTCBCurPŒ
->
MsgQP’dTimeMax
 = OSTCBCurPŒ->
MsgQP’dTime
;

733 
	`CPU_CRITICAL_EXIT
();

734  (
p_void
);

737 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

738 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

739 
	`CPU_CRITICAL_EXIT
();

742 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

743 
	`CPU_CRITICAL_EXIT
();

744 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

749 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

750 
	`OS_P’d
((
OS_PEND_DATA
 *)0,

751 (
OS_PEND_OBJ
 *)0,

752 (
OS_STATE
 )
OS_TASK_PEND_ON_TASK_Q
,

753 (
OS_TICK
 )
timeout
);

754 
	`OS_CRITICAL_EXIT_NO_SCHED
();

756 
	`OSSched
();

758 
	`CPU_CRITICAL_ENTER
();

759 
OSTCBCurPŒ
->
P’dStus
) {

760 
OS_STATUS_PEND_OK
:

761 
p_void
 = 
OSTCBCurPŒ
->
MsgPŒ
;

762 *
p_msg_size
 = 
OSTCBCurPŒ
->
MsgSize
;

763 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

764 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

765 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

766 
OSTCBCurPŒ
->
MsgQP’dTime
 = 
	`OS_TS_GET
(è- OSTCBCurPŒ->
TS
;

767 ià(
OSTCBCurPŒ
->
MsgQP’dTimeMax
 < OSTCBCurPŒ->
MsgQP’dTime
) {

768 
OSTCBCurPŒ
->
MsgQP’dTimeMax
 = OSTCBCurPŒ->
MsgQP’dTime
;

772 *
p_”r
 = 
OS_ERR_NONE
;

775 
OS_STATUS_PEND_ABORT
:

776 
p_void
 = (*)0;

777 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

778 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

779 *
p_ts
 = (
CPU_TS
 )0;

781 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

784 
OS_STATUS_PEND_TIMEOUT
:

786 
p_void
 = (*)0;

787 *
p_msg_size
 = (
OS_MSG_SIZE
)0;

788 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

789 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

791 *
p_”r
 = 
OS_ERR_TIMEOUT
;

794 
	`CPU_CRITICAL_EXIT
();

795  (
p_void
);

796 
	}
}

827 #ià(
OS_CFG_TASK_Q_EN
 > 0uè&& (
OS_CFG_TASK_Q_PEND_ABORT_EN
 > 0u)

828 
CPU_BOOLEAN
 
	$OSTaskQP’dAbÜt
 (
OS_TCB
 *
p_tcb
,

829 
OS_OPT
 
Ýt
,

830 
OS_ERR
 *
p_”r
)

832 
CPU_TS
 
ts
;

833 
	`CPU_SR_ALLOC
();

837 #ifdeà
OS_SAFETY_CRITICAL


838 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

839 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

840  (
DEF_FALSE
);

844 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

845 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

846 *
p_”r
 = 
OS_ERR_PEND_ABORT_ISR
;

847  (
DEF_FALSE
);

851 #ià
OS_CFG_ARG_CHK_EN
 > 0u

852 
Ýt
) {

853 
OS_OPT_POST_NONE
:

854 
OS_OPT_POST_NO_SCHED
:

858 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

859  (
DEF_FALSE
);

863 
	`CPU_CRITICAL_ENTER
();

864 #ià
OS_CFG_ARG_CHK_EN
 > 0u

865 ià((
p_tcb
 =ð(
OS_TCB
 *)0) ||

866 (
p_tcb
 =ð
OSTCBCurPŒ
)) {

867 
	`CPU_CRITICAL_EXIT
();

868 *
p_”r
 = 
OS_ERR_PEND_ABORT_SELF
;

869  (
DEF_FALSE
);

873 ià(
p_tcb
->
P’dOn
 !ð
OS_TASK_PEND_ON_TASK_Q
) {

874 
	`CPU_CRITICAL_EXIT
();

875 *
p_”r
 = 
OS_ERR_PEND_ABORT_NONE
;

876  (
DEF_FALSE
);

879 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

880 
ts
 = 
	`OS_TS_GET
();

881 
	`OS_P’dAbÜt
((
OS_PEND_OBJ
 *)0,

882 
p_tcb
,

883 
ts
);

884 
	`OS_CRITICAL_EXIT_NO_SCHED
();

885 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

886 
	`OSSched
();

888 *
p_”r
 = 
OS_ERR_NONE
;

889  (
DEF_TRUE
);

890 
	}
}

929 #ià
OS_CFG_TASK_Q_EN
 > 0u

930 
	$OSTaskQPo¡
 (
OS_TCB
 *
p_tcb
,

931 *
p_void
,

932 
OS_MSG_SIZE
 
msg_size
,

933 
OS_OPT
 
Ýt
,

934 
OS_ERR
 *
p_”r
)

936 
CPU_TS
 
ts
;

940 #ifdeà
OS_SAFETY_CRITICAL


941 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

942 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

947 #ià
OS_CFG_ARG_CHK_EN
 > 0u

948 
Ýt
) {

949 
OS_OPT_POST_FIFO
:

950 
OS_OPT_POST_LIFO
:

951 
OS_OPT_POST_FIFO
 | 
OS_OPT_POST_NO_SCHED
:

952 
OS_OPT_POST_LIFO
 | 
OS_OPT_POST_NO_SCHED
:

956 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

961 
ts
 = 
	`OS_TS_GET
();

963 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

964 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

965 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_TASK_MSG
,

966 (*)
p_tcb
,

967 (*)
p_void
,

968 (
OS_MSG_SIZE
)
msg_size
,

969 (
OS_FLAGS
 )0,

970 (
OS_OPT
 )
Ýt
,

971 (
CPU_TS
 )
ts
,

972 (
OS_ERR
 *)
p_”r
);

977 
	`OS_TaskQPo¡
(
p_tcb
,

978 
p_void
,

979 
msg_size
,

980 
Ýt
,

981 
ts
,

982 
p_”r
);

983 
	}
}

1010 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1011 
OS_REG
 
	$OSTaskRegG‘
 (
OS_TCB
 *
p_tcb
,

1012 
OS_REG_ID
 
id
,

1013 
OS_ERR
 *
p_”r
)

1015 
OS_REG
 
v®ue
;

1016 
	`CPU_SR_ALLOC
();

1020 #ifdeà
OS_SAFETY_CRITICAL


1021 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1022 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1023  ((
OS_REG
)0);

1027 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1028 ià(
id
 >ð
OS_CFG_TASK_REG_TBL_SIZE
) {

1029 *
p_”r
 = 
OS_ERR_REG_ID_INVALID
;

1030  ((
OS_REG
)0);

1034 
	`CPU_CRITICAL_ENTER
();

1035 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

1036 
p_tcb
 = 
OSTCBCurPŒ
;

1038 
v®ue
 = 
p_tcb
->
RegTbl
[
id
];

1039 
	`CPU_CRITICAL_EXIT
();

1040 *
p_”r
 = 
OS_ERR_NONE
;

1041  ((
OS_REG
)
v®ue
);

1042 
	}
}

1063 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1064 
OS_REG_ID
 
	$OSTaskRegG‘ID
 (
OS_ERR
 *
p_”r
)

1066 
OS_REG_ID
 
id
;

1067 
	`CPU_SR_ALLOC
();

1071 #ifdeà
OS_SAFETY_CRITICAL


1072 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1073 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1074  ((
OS_REG_ID
)
OS_CFG_TASK_REG_TBL_SIZE
);

1078 
	`CPU_CRITICAL_ENTER
();

1079 ià(
OSTaskRegNextAvažID
 >ð
OS_CFG_TASK_REG_TBL_SIZE
) {

1080 *
p_”r
 = 
OS_ERR_NO_MORE_ID_AVAIL
;

1081 
	`CPU_CRITICAL_EXIT
();

1082  ((
OS_REG_ID
)
OS_CFG_TASK_REG_TBL_SIZE
);

1085 
id
 = 
OSTaskRegNextAvažID
;

1086 
OSTaskRegNextAvažID
++;

1087 
	`CPU_CRITICAL_EXIT
();

1088 *
p_”r
 = 
OS_ERR_NONE
;

1089  (
id
);

1090 
	}
}

1119 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1120 
	$OSTaskRegS‘
 (
OS_TCB
 *
p_tcb
,

1121 
OS_REG_ID
 
id
,

1122 
OS_REG
 
v®ue
,

1123 
OS_ERR
 *
p_”r
)

1125 
	`CPU_SR_ALLOC
();

1129 #ifdeà
OS_SAFETY_CRITICAL


1130 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1131 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1136 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1137 ià(
id
 >ð
OS_CFG_TASK_REG_TBL_SIZE
) {

1138 *
p_”r
 = 
OS_ERR_REG_ID_INVALID
;

1143 
	`CPU_CRITICAL_ENTER
();

1144 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

1145 
p_tcb
 = 
OSTCBCurPŒ
;

1147 
p_tcb
->
RegTbl
[
id
] = 
v®ue
;

1148 
	`CPU_CRITICAL_EXIT
();

1149 *
p_”r
 = 
OS_ERR_NONE
;

1150 
	}
}

1175 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

1176 
	$OSTaskResume
 (
OS_TCB
 *
p_tcb
,

1177 
OS_ERR
 *
p_”r
)

1179 
	`CPU_SR_ALLOC
();

1183 #ifdeà
OS_SAFETY_CRITICAL


1184 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1185 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1190 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 == 0u) && \

1191 (
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u)

1192 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1193 *
p_”r
 = 
OS_ERR_TASK_RESUME_ISR
;

1199 
	`CPU_CRITICAL_ENTER
();

1200 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1201 ià((
p_tcb
 =ð(
OS_TCB
 *)0) ||

1202 (
p_tcb
 =ð
OSTCBCurPŒ
)) {

1203 
	`CPU_CRITICAL_EXIT
();

1204 *
p_”r
 = 
OS_ERR_TASK_RESUME_SELF
;

1208 
	`CPU_CRITICAL_EXIT
();

1210 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

1211 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1212 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_TASK_RESUME
,

1213 (*)
p_tcb
,

1215 (
OS_MSG_SIZE
)0,

1216 (
OS_FLAGS
 )0,

1217 (
OS_OPT
 )0,

1218 (
CPU_TS
 )0,

1219 (
OS_ERR
 *)
p_”r
);

1224 
	`OS_TaskResume
(
p_tcb
, 
p_”r
);

1225 
	}
}

1262 
OS_SEM_CTR
 
	$OSTaskSemP’d
 (
OS_TICK
 
timeout
,

1263 
OS_OPT
 
Ýt
,

1264 
CPU_TS
 *
p_ts
,

1265 
OS_ERR
 *
p_”r
)

1267 
OS_SEM_CTR
 
ùr
;

1268 
	`CPU_SR_ALLOC
();

1272 #ifdeà
OS_SAFETY_CRITICAL


1273 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1274 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1275  ((
OS_SEM_CTR
)0);

1279 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

1280 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1281 *
p_”r
 = 
OS_ERR_PEND_ISR
;

1282  ((
OS_SEM_CTR
)0);

1286 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1287 
Ýt
) {

1288 
OS_OPT_PEND_BLOCKING
:

1289 
OS_OPT_PEND_NON_BLOCKING
:

1293 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

1294  ((
OS_SEM_CTR
)0);

1298 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

1299 *
p_ts
 = (
CPU_TS
 )0;

1302 
	`CPU_CRITICAL_ENTER
();

1303 ià(
OSTCBCurPŒ
->
SemCŒ
 > (
OS_SEM_CTR
)0) {

1304 
OSTCBCurPŒ
->
SemCŒ
--;

1305 
ùr
 = 
OSTCBCurPŒ
->
SemCŒ
;

1306 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

1307 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

1309 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

1310 
OSTCBCurPŒ
->
SemP’dTime
 = 
	`OS_TS_GET
(è- OSTCBCurPŒ->
TS
;

1311 ià(
OSTCBCurPŒ
->
SemP’dTimeMax
 < OSTCBCurPŒ->
SemP’dTime
) {

1312 
OSTCBCurPŒ
->
SemP’dTimeMax
 = OSTCBCurPŒ->
SemP’dTime
;

1315 
	`CPU_CRITICAL_EXIT
();

1316 *
p_”r
 = 
OS_ERR_NONE
;

1317  (
ùr
);

1320 ià((
Ýt
 & 
OS_OPT_PEND_NON_BLOCKING
è!ð(
OS_OPT
)0) {

1321 
	`CPU_CRITICAL_EXIT
();

1322 *
p_”r
 = 
OS_ERR_PEND_WOULD_BLOCK
;

1323  ((
OS_SEM_CTR
)0);

1325 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1326 
	`CPU_CRITICAL_EXIT
();

1327 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

1328  ((
OS_SEM_CTR
)0);

1332 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

1333 
	`OS_P’d
((
OS_PEND_DATA
 *)0,

1334 (
OS_PEND_OBJ
 *)0,

1335 (
OS_STATE
 )
OS_TASK_PEND_ON_TASK_SEM
,

1336 (
OS_TICK
 )
timeout
);

1337 
	`OS_CRITICAL_EXIT_NO_SCHED
();

1339 
	`OSSched
();

1341 
	`CPU_CRITICAL_ENTER
();

1342 
OSTCBCurPŒ
->
P’dStus
) {

1343 
OS_STATUS_PEND_OK
:

1344 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

1345 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

1346 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

1347 
OSTCBCurPŒ
->
SemP’dTime
 = 
	`OS_TS_GET
(è- OSTCBCurPŒ->
TS
;

1348 ià(
OSTCBCurPŒ
->
SemP’dTimeMax
 < OSTCBCurPŒ->
SemP’dTime
) {

1349 
OSTCBCurPŒ
->
SemP’dTimeMax
 = OSTCBCurPŒ->
SemP’dTime
;

1353 *
p_”r
 = 
OS_ERR_NONE
;

1356 
OS_STATUS_PEND_ABORT
:

1357 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

1358 *
p_ts
 = 
OSTCBCurPŒ
->
TS
;

1360 *
p_”r
 = 
OS_ERR_PEND_ABORT
;

1363 
OS_STATUS_PEND_TIMEOUT
:

1364 ià(
p_ts
 !ð(
CPU_TS
 *)0) {

1365 *
p_ts
 = (
CPU_TS
 )0;

1367 *
p_”r
 = 
OS_ERR_TIMEOUT
;

1371 *
p_”r
 = 
OS_ERR_STATUS_INVALID
;

1374 
ùr
 = 
OSTCBCurPŒ
->
SemCŒ
;

1375 
	`CPU_CRITICAL_EXIT
();

1376  (
ùr
);

1377 
	}
}

1408 #ià
OS_CFG_TASK_SEM_PEND_ABORT_EN
 > 0u

1409 
CPU_BOOLEAN
 
	$OSTaskSemP’dAbÜt
 (
OS_TCB
 *
p_tcb
,

1410 
OS_OPT
 
Ýt
,

1411 
OS_ERR
 *
p_”r
)

1413 
CPU_TS
 
ts
;

1414 
	`CPU_SR_ALLOC
();

1418 #ifdeà
OS_SAFETY_CRITICAL


1419 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1420 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1421  (
DEF_FALSE
);

1425 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

1426 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1427 *
p_”r
 = 
OS_ERR_PEND_ABORT_ISR
;

1428  (
DEF_FALSE
);

1432 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1433 
Ýt
) {

1434 
OS_OPT_POST_NONE
:

1435 
OS_OPT_POST_NO_SCHED
:

1439 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

1440  (
DEF_FALSE
);

1444 
	`CPU_CRITICAL_ENTER
();

1445 ià((
p_tcb
 =ð(
OS_TCB
 *)0) ||

1446 (
p_tcb
 =ð
OSTCBCurPŒ
)) {

1447 
	`CPU_CRITICAL_EXIT
();

1448 *
p_”r
 = 
OS_ERR_PEND_ABORT_SELF
;

1449  (
DEF_FALSE
);

1452 ià(
p_tcb
->
P’dOn
 !ð
OS_TASK_PEND_ON_TASK_SEM
) {

1453 
	`CPU_CRITICAL_EXIT
();

1454 *
p_”r
 = 
OS_ERR_PEND_ABORT_NONE
;

1455  (
DEF_FALSE
);

1457 
	`CPU_CRITICAL_EXIT
();

1459 
	`OS_CRITICAL_ENTER
();

1460 
ts
 = 
	`OS_TS_GET
();

1461 
	`OS_P’dAbÜt
((
OS_PEND_OBJ
 *)0,

1462 
p_tcb
,

1463 
ts
);

1464 
	`OS_CRITICAL_EXIT_NO_SCHED
();

1465 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

1466 
	`OSSched
();

1468 *
p_”r
 = 
OS_ERR_NONE
;

1469  (
DEF_TRUE
);

1470 
	}
}

1497 
OS_SEM_CTR
 
	$OSTaskSemPo¡
 (
OS_TCB
 *
p_tcb
,

1498 
OS_OPT
 
Ýt
,

1499 
OS_ERR
 *
p_”r
)

1501 
OS_SEM_CTR
 
ùr
;

1502 
CPU_TS
 
ts
;

1506 #ifdeà
OS_SAFETY_CRITICAL


1507 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1508 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1509  ((
OS_SEM_CTR
)0);

1513 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1514 
Ýt
) {

1515 
OS_OPT_POST_NONE
:

1516 
OS_OPT_POST_NO_SCHED
:

1520 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

1521  ((
OS_SEM_CTR
)0u);

1525 
ts
 = 
	`OS_TS_GET
();

1527 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

1528 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1529 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_TASK_SIGNAL
,

1530 (*)
p_tcb
,

1532 (
OS_MSG_SIZE
)0,

1533 (
OS_FLAGS
 )0,

1534 (
OS_OPT
 )0,

1535 (
CPU_TS
 )
ts
,

1536 (
OS_ERR
 *)
p_”r
);

1537  ((
OS_SEM_CTR
)0);

1541 
ùr
 = 
	`OS_TaskSemPo¡
(
p_tcb
,

1542 
Ýt
,

1543 
ts
,

1544 
p_”r
);

1546  (
ùr
);

1547 
	}
}

1570 
OS_SEM_CTR
 
	$OSTaskSemS‘
 (
OS_TCB
 *
p_tcb
,

1571 
OS_SEM_CTR
 
út
,

1572 
OS_ERR
 *
p_”r
)

1574 
OS_SEM_CTR
 
ùr
;

1575 
	`CPU_SR_ALLOC
();

1579 #ifdeà
OS_SAFETY_CRITICAL


1580 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1581 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1582  ((
OS_SEM_CTR
)0);

1586 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

1587 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1588 *
p_”r
 = 
OS_ERR_SET_ISR
;

1589  ((
OS_SEM_CTR
)0);

1593 
	`CPU_CRITICAL_ENTER
();

1594 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

1595 
p_tcb
 = 
OSTCBCurPŒ
;

1597 
ùr
 = 
p_tcb
->
SemCŒ
;

1598 
p_tcb
->
SemCŒ
 = (
OS_SEM_CTR
)
út
;

1599 
	`CPU_CRITICAL_EXIT
();

1600 *
p_”r
 = 
OS_ERR_NONE
;

1601  (
ùr
);

1602 
	}
}

1629 #ià
OS_CFG_STAT_TASK_STK_CHK_EN
 > 0u

1630 
	$OSTaskStkChk
 (
OS_TCB
 *
p_tcb
,

1631 
CPU_STK_SIZE
 *
p_ä“
,

1632 
CPU_STK_SIZE
 *
p_u£d
,

1633 
OS_ERR
 *
p_”r
)

1635 
CPU_STK_SIZE
 
ä“_¡k
;

1636 
CPU_STK
 *
p_¡k
;

1637 
	`CPU_SR_ALLOC
();

1641 #ifdeà
OS_SAFETY_CRITICAL


1642 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1643 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1648 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

1649 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1650 *
p_”r
 = 
OS_ERR_TASK_STK_CHK_ISR
;

1655 #ià
OS_CFG_ARG_CHK_EN
 > 0u

1656 ià(
p_ä“
 =ð(
CPU_STK_SIZE
*)0) {

1657 *
p_”r
 = 
OS_ERR_PTR_INVALID
;

1661 ià(
p_u£d
 =ð(
CPU_STK_SIZE
*)0) {

1662 *
p_”r
 = 
OS_ERR_PTR_INVALID
;

1667 
	`CPU_CRITICAL_ENTER
();

1668 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

1669 
p_tcb
 = 
OSTCBCurPŒ
;

1672 ià(
p_tcb
->
StkPŒ
 =ð(
CPU_STK
*)0) {

1673 
	`CPU_CRITICAL_EXIT
();

1674 *
p_ä“
 = (
CPU_STK_SIZE
)0;

1675 *
p_u£d
 = (
CPU_STK_SIZE
)0;

1676 *
p_”r
 = 
OS_ERR_TASK_NOT_EXIST
;

1680 ià((
p_tcb
->
O±
 & 
OS_OPT_TASK_STK_CHK
è=ð(
OS_OPT
)0) {

1681 
	`CPU_CRITICAL_EXIT
();

1682 *
p_ä“
 = (
CPU_STK_SIZE
)0;

1683 *
p_u£d
 = (
CPU_STK_SIZE
)0;

1684 *
p_”r
 = 
OS_ERR_TASK_OPT
;

1687 
	`CPU_CRITICAL_EXIT
();

1689 
ä“_¡k
 = 0u;

1690 #ià
CPU_CFG_STK_GROWTH
 =ð
CPU_STK_GROWTH_HI_TO_LO


1691 
p_¡k
 = 
p_tcb
->
StkBa£PŒ
;

1692 *
p_¡k
 =ð(
CPU_STK
)0) {

1693 
p_¡k
++;

1694 
ä“_¡k
++;

1697 
p_¡k
 = 
p_tcb
->
StkBa£PŒ
 +…_tcb->
StkSize
 - 1u;

1698 *
p_¡k
 =ð(
CPU_STK
)0) {

1699 
ä“_¡k
++;

1700 
p_¡k
--;

1703 *
p_ä“
 = 
ä“_¡k
;

1704 *
p_u£d
 = (
p_tcb
->
StkSize
 - 
ä“_¡k
);

1705 *
p_”r
 = 
OS_ERR_NONE
;

1706 
	}
}

1737 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

1738 
	$OSTaskSu¥’d
 (
OS_TCB
 *
p_tcb
,

1739 
OS_ERR
 *
p_”r
)

1741 #ifdeà
OS_SAFETY_CRITICAL


1742 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1743 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1748 #ià(
OS_CFG_ISR_POST_DEFERRED_EN
 == 0u) && \

1749 (
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u)

1750 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1751 *
p_”r
 = 
OS_ERR_TASK_SUSPEND_ISR
;

1756 ià(
p_tcb
 =ð&
OSIdËTaskTCB
) {

1757 *
p_”r
 = 
OS_ERR_TASK_SUSPEND_IDLE
;

1761 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

1762 ià(
p_tcb
 =ð&
OSIÁQTaskTCB
) {

1763 *
p_”r
 = 
OS_ERR_TASK_SUSPEND_INT_HANDLER
;

1767 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1768 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
)
OS_OBJ_TYPE_TASK_SUSPEND
,

1769 (*)
p_tcb
,

1771 (
OS_MSG_SIZE
)0,

1772 (
OS_FLAGS
 )0,

1773 (
OS_OPT
 )0,

1774 (
CPU_TS
 )0,

1775 (
OS_ERR
 *)
p_”r
);

1780 
	`OS_TaskSu¥’d
(
p_tcb
, 
p_”r
);

1781 
	}
}

1805 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

1806 
	$OSTaskTimeQuªS‘
 (
OS_TCB
 *
p_tcb
,

1807 
OS_TICK
 
time_quª
,

1808 
OS_ERR
 *
p_”r
)

1810 
	`CPU_SR_ALLOC
();

1814 #ifdeà
OS_SAFETY_CRITICAL


1815 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1816 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1821 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

1822 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

1823 *
p_”r
 = 
OS_ERR_SET_ISR
;

1828 
	`CPU_CRITICAL_ENTER
();

1829 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

1830 
p_tcb
 = 
OSTCBCurPŒ
;

1833 ià(
time_quª
 == 0u) {

1834 
p_tcb
->
TimeQuª
 = 
OSSchedRoundRobšDætTimeQuª
;

1836 
p_tcb
->
TimeQuª
 = 
time_quª
;

1838 ià(
p_tcb
->
TimeQuª
 >…_tcb->
TimeQuªCŒ
) {

1839 
p_tcb
->
TimeQuªCŒ
 =…_tcb->
TimeQuª
;

1841 
	`CPU_CRITICAL_EXIT
();

1842 *
p_”r
 = 
OS_ERR_NONE
;

1843 
	}
}

1861 #ià
OS_CFG_DBG_EN
 > 0u

1862 
	$OS_TaskDbgLi¡Add
 (
OS_TCB
 *
p_tcb
)

1864 
p_tcb
->
DbgP»vPŒ
 = (
OS_TCB
 *)0;

1865 ià(
OSTaskDbgLi¡PŒ
 =ð(
OS_TCB
 *)0) {

1866 
p_tcb
->
DbgNextPŒ
 = (
OS_TCB
 *)0;

1868 
p_tcb
->
DbgNextPŒ
 = 
OSTaskDbgLi¡PŒ
;

1869 
OSTaskDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_tcb
;

1871 
OSTaskDbgLi¡PŒ
 = 
p_tcb
;

1872 
	}
}

1876 
	$OS_TaskDbgLi¡Remove
 (
OS_TCB
 *
p_tcb
)

1878 
OS_TCB
 *
p_tcb_Ãxt
;

1879 
OS_TCB
 *
p_tcb_´ev
;

1882 
p_tcb_´ev
 = 
p_tcb
->
DbgP»vPŒ
;

1883 
p_tcb_Ãxt
 = 
p_tcb
->
DbgNextPŒ
;

1885 ià(
p_tcb_´ev
 =ð(
OS_TCB
 *)0) {

1886 
OSTaskDbgLi¡PŒ
 = 
p_tcb_Ãxt
;

1887 ià(
p_tcb_Ãxt
 !ð(
OS_TCB
 *)0) {

1888 
p_tcb_Ãxt
->
DbgP»vPŒ
 = (
OS_TCB
 *)0;

1890 
p_tcb
->
DbgNextPŒ
 = (
OS_TCB
 *)0;

1892 } ià(
p_tcb_Ãxt
 =ð(
OS_TCB
 *)0) {

1893 
p_tcb_´ev
->
DbgNextPŒ
 = (
OS_TCB
 *)0;

1894 
p_tcb
->
DbgP»vPŒ
 = (
OS_TCB
 *)0;

1897 
p_tcb_´ev
->
DbgNextPŒ
 = 
p_tcb_Ãxt
;

1898 
p_tcb_Ãxt
->
DbgP»vPŒ
 = 
p_tcb_´ev
;

1899 
p_tcb
->
DbgNextPŒ
 = (
OS_TCB
 *)0;

1900 
p_tcb
->
DbgP»vPŒ
 = (
OS_TCB
 *)0;

1902 
	}
}

1923 
	$OS_TaskIn™
 (
OS_ERR
 *
p_”r
)

1925 #ifdeà
OS_SAFETY_CRITICAL


1926 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

1927 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

1932 #ià
OS_CFG_DBG_EN
 > 0u

1933 
OSTaskDbgLi¡PŒ
 = (
OS_TCB
 *)0;

1936 
OSTaskQty
 = (
OS_OBJ_QTY
 )0;

1937 
OSTaskCtxSwCŒ
 = (
OS_CTX_SW_CTR
)0;

1939 *
p_”r
 = 
OS_ERR_NONE
;

1940 
	}
}

1957 
	$OS_TaskIn™TCB
 (
OS_TCB
 *
p_tcb
)

1959 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

1960 
OS_REG_ID
 
»g_id
;

1962 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

1963 
OS_TLS_ID
 
id
;

1965 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

1966 
CPU_TS
 
ts
;

1970 
p_tcb
->
StkPŒ
 = (
CPU_STK
 *)0;

1971 
p_tcb
->
StkLim™PŒ
 = (
CPU_STK
 *)0;

1973 
p_tcb
->
ExtPŒ
 = (*)0;

1975 
p_tcb
->
NextPŒ
 = (
OS_TCB
 *)0;

1976 
p_tcb
->
P»vPŒ
 = (
OS_TCB
 *)0;

1978 
p_tcb
->
TickNextPŒ
 = (
OS_TCB
 *)0;

1979 
p_tcb
->
TickP»vPŒ
 = (
OS_TCB
 *)0;

1980 
p_tcb
->
TickSpokePŒ
 = (
OS_TICK_SPOKE
 *)0;

1982 
p_tcb
->
NamePŒ
 = (
CPU_CHAR
 *)((*)"?Task");

1984 
p_tcb
->
StkBa£PŒ
 = (
CPU_STK
 *)0;

1986 
p_tcb
->
TaskEÁryAddr
 = (
OS_TASK_PTR
 )0;

1987 
p_tcb
->
TaskEÁryArg
 = (*)0;

1989 #ià(
OS_CFG_PEND_MULTI_EN
 > 0u)

1990 
p_tcb
->
P’dD©aTblPŒ
 = (
OS_PEND_DATA
 *)0;

1991 
p_tcb
->
P’dD©aTblEÁr›s
 = (
OS_OBJ_QTY
 )0u;

1994 
p_tcb
->
TS
 = (
CPU_TS
 )0u;

1996 #ià(
OS_MSG_EN
 > 0u)

1997 
p_tcb
->
MsgPŒ
 = (*)0;

1998 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
 )0u;

2001 #ià
OS_CFG_TASK_Q_EN
 > 0u

2002 
	`OS_MsgQIn™
(&
p_tcb
->
MsgQ
,

2003 (
OS_MSG_QTY
)0u);

2004 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

2005 
p_tcb
->
MsgQP’dTime
 = (
CPU_TS
 )0u;

2006 
p_tcb
->
MsgQP’dTimeMax
 = (
CPU_TS
 )0u;

2010 #ià
OS_CFG_FLAG_EN
 > 0u

2011 
p_tcb
->
FÏgsP’d
 = (
OS_FLAGS
 )0u;

2012 
p_tcb
->
FÏgsO±
 = (
OS_OPT
 )0u;

2013 
p_tcb
->
FÏgsRdy
 = (
OS_FLAGS
 )0u;

2016 #ià
OS_CFG_TASK_REG_TBL_SIZE
 > 0u

2017 
»g_id
 = 0u;„eg_id < 
OS_CFG_TASK_REG_TBL_SIZE
;„eg_id++) {

2018 
p_tcb
->
RegTbl
[
»g_id
] = (
OS_REG
)0u;

2022 #ià
	`defšed
(
OS_CFG_TLS_TBL_SIZE
) && (OS_CFG_TLS_TBL_SIZE > 0u)

2023 
id
 = 0u; id < 
OS_CFG_TLS_TBL_SIZE
; id++) {

2024 
p_tcb
->
TLS_Tbl
[
id
] = (
OS_TLS
)0;

2028 
p_tcb
->
SemCŒ
 = (
OS_SEM_CTR
 )0u;

2029 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

2030 
p_tcb
->
SemP’dTime
 = (
CPU_TS
 )0u;

2031 
p_tcb
->
SemP’dTimeMax
 = (
CPU_TS
 )0u;

2034 
p_tcb
->
StkSize
 = (
CPU_STK_SIZE
 )0u;

2037 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

2038 
p_tcb
->
Su¥’dCŒ
 = (
OS_NESTING_CTR
 )0u;

2041 #ià
OS_CFG_STAT_TASK_STK_CHK_EN
 > 0u

2042 
p_tcb
->
StkF»e
 = (
CPU_STK_SIZE
 )0u;

2043 
p_tcb
->
StkU£d
 = (
CPU_STK_SIZE
 )0u;

2046 
p_tcb
->
O±
 = (
OS_OPT
 )0u;

2048 
p_tcb
->
TickCŒP»v
 = (
OS_TICK
 )
OS_TICK_TH_INIT
;

2049 
p_tcb
->
TickCŒM©ch
 = (
OS_TICK
 )0u;

2050 
p_tcb
->
TickRemaš
 = (
OS_TICK
 )0u;

2052 
p_tcb
->
TimeQuª
 = (
OS_TICK
 )0u;

2053 
p_tcb
->
TimeQuªCŒ
 = (
OS_TICK
 )0u;

2055 #ià
OS_CFG_TASK_PROFILE_EN
 > 0u

2056 
p_tcb
->
CPUU§ge
 = (
OS_CPU_USAGE
 )0u;

2057 
p_tcb
->
CPUU§geMax
 = (
OS_CPU_USAGE
 )0u;

2058 
p_tcb
->
CtxSwCŒ
 = (
OS_CTX_SW_CTR
 )0u;

2059 
p_tcb
->
CyþesD–
 = (
CPU_TS
 )0u;

2060 
ts
 = 
	`OS_TS_GET
();

2061 
p_tcb
->
CyþesS¹
 = 
ts
;

2062 
p_tcb
->
CyþesTÙ®
 = (
OS_CYCLES
 )0u;

2064 #ifdeà
CPU_CFG_INT_DIS_MEAS_EN


2065 
p_tcb
->
IÁDisTimeMax
 = (
CPU_TS
 )0u;

2067 #ià
OS_CFG_SCHED_LOCK_TIME_MEAS_EN
 > 0u

2068 
p_tcb
->
SchedLockTimeMax
 = (
CPU_TS
 )0u;

2071 
p_tcb
->
P’dOn
 = (
OS_STATE
 )
OS_TASK_PEND_ON_NOTHING
;

2072 
p_tcb
->
P’dStus
 = (
OS_STATUS
 )
OS_STATUS_PEND_OK
;

2073 
p_tcb
->
TaskS‹
 = (
OS_STATE
 )
OS_TASK_STATE_RDY
;

2075 
p_tcb
->
Prio
 = (
OS_PRIO
 )
OS_PRIO_INIT
;

2077 #ià
OS_CFG_DBG_EN
 > 0u

2078 
p_tcb
->
DbgP»vPŒ
 = (
OS_TCB
 *)0;

2079 
p_tcb
->
DbgNextPŒ
 = (
OS_TCB
 *)0;

2080 
p_tcb
->
DbgNamePŒ
 = (
CPU_CHAR
 *)((*)" ");

2082 
	}
}

2126 #ià
OS_CFG_TASK_Q_EN
 > 0u

2127 
	$OS_TaskQPo¡
 (
OS_TCB
 *
p_tcb
,

2128 *
p_void
,

2129 
OS_MSG_SIZE
 
msg_size
,

2130 
OS_OPT
 
Ýt
,

2131 
CPU_TS
 
ts
,

2132 
OS_ERR
 *
p_”r
)

2134 
	`CPU_SR_ALLOC
();

2138 
	`OS_CRITICAL_ENTER
();

2139 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

2140 
p_tcb
 = 
OSTCBCurPŒ
;

2142 *
p_”r
 = 
OS_ERR_NONE
;

2143 
p_tcb
->
TaskS‹
) {

2144 
OS_TASK_STATE_RDY
:

2145 
OS_TASK_STATE_DLY
:

2146 
OS_TASK_STATE_SUSPENDED
:

2147 
OS_TASK_STATE_DLY_SUSPENDED
:

2148 
	`OS_MsgQPut
(&
p_tcb
->
MsgQ
,

2149 
p_void
,

2150 
msg_size
,

2151 
Ýt
,

2152 
ts
,

2153 
p_”r
);

2154 
	`OS_CRITICAL_EXIT
();

2157 
OS_TASK_STATE_PEND
:

2158 
OS_TASK_STATE_PEND_TIMEOUT
:

2159 
OS_TASK_STATE_PEND_SUSPENDED
:

2160 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

2161 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_TASK_Q
) {

2162 
	`OS_Po¡
((
OS_PEND_OBJ
 *)0,

2163 
p_tcb
,

2164 
p_void
,

2165 
msg_size
,

2166 
ts
);

2167 
	`OS_CRITICAL_EXIT_NO_SCHED
();

2168 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0u) {

2169 
	`OSSched
();

2172 
	`OS_MsgQPut
(&
p_tcb
->
MsgQ
,

2173 
p_void
,

2174 
msg_size
,

2175 
Ýt
,

2176 
ts
,

2177 
p_”r
);

2178 
	`OS_CRITICAL_EXIT
();

2183 
	`OS_CRITICAL_EXIT
();

2184 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

2187 
	}
}

2214 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

2215 
	$OS_TaskResume
 (
OS_TCB
 *
p_tcb
,

2216 
OS_ERR
 *
p_”r
)

2218 
	`CPU_SR_ALLOC
();

2221 
	`CPU_CRITICAL_ENTER
();

2222 *
p_”r
 = 
OS_ERR_NONE
;

2223 
p_tcb
->
TaskS‹
) {

2224 
OS_TASK_STATE_RDY
:

2225 
OS_TASK_STATE_DLY
:

2226 
OS_TASK_STATE_PEND
:

2227 
OS_TASK_STATE_PEND_TIMEOUT
:

2228 
	`CPU_CRITICAL_EXIT
();

2229 *
p_”r
 = 
OS_ERR_TASK_NOT_SUSPENDED
;

2232 
OS_TASK_STATE_SUSPENDED
:

2233 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

2234 
p_tcb
->
Su¥’dCŒ
--;

2235 ià(
p_tcb
->
Su¥’dCŒ
 =ð(
OS_NESTING_CTR
)0) {

2236 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

2237 
	`OS_TaskRdy
(
p_tcb
);

2239 
	`OS_CRITICAL_EXIT_NO_SCHED
();

2242 
OS_TASK_STATE_DLY_SUSPENDED
:

2243 
p_tcb
->
Su¥’dCŒ
--;

2244 ià(
p_tcb
->
Su¥’dCŒ
 =ð(
OS_NESTING_CTR
)0) {

2245 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_DLY
;

2247 
	`CPU_CRITICAL_EXIT
();

2250 
OS_TASK_STATE_PEND_SUSPENDED
:

2251 
p_tcb
->
Su¥’dCŒ
--;

2252 ià(
p_tcb
->
Su¥’dCŒ
 =ð(
OS_NESTING_CTR
)0) {

2253 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND
;

2255 
	`CPU_CRITICAL_EXIT
();

2258 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

2259 
p_tcb
->
Su¥’dCŒ
--;

2260 ià(
p_tcb
->
Su¥’dCŒ
 =ð(
OS_NESTING_CTR
)0) {

2261 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND_TIMEOUT
;

2263 
	`CPU_CRITICAL_EXIT
();

2267 
	`CPU_CRITICAL_EXIT
();

2268 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

2272 
	`OSSched
();

2273 
	}
}

2292 
	$OS_TaskR‘uº
 ()

2294 
OS_ERR
 
”r
;

2298 
	`OSTaskR‘uºHook
(
OSTCBCurPŒ
);

2299 #ià
OS_CFG_TASK_DEL_EN
 > 0u

2300 
	`OSTaskD–
((
OS_TCB
 *)0,

2301 (
OS_ERR
 *)&
”r
);

2304 
	`OSTimeDly
((
OS_TICK
 )
OSCfg_TickR©e_Hz
,

2305 (
OS_OPT
 )
OS_OPT_TIME_DLY
,

2306 (
OS_ERR
 *)&
”r
);

2309 
	}
}

2342 
OS_SEM_CTR
 
	$OS_TaskSemPo¡
 (
OS_TCB
 *
p_tcb
,

2343 
OS_OPT
 
Ýt
,

2344 
CPU_TS
 
ts
,

2345 
OS_ERR
 *
p_”r
)

2347 
OS_SEM_CTR
 
ùr
;

2348 
	`CPU_SR_ALLOC
();

2352 
	`OS_CRITICAL_ENTER
();

2353 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

2354 
p_tcb
 = 
OSTCBCurPŒ
;

2356 
p_tcb
->
TS
 = 
ts
;

2357 *
p_”r
 = 
OS_ERR_NONE
;

2358 
p_tcb
->
TaskS‹
) {

2359 
OS_TASK_STATE_RDY
:

2360 
OS_TASK_STATE_DLY
:

2361 
OS_TASK_STATE_SUSPENDED
:

2362 
OS_TASK_STATE_DLY_SUSPENDED
:

2363 (
OS_SEM_CTR
)) {

2365 ià(
p_tcb
->
SemCŒ
 =ð
DEF_INT_08U_MAX_VAL
) {

2366 
	`OS_CRITICAL_EXIT
();

2367 *
p_”r
 = 
OS_ERR_SEM_OVF
;

2368  ((
OS_SEM_CTR
)0);

2373 ià(
p_tcb
->
SemCŒ
 =ð
DEF_INT_16U_MAX_VAL
) {

2374 
	`OS_CRITICAL_EXIT
();

2375 *
p_”r
 = 
OS_ERR_SEM_OVF
;

2376  ((
OS_SEM_CTR
)0);

2381 ià(
p_tcb
->
SemCŒ
 =ð
DEF_INT_32U_MAX_VAL
) {

2382 
	`OS_CRITICAL_EXIT
();

2383 *
p_”r
 = 
OS_ERR_SEM_OVF
;

2384  ((
OS_SEM_CTR
)0);

2391 
p_tcb
->
SemCŒ
++;

2392 
ùr
 = 
p_tcb
->
SemCŒ
;

2393 
	`OS_CRITICAL_EXIT
();

2396 
OS_TASK_STATE_PEND
:

2397 
OS_TASK_STATE_PEND_TIMEOUT
:

2398 
OS_TASK_STATE_PEND_SUSPENDED
:

2399 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

2400 ià(
p_tcb
->
P’dOn
 =ð
OS_TASK_PEND_ON_TASK_SEM
) {

2401 
	`OS_Po¡
((
OS_PEND_OBJ
 *)0,

2402 (
OS_TCB
 *)
p_tcb
,

2404 (
OS_MSG_SIZE
 )0u,

2405 (
CPU_TS
 )
ts
);

2406 
ùr
 = 
p_tcb
->
SemCŒ
;

2407 
	`OS_CRITICAL_EXIT_NO_SCHED
();

2408 ià((
Ýt
 & 
OS_OPT_POST_NO_SCHED
è=ð(
OS_OPT
)0) {

2409 
	`OSSched
();

2412 (
OS_SEM_CTR
)) {

2414 ià(
p_tcb
->
SemCŒ
 =ð
DEF_INT_08U_MAX_VAL
) {

2415 
	`OS_CRITICAL_EXIT
();

2416 *
p_”r
 = 
OS_ERR_SEM_OVF
;

2417  ((
OS_SEM_CTR
)0);

2422 ià(
p_tcb
->
SemCŒ
 =ð
DEF_INT_16U_MAX_VAL
) {

2423 
	`OS_CRITICAL_EXIT
();

2424 *
p_”r
 = 
OS_ERR_SEM_OVF
;

2425  ((
OS_SEM_CTR
)0);

2430 ià(
p_tcb
->
SemCŒ
 =ð
DEF_INT_32U_MAX_VAL
) {

2431 
	`OS_CRITICAL_EXIT
();

2432 *
p_”r
 = 
OS_ERR_SEM_OVF
;

2433  ((
OS_SEM_CTR
)0);

2440 
p_tcb
->
SemCŒ
++;

2441 
ùr
 = 
p_tcb
->
SemCŒ
;

2442 
	`OS_CRITICAL_EXIT
();

2447 
	`OS_CRITICAL_EXIT
();

2448 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

2449 
ùr
 = (
OS_SEM_CTR
)0;

2452  (
ùr
);

2453 
	}
}

2485 #ià
OS_CFG_TASK_SUSPEND_EN
 > 0u

2486 
	$OS_TaskSu¥’d
 (
OS_TCB
 *
p_tcb
,

2487 
OS_ERR
 *
p_”r
)

2489 
	`CPU_SR_ALLOC
();

2493 
	`CPU_CRITICAL_ENTER
();

2494 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

2495 
p_tcb
 = 
OSTCBCurPŒ
;

2498 ià(
p_tcb
 =ð
OSTCBCurPŒ
) {

2499 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

2500 
	`CPU_CRITICAL_EXIT
();

2501 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

2506 *
p_”r
 = 
OS_ERR_NONE
;

2507 
p_tcb
->
TaskS‹
) {

2508 
OS_TASK_STATE_RDY
:

2509 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

2510 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

2511 
p_tcb
->
Su¥’dCŒ
 = (
OS_NESTING_CTR
)1;

2512 
	`OS_RdyLi¡Remove
(
p_tcb
);

2513 
	`OS_CRITICAL_EXIT_NO_SCHED
();

2516 
OS_TASK_STATE_DLY
:

2517 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_DLY_SUSPENDED
;

2518 
p_tcb
->
Su¥’dCŒ
 = (
OS_NESTING_CTR
)1;

2519 
	`CPU_CRITICAL_EXIT
();

2522 
OS_TASK_STATE_PEND
:

2523 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND_SUSPENDED
;

2524 
p_tcb
->
Su¥’dCŒ
 = (
OS_NESTING_CTR
)1;

2525 
	`CPU_CRITICAL_EXIT
();

2528 
OS_TASK_STATE_PEND_TIMEOUT
:

2529 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
;

2530 
p_tcb
->
Su¥’dCŒ
 = (
OS_NESTING_CTR
)1;

2531 
	`CPU_CRITICAL_EXIT
();

2534 
OS_TASK_STATE_SUSPENDED
:

2535 
OS_TASK_STATE_DLY_SUSPENDED
:

2536 
OS_TASK_STATE_PEND_SUSPENDED
:

2537 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

2538 
p_tcb
->
Su¥’dCŒ
++;

2539 
	`CPU_CRITICAL_EXIT
();

2543 
	`CPU_CRITICAL_EXIT
();

2544 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

2548 
	`OSSched
();

2549 
	}
}

	@os_tick.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_tick__c
 = "$Id: $";

61 
	$OS_TickTask
 (*
p_¬g
)

63 
OS_ERR
 
”r
;

64 
CPU_TS
 
ts
;

67 
p_¬g
 =…_arg;

69 
DEF_ON
) {

70 ()
	`OSTaskSemP’d
((
OS_TICK
 )0,

71 (
OS_OPT
 )
OS_OPT_PEND_BLOCKING
,

72 (
CPU_TS
 *)&
ts
,

73 (
OS_ERR
 *)&
”r
);

74 ià(
”r
 =ð
OS_ERR_NONE
) {

75 ià(
OSRuÂšg
 =ð
OS_STATE_OS_RUNNING
) {

76 
	`OS_TickLi¡Upd©e
();

80 
	}
}

104 
	$OS_TickTaskIn™
 (
OS_ERR
 *
p_”r
)

106 #ifdeà
OS_SAFETY_CRITICAL


107 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

108 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

113 
OSTickCŒ
 = (
OS_TICK
)0u;

115 
OSTickTaskTimeMax
 = (
CPU_TS
)0u;

118 
	`OS_TickLi¡In™
();

121 ià(
OSCfg_TickTaskStkBa£PŒ
 =ð(
CPU_STK
 *)0) {

122 *
p_”r
 = 
OS_ERR_TICK_STK_INVALID
;

126 ià(
OSCfg_TickTaskStkSize
 < 
OSCfg_StkSizeMš
) {

127 *
p_”r
 = 
OS_ERR_TICK_STK_SIZE_INVALID
;

131 ià(
OSCfg_TickTaskPrio
 >ð(
OS_CFG_PRIO_MAX
 - 1u)) {

132 *
p_”r
 = 
OS_ERR_TICK_PRIO_INVALID
;

136 
	`OSTaskC»©e
((
OS_TCB
 *)&
OSTickTaskTCB
,

137 (
CPU_CHAR
 *)((*)"uC/OS-III Tick Task"),

138 (
OS_TASK_PTR
 )
OS_TickTask
,

140 (
OS_PRIO
 )
OSCfg_TickTaskPrio
,

141 (
CPU_STK
 *)
OSCfg_TickTaskStkBa£PŒ
,

142 (
CPU_STK_SIZE
)
OSCfg_TickTaskStkLim™
,

143 (
CPU_STK_SIZE
)
OSCfg_TickTaskStkSize
,

144 (
OS_MSG_QTY
 )0u,

145 (
OS_TICK
 )0u,

147 (
OS_OPT
 )(
OS_OPT_TASK_STK_CHK
 | 
OS_OPT_TASK_STK_CLR
 | 
OS_OPT_TASK_NO_TLS
),

148 (
OS_ERR
 *)
p_”r
);

149 
	}
}

166 
	$OS_TickLi¡In™
 ()

168 
OS_TICK_SPOKE_IX
 
i
;

169 
OS_TICK_SPOKE
 *
p_¥oke
;

173 
i
 = 0u; i < 
OSCfg_TickWh“lSize
; i++) {

174 
p_¥oke
 = (
OS_TICK_SPOKE
 *)&
OSCfg_TickWh“l
[
i
];

175 
p_¥oke
->
Fœ¡PŒ
 = (
OS_TCB
 *)0;

176 
p_¥oke
->
NbrEÁr›s
 = (
OS_OBJ_QTY
 )0u;

177 
p_¥oke
->
NbrEÁr›sMax
 = (
OS_OBJ_QTY
 )0u;

179 
	}
}

220 
	$OS_TickLi¡In£¹
 (
OS_TCB
 *
p_tcb
,

221 
OS_TICK
 
time
,

222 
OS_OPT
 
Ýt
,

223 
OS_ERR
 *
p_”r
)

225 
OS_TICK
 
tick_d–
;

226 
OS_TICK
 
tick_Ãxt
;

227 
OS_TICK_SPOKE
 *
p_¥oke
;

228 
OS_TCB
 *
p_tcb0
;

229 
OS_TCB
 *
p_tcb1
;

230 
OS_TICK_SPOKE_IX
 
¥oke
;

234 ià(
Ýt
 =ð
OS_OPT_TIME_MATCH
) {

235 
tick_d–
 = 
time
 - 
OSTickCŒ
 - 1u;

236 ià(
tick_d–
 > 
OS_TICK_TH_RDY
) {

237 
p_tcb
->
TickCŒM©ch
 = (
OS_TICK
 )0u;

238 
p_tcb
->
TickRemaš
 = (
OS_TICK
 )0u;

239 
p_tcb
->
TickSpokePŒ
 = (
OS_TICK_SPOKE
 *)0;

240 *
p_”r
 = 
OS_ERR_TIME_ZERO_DLY
;

243 
p_tcb
->
TickCŒM©ch
 = 
time
;

244 
p_tcb
->
TickRemaš
 = 
tick_d–
 + 1u;

246 } ià(
time
 > (
OS_TICK
)0u) {

247 ià(
Ýt
 =ð
OS_OPT_TIME_PERIODIC
) {

248 
tick_Ãxt
 = 
p_tcb
->
TickCŒP»v
 + 
time
;

249 
tick_d–
 = 
tick_Ãxt
 - 
OSTickCŒ
 - 1u;

250 ià(
tick_d–
 < 
time
) {

251 
p_tcb
->
TickCŒM©ch
 = 
tick_Ãxt
;

253 
p_tcb
->
TickCŒM©ch
 = 
OSTickCŒ
 + 
time
;

255 
p_tcb
->
TickRemaš
 =…_tcb->
TickCŒM©ch
 - 
OSTickCŒ
;

256 
p_tcb
->
TickCŒP»v
 =…_tcb->
TickCŒM©ch
;

259 
p_tcb
->
TickCŒM©ch
 = 
OSTickCŒ
 + 
time
;

260 
p_tcb
->
TickRemaš
 = 
time
;

264 
p_tcb
->
TickCŒM©ch
 = (
OS_TICK
 )0u;

265 
p_tcb
->
TickRemaš
 = (
OS_TICK
 )0u;

266 
p_tcb
->
TickSpokePŒ
 = (
OS_TICK_SPOKE
 *)0;

267 *
p_”r
 = 
OS_ERR_TIME_ZERO_DLY
;

272 
¥oke
 = (
OS_TICK_SPOKE_IX
)(
p_tcb
->
TickCŒM©ch
 % 
OSCfg_TickWh“lSize
);

273 
p_¥oke
 = &
OSCfg_TickWh“l
[
¥oke
];

275 ià(
p_¥oke
->
NbrEÁr›s
 =ð(
OS_OBJ_QTY
)0u) {

276 
p_tcb
->
TickNextPŒ
 = (
OS_TCB
 *)0;

277 
p_tcb
->
TickP»vPŒ
 = (
OS_TCB
 *)0;

278 
p_¥oke
->
Fœ¡PŒ
 = 
p_tcb
;

279 
p_¥oke
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)1u;

281 
p_tcb1
 = 
p_¥oke
->
Fœ¡PŒ
;

282 
p_tcb1
 !ð(
OS_TCB
 *)0) {

283 
p_tcb1
->
TickRemaš
 =…_tcb1->
TickCŒM©ch


284 - 
OSTickCŒ
;

285 ià(
p_tcb
->
TickRemaš
 > 
p_tcb1
->TickRemain) {

286 ià(
p_tcb1
->
TickNextPŒ
 !ð(
OS_TCB
 *)0) {

287 
p_tcb1
 =…_tcb1->
TickNextPŒ
;

289 
p_tcb
->
TickNextPŒ
 = (
OS_TCB
 *)0;

290 
p_tcb
->
TickP»vPŒ
 = 
p_tcb1
;

291 
p_tcb1
->
TickNextPŒ
 = 
p_tcb
;

292 
p_tcb1
 = (
OS_TCB
 *)0;

295 ià(
p_tcb1
->
TickP»vPŒ
 =ð(
OS_TCB
 *)0) {

296 
p_tcb
->
TickP»vPŒ
 = (
OS_TCB
 *)0;

297 
p_tcb
->
TickNextPŒ
 = 
p_tcb1
;

298 
p_tcb1
->
TickP»vPŒ
 = 
p_tcb
;

299 
p_¥oke
->
Fœ¡PŒ
 = 
p_tcb
;

301 
p_tcb0
 = 
p_tcb1
->
TickP»vPŒ
;

302 
p_tcb
->
TickP»vPŒ
 = 
p_tcb0
;

303 
p_tcb
->
TickNextPŒ
 = 
p_tcb1
;

304 
p_tcb0
->
TickNextPŒ
 = 
p_tcb
;

305 
p_tcb1
->
TickP»vPŒ
 = 
p_tcb
;

307 
p_tcb1
 = (
OS_TCB
 *)0;

310 
p_¥oke
->
NbrEÁr›s
++;

312 ià(
p_¥oke
->
NbrEÁr›sMax
 <…_¥oke->
NbrEÁr›s
) {

313 
p_¥oke
->
NbrEÁr›sMax
 =…_¥oke->
NbrEÁr›s
;

315 
p_tcb
->
TickSpokePŒ
 = 
p_¥oke
;

316 *
p_”r
 = 
OS_ERR_NONE
;

317 
	}
}

337 
	$OS_TickLi¡Remove
 (
OS_TCB
 *
p_tcb
)

339 
OS_TICK_SPOKE
 *
p_¥oke
;

340 
OS_TCB
 *
p_tcb1
;

341 
OS_TCB
 *
p_tcb2
;

345 
p_¥oke
 = 
p_tcb
->
TickSpokePŒ
;

346 ià(
p_¥oke
 !ð(
OS_TICK_SPOKE
 *)0) {

347 
p_tcb
->
TickRemaš
 = (
OS_TICK
)0u;

348 ià(
p_¥oke
->
Fœ¡PŒ
 =ð
p_tcb
) {

349 
p_tcb1
 = (
OS_TCB
 *)
p_tcb
->
TickNextPŒ
;

350 
p_¥oke
->
Fœ¡PŒ
 = 
p_tcb1
;

351 ià(
p_tcb1
 !ð(
OS_TCB
 *)0) {

352 
p_tcb1
->
TickP»vPŒ
 = (
OS_TCB
 *)0;

355 
p_tcb1
 = 
p_tcb
->
TickP»vPŒ
;

356 
p_tcb2
 = 
p_tcb
->
TickNextPŒ
;

357 
p_tcb1
->
TickNextPŒ
 = 
p_tcb2
;

358 ià(
p_tcb2
 !ð(
OS_TCB
 *)0) {

359 
p_tcb2
->
TickP»vPŒ
 = 
p_tcb1
;

362 
p_tcb
->
TickNextPŒ
 = (
OS_TCB
 *)0;

363 
p_tcb
->
TickP»vPŒ
 = (
OS_TCB
 *)0;

364 
p_tcb
->
TickSpokePŒ
 = (
OS_TICK_SPOKE
 *)0;

365 
p_tcb
->
TickCŒM©ch
 = (
OS_TICK
 )0u;

366 
p_¥oke
->
NbrEÁr›s
--;

368 
	}
}

386 
	$OS_TickLi¡Re£tP—k
 ()

388 
OS_TICK_SPOKE_IX
 
i
;

389 
OS_TICK_SPOKE
 *
p_¥oke
;

393 
i
 = 0u; i < 
OSCfg_TickWh“lSize
; i++) {

394 
p_¥oke
 = (
OS_TICK_SPOKE
 *)&
OSCfg_TickWh“l
[
i
];

395 
p_¥oke
->
NbrEÁr›sMax
 = (
OS_OBJ_QTY
 )0u;

397 
	}
}

415 
	$OS_TickLi¡Upd©e
 ()

417 
CPU_BOOLEAN
 
dÚe
;

418 
OS_TICK_SPOKE
 *
p_¥oke
;

419 
OS_TCB
 *
p_tcb
;

420 
OS_TCB
 *
p_tcb_Ãxt
;

421 
OS_TICK_SPOKE_IX
 
¥oke
;

422 
CPU_TS
 
ts_¡¬t
;

423 
CPU_TS
 
ts_’d
;

424 
	`CPU_SR_ALLOC
();

427 
	`OS_CRITICAL_ENTER
();

428 
ts_¡¬t
 = 
	`OS_TS_GET
();

429 
OSTickCŒ
++;

430 
¥oke
 = (
OS_TICK_SPOKE_IX
)(
OSTickCŒ
 % 
OSCfg_TickWh“lSize
);

431 
p_¥oke
 = &
OSCfg_TickWh“l
[
¥oke
];

432 
p_tcb
 = 
p_¥oke
->
Fœ¡PŒ
;

433 
dÚe
 = 
DEF_FALSE
;

434 
dÚe
 =ð
DEF_FALSE
) {

435 ià(
p_tcb
 !ð(
OS_TCB
 *)0) {

436 
p_tcb_Ãxt
 = 
p_tcb
->
TickNextPŒ
;

437 
p_tcb
->
TaskS‹
) {

438 
OS_TASK_STATE_RDY
:

439 
OS_TASK_STATE_PEND
:

440 
OS_TASK_STATE_SUSPENDED
:

441 
OS_TASK_STATE_PEND_SUSPENDED
:

444 
OS_TASK_STATE_DLY
:

445 
p_tcb
->
TickRemaš
 =…_tcb->
TickCŒM©ch


446 - 
OSTickCŒ
;

447 ià(
OSTickCŒ
 =ð
p_tcb
->
TickCŒM©ch
) {

448 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

449 
	`OS_TaskRdy
(
p_tcb
);

451 
dÚe
 = 
DEF_TRUE
;

455 
OS_TASK_STATE_PEND_TIMEOUT
:

456 
p_tcb
->
TickRemaš
 =…_tcb->
TickCŒM©ch


457 - 
OSTickCŒ
;

458 ià(
OSTickCŒ
 =ð
p_tcb
->
TickCŒM©ch
) {

459 #ià(
OS_MSG_EN
 > 0u)

460 
p_tcb
->
MsgPŒ
 = (*)0;

461 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

463 
p_tcb
->
TS
 = 
	`OS_TS_GET
();

464 
	`OS_P’dLi¡Remove
(
p_tcb
);

465 
	`OS_TaskRdy
(
p_tcb
);

466 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

467 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_TIMEOUT
;

468 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

470 
dÚe
 = 
DEF_TRUE
;

474 
OS_TASK_STATE_DLY_SUSPENDED
:

475 
p_tcb
->
TickRemaš
 =…_tcb->
TickCŒM©ch


476 - 
OSTickCŒ
;

477 ià(
OSTickCŒ
 =ð
p_tcb
->
TickCŒM©ch
) {

478 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

479 
	`OS_TickLi¡Remove
(
p_tcb
);

481 
dÚe
 = 
DEF_TRUE
;

485 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

486 
p_tcb
->
TickRemaš
 =…_tcb->
TickCŒM©ch


487 - 
OSTickCŒ
;

488 ià(
OSTickCŒ
 =ð
p_tcb
->
TickCŒM©ch
) {

489 #ià(
OS_MSG_EN
 > 0u)

490 
p_tcb
->
MsgPŒ
 = (*)0;

491 
p_tcb
->
MsgSize
 = (
OS_MSG_SIZE
)0u;

493 
p_tcb
->
TS
 = 
	`OS_TS_GET
();

494 
	`OS_P’dLi¡Remove
(
p_tcb
);

495 
	`OS_TickLi¡Remove
(
p_tcb
);

496 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

497 
p_tcb
->
P’dStus
 = 
OS_STATUS_PEND_TIMEOUT
;

498 
p_tcb
->
P’dOn
 = 
OS_TASK_PEND_ON_NOTHING
;

500 
dÚe
 = 
DEF_TRUE
;

507 
p_tcb
 = 
p_tcb_Ãxt
;

509 
dÚe
 = 
DEF_TRUE
;

512 
ts_’d
 = 
	`OS_TS_GET
(è- 
ts_¡¬t
;

513 ià(
OSTickTaskTimeMax
 < 
ts_’d
) {

514 
OSTickTaskTimeMax
 = 
ts_’d
;

516 
	`OS_CRITICAL_EXIT
();

517 
	}
}

	@os_time.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_time__c
 = "$Id: $";

80 
	$OSTimeDly
 (
OS_TICK
 
dly
,

81 
OS_OPT
 
Ýt
,

82 
OS_ERR
 *
p_”r
)

84 
	`CPU_SR_ALLOC
();

88 #ifdeà
OS_SAFETY_CRITICAL


89 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

90 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

95 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

96 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

97 *
p_”r
 = 
OS_ERR_TIME_DLY_ISR
;

102 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

103 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

107 
Ýt
) {

108 
OS_OPT_TIME_DLY
:

109 
OS_OPT_TIME_TIMEOUT
:

110 
OS_OPT_TIME_PERIODIC
:

111 ià(
dly
 =ð(
OS_TICK
)0u) {

112 *
p_”r
 = 
OS_ERR_TIME_ZERO_DLY
;

117 
OS_OPT_TIME_MATCH
:

121 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

125 
	`OS_CRITICAL_ENTER
();

126 
OSTCBCurPŒ
->
TaskS‹
 = 
OS_TASK_STATE_DLY
;

127 
	`OS_TickLi¡In£¹
(
OSTCBCurPŒ
,

128 
dly
,

129 
Ýt
,

130 
p_”r
);

131 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

132 
	`OS_CRITICAL_EXIT_NO_SCHED
();

135 
	`OS_RdyLi¡Remove
(
OSTCBCurPŒ
);

136 
	`OS_CRITICAL_EXIT_NO_SCHED
();

137 
	`OSSched
();

138 *
p_”r
 = 
OS_ERR_NONE
;

139 
	}
}

199 #ià
OS_CFG_TIME_DLY_HMSM_EN
 > 0u

200 
	$OSTimeDlyHMSM
 (
CPU_INT16U
 
hours
,

201 
CPU_INT16U
 
mšu‹s
,

202 
CPU_INT16U
 
£cÚds
,

203 
CPU_INT32U
 
mžli
,

204 
OS_OPT
 
Ýt
,

205 
OS_ERR
 *
p_”r
)

207 #ià
OS_CFG_ARG_CHK_EN
 > 0u

208 
CPU_BOOLEAN
 
Ýt_šv®id
;

209 
CPU_BOOLEAN
 
Ýt_nÚ_¡riù
;

211 
OS_OPT
 
Ýt_time
;

212 
OS_RATE_HZ
 
tick_¿‹
;

213 
OS_TICK
 
ticks
;

214 
	`CPU_SR_ALLOC
();

218 #ifdeà
OS_SAFETY_CRITICAL


219 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

220 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

225 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

226 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

227 *
p_”r
 = 
OS_ERR_TIME_DLY_ISR
;

232 ià(
OSSchedLockNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

233 *
p_”r
 = 
OS_ERR_SCHED_LOCKED
;

237 
Ýt_time
 = 
Ýt
 & 
OS_OPT_TIME_MASK
;

238 
Ýt_time
) {

239 
OS_OPT_TIME_DLY
:

240 
OS_OPT_TIME_TIMEOUT
:

241 
OS_OPT_TIME_PERIODIC
:

242 ià(
mžli
 =ð(
CPU_INT32U
)0u) {

243 ià(
£cÚds
 =ð(
CPU_INT16U
)0u) {

244 ià(
mšu‹s
 =ð(
CPU_INT16U
)0u) {

245 ià(
hours
 =ð(
CPU_INT16U
)0u) {

246 *
p_”r
 = 
OS_ERR_TIME_ZERO_DLY
;

254 
OS_OPT_TIME_MATCH
:

258 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

262 #ià
OS_CFG_ARG_CHK_EN
 > 0u

263 
Ýt_šv®id
 = 
	`DEF_BIT_IS_SET_ANY
(
Ýt
, ~
OS_OPT_TIME_OPTS_MASK
);

264 ià(
Ýt_šv®id
 =ð
DEF_YES
) {

265 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

269 
Ýt_nÚ_¡riù
 = 
	`DEF_BIT_IS_SET
(
Ýt
, 
OS_OPT_TIME_HMSM_NON_STRICT
);

270 ià(
Ýt_nÚ_¡riù
 !ð
DEF_YES
) {

271 ià(
mžli
 > (
CPU_INT32U
)999u) {

272 *
p_”r
 = 
OS_ERR_TIME_INVALID_MILLISECONDS
;

275 ià(
£cÚds
 > (
CPU_INT16U
)59u) {

276 *
p_”r
 = 
OS_ERR_TIME_INVALID_SECONDS
;

279 ià(
mšu‹s
 > (
CPU_INT16U
)59u) {

280 *
p_”r
 = 
OS_ERR_TIME_INVALID_MINUTES
;

283 ià(
hours
 > (
CPU_INT16U
)99u) {

284 *
p_”r
 = 
OS_ERR_TIME_INVALID_HOURS
;

288 ià(
mšu‹s
 > (
CPU_INT16U
)9999u) {

289 *
p_”r
 = 
OS_ERR_TIME_INVALID_MINUTES
;

292 ià(
hours
 > (
CPU_INT16U
)999u) {

293 *
p_”r
 = 
OS_ERR_TIME_INVALID_HOURS
;

301 
tick_¿‹
 = 
OSCfg_TickR©e_Hz
;

302 
ticks
 = ((
OS_TICK
)
hours
 * (OS_TICK)3600u + (OS_TICK)
mšu‹s
 * (OS_TICK)60u + (OS_TICK)
£cÚds
è* 
tick_¿‹


303 + (
tick_¿‹
 * ((
OS_TICK
)
mžli
 + (OS_TICK)500u /ick_rate)) / (OS_TICK)1000u;

305 ià(
ticks
 > (
OS_TICK
)0u) {

306 
	`OS_CRITICAL_ENTER
();

307 
OSTCBCurPŒ
->
TaskS‹
 = 
OS_TASK_STATE_DLY
;

308 
	`OS_TickLi¡In£¹
(
OSTCBCurPŒ
,

309 
ticks
,

310 
Ýt_time
,

311 
p_”r
);

312 ià(*
p_”r
 !ð
OS_ERR_NONE
) {

313 
	`OS_CRITICAL_EXIT_NO_SCHED
();

316 
	`OS_RdyLi¡Remove
(
OSTCBCurPŒ
);

317 
	`OS_CRITICAL_EXIT_NO_SCHED
();

318 
	`OSSched
();

319 *
p_”r
 = 
OS_ERR_NONE
;

321 *
p_”r
 = 
OS_ERR_TIME_ZERO_DLY
;

323 
	}
}

348 #ià
OS_CFG_TIME_DLY_RESUME_EN
 > 0u

349 
	$OSTimeDlyResume
 (
OS_TCB
 *
p_tcb
,

350 
OS_ERR
 *
p_”r
)

352 
	`CPU_SR_ALLOC
();

356 #ifdeà
OS_SAFETY_CRITICAL


357 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

358 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

363 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

364 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0u) {

365 *
p_”r
 = 
OS_ERR_TIME_DLY_RESUME_ISR
;

370 #ià
OS_CFG_ARG_CHK_EN
 > 0u

371 ià(
p_tcb
 =ð(
OS_TCB
 *)0) {

372 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

377 
	`CPU_CRITICAL_ENTER
();

378 ià(
p_tcb
 =ð
OSTCBCurPŒ
) {

379 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

380 
	`CPU_CRITICAL_EXIT
();

384 
p_tcb
->
TaskS‹
) {

385 
OS_TASK_STATE_RDY
:

386 
	`CPU_CRITICAL_EXIT
();

387 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

390 
OS_TASK_STATE_DLY
:

391 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

392 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_RDY
;

393 
	`OS_TickLi¡Remove
(
p_tcb
);

394 
	`OS_RdyLi¡In£¹
(
p_tcb
);

395 
	`OS_CRITICAL_EXIT_NO_SCHED
();

396 *
p_”r
 = 
OS_ERR_NONE
;

399 
OS_TASK_STATE_PEND
:

400 
	`CPU_CRITICAL_EXIT
();

401 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

404 
OS_TASK_STATE_PEND_TIMEOUT
:

405 
	`CPU_CRITICAL_EXIT
();

406 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

409 
OS_TASK_STATE_SUSPENDED
:

410 
	`CPU_CRITICAL_EXIT
();

411 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

414 
OS_TASK_STATE_DLY_SUSPENDED
:

415 
	`OS_CRITICAL_ENTER_CPU_CRITICAL_EXIT
();

416 
p_tcb
->
TaskS‹
 = 
OS_TASK_STATE_SUSPENDED
;

417 
	`OS_TickLi¡Remove
(
p_tcb
);

418 
	`OS_CRITICAL_EXIT_NO_SCHED
();

419 *
p_”r
 = 
OS_ERR_TASK_SUSPENDED
;

422 
OS_TASK_STATE_PEND_SUSPENDED
:

423 
	`CPU_CRITICAL_EXIT
();

424 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

427 
OS_TASK_STATE_PEND_TIMEOUT_SUSPENDED
:

428 
	`CPU_CRITICAL_EXIT
();

429 *
p_”r
 = 
OS_ERR_TASK_NOT_DLY
;

433 
	`CPU_CRITICAL_EXIT
();

434 *
p_”r
 = 
OS_ERR_STATE_INVALID
;

438 
	`OSSched
();

439 
	}
}

457 
OS_TICK
 
	$OSTimeG‘
 (
OS_ERR
 *
p_”r
)

459 
OS_TICK
 
ticks
;

460 
	`CPU_SR_ALLOC
();

464 #ifdeà
OS_SAFETY_CRITICAL


465 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

466 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

467  ((
OS_TICK
)0);

471 
	`CPU_CRITICAL_ENTER
();

472 
ticks
 = 
OSTickCŒ
;

473 
	`CPU_CRITICAL_EXIT
();

474 *
p_”r
 = 
OS_ERR_NONE
;

475  (
ticks
);

476 
	}
}

494 
	$OSTimeS‘
 (
OS_TICK
 
ticks
,

495 
OS_ERR
 *
p_”r
)

497 
	`CPU_SR_ALLOC
();

501 #ifdeà
OS_SAFETY_CRITICAL


502 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

503 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

508 
	`CPU_CRITICAL_ENTER
();

509 
OSTickCŒ
 = 
ticks
;

510 
	`CPU_CRITICAL_EXIT
();

511 *
p_”r
 = 
OS_ERR_NONE
;

512 
	}
}

528 
	$OSTimeTick
 ()

530 
OS_ERR
 
”r
;

531 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

532 
CPU_TS
 
ts
;

536 
	`OSTimeTickHook
();

538 #ià
OS_CFG_ISR_POST_DEFERRED_EN
 > 0u

540 
ts
 = 
	`OS_TS_GET
();

541 
	`OS_IÁQPo¡
((
OS_OBJ_TYPE
è
OS_OBJ_TYPE_TICK
,

542 (*)&
OSRdyLi¡
[
OSPrioCur
],

544 (
OS_MSG_SIZE
) 0u,

545 (
OS_FLAGS
 ) 0u,

546 (
OS_OPT
 ) 0u,

547 (
CPU_TS
 ) 
ts
,

548 (
OS_ERR
 *)&
”r
);

552 ()
	`OSTaskSemPo¡
((
OS_TCB
 *)&
OSTickTaskTCB
,

553 (
OS_OPT
 ) 
OS_OPT_POST_NONE
,

554 (
OS_ERR
 *)&
”r
);

557 #ià
OS_CFG_SCHED_ROUND_ROBIN_EN
 > 0u

558 
	`OS_SchedRoundRobš
(&
OSRdyLi¡
[
OSPrioCur
]);

561 #ià
OS_CFG_TMR_EN
 > 0u

562 
OSTmrUpd©eCŒ
--;

563 ià(
OSTmrUpd©eCŒ
 =ð(
OS_CTR
)0u) {

564 
OSTmrUpd©eCŒ
 = 
OSTmrUpd©eCÁ
;

565 
	`OSTaskSemPo¡
((
OS_TCB
 *)&
OSTmrTaskTCB
,

566 (
OS_OPT
 ) 
OS_OPT_POST_NONE
,

567 (
OS_ERR
 *)&
”r
);

572 
	}
}

	@os_tmr.c

33 
	#MICRIUM_SOURCE


	)

34 
	~<os.h
>

36 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


37 cÚ¡ 
CPU_CHAR
 *
	gos_tmr__c
 = "$Id: $";

41 #ià
OS_CFG_TMR_EN
 > 0u

48 
	#OS_OPT_LINK_DLY
 (
OS_OPT
)(0u)

	)

49 
	#OS_OPT_LINK_PERIODIC
 (
OS_OPT
)(1u)

	)

104 
	$OSTmrC»©e
 (
OS_TMR
 *
p_tmr
,

105 
CPU_CHAR
 *
p_Çme
,

106 
OS_TICK
 
dly
,

107 
OS_TICK
 
³riod
,

108 
OS_OPT
 
Ýt
,

109 
OS_TMR_CALLBACK_PTR
 
p_ÿÎback
,

110 *
p_ÿÎback_¬g
,

111 
OS_ERR
 *
p_”r
)

113 
	`CPU_SR_ALLOC
();

117 #ifdeà
OS_SAFETY_CRITICAL


118 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

119 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

124 #ifdeà
OS_SAFETY_CRITICAL_IEC61508


125 ià(
OSSaãtyCr™iÿlS¹FÏg
 =ð
DEF_TRUE
) {

126 *
p_”r
 = 
OS_ERR_ILLEGAL_CREATE_RUN_TIME
;

131 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

132 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

133 *
p_”r
 = 
OS_ERR_TMR_ISR
;

138 #ià
OS_CFG_ARG_CHK_EN
 > 0u

139 ià(
p_tmr
 =ð(
OS_TMR
 *)0) {

140 *
p_”r
 = 
OS_ERR_OBJ_PTR_NULL
;

144 
Ýt
) {

145 
OS_OPT_TMR_PERIODIC
:

146 ià(
³riod
 =ð(
OS_TICK
)0) {

147 *
p_”r
 = 
OS_ERR_TMR_INVALID_PERIOD
;

152 
OS_OPT_TMR_ONE_SHOT
:

153 ià(
dly
 =ð(
OS_TICK
)0) {

154 *
p_”r
 = 
OS_ERR_TMR_INVALID_DLY
;

160 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

165 
	`OS_CRITICAL_ENTER
();

166 
p_tmr
->
S‹
 = (
OS_STATE
 )
OS_TMR_STATE_STOPPED
;

167 
p_tmr
->
Ty³
 = (
OS_OBJ_TYPE
 )
OS_OBJ_TYPE_TMR
;

168 
p_tmr
->
NamePŒ
 = (
CPU_CHAR
 *)
p_Çme
;

169 
p_tmr
->
Dly
 = (
OS_TICK
 )
dly
;

170 
p_tmr
->
M©ch
 = (
OS_TICK
 )0;

171 
p_tmr
->
Remaš
 = (
OS_TICK
 )0;

172 
p_tmr
->
P”iod
 = (
OS_TICK
 )
³riod
;

173 
p_tmr
->
O±
 = (
OS_OPT
 )
Ýt
;

174 
p_tmr
->
C®lbackPŒ
 = (
OS_TMR_CALLBACK_PTR
)
p_ÿÎback
;

175 
p_tmr
->
C®lbackPŒArg
 = (*)
p_ÿÎback_¬g
;

176 
p_tmr
->
NextPŒ
 = (
OS_TMR
 *)0;

177 
p_tmr
->
P»vPŒ
 = (
OS_TMR
 *)0;

179 #ià
OS_CFG_DBG_EN
 > 0u

180 
	`OS_TmrDbgLi¡Add
(
p_tmr
);

182 
OSTmrQty
++;

184 
	`OS_CRITICAL_EXIT_NO_SCHED
();

185 *
p_”r
 = 
OS_ERR_NONE
;

186 
	}
}

211 #ià
OS_CFG_TMR_DEL_EN
 > 0u

212 
CPU_BOOLEAN
 
	$OSTmrD–
 (
OS_TMR
 *
p_tmr
,

213 
OS_ERR
 *
p_”r
)

215 
OS_ERR
 
”r
;

219 #ifdeà
OS_SAFETY_CRITICAL


220 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

221 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

222  (
DEF_FALSE
);

226 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

227 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

228 *
p_”r
 = 
OS_ERR_TMR_ISR
;

229  (
DEF_FALSE
);

233 #ià
OS_CFG_ARG_CHK_EN
 > 0u

234 ià(
p_tmr
 =ð(
OS_TMR
 *)0) {

235 *
p_”r
 = 
OS_ERR_TMR_INVALID
;

236  (
DEF_FALSE
);

240 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

241 ià(
p_tmr
->
Ty³
 !ð
OS_OBJ_TYPE_TMR
) {

242 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

243  (
DEF_FALSE
);

247 
	`OSSchedLock
(&
”r
);

248 #ià
OS_CFG_DBG_EN
 > 0u

249 
	`OS_TmrDbgLi¡Remove
(
p_tmr
);

251 
OSTmrQty
--;

253 
p_tmr
->
S‹
) {

254 
OS_TMR_STATE_RUNNING
:

255 
	`OS_TmrUÆšk
(
p_tmr
);

256 
	`OS_TmrCÌ
(
p_tmr
);

257 
	`OSSchedUÆock
(&
”r
);

258 *
p_”r
 = 
OS_ERR_NONE
;

259  (
DEF_TRUE
);

261 
OS_TMR_STATE_STOPPED
:

262 
OS_TMR_STATE_COMPLETED
:

263 
	`OS_TmrCÌ
(
p_tmr
);

264 
	`OSSchedUÆock
(&
”r
);

265 *
p_”r
 = 
OS_ERR_NONE
;

266  (
DEF_TRUE
);

268 
OS_TMR_STATE_UNUSED
:

269 
	`OSSchedUÆock
(&
”r
);

270 *
p_”r
 = 
OS_ERR_TMR_INACTIVE
;

271  (
DEF_FALSE
);

274 
	`OSSchedUÆock
(&
”r
);

275 *
p_”r
 = 
OS_ERR_TMR_INVALID_STATE
;

276  (
DEF_FALSE
);

278 
	}
}

305 
OS_TICK
 
	$OSTmrRemašG‘
 (
OS_TMR
 *
p_tmr
,

306 
OS_ERR
 *
p_”r
)

308 
OS_TICK
 
»maš
;

309 
OS_ERR
 
”r
;

313 #ifdeà
OS_SAFETY_CRITICAL


314 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

315 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

316  ((
OS_TICK
)0);

320 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

321 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

322 *
p_”r
 = 
OS_ERR_TMR_ISR
;

323  ((
OS_TICK
)0);

327 #ià
OS_CFG_ARG_CHK_EN
 > 0u

328 ià(
p_tmr
 =ð(
OS_TMR
 *)0) {

329 *
p_”r
 = 
OS_ERR_TMR_INVALID
;

330  ((
OS_TICK
)0);

334 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

335 ià(
p_tmr
->
Ty³
 !ð
OS_OBJ_TYPE_TMR
) {

336 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

337  ((
OS_TICK
)0);

341 
	`OSSchedLock
(&
”r
);

342 
p_tmr
->
S‹
) {

343 
OS_TMR_STATE_RUNNING
:

344 
»maš
 = 
p_tmr
->
M©ch


345 - 
OSTmrTickCŒ
;

346 
p_tmr
->
Remaš
 = 
»maš
;

347 
	`OSSchedUÆock
(&
”r
);

348 *
p_”r
 = 
OS_ERR_NONE
;

349  (
»maš
);

351 
OS_TMR_STATE_STOPPED
:

352 ià(
p_tmr
->
O±
 =ð
OS_OPT_TMR_PERIODIC
) {

353 ià(
p_tmr
->
Dly
 == 0u) {

354 
»maš
 = 
p_tmr
->
P”iod
;

356 
»maš
 = 
p_tmr
->
Dly
;

359 
»maš
 = 
p_tmr
->
Dly
;

361 
p_tmr
->
Remaš
 = 
»maš
;

362 
	`OSSchedUÆock
(&
”r
);

363 *
p_”r
 = 
OS_ERR_NONE
;

364  (
»maš
);

366 
OS_TMR_STATE_COMPLETED
:

367 
	`OSSchedUÆock
(&
”r
);

368 *
p_”r
 = 
OS_ERR_NONE
;

369  ((
OS_TICK
)0);

371 
OS_TMR_STATE_UNUSED
:

372 
	`OSSchedUÆock
(&
”r
);

373 *
p_”r
 = 
OS_ERR_TMR_INACTIVE
;

374  ((
OS_TICK
)0);

377 
	`OSSchedUÆock
(&
”r
);

378 *
p_”r
 = 
OS_ERR_TMR_INVALID_STATE
;

379  ((
OS_TICK
)0);

381 
	}
}

411 
CPU_BOOLEAN
 
	$OSTmrS¹
 (
OS_TMR
 *
p_tmr
,

412 
OS_ERR
 *
p_”r
)

414 
OS_ERR
 
”r
;

418 #ifdeà
OS_SAFETY_CRITICAL


419 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

420 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

421  (
DEF_FALSE
);

425 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

426 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

427 *
p_”r
 = 
OS_ERR_TMR_ISR
;

428  (
DEF_FALSE
);

432 #ià
OS_CFG_ARG_CHK_EN
 > 0u

433 ià(
p_tmr
 =ð(
OS_TMR
 *)0) {

434 *
p_”r
 = 
OS_ERR_TMR_INVALID
;

435  (
DEF_FALSE
);

439 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

440 ià(
p_tmr
->
Ty³
 !ð
OS_OBJ_TYPE_TMR
) {

441 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

442  (
DEF_FALSE
);

446 
	`OSSchedLock
(&
”r
);

447 
p_tmr
->
S‹
) {

448 
OS_TMR_STATE_RUNNING
:

449 
	`OS_TmrUÆšk
(
p_tmr
);

450 
	`OS_TmrLšk
(
p_tmr
, 
OS_OPT_LINK_DLY
);

451 
	`OSSchedUÆock
(&
”r
);

452 *
p_”r
 = 
OS_ERR_NONE
;

453  (
DEF_TRUE
);

455 
OS_TMR_STATE_STOPPED
:

456 
OS_TMR_STATE_COMPLETED
:

457 
	`OS_TmrLšk
(
p_tmr
, 
OS_OPT_LINK_DLY
);

458 
	`OSSchedUÆock
(&
”r
);

459 *
p_”r
 = 
OS_ERR_NONE
;

460  (
DEF_TRUE
);

462 
OS_TMR_STATE_UNUSED
:

463 
	`OSSchedUÆock
(&
”r
);

464 *
p_”r
 = 
OS_ERR_TMR_INACTIVE
;

465  (
DEF_FALSE
);

468 
	`OSSchedUÆock
(&
”r
);

469 *
p_”r
 = 
OS_ERR_TMR_INVALID_STATE
;

470  (
DEF_FALSE
);

472 
	}
}

500 
OS_STATE
 
	$OSTmrS‹G‘
 (
OS_TMR
 *
p_tmr
,

501 
OS_ERR
 *
p_”r
)

503 
OS_STATE
 
¡©e
;

504 
	`CPU_SR_ALLOC
();

508 #ifdeà
OS_SAFETY_CRITICAL


509 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

510 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

511  (
OS_TMR_STATE_UNUSED
);

515 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

516 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

517 *
p_”r
 = 
OS_ERR_TMR_ISR
;

518  (
OS_TMR_STATE_UNUSED
);

522 #ià
OS_CFG_ARG_CHK_EN
 > 0u

523 ià(
p_tmr
 =ð(
OS_TMR
 *)0) {

524 *
p_”r
 = 
OS_ERR_TMR_INVALID
;

525  (
OS_TMR_STATE_UNUSED
);

529 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

530 ià(
p_tmr
->
Ty³
 !ð
OS_OBJ_TYPE_TMR
) {

531 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

532  (
OS_TMR_STATE_UNUSED
);

536 
	`CPU_CRITICAL_ENTER
();

537 
¡©e
 = 
p_tmr
->
S‹
;

538 
¡©e
) {

539 
OS_TMR_STATE_UNUSED
:

540 
OS_TMR_STATE_STOPPED
:

541 
OS_TMR_STATE_COMPLETED
:

542 
OS_TMR_STATE_RUNNING
:

543 *
p_”r
 = 
OS_ERR_NONE
;

547 *
p_”r
 = 
OS_ERR_TMR_INVALID_STATE
;

550 
	`CPU_CRITICAL_EXIT
();

551  (
¡©e
);

552 
	}
}

591 
CPU_BOOLEAN
 
	$OSTmrStÝ
 (
OS_TMR
 *
p_tmr
,

592 
OS_OPT
 
Ýt
,

593 *
p_ÿÎback_¬g
,

594 
OS_ERR
 *
p_”r
)

596 
OS_TMR_CALLBACK_PTR
 
p_âù
;

597 
OS_ERR
 
”r
;

601 #ifdeà
OS_SAFETY_CRITICAL


602 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

603 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

604  (
DEF_FALSE
);

608 #ià
OS_CFG_CALLED_FROM_ISR_CHK_EN
 > 0u

609 ià(
OSIÁNe¡šgCŒ
 > (
OS_NESTING_CTR
)0) {

610 *
p_”r
 = 
OS_ERR_TMR_ISR
;

611  (
DEF_FALSE
);

615 #ià
OS_CFG_ARG_CHK_EN
 > 0u

616 ià(
p_tmr
 =ð(
OS_TMR
 *)0) {

617 *
p_”r
 = 
OS_ERR_TMR_INVALID
;

618  (
DEF_FALSE
);

622 #ià
OS_CFG_OBJ_TYPE_CHK_EN
 > 0u

623 ià(
p_tmr
->
Ty³
 !ð
OS_OBJ_TYPE_TMR
) {

624 *
p_”r
 = 
OS_ERR_OBJ_TYPE
;

625  (
DEF_FALSE
);

629 
	`OSSchedLock
(&
”r
);

630 
p_tmr
->
S‹
) {

631 
OS_TMR_STATE_RUNNING
:

632 
	`OS_TmrUÆšk
(
p_tmr
);

633 *
p_”r
 = 
OS_ERR_NONE
;

634 
Ýt
) {

635 
OS_OPT_TMR_CALLBACK
:

636 
p_âù
 = 
p_tmr
->
C®lbackPŒ
;

637 ià(
p_âù
 !ð(
OS_TMR_CALLBACK_PTR
)0) {

638 (*
p_âù
)((*)
p_tmr
,…_tmr->
C®lbackPŒArg
);

640 *
p_”r
 = 
OS_ERR_TMR_NO_CALLBACK
;

644 
OS_OPT_TMR_CALLBACK_ARG
:

645 
p_âù
 = 
p_tmr
->
C®lbackPŒ
;

646 ià(
p_âù
 !ð(
OS_TMR_CALLBACK_PTR
)0) {

647 (*
p_âù
)((*)
p_tmr
, 
p_ÿÎback_¬g
);

649 *
p_”r
 = 
OS_ERR_TMR_NO_CALLBACK
;

653 
OS_OPT_TMR_NONE
:

657 
	`OSSchedUÆock
(&
”r
);

658 *
p_”r
 = 
OS_ERR_OPT_INVALID
;

659  (
DEF_FALSE
);

661 
	`OSSchedUÆock
(&
”r
);

662  (
DEF_TRUE
);

664 
OS_TMR_STATE_COMPLETED
:

665 
OS_TMR_STATE_STOPPED
:

666 
	`OSSchedUÆock
(&
”r
);

667 *
p_”r
 = 
OS_ERR_TMR_STOPPED
;

668  (
DEF_TRUE
);

670 
OS_TMR_STATE_UNUSED
:

671 
	`OSSchedUÆock
(&
”r
);

672 *
p_”r
 = 
OS_ERR_TMR_INACTIVE
;

673  (
DEF_FALSE
);

676 
	`OSSchedUÆock
(&
”r
);

677 *
p_”r
 = 
OS_ERR_TMR_INVALID_STATE
;

678  (
DEF_FALSE
);

680 
	}
}

698 
	$OS_TmrCÌ
 (
OS_TMR
 *
p_tmr
)

700 
p_tmr
->
S‹
 = 
OS_TMR_STATE_UNUSED
;

701 
p_tmr
->
Ty³
 = 
OS_OBJ_TYPE_NONE
;

702 
p_tmr
->
NamePŒ
 = (
CPU_CHAR
 *)((*)"?TMR");

703 
p_tmr
->
Dly
 = (
OS_TICK
 )0;

704 
p_tmr
->
M©ch
 = (
OS_TICK
 )0;

705 
p_tmr
->
Remaš
 = (
OS_TICK
 )0;

706 
p_tmr
->
P”iod
 = (
OS_TICK
 )0;

707 
p_tmr
->
O±
 = (
OS_OPT
 )0;

708 
p_tmr
->
C®lbackPŒ
 = (
OS_TMR_CALLBACK_PTR
)0;

709 
p_tmr
->
C®lbackPŒArg
 = (*)0;

710 
p_tmr
->
NextPŒ
 = (
OS_TMR
 *)0;

711 
p_tmr
->
P»vPŒ
 = (
OS_TMR
 *)0;

712 
	}
}

730 #ià
OS_CFG_DBG_EN
 > 0u

731 
	$OS_TmrDbgLi¡Add
 (
OS_TMR
 *
p_tmr
)

733 
p_tmr
->
DbgP»vPŒ
 = (
OS_TMR
 *)0;

734 ià(
OSTmrDbgLi¡PŒ
 =ð(
OS_TMR
 *)0) {

735 
p_tmr
->
DbgNextPŒ
 = (
OS_TMR
 *)0;

737 
p_tmr
->
DbgNextPŒ
 = 
OSTmrDbgLi¡PŒ
;

738 
OSTmrDbgLi¡PŒ
->
DbgP»vPŒ
 = 
p_tmr
;

740 
OSTmrDbgLi¡PŒ
 = 
p_tmr
;

741 
	}
}

745 
	$OS_TmrDbgLi¡Remove
 (
OS_TMR
 *
p_tmr
)

747 
OS_TMR
 *
p_tmr_Ãxt
;

748 
OS_TMR
 *
p_tmr_´ev
;

751 
p_tmr_´ev
 = 
p_tmr
->
DbgP»vPŒ
;

752 
p_tmr_Ãxt
 = 
p_tmr
->
DbgNextPŒ
;

754 ià(
p_tmr_´ev
 =ð(
OS_TMR
 *)0) {

755 
OSTmrDbgLi¡PŒ
 = 
p_tmr_Ãxt
;

756 ià(
p_tmr_Ãxt
 !ð(
OS_TMR
 *)0) {

757 
p_tmr_Ãxt
->
DbgP»vPŒ
 = (
OS_TMR
 *)0;

759 
p_tmr
->
DbgNextPŒ
 = (
OS_TMR
 *)0;

761 } ià(
p_tmr_Ãxt
 =ð(
OS_TMR
 *)0) {

762 
p_tmr_´ev
->
DbgNextPŒ
 = (
OS_TMR
 *)0;

763 
p_tmr
->
DbgP»vPŒ
 = (
OS_TMR
 *)0;

766 
p_tmr_´ev
->
DbgNextPŒ
 = 
p_tmr_Ãxt
;

767 
p_tmr_Ãxt
->
DbgP»vPŒ
 = 
p_tmr_´ev
;

768 
p_tmr
->
DbgNextPŒ
 = (
OS_TMR
 *)0;

769 
p_tmr
->
DbgP»vPŒ
 = (
OS_TMR
 *)0;

771 
	}
}

795 
	$OS_TmrIn™
 (
OS_ERR
 *
p_”r
)

797 
OS_TMR_SPOKE_IX
 
i
;

798 
OS_TMR_SPOKE
 *
p_¥oke
;

802 #ifdeà
OS_SAFETY_CRITICAL


803 ià(
p_”r
 =ð(
OS_ERR
 *)0) {

804 
	`OS_SAFETY_CRITICAL_EXCEPTION
();

809 #ià
OS_CFG_DBG_EN
 > 0u

810 
OSTmrDbgLi¡PŒ
 = (
OS_TMR
 *)0;

813 ià(
OSCfg_TmrTaskR©e_Hz
 > (
OS_RATE_HZ
)0) {

814 
OSTmrUpd©eCÁ
 = 
OSCfg_TickR©e_Hz
 / 
OSCfg_TmrTaskR©e_Hz
;

816 
OSTmrUpd©eCÁ
 = 
OSCfg_TickR©e_Hz
 / (
OS_RATE_HZ
)10;

818 
OSTmrUpd©eCŒ
 = 
OSTmrUpd©eCÁ
;

820 
OSTmrTickCŒ
 = (
OS_TICK
)0;

822 
OSTmrTaskTimeMax
 = (
CPU_TS
)0;

824 
i
 = 0u; i < 
OSCfg_TmrWh“lSize
; i++) {

825 
p_¥oke
 = &
OSCfg_TmrWh“l
[
i
];

826 
p_¥oke
->
NbrEÁr›s
 = (
OS_OBJ_QTY
)0;

827 
p_¥oke
->
NbrEÁr›sMax
 = (
OS_OBJ_QTY
)0;

828 
p_¥oke
->
Fœ¡PŒ
 = (
OS_TMR
 *)0;

832 ià(
OSCfg_TmrTaskStkBa£PŒ
 =ð(
CPU_STK
*)0) {

833 *
p_”r
 = 
OS_ERR_TMR_STK_INVALID
;

837 ià(
OSCfg_TmrTaskStkSize
 < 
OSCfg_StkSizeMš
) {

838 *
p_”r
 = 
OS_ERR_TMR_STK_SIZE_INVALID
;

842 ià(
OSCfg_TmrTaskPrio
 >ð(
OS_CFG_PRIO_MAX
 - 1u)) {

843 *
p_”r
 = 
OS_ERR_TMR_PRIO_INVALID
;

847 
	`OSTaskC»©e
((
OS_TCB
 *)&
OSTmrTaskTCB
,

848 (
CPU_CHAR
 *)((*)"uC/OS-III Timer Task"),

849 (
OS_TASK_PTR
 )
OS_TmrTask
,

851 (
OS_PRIO
 )
OSCfg_TmrTaskPrio
,

852 (
CPU_STK
 *)
OSCfg_TmrTaskStkBa£PŒ
,

853 (
CPU_STK_SIZE
)
OSCfg_TmrTaskStkLim™
,

854 (
CPU_STK_SIZE
)
OSCfg_TmrTaskStkSize
,

855 (
OS_MSG_QTY
 )0,

856 (
OS_TICK
 )0,

858 (
OS_OPT
 )(
OS_OPT_TASK_STK_CHK
 | 
OS_OPT_TASK_STK_CLR
 | 
OS_OPT_TASK_NO_TLS
),

859 (
OS_ERR
 *)
p_”r
);

860 
	}
}

884 
	$OS_TmrLšk
 (
OS_TMR
 *
p_tmr
,

885 
OS_OPT
 
Ýt
)

887 
OS_TMR_SPOKE
 *
p_¥oke
;

888 
OS_TMR
 *
p_tmr0
;

889 
OS_TMR
 *
p_tmr1
;

890 
OS_TMR_SPOKE_IX
 
¥oke
;

894 
p_tmr
->
S‹
 = 
OS_TMR_STATE_RUNNING
;

895 ià(
Ýt
 =ð
OS_OPT_LINK_PERIODIC
) {

896 
p_tmr
->
M©ch
 =…_tmr->
P”iod
 + 
OSTmrTickCŒ
;

898 ià(
p_tmr
->
Dly
 =ð(
OS_TICK
)0) {

899 
p_tmr
->
M©ch
 =…_tmr->
P”iod
 + 
OSTmrTickCŒ
;

901 
p_tmr
->
M©ch
 =…_tmr->
Dly
 + 
OSTmrTickCŒ
;

904 
¥oke
 = (
OS_TMR_SPOKE_IX
)(
p_tmr
->
M©ch
 % 
OSCfg_TmrWh“lSize
);

905 
p_¥oke
 = &
OSCfg_TmrWh“l
[
¥oke
];

907 ià(
p_¥oke
->
Fœ¡PŒ
 =ð(
OS_TMR
 *)0) {

908 
p_tmr
->
NextPŒ
 = (
OS_TMR
 *)0;

909 
p_tmr
->
P»vPŒ
 = (
OS_TMR
 *)0;

910 
p_¥oke
->
Fœ¡PŒ
 = 
p_tmr
;

911 
p_¥oke
->
NbrEÁr›s
 = 1u;

913 
p_tmr
->
Remaš
 =…_tmr->
M©ch


914 - 
OSTmrTickCŒ
;

915 
p_tmr1
 = 
p_¥oke
->
Fœ¡PŒ
;

916 
p_tmr1
 !ð(
OS_TMR
 *)0) {

917 
p_tmr1
->
Remaš
 =…_tmr1->
M©ch


918 - 
OSTmrTickCŒ
;

919 ià(
p_tmr
->
Remaš
 > 
p_tmr1
->Remain) {

920 ià(
p_tmr1
->
NextPŒ
 !ð(
OS_TMR
 *)0) {

921 
p_tmr1
 =…_tmr1->
NextPŒ
;

923 
p_tmr
->
NextPŒ
 = (
OS_TMR
 *)0;

924 
p_tmr
->
P»vPŒ
 = 
p_tmr1
;

925 
p_tmr1
->
NextPŒ
 = 
p_tmr
;

926 
p_tmr1
 = (
OS_TMR
 *)0;

929 ià(
p_tmr1
->
P»vPŒ
 =ð(
OS_TMR
 *)0) {

930 
p_tmr
->
P»vPŒ
 = (
OS_TMR
 *)0;

931 
p_tmr
->
NextPŒ
 = 
p_tmr1
;

932 
p_tmr1
->
P»vPŒ
 = 
p_tmr
;

933 
p_¥oke
->
Fœ¡PŒ
 = 
p_tmr
;

935 
p_tmr0
 = 
p_tmr1
->
P»vPŒ
;

936 
p_tmr
->
P»vPŒ
 = 
p_tmr0
;

937 
p_tmr
->
NextPŒ
 = 
p_tmr1
;

938 
p_tmr0
->
NextPŒ
 = 
p_tmr
;

939 
p_tmr1
->
P»vPŒ
 = 
p_tmr
;

941 
p_tmr1
 = (
OS_TMR
 *)0;

944 
p_¥oke
->
NbrEÁr›s
++;

946 ià(
p_¥oke
->
NbrEÁr›sMax
 <…_¥oke->
NbrEÁr›s
) {

947 
p_¥oke
->
NbrEÁr›sMax
 =…_¥oke->
NbrEÁr›s
;

949 
	}
}

966 
	$OS_TmrRe£tP—k
 ()

968 
OS_TMR_SPOKE
 *
p_¥oke
;

969 
OS_TMR_SPOKE_IX
 
i
;

973 
i
 = 0u; i < 
OSCfg_TmrWh“lSize
; i++) {

974 
p_¥oke
 = (
OS_TMR_SPOKE
 *)&
OSCfg_TmrWh“l
[
i
];

975 
p_¥oke
->
NbrEÁr›sMax
 = (
OS_OBJ_QTY
 )0u;

977 
	}
}

995 
	$OS_TmrUÆšk
 (
OS_TMR
 *
p_tmr
)

997 
OS_TMR_SPOKE
 *
p_¥oke
;

998 
OS_TMR
 *
p_tmr1
;

999 
OS_TMR
 *
p_tmr2
;

1000 
OS_TMR_SPOKE_IX
 
¥oke
;

1004 
¥oke
 = (
OS_TMR_SPOKE_IX
)(
p_tmr
->
M©ch
 % 
OSCfg_TmrWh“lSize
);

1005 
p_¥oke
 = &
OSCfg_TmrWh“l
[
¥oke
];

1007 ià(
p_¥oke
->
Fœ¡PŒ
 =ð
p_tmr
) {

1008 
p_tmr1
 = (
OS_TMR
 *)
p_tmr
->
NextPŒ
;

1009 
p_¥oke
->
Fœ¡PŒ
 = (
OS_TMR
 *)
p_tmr1
;

1010 ià(
p_tmr1
 !ð(
OS_TMR
 *)0) {

1011 
p_tmr1
->
P»vPŒ
 = (
OS_TMR
 *)0;

1014 
p_tmr1
 = (
OS_TMR
 *)
p_tmr
->
P»vPŒ
;

1015 
p_tmr2
 = (
OS_TMR
 *)
p_tmr
->
NextPŒ
;

1016 
p_tmr1
->
NextPŒ
 = 
p_tmr2
;

1017 ià(
p_tmr2
 !ð(
OS_TMR
 *)0) {

1018 
p_tmr2
->
P»vPŒ
 = (
OS_TMR
 *)
p_tmr1
;

1021 
p_tmr
->
S‹
 = 
OS_TMR_STATE_STOPPED
;

1022 
p_tmr
->
NextPŒ
 = (
OS_TMR
 *)0;

1023 
p_tmr
->
P»vPŒ
 = (
OS_TMR
 *)0;

1024 
p_¥oke
->
NbrEÁr›s
--;

1025 
	}
}

1042 
	$OS_TmrTask
 (*
p_¬g
)

1044 
CPU_BOOLEAN
 
dÚe
;

1045 
OS_ERR
 
”r
;

1046 
OS_TMR_CALLBACK_PTR
 
p_âù
;

1047 
OS_TMR_SPOKE
 *
p_¥oke
;

1048 
OS_TMR
 *
p_tmr
;

1049 
OS_TMR
 *
p_tmr_Ãxt
;

1050 
OS_TMR_SPOKE_IX
 
¥oke
;

1051 
CPU_TS
 
ts
;

1052 
CPU_TS
 
ts_¡¬t
;

1053 
CPU_TS
 
ts_’d
;

1057 
p_¬g
 =…_arg;

1058 
DEF_ON
) {

1059 ()
	`OSTaskSemP’d
((
OS_TICK
 )0,

1060 (
OS_OPT
 )
OS_OPT_PEND_BLOCKING
,

1061 (
CPU_TS
 *)&
ts
,

1062 (
OS_ERR
 *)&
”r
);

1064 
	`OSSchedLock
(&
”r
);

1065 
ts_¡¬t
 = 
	`OS_TS_GET
();

1066 
OSTmrTickCŒ
++;

1067 
¥oke
 = (
OS_TMR_SPOKE_IX
)(
OSTmrTickCŒ
 % 
OSCfg_TmrWh“lSize
);

1068 
p_¥oke
 = &
OSCfg_TmrWh“l
[
¥oke
];

1069 
p_tmr
 = 
p_¥oke
->
Fœ¡PŒ
;

1070 
dÚe
 = 
DEF_FALSE
;

1071 
dÚe
 =ð
DEF_FALSE
) {

1072 ià(
p_tmr
 !ð(
OS_TMR
 *)0) {

1073 
p_tmr_Ãxt
 = (
OS_TMR
 *)
p_tmr
->
NextPŒ
;

1075 ià(
OSTmrTickCŒ
 =ð
p_tmr
->
M©ch
) {

1076 
	`OS_TmrUÆšk
(
p_tmr
);

1077 ià(
p_tmr
->
O±
 =ð
OS_OPT_TMR_PERIODIC
) {

1078 
	`OS_TmrLšk
(
p_tmr
,

1079 
OS_OPT_LINK_PERIODIC
);

1081 
p_tmr
->
S‹
 = 
OS_TMR_STATE_COMPLETED
;

1083 
p_âù
 = 
p_tmr
->
C®lbackPŒ
;

1084 ià(
p_âù
 !ð(
OS_TMR_CALLBACK_PTR
)0) {

1085 (*
p_âù
)((*)
p_tmr
,

1086 
p_tmr
->
C®lbackPŒArg
);

1088 
p_tmr
 = 
p_tmr_Ãxt
;

1090 
dÚe
 = 
DEF_TRUE
;

1093 
dÚe
 = 
DEF_TRUE
;

1096 
ts_’d
 = 
	`OS_TS_GET
(è- 
ts_¡¬t
;

1097 
	`OSSchedUÆock
(&
”r
);

1098 ià(
OSTmrTaskTimeMax
 < 
ts_’d
) {

1099 
OSTmrTaskTimeMax
 = 
ts_’d
;

1102 
	}
}

	@os_type.h

31 #iâdeà 
OS_TYPE_H


32 
	#OS_TYPE_H


	)

34 #ifdeà 
VSC_INCLUDE_H_FILE_NAMES


35 cÚ¡ 
CPU_CHAR
 *
	gos_ty³__h
 = "$Id: $";

48 
CPU_INT16U
 
	tOS_CPU_USAGE
;

50 
CPU_INT32U
 
	tOS_CTR
;

52 
CPU_INT32U
 
	tOS_CTX_SW_CTR
;

54 
CPU_INT32U
 
	tOS_CYCLES
;

56 
CPU_INT32U
 
	tOS_FLAGS
;

58 
CPU_INT32U
 
	tOS_IDLE_CTR
;

60 
CPU_INT16U
 
	tOS_MEM_QTY
;

61 
CPU_INT16U
 
	tOS_MEM_SIZE
;

63 
CPU_INT16U
 
	tOS_MSG_QTY
;

64 
CPU_INT16U
 
	tOS_MSG_SIZE
;

66 
CPU_INT08U
 
	tOS_NESTING_CTR
;

68 
CPU_INT16U
 
	tOS_OBJ_QTY
;

69 
CPU_INT32U
 
	tOS_OBJ_TYPE
;

71 
CPU_INT16U
 
	tOS_OPT
;

73 
CPU_INT08U
 
	tOS_PRIO
;

75 
CPU_INT16U
 
	tOS_QTY
;

77 
CPU_INT32U
 
	tOS_RATE_HZ
;

79 
CPU_INT32U
 
	tOS_REG
;

80 
CPU_INT08U
 
	tOS_REG_ID
;

82 
CPU_INT32U
 
	tOS_SEM_CTR
;

84 
CPU_INT08U
 
	tOS_STATE
;

86 
CPU_INT08U
 
	tOS_STATUS
;

88 
CPU_INT32U
 
	tOS_TICK
;

89 
CPU_INT16U
 
	tOS_TICK_SPOKE_IX
;

91 
CPU_INT16U
 
	tOS_TMR_SPOKE_IX
;

	@os_var.c

33 
	#OS_GLOBALS


	)

35 
	#MICRIUM_SOURCE


	)

36 
	~<os.h
>

38 #ifdeà
VSC_INCLUDE_SOURCE_FILE_NAMES


39 cÚ¡ 
CPU_CHAR
 *
	gos_v¬__c
 = "$Id: $";

	@
1
.
0
20
195
os.h
os_cfg_app.c
os_core.c
os_dbg.c
os_flag.c
os_int.c
os_mem.c
os_msg.c
os_mutex.c
os_pend_multi.c
os_prio.c
os_q.c
os_sem.c
os_stat.c
os_task.c
os_tick.c
os_time.c
os_tmr.c
os_type.h
os_var.c
